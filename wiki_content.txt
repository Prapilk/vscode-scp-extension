Starting with SphereServer
Setup of Sphere
Where to get Sphere
Installing Sphere
Configuring Sphere.ini
Sphere 101
Chapter 1
(Numbers, DEFNAME, ITEMDEF, CHARDEF)
Chapter 2
(Sphere files explained)
Chapter 3
(Scripting NPC's and items, Cool commands)
Chapter 4
(Objects, operators, speech)
Chapter 5
(Tags, Vars, Locals, Functions)
Chapter 6
(LINKs, TIMERs, TARGETs)
Chapter 7
(Loops and powerful functions)
Chapter 8
(SKILLMENUs, MENUs, Gumps)
Chapter 9
(Events)
Chapter 10
(String Handling)
Extra Tutorials
Common Mistakes Explained
(A revision of Maximus's tutorial on the forums, and continuation of Taran's Misconceptions tutorial)
Internet and Sphere
(And how to make the right use of them)
Languages Tutorial
(How to script your own language system)
Making your own Skills
(How to make and customize your skill)
Nazghul's Mul Patching Tutorial
external link
(A document about mul patching and customizing your server)
Overriding Hardcoded Commands
(How to override hardcoded commands and functions)
Scheduled Reboot
(How to schedule system reboots)
Using MySQL
(How to use MySQL)
Bitwise Operations
(How to work with FLAGS/ATTR)
Script Debugging
(How to fix your scripts)
IMPORTANT LINKS
SphereServer Official Github
Download Nightly Builds
(Plus! Extra downloads, like tools and scripts!)
SphereX Changelog
|
56d Changelog
|
Older Changelog
Join us at Discord
(We will solve most of your doubts over there)
.
Reference Compendium
Definitions
Chardef
|
Characters
Dialogs
Events
Itemdef
|
Items
Menus
Region Resources
Region Types
Regions
Rooms
Skill Classes
Skill Menus
Skills
Spawn Groups
Spells
Types
Objects
Accounts
Characters
Database
Files
GM Pages
Items
Special Items
Map Points
Parties
Regions
Rooms
Sectors
Server
Scripts
Functions and Triggers
General Functions, Properties and References
Intrinsic Functions
Statements
Triggers
.
.
Contents
1
Useful Links
2
Sphere 3rd Party Tools
3
Other Articles
4
Credits
5
External Links
Useful Links
Modern SphereServer Nightly Downloads (Server)
https://forum.spherecommunity.net/sshare.php?srt=4
Older/Classic SphereServer downloads (Server)
https://forum.spherecommunity.net/sshare.php?srt=4&prj=7
Sphere-X Script Pack (Scripts)
https://github.com/Sphereserver/Scripts-X
Julians Script Vault (Scripts)
https://github.com/JulianUO/SphereX-ScriptsVault
List of UO Packets (Info)
https://docs.polserver.com/packets/index.php
Scripts
https://mirror.ashkantra.de/scripts/Sphere/
GM Commands (Commands)
https://wiki.spherecommunity.net/index.php?title=GM_Commands
Axis 2 Downloads (GM Tool)
https://forum.spherecommunity.net/sshare.php?srt=4&prj=1
Leviathan (GM tool)
https://github.com/cbnolok/Leviathan/releases
Ultima Online Downloads (Clients)
https://mega.nz/folder/6uYxnIpY#tahGzzz_yOkLgNM1c_DxdQ
Client 7.0.20
https://mirror.ashkantra.de/fullclients/
ClassicUO (Third Party Client)
https://www.classicuo.eu/
OrionUO (Third Party Client)
http://orionuo.online/
CentrED (Worldbuilding)
https://uo.wzk.cz/centred/
UO-Pixel (Graphics)
http://www.uo-pixel.de/
UO Fiddler ( MUL Viewer)
http://uofiddler.polserver.com/
UO Grafiken by Nyray (Graphics)
https://nyray.wordpress.com/
Vestimisu (Graphics)
http://vestimisu.blogspot.com/
Ultima Online Graphics By Rubra (Graphcs)
http://uographicsrubra.blogspot.com/
Isis‘ UO Grafiken (Graphics)
https://isispixel.wordpress.com/
ServUO (Graphics)
https://www.servuo.com/archive/categories/assets.13/
UOGateway (Shard Listing)
https://uogateway.com/
Sphere 3rd Party Tools
Axis II
- GM Tool for Sphere that will allow you to place objects in-game, spawns, traveling and many other useful functions for shard admins and GMs.
vSCP
- vSCP is the most complete and up-to-date syntax editor for sphere scripting. It does contain syntax highlighting, autocomplete, folding markers to specify blocks of code that can expand or collapse, bookmarks, autoindent, find/replace/gotoline, help guide for all the sphere elements added to your code, and more!
vServerLauncher
- Install and run the latest build of sphereserver in a few clicks with vServerLauncher. It's pretty quick and simple!
SphereService
- Relaunch SphereSvr.exe everytime it closes/crashes. Automatically runs at windows startup and works in a silent mode minimized to Tray.
vCrypter
- Type the client version and the tool will calculate the correct UO login keys for classic or enhanced clients.
Other Articles
Armor Calculation
Client Changes
Common Scripting Misconceptions
Custom Object Properties
Error Codes
Experience System
How Combat Works
Occam's Razor
Optimization Theory
Override TAGs
Revisions Changelog
Sendpacket
Skill Gain Theory
The Process of Scripting
Building Component Reference
Credits
Special thanks to:
XuN, Nolok, Ben, and Drk
, for their hard work on the X branch taking Sphere into the next decade.
Ben, Cloud_Br, Ellessar, Jdog, Lord Zerofiz, Mordaunt, Nazghul-ll, RanXerox, Rattlehead, Sandman, Sharlenwar, ShiryuX, thelegbra, Maximus, WarAngel and Valios
, for helping to add content.
Daleth
, for writing the Sphere Reference Project, and
Mordaunt
for converting it to .chm format.
Tracker
, for writing the Sphere 56 Tracking Changes in Sphereserver.net
Taran
, for writing the original and now famous Sphere Scripting for Dummies tutorials, and
MrSugarCube
for bringing it up-to-date directly from source.
Ben, Khaos, Ranxerox, Shiryux, Furio, Radiant, Vjaka, Nazghul-ll, Ellessar, Torfo, Shadow Dragon, MrSugarCube and coruja747
for continuing to develop Sphere into a powerful and very customizable Ultima Online emulator.
Crius
, for providing hosting for the original SphereWiki, and
Torfo
for providing the current hosting.
External Links
Useful Links
(An ongoing list of useful links for community members)
Official SphereServer Website
Nightly builds
Nightly builds - OUTDATED, use the link above
Sphere Community Pack 2.0
Jerrith's UO Packet Guide
Wyatt&Kons's UOKR Packet Guide

--- PAGE BREAK ---

Help
Available languages
Missing languages
There are two different sources for downloading Sphere: Pre-Releases and Automated Builds. Below is a summary of what each is to help you choose between them.
Prerelease Builds
Prerelease builds are periodically released when the Sphere developers feel that enough progress has been made and are relatively happy with the stability of the build (i.e. the build actually runs!). Since there is not yet a "final" build of Sphere, the prereleases are the closest "Stable" thing that you can get.
Visit the
Pre-releases
website to find the latest prerelease download for Sphere. There different Version but Sphere X is the more recent, more performant and the one where there some active dev.
This build is more than likely the one you want to download.
If you are unsure, then review the
Which Do I Want?
section for more information.
Automated Builds
on every modification an automated process will compile a new Sphere executable directly from the latest development code. If you want the latest cutting edge features that aren't available in the latest prerelease then you may want to consider using an automated build.
Visit the
SphereServer Nightly Automated Builds
website to download all latest automated build for Sphere.
Before you rush over and download an automated build, take care of the following warnings:
Since these builds are compiled directly from the latest development source code, it is not recommended that you use these at all on a live server unless you know exactly what you are doing and have performed thorough tests first!
The Sphere development team will not provide any support for using these builds. If you encounter a problem then you will be completely on your own.
Which Do I Want?
If you're unsure of which to use the best option is to simply use the latest prerelease. Automated builds are only intended to be used by advanced users or testers, who may want to test some of the newer features before they are released.
Here is a brief comparison of the two build types:
Prerelease Builds
Automated Builds
Support available in
[1]
Discord or the Forum
No support available at all
Increased chance of stability
Decreased chance of stability
Compiled manually from a more stable code branch
Compiled automatically from the development code branch
Does not contain the very latest features and bugfixes
Contains the very latest features and bugfixes
Released periodically (sometimes months apart)
Released daily
To summarise, the prerelease builds are supported and specifically released by the Sphere development team at appropriate times when it is felt that enough development work has been made for a new release to be worthwhile. Unless you urgently need an as-of-yet unreleased feature or bugfix there should be no reason for you, as an end-user, to want to download an automated build.
Note:
If your only reason for choosing to use an automated Sphere build is that you don't want to wait for an official prerelease containing a new feature or bugfix then you should reconsider this decision. Whilst you may enjoy having the feature or bugfix in question, there is also an increased chance that some of the work has not been completed, or a new bug may have been introduced, which could consequently destabalise your server!

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Windows
2
Linux
2.1
Preface
2.2
Preparations
2.3
Installation Step-By-Step
2.4
Test the Installation
2.5
Preparing for production
3
FreeBSD
Windows
Start by downloading Sphere. See the
Where to get Sphere
page for download links. You should end up with two different zip files, one containing the Sphere executable and the other containing the
Script Pack
.
Extract the SphereServer.zip file to wherever you want to run it from. I would recommend "c:\sphere"
Extract Scripts.zip to the directory where you previously extracted the file in the previous step. Now you should have the directory scripts in "c:\sphere".
Create three new folders, one named "accounts", another called "logs", and the third one called "save".
Now, go to your "save" folder, recently created. And create an empty text file (I recommend using the Start Menu to access Notepad instead of "Right Click => New"). Write an empty line and add "[EOF]" in the second one. Save the file as "spheredata.SCP" (not .txt).
Copy this file four times an rename them as: spherestatics, spherechars.scp, spheremultis.scp and sphereworld.scp
Now,
configure your sphere.ini
. This is a must before running Sphere for the first time!
Double Click on SphereSvr.exe to launch the Console. This black window is your server console from which you can enter commands.
Create an Account for yourself. In the console, type in "
account add USERNAME PASSWORD
". With whatever username and password you want. Then, type in "
account USERNAME plevel 7
" to grant your account Owner privileges.
Now you can go around your map and explore some parts of it. You can use the navigation bar on the left to read various tutorials to learn how to script and learn something about Sphere. After that, read the other articles and check the
reference compendium
if you need something special.
Linux
Preface
Installing Sphere on a Linux box is not more difficult as doing this task on a Windows PC. Either way you will have to have basic knowledge about your operation system, and you should not rely on that you simply have to doubleclick like mad to get the beast up and running.
Even more, this tutorial will assume that you are using a shell on the linux box, and that you have root access. You do not trust your skills to type a command without mistakes, or no one will trust your knowledge enough to give you system administrator privileges on his Linux PC? Well, then - your busted. Go home, and play Solitaire on a neat little Windows box, ok?
Finally, this tutorial will NOT cover the ways to get the necessary files onto the Linux server. If you cannot figure this out yourself - read the last sentence of the paragraph before. THIS IS NOT A LESSON "Linux for Dummies"! Do your homework, and learn. There are many books about Linux' basics, even E-Books you can download free of charge. Surfing to
http://www.linux.org
will be a good point to start.
One last word about syntax: LINUX commands and filenames are case sensitive! So if later on a file cannot be found it usually is because you typed something like "sphere.INI" instead of "sphere.ini".
And in this document lines in italics are denoting what you have to type into (or read from) the shell.
Preparations
On the Linux box you will need a MySQL client installation. You do not need a server if you do not plan to use the database features, but Sphere will not start without the proper MySQL client libraries. Period.
You also need access to a Sphere prerelease FOR LINUX, the default script package for this version, and eventually additional libraries (libboost for recent releases).
Installation Step-By-Step
1)
As user root, create a user named 'sphere'. Set or create it's home directory (usually /home/sphere/), give it the correct owner and permissions:
useradd -d /home/sphere sphere
mkdir /home/sphere
chown sphere /home/sphere
chmod 700 /home/sphere
2)
Copy the files from the Sphere LINUX package and the scriptpack into this newly created directory. Create all missing directories like "save", "logs", "accounts" as they are named in your sphere.ini and spheretables.scp. You should end up with a structure like this:
/home/sphere --- spheresvr
               | sphere.ini
               | sphereCrypt.ini
               |-------------------- accounts/
               |-------------------- logs/
               |-------------------- muls/
               |-------------------- save/
               |-------------------- scripts/
3)
After copying all related files to their respective positions, make sure that they all have the correct permissions and ownerships. Still as root do:
cd ~sphere
chown -R sphere *
find . -type d | xargs chmod 0700
find . -type f | xargs chmod 0600
chmod 4700 spheresvr
4)
Still as root, print the shared library dependencies:
ldd spheresvr
the output should be something like this:
longbow:/home/sphere# ldd spheresvr
libpthread.so.0 => /lib/libpthread.so.0 (0x4001f000)
libmysqlclient.so.15 => /usr/lib/libmysqlclient.so.15 (0x40071000)
libboost_regex-gcc-1_33_1.so => /usr/lib/libboost_regex-gcc-1_33_1.so (0x40243000)
libstdc++.so.6 => /usr/lib/libstdc++.so.6 (0x402ea000)
libm.so.6 => /lib/libm.so.6 (0x403c9000)
libgcc_s.so.1 => /lib/libgcc_s.so.1 (0x403ef000)
libc.so.6 => /lib/libc.so.6 (0x403fa000)
/lib/ld-linux.so.2 (0x40000000)
libcrypt.so.1 => /lib/libcrypt.so.1 (0x4051c000)
libnsl.so.1 => /lib/libnsl.so.1 (0x4054a000)
libz.so.1 => /usr/lib/libz.so.1 (0x40561000)
LOOK FOR MISSING LIBRARIES!
If something is missing, just install it. You should know how to do. If it's just libboost what is missing, you have got this with the preparations. Copy it into /usr/lib/ and type:
ldconfig
Test the Installation
It does matter if you start your test as user
root
or user
sphere
... But setting the permissions of the spheresvr executable to 4700 forces it to always be started as it's owner, and if you followed the earlier instuctions, that owner is
sphere
. So start it like this:
cd ~sphere
./spheresvr
You will get the usual startup yaddayadda, perhaps including some warnings such as:
longbow:/home/sphere# ./spheresvr
WARNING:(sphere.ini,587)'scripts/spherestatusbase.html' not found...
ERROR:(sphere.ini,587)Can't open web page input 'spherestatusbase1.htm'
Sphere Version 0.56b [Linux] by www.sphereserver.com, compiled at Sep 15 2006 (23:23:07)
Signal handlers installed.
Expansion maps supported: T2A, LBR, AOS, SE, ML
ERROR:(spheretables.scp,59)Unable to open directory scripts/custom/
ERROR:(spheretables.scp,59)DirList=-1 for 'scripts/custom/'
Allocating map sectors: 0=7168 1=7168 2=900 3=1280 4=32761
Indexing 211 scripts...
Loading scripts/sphere_defs.scp
[...]
Finally your Sphere will tell you something like:
[...]
Loading save/spheredata...
Loading save/spherestatics...
Loading save/sphereworld...
Loading save/spherechars...
166 Objects accounted for
Option flags: CommandSysmsgs + NoHouseMuteSpeech
Experimental flags: DiagonalWalkCheck + ScriptsReturnStrings + NewTriggersEnable + NewPositionChecks + WalkCheck + ScriptProfiler + SizeOptimize
Admin=me@my.email.com, URL=www.myshard.com, Lang=English, TZ=0
Startup complete. items=0, chars=0
Creating thread.
You can safely ignore script warnings and errors regarding missing web pages. But if the sphere issues other errors, or terminates, dont just stare at the error number like the rabbit stares at the snake: The text immediately above the error will tell you what's wrong. So fix it.  For example, after starting the server, if you see errors like:
16:55:FATAL:Segmentation fault 16:55:FATAL:Error Pri=1, Code=11, Desc='Segmentation fault', in CChar::CanMoveWalkTo() #1 "Check Valid Move"
...the filesystem ACLs may be wrong, specifically the ACLs on the UO mul and uop files in the UO client directory.  There are numerous solutions, but one way to fix this is to change the permissions on these files to 644.
But I digress.... Assuming no catestrophic failures, you are now in the sphere console and can issue the common commands (type '?' to get a list). So create an account, activate it, edit the login.cfg (or host details) on your windows box with the client installation to point to the address of the Linux box, and be the first to log in.
To stop the Sphere, type 'S' in the console, then 'x'. Linux will tell you something about deinstalling handlers and shutting down. But often it will just "hang" after this, not really terminating. Clear this situation by typing CTRL-c
Preparing for production
Perhaps you closed your shell during the test. Then you should have noticed that the operating system killed your Sphere at the same moment. That's not a bug but wanted behaviour: Linux is a multi user os, and when a user logs out processes started by him shall not accidentally kept running.
But of course you will not be able to keep open the console all the time, at least if your Linux box can only be reached remotely, perhaps by ssh. If it's the main service running on the box, you should create a startup script what starts spheresvr in an endless loop, thus restarting it in the event it should crash. To do this, first install the 'screen' utility using the packet manager of your distribution. Then use the text editor of your choice and create a script like this:
#!/bin/sh
cd ~sphere
while true; do
screen -D -m /home/sphere/spheresvr
sleep 30
done
This way the server will be run in a virtual window to what you always can attach with 'screen -r'. Read the manpage for screen for more information.
Then take it to the next level!  Perhaps create an /etc/init.d/sphereserver script to start, stop, or restart the server... then softlink that script in the various /etc/rc*.d/ directories so that the sphere server automatically starts when the linux server is rebooted... maybe setup a cron job to automatically rotate and archive the log files that sphere creates.
FreeBSD
We currently have no guide for this OS. Anyway, the developers have posted a list of required stuff. Here is the list:
Compiled on:
FreeBSD freebsdvbox.fastwebnet.it 7.0-RELEASE FreeBSD 7.0-RELEASE #0: Sun Feb 24 19:59:52 UTC 2008     root@logan.cse.buffalo.edu:/usr/obj/usr/src/sys/GENERIC  i386
With:
Using built-in specs.
Target: i386-portbld-freebsd7.0
Configured with: ./..//gcc-4.1-20071105/configure --disable-nls --with-system-zlib --with-libiconv-prefix=/usr/local --program-suffix=41 --libdir=/usr/local/lib/gcc-4.1.3 --with-gxx-include-dir=/usr/local/lib/gcc-4.1.3/include/c++/ --disable-rpath --prefix=/usr/local --mandir=/usr/local/man --infodir=/usr/local/info/gcc41 i386-portbld-freebsd7.0
Thread model: posix
gcc version 4.1.3 20071105 (prerelease)
Linked Against:
libthr.so.3 => /lib/libthr.so.3 (0x281f3000)
libmysqlclient.so.15 => /usr/local/lib/mysql/libmysqlclient.so.15 (0x28206000)
libstdc++.so.6 => /usr/lib/libstdc++.so.6 (0x28265000)
libm.so.5 => /lib/libm.so.5 (0x2835a000)
libgcc_s.so.1 => /lib/libgcc_s.so.1 (0x2836f000)
libc.so.7 => /lib/libc.so.7 (0x2837a000)
libcrypt.so.4 => /lib/libcrypt.so.4 (0x28476000)
libz.so.4 => /lib/libz.so.4 (0x2848f000)
If you use this release, please check
this topic
.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Sphere.ini contains all of the internal options for the Sphere emulator. In order to configure your shard, this is the file you will start with. The file itself is pretty self-explanatory, but in order to avoid common mistakes, we're going to add more explanatory comments throughout the file. Comments and additions/changes will be in
bold blue text
.
Remember to uncomment every line you're gonna use. Example:
If you want to use additional map2, this:
// MAP2=2304,1600,32,2
Should be this:
MAP2=2304,1600,32,2
And so on, with every setting you want to use (MySQL, AutoResdisp, etc).
Let's check the sphere.ini file!
//****************************************************************************
// SPHERE by : Menasoft 1997-2003
// www.sphereserver.com
// All SPHERE script files and formats are copyright Menasoft & Partners.
// This file may be freely edited for personal use, but may not be distributed
// in whole or in part, in any format without express written permission from
// Menasoft & Partners.  All donations and contributions
// become the property of Menasoft & Partners.
//****************************************************************************

///////////////////////////////////////////////////////////////
//////// General Information
///////////////////////////////////////////////////////////////

[SPHERE]
// Name of your Sphere shard
ServName=MyShard
// The IP of your server, this will be 127.0.0.1 almost always
ServIP=127.0.0.1
// The port of your server, this is 2593 by default
ServPort=2593

// Admin's contact email
AdminEmail=me@my.email.com
// Web page for this server
URL=www.myshard.com
// GMT offset, from -12 to +12 [London=0, EST=5, etc]
TimeZone=0

// Official staff language
Lang=English
// Start this as a system service on Win2000, XP, NT
// Enabling this also removes the ability to use the console
NTService=0

// MySql configuration.
// If you want to enable MYSQL, set 1
//MYSQL=0
// This is where the MySQL host is located, localhost if it's on the same machine
//MySqlHost=
// The username for the desired database
//MySqlUser=
// The password for the user
//MySqlPassword=
// The name of the database. This is _NOT_ the host, you must set the name of the DB
//MySqlDatabase=

///////////////////////////////////////////////////////////////
//////// File Locations
///////////////////////////////////////////////////////////////
// Directory where spheretables.scp is located, from there we will
// load any additional scripts
// This can be used to load the same script pack,
// using a different .exe for testing.
ScpFiles=scripts/

// Where your sphereworld.scp and spherechars.scp are located
WorldSave=save/

// Where your sphereaccu.scp and sphereacct.scp is located
AcctFiles=accounts/

// Where your UO installation is located. This need: map0.mul, statics0.mul,
//  staidx0.mul, multi.mul, multi.idx, hues.mul, tiledata.mul.
// Optional files: verdata.mul, mapX.mul/staticsX.mul/staidxX.mul for higher
//  maps support (Malas, etc).
//
// Note that if not set, sphere will scan windows registry to auto-detect it
//MulFiles=mul/

// Where your log files will be saved by sphere
Log=logs/

// To activate ML-sized map #0 uncomment the next line (don't forget to uncomment
// sphere_map0_ml.scp and sphere_map_points0_ml.scp in spheretables.scp if you want
// to use the default areas)
//Map0=7168,4096,-1,-1

// To activate ML-sized map #1 uncomment the next line
//Map1=7168,4096,-1,-1

// To enable the use of MapDif*.mul and StaDif*.mul files, set this to 1.
// Some kind of map patches, used for Map0 and Map1, for example.
// The island Occlo (Map0) is Haven in Map1. This option handles that.
// More recent client versions no longer use map patches, since a separate MAP1.MUL file was
// added to the UO installation.
UseMapDiffs=0

///////////////////////////////////////////////////////////////
//////// World Save Information
///////////////////////////////////////////////////////////////
// How often for Sphere to save your world (minutes)
SavePeriod=20

// How many backup levels to keep. Each level means 7 backups done for it.
// So, 10*7 = 70 backup saves will be storied.
BackupLevels=10

// On would save in the background quietly over a longer period of time, and not interrupt the game
// Off would notify "World save has been initiated" and save faster, but pause the game momentarily
SaveBackground=0

///////////////////////////////////////////////////////////////
//////// Account Management
///////////////////////////////////////////////////////////////
//Code for servers account application process
//  0=Closed,       // Closed. Not accepting more.
//  2=Free,         // Anyone can just log in and create a full account.
//  3=GuestAuto,    // You get to be a guest and are automatically sent email with u're new password.
//  4=GuestTrial,   // You get to be a guest til u're accepted for full by an Admin.
//  6=Unspecified,  // Not specified.
// To enable auto account you must set this to 2
AccApp=0

// Store password hashed with MD5
// MD5 is a safer way to store passwords.
More Information
Md5Passwords=0

// local ip is assumed to be the admin
LocalIPAdmin=1

// Default number of chars allowed per account (maximum value is 7)
MaxCharsPerAccount=5

// Min time for a char to exist before delete allowed (in seconds)
MinCharDeleteTime=3*24*60

// Max number of Guest accounts allowed
GuestsMax=0

// Max login tries for account before a temporary ban (0 is disabled)
// Like on some paid forums, this is useful.
MaxAccountLoginTries=0

///////////////////////////////////////////////////////////////
//////// Client Management
///////////////////////////////////////////////////////////////
// What client protocol version used
// Comment out the ClientVersion line to allow any client that is supported.
//ClientVersion=2.0.3

// Set this to 0 to allow login to encrypted clients
// The official clients use encryption.
UseCrypt=1

// Set this to 1 to allow login to unencrypted clients
// You can use tools such as
UO Rice
and
UOGateway
to remove encryption on a client.
UseNoCrypt=0

// Maximum total open connections to server
ClientMax=256

// Maximum open connections to server per IP
ClientMaxIP=16

// Maximum total (not-in-game) connections to server
ConnectingMax=32

// Maximum total simultaneous (not-in-game) connections to server per IP
ConnectingMaxIp=8

// How long logged out clients linger in seconds
ClientLinger=15

// Walk limiting code: buffer size (in tenths of second)
WalkBuffer=75

// Walk limiting code: regen speed (%)
WalkRegen=25

// Only commands issued by this plevel and higher will be logged
// With zero it will log EVERY command used.
CommandLog=0

// Prefix for ingame commands
CommandPrefix=.

// Function to call if client is executing a command to override the default.
//CommandTrigger=f_oncommand

// Use the built in http server
// 0 - disable http server and webpage generation
// 1 - disable http server and enable webpage generation
// 2 - enable http server and webpage generation (default)
UseHttp=2

// Use the OSI AuthID to avoid possible hijack to game server.
UseAuthID=0

// Default setting for all accounts specifying default resdisp.
// 0=Pre-T2A, 1=T2A, 2=LBR, 3=AoS, 4=SE, 5=ML
//AutoResDisp=1

// Default setting for new accounts specifying default priv level
//AutoPrivFlags=010

// Max tooltip (if enabled) to send on each tick (to avoid client flooding)
//MaxTooltipForTick=7

// How often send my hits updates to visible clients (in seconds)
//HitsUpdateRate=1

///////////////////////////////////////////////////////////////
//////// Game Mechanics
///////////////////////////////////////////////////////////////

// Maximum distance to hear char whispering
//DistanceWhisper=3

// Maximum distance to hear char talking
//DistanceTalk=18

// Maximum distance to hear char yelling
//DistanceYell=31

// Do not allow entering under roof being on horse?
MountHeight=0

// Archery does not work if too close (0 = not checked)
ArcheryMinDist=2

// Maximum Distance for Archery
ArcheryMaxDist=15

// Speed scale factor for weapons
// The formula is DELAY = SPEEDSCALEFACTOR / ((DEX + 100) * SPEED)
SpeedScaleFactor=15000

// This is the percent of max weight at which stamina is lost half the time
// (200 = no effect)
StaminaLossAtWeight=150

// Weight penalty for running +N% of max carry weight (0 = no effect)
RunningPenalty=50

// Show people joining/leaving the server. 0 disables, 2 enables staff only.
ArriveDepartMsg=1

// Are house and boat keys newbied automatically
AutoNewbieKeys=1

// Maximum number of items allowed in bank
BankMaxItems=1000

// Maximum weight in stones allowed in bank
BankMaxWeight=1000

// If 1 vendors will take gold only from backpack
// If 0 vendors will take gold from bank and backpack
PayFromPackOnly=0

// Disable weather effects?
NoWeather=1

// Default light level in dungeons
// 0 = Bright; 3 = Dark.
DungeonLight=27

// Day light level 0-30
LightDay=0

// Night light level 0-30
LightNight=25

// Allow manual sector light override?
//AllowLightOverride=1

// Wool Regen Time (in minutes)
WoolGrowthTime=30

// Suppress player speech with 75% of capital letters
// "LETZ AVOID L337 SP33CH DEWD." Will not be displayed.
SuppressCapitals=0

// Extra combat flags to control the fight (default:0, 0.55i compatible)
// COMBAT_NODIRCHANGE              00001 // Not rotate player when fighting (like was in 0.51a)
// COMBAT_FACECOMBAT               00002 // Allow faced combat only (recommended)
// COMBAT_PREHIT                   00004 // allow prehit for close combat. first hit is instant (delay 0.1sec)
// COMBAT_USE_RESISTANCE           00008 // use character props RES* against oldfashioned damage types
// COMBAT_SPECIALDAMAGE            00010 // use character tags TAG.*DAMAGE to apply additional damage
// COMBAT_DCLICKSELF_UNMOUNTS      00020 // unmount horse when dclicking self while in warmode
// COMBAT_ALLOWHITFROMSHIP         00040 // Allow attacking opponents from ships
// COMBAT_OSIDAMAGEMOD             00080 // modify weapon damage OSI-style (taking anatomy, tactics, lumberjacking into account)
// COMBAT_ARCHERYCANMOVE           00100 // firing bow while moving
// COMBAT_STAYINRANGE              00200 // abort attack swing when out of range instead of waiting to come back in range
//
// COMBAT_STACKARMOR               01000 // If a region is covered by more than one armor part, all AR will count
// COMBAT_TARGETTEDHIT             02000 // Allows setting of preferred hit area by TAG.HITPREFERENCE
//CombatFlags=0

// Extra magic flags to control magic/magery behaviour (default:0, 0.55i compatible)
// MAGICF_NODIRCHANGE        = 0x0000001 // Not rotate player when casting/targeting
// MAGICF_PRECAST            = 0x0000002 // Precasting (cast spell before target prompt)
// MAGICF_IGNOREAR           = 0x0000004 // Magic damage ignore ar
// MAGICF_CANHARMSELF        = 0x0000008 // Magic can do damage on self
// MAGICF_STACKSTATS         = 0x0000010 // Different stat spells don't cancel each other out
// MAGICF_FREEZEONCAST       = 0x0000020 // No movement whilst casting
// MAGICF_SUMMONWALKCHECK    = 0x0000040 // Summoned creatures should be able to walk on the target location (e.g. water creatures to be summoned on water)
// MAGICF_NOFIELDSOVERWALLS  = 0x0000080 // Field spells cannot cross over blocking objects
//MagicFlags=0

// Length of time (in seconds) for a player to choose a target when casting (0 = no timeout)
SpellTimeout=0

// Zero point for sextant coordinates counting
//ZeroPoint=1323,1624,0

// How far from land i can be to take off a ship
//MaxShipPlankTeleport=18

///////////////////////////////////////////////////////////////
//////// NPC/Item/Player Management
///////////////////////////////////////////////////////////////
// Distance in tiles before an NPC that's wandered too far from it's home will teleport back
LostNPCTeleport=50

// Whether PCs get a resurrection robe when they get resurrected.
NoResRobe=0

// Time for a NPC corpse to decay mins
CorpseNPCDecay=10

// Time for a player corpse to decay mins
CorpsePlayerDecay=15

// Base decay time in minutes for items
DecayTimer=30

// Put [NPC] tags over chars
// And [TAME] if the character is tamed.
CharTags=0

// Flip dropped items
FlipDroppedItems=0

// Set to 1 to allow players to take equipment from their pets' paperdoll
CanUndressPets=1

// Monsters run when scared of death
MonsterFear=0

// Monsters may fight each other
MonsterFight=0

// Percent setting of the all NPC move rate, default 100
MoveRate=100

// Do players receive sounds
GenericSounds=1

// Max number of items to sell to one person at once
VendorMaxSell=255

// Max level npc trainers can go
// Remember that in skills: 300 = 30.0
NPCTrainMax=300

// Percent of own ability npcs can train to
NPCTrainPercent=30

// NPC will not be addressed as "Lord" or such if this is set
// To avoid double title as: Lord Lord Knight
// NPCNoFameTitle=0

// Max level of skill trainable on dummies, archery butte ecc..
// Remember that in skills: 300 = 30.0
SkillPracticeMax=300

// Max skill player's will start with on skills they haven't chosen during
// character creation
// If set to 0, players will start _only_ with their selected skills.
MaxBaseSkill=200

// If set to 0, the MaxBaseSkill will only apply to skills that the client
// can see in their menu (based on Feature* settings, ResDisp and Client
// Version). If this is set to 1 then players to start with all the skills
// that have been defined.
InitHiddenSkills=0

// Time in seconds for hitpoint regeneration
Regen0=40

// Time in seconds for mana regeneration
Regen1=20

// Time in seconds for stamina regeneration
Regen2=10

// Time in seconds for food degeneration
// 60*60*24 = 1 day of real life time
Regen3=60*60*24

// Speech block associated to players
SpeechSelf=spk_player

// Speech block associated to pets
SpeechPet=spk_pet

//Events related to all NPCs
//EventsPet=your_event

//Events related to all players
//EventsPlayer=your_event

//Events related to all regions
//EventsRegion=your_event

// When player skills/stats goes this times more than skillclass allowed, drop
// them to skillclass level. Setting this to 0 disables the action.
OverSkillMultiply=2

// NPC AI settings
// NPC_AI_PATH                  0001    NPC pathfinding
// NPC_AI_FOOD                  0002    NPC food search (objects + grass)
// NPC_AI_EXTRA                 0004    NPC magics, etc
// NPC_AI_ALWAYSINT             0008    Always be as smart as possible with pathfinding
// NPC_AI_INTFOOD               0010    NPC food search (more intelligent and trusworthy)
// NPC_AI_COMBAT                0040    Look for friends in combat
// NPC_AI_VEND_TIME             0080    vendors closing their shops at nighttime
// NPC_AI_LOOTING               0100    loot corpses an the way
// NPC_AI_MOVEOBSTACLES         0200    if moveable items block my way, try to move them
//NPCAI=0

///////////////////////////////////////////////////////////////
//////// Crime/Murder/Karma/Fame/Guard Settings
///////////////////////////////////////////////////////////////
// Karma when player goes from good to neutral (from -10000 to 10000)
PlayerNeutral=-2000

// How many minutes are criminals flagged for
CriminalTimer=3

// Times a player can snoop before becoming a criminal
SnoopCriminal=20

// Seconds time to decay a murder count (default 8*60*60 is 8 hours)
MurderDecayTime=8*60*60

// Amount of murders before we get title
MurderMinCount=1

// Looting or carving a blue player is a crime
LootingIsaCrime=1

// Flag players criminal for helping criminals?
HelpingCriminalsIsaCrime=1

// How long do guards linger about in minutes
GuardLinger=3

// Will guards kill instantly or follow normal combat rules
GuardsInstantKill=1

// Limits the MAXHITS/MAXMANA/MAXSTAM changes
// STAT_FLAG_NORMAL     0x00 // MAX* status allowed (default)
// STAT_FLAG_DENYMAX    0x01 // MAX* denied
// STAT_FLAG_DENYMAXP   0x02 //             .. for players
// STAT_FLAG_DENYMAXN   0x04 //             .. for npcs
StatsFlags=0

// Uses the new LoS algorithm
// ADVANCEDLOS_DISABLED   0x00 // Disabled, use the old method
// ADVANCEDLOS_PLAYER     0x01 // Enabled only for players
// ADVANCEDLOS_NPC        0x02 // Enabled only for NPCs
AdvancedLos=0

// Default color settings for characters (name, speech)
//ColorNotoGood=063       // blue
//ColorNotoGuildSame=044  // green (ally)
//ColorNotoCriminal=03b2  // grey (criminal)
//ColorNotoNeutral=03b2   // grey (can be attacked)
//ColorNotoEvil=026       // red
//ColorNotoGuildWar=02b   // orange (enemy guild)
//ColorNotoDefault=03b2   // grey (if not any other)

// Which notoriety flags do pets inherit from their masters? (default 0)
// Set flags to indicate which notoriety statuses a pet can inherit from its owner.
//  NotoGood      = 0x01  // blue
//  NotoGuildSame = 0x02  // green (ally)
//  NotoNeutral   = 0x04  // grey (can be attacked)
//  NotoCriminal  = 0x08  // grey (criminal)
//  NotoGuildWar  = 0x10  // orange (enemy guild)
//  NotoEvil      = 0x20  // red
// e.g. "03a" will show pets as criminal/warring/evil/allied when their master has
//      one of these statuses, regardless of the pet's true notoriety.
PetsInheritNotoriety=0

///////////////////////////////////////////////////////////////
//////// Server Mechanics
///////////////////////////////////////////////////////////////
// Experimental flags
// Flags for options that affect server behaviour and which might affect compatibility
// See the revisions.txt file for more details on this
// EF_DiagonalWalkCheck         = 00000001
// EF_UNICODE                   = 00000002 // No on Linux.
Enables UNICODE fixes
// EF_New_Triggers              = 00000008
// Adds more triggers
// EF_Intrinsic_Locals          = 00000020
// Locals can be reference differently. <LOCAL.X> can be referenced as <X>.
// EF_Item_Strict_Comparison    = 00000040
// EF_NewPositionChecks         = 00000080 // Do not set while server is running !!!
// EF_WalkCheck                 = 00000100
// Fixes house looting bugs, and other walkchecking related problems.
// EF_AllowTelnetPacketFilter   = 00000200 // Enables packet filtering for telnet connections as well
// EF_Script_Profiler           = 00000400
// EF_Size_Optimise             = 00000800
// EF_Minimize_Triggers         = 00001000 // Minimize trigger calls (use only 0.51 triggers)
// EF_DamageTools               = 00002000 // damage tools (and fire @damage on them) while mining or lumberjacking
// EF_PetSlots			= 00004000 // INCOMPLETE YET! DO NOT USE until this warning is removed!
// EF_UsePingServer             = 00008000 // Enable the experimental Ping Server (for showing pings on the server list, uses UDP port 12000)
// EF_NPCAct_Triggers           = 00010000 // Enable @NPCSpecialAction and @NPCAction triggers (mutual exclusive with EF_Minimize_Triggers)
// EF_UseNetworkMultiVersion    = 00400000 // Modify EF_UseNetworkMulti so clients prior to 4.0.0 are unaffected (try this if you find EF_UseNetworkMulti negatively affects older clients). - Do not set while server is running !!!
// EF_UseNetworkMulti           = 00800000 // Enable optimized network routines (better) - Do not set while server is running !!!
// EF_Specific                  = 01000000 // Specific behaviour, not completly tested
Experimental=00000

// Option flags
// Flags for options that affect server behaviour but not compatibility
// See the revisions.txt file for more details on this
// OF_Command_Sysmsgs           = 00000008 //Shows status of hearall, allshow, allmove... commands after toggling them
// OF_OSIMultiSight             = 00000020
// OF_Items_AutoName            = 00000040
// OF_FileCommands              = 00000080
// This enables all FILE commands, information about this command is
here
// OF_NoItemNaming              = 00000100
// If enabled, prevents Sphere from naming crafted items ("Crafted by...")
// OF_NoHouseMuteSpeech         = 00000200
// OF_Flood_Protection          = 00001000
// OF_Buffs                     = 00002000
// OF_NoPrefix                  = 00004000 // Add prefix "A" and "An" to itemnames or not
// OF_DyeType                   = 00008000 // if set allows using i_dye on all t_dye_vat instead of only i_dye_tub
// OF_DrinkIsFood               = 00010000 // type T_DRINK will increase FOOD lvl like T_FOOD
// OF_Specific                  = 01000000 // Specific behaviour, not completly tested
OptionFlags=08|0200

// FeatureT2A, used to control T2A expansion features ( default 03 )
// FEATURE_T2A_UPDATE           01 // Monster and Lost lands
// FEATURE_T2A_CHAT             02 // In game chat
FeatureT2A = 03

// FeatureLBR, used to control LBR expansion features ( default 0 )
// FEATURE_LBR_UPDATE           01 // Lbr Monsters
// FEATURE_LBR_SOUND            02 // MP3 instead of MIDI
FeatureLBR = 0

// FeatureAOS, used to control AOS expansion features ( default 0 )
// FEATURE_AOS_UPDATE_A         01 // AOS Monsters, Map
// FEATURE_AOS_UPDATE_B         02 // Tooltip, Fightbook, Necro/paladin on creation, Single/Six char selection screen, Skills, Newer spellbook support
// FEATURE_AOS_POPUP            04 // PopUp Menus
// FEATURE_AOS_DAMAGE           08
FeatureAOS = 0

// FeatureSE, used to control SE expansion features ( default 0 )
// FEATURE_SE_UPDATE            01 // Basic SE features
// FEATURE_SE_NINJASAM          02 // Ninja and Samurai
FeatureSE = 0

// FeatureML, used to control ML expansion features ( default 0 )
// FEATURE_ML_UPDATE            01 // Basic ML features
// FEATURE_ML_NINTHAGE          02 // Unlocks ninth age house designer items
FeatureML = 0

// FeatureKR, used to control KR expansion features ( default 0 ) (still not complete but usable)
// FEATURE_KR_UPDATE            01 // Basic KR features
FeatureKR = 0

// In game effects to turn on and off
// Messages echoed to the server console while in debug mode
// DEBUGF_NPC_EMOTE     = 00001
// DEBUGF_ADVANCE_STATS = 00002
// DEBUGF_WALKCODES     = 00080 // try the new walk code checking stuff
// DEBUGF_EXP           = 00200 // experience gain/loss
// DEBUGF_LEVEL         = 00400 // experience level changes
// DEBUGF_SCRIPTS       = 00800 // debug flag for scripts
// DEBUGF_LOS           = 01000 // debug flag for AdvancedLOS
// DEBUGF_WALK          = 02000 // debug flag for new walking check stuff
//DebugFlags=00

// Allow rapid Buy/Sell through Buy/Sell agent
AllowBuySellAgent=0

// Console Hears all that is said on the server
HearAll=1

// Secure mode attempts to ignore errors, protect from accidently shutdowns
Secure=1

// Value from 1 to 32, set sectors inactive when unused to conserve resources
SectorSleep=10

// Disconnect inactive socket in x min
DeadSocketTime=5

// Always force a full garbage collection on save
ForceGarbageCollect=1

// Time before restarting when server appears hung (in seconds)
FreezeRestartTime=60

// Length of the game world minute in real world in seconds
GameMinuteLength=60

// Bit Mask of the subjects you want to log when logging is on
// LOGM_ACCOUNTS        0x00080
// LOGM_SAVE            0x00200 // world save status.
// LOGM_CLIENTS_LOG     0x00400 // all clients as they log in and out.
// LOGM_GM_PAGE         0x00800 // player gm pages.
// LOGM_PLAYER_SPEAK    0x01000 // All that the players say.
// LOGM_GM_CMDS         0x02000 // Log all GM commands.
// LOGM_CHEAT           0x04000 // Probably an exploit !
// LOGM_KILLS           0x08000 // Log player combat results.
// LOGM_HTTP            0x10000
//                      0x1ffff // log everything
LogMask=01ec80

// Amount of time to keep map data cached in sec
MapCacheTime=120

// Max NPC chars for a sector to prevent lag
MaxComplexity=32

// Amount of items in one tile so start showing "too many items here"
MaxItemComplexity=25

// Amount of items in one sector to start showing "x items too complex"
MaxSectorComplexity=1024

// Limit the number of cycles the while/for loop can proceed. Setting this to
// zero disables the limitation
MaxLoopTimes=0

// Amount of minutes to call f_onserver_timer (0 disables this, default)
TimerCall=0

// Should sphere record the time it takes to do actions like treating npcs, scripts, clients and such?
// Can be viewed by right clicking the mouse on sphere screen.
Profile=0

///////////////////////////////////////////////////////////////
//////// Magic/Effects Settings
///////////////////////////////////////////////////////////////

// Allow casting while equipped
EquippedCast=1

// Words of power for player using magic
WOPPlayer=1

// Words of power for staff using magic
WOPStaff=0

// Words of power font
//WOPFont=3

// Words of power color
//WOPColor=03B2

// Reagents lost if magic fails
ReagentLossFail=0

// Magic requires reagents
ReagentsRequired=0

// What % of hitpoints players will resurrect with. Note, that if you set this
// too low, people with little STR will have problems resurrecting.
HitPointPercentOnRez=33

// How many % of hits will the character loose when starving. 0 disables
//HitsHungerLoss=0

// Amount of skill of lock picking needed to unlock a magically locked door
MagicUnlockDoor=900

// Teleport effect for GMs and players. Setting 0 disables the effect
TeleportEffectNPC=0372a
TeleportEffectPlayers=0372a
TeleportEffectStaff=03709
TeleportSoundNPC=01fe
TeleportSoundPlayers=01fe
TeleportSoundStaff=01f3

///////////////////////////////////////////////////////////////
//////// Experience and Level system
///////////////////////////////////////////////////////////////

// Enable experience system
//ExperienceSystem=0

// Experience system settings:
//  0001    gain experience in combat
//  0002    gain experience in crafts
//  0004    allow experience to go down
//  0008    limit experience decrease by a range witheen a current level
//  0010    auto-init EXP/LEVEL for NPCs if not set in @Create
//  0020    allow trigger @ExpChange
//  0040    allow trigger @ExpLevelChange
//ExperienceMode=0

// If combat experience gain is allowed, use these percents for gaining exp in
// Player versus Monster and Player versus Player combats. Value 0 disables gain.
//ExperienceKoefPVM=100
//ExperienceKoefPVP=100

// Enable levels system (as a part of experience system)
//LevelSystem=0

// Level system settings:
//  linear = 0  (each NextLevelAt exp will give a level up)
//  double = 1  (you need (NextLevelAt * (level+1)) to get a level up)
//LevelMode=1

// Amount of experience to raise to the next level
//LevelNextAt=0

///////////////////////////////////////////////////////////////
//////// external program support
///////////////////////////////////////////////////////////////

// TNG
// on Linux do sth like "/srv/www/"
// on Windows do sth. like "C:\foo\bar\"
StripPath=scripts\web\

///////////////////////////////////////////////////////////////
//////// Webpage Settings
///////////////////////////////////////////////////////////////

// Note, that you can catch error codes by creating sphere404.htm and so on
// for all HTTP error codes sphere support.

[WEBPAGE 1]
// Determines what html file is used as base for the status page
WebPageSrc=scripts/web/spherestatusbase.html
// Determines where the status page is saved
WebPageFile=scripts/web/status.html
// In seconds, how often the status file is updated
WebPageUpdate=60
// Required PLevel to view this page (0 = anyone, 6 = admins only)
PLevel=0

///////////////////////////////////////////////////////////////
//////// Abuse Control
///////////////////////////////////////////////////////////////

// Block these ips from the server
// 255 is a wildcard, so 255.255.255.255 disables anyone connecting.
[BlockIP]
//123.34.45.56
//123.45.56.78

///////////////////////////////////////////////////////////////
//////// Connection Information
///////////////////////////////////////////////////////////////

//First line should be the name of your shard (this is what people see when they connect)
//Second line should be the IP of your shard (this is almost always 127.0.0.1)
//Third line should be the port of your shard (this should be whatever ServPort is set to)
// For help configuring this section, see
Rattlehead's Single Shard Listing For Routers tutorial
//Uncomment next 3 lines below this if you have a router
//First line should be a name different than your shard name above this
//Second line should be your real/external IP (www.whatismyip.com)
//Third line should be the shard port (this should be whatever ServPort is set to)
[SERVERS]
MyShard
127.0.0.1
2593

//External
//my.ip.goes.here
//2593

[EOF]

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Numbers
2
Defnames
3
ITEMDEF
4
CHARDEF
5
TEMPLATE
6
Examples
Numbers
The first thing you'll notice while looking through SPHERE scripts is the wide variety of ways to write numbers. Since numbers are insanely important to a SPHERE scripter, this is the first lesson in the series. By the end of the lesson, I hope that you have a general understanding of hexadecimal, decimal and binary numbering systems, and SPHERE's ways of identifying each. You will also know how to generate random numbers either from a series or from a list of choices.
The first thing you need to understand is that the way we count is not the only way to count. Our numbering system contains ten digits (0, 1, 2, 3, 4, 5, 6, 7, 8, and 9). Therefore, at the tenth number, we have to add an extra column to the number, and reset the first column to zero (1, 2, 3, 4, 5, 6, 7, 8, 9, 10). That's why our numbering system works the way it does.
In the decimal system, without realizing it, we write our numbers to mean powers of ten. For example, if you take the number 17282 (which I just made up), and divide it down we get this:
Power of ten
4
3
2
1
0
Ten to that power
10000
1000
100
10
1
Digit
1
7
2
8
2
To reach the number 17282 from here, we simply take ten to the power of the number in the top row, multiply it by the number in the bottom row, and then add all those numbers together. We get 10000 + 7000 + 200 + 80 + 2. Obviously, this is simplistic, and we do it without even realizing we're doing it. You're probably thinking "Riiight, what does Taran think he's getting at?" Well, we aren't so special that our counting system is the only way to count.
Now, there is another numbering system that is used almost solely by computers. It only contains two numbers (1 and 0) and is therefore called the binary (meaning two) system. Binary numbers look like this: 101011101101, and you often see them in ads for computers and other electronic equipment (oftentimes they are shown streaming out of a CD player on television commercials). Digits in the binary system are called bits (short for BInary digiT)Binary numbers are almost impossible to translate to decimal directly, and so some math must be done.
Binary works in the same way, by adding powers of a number. In the case of binary, since there are two numbers in the whole system, that number is naturally two. Here are some examples of powers of two. These numbers might look familiar to some people.
Power of 2
Binary number
Decimal number
0
1
1
1
10
2
2
100
4
3
1000
8
4
10000
16
5
100000
32
6
1000000
64
7
10000000
128
8
100000000
256
9
1000000000
512
10
10000000000
1024
Ridiculous eh?  :)
We need a better system! The reason we get such strange results is because 10 is not a power of two. We need to find a system where the number base IS a power of two. The most commonly used system used is base-16, or hexadecimal. I'm sure if you've perused the SPHERE boards, you've seen the word hex floating around. No, this isn't a curse or evil spell, it's a short way of saying "hexadecimal".
Binary
Decimal
Hexadecimal
1
1
1
10
2
2
11
3
3
100
4
4
101
5
5
110
6
6
111
7
7
1000
8
8
1001
9
9
1010
10
A
1011
11
B
1100
12
C
1101
13
D
1110
14
E
1111
15
F
10000
16
10
See how it works? There are an extra six numbers added onto the end of the system, represented by the first six letters of the alphabet.
Now, in SPHERE scripting, you are almost NEVER going to be dealing with binary numbers that are NOT powers of two, and if you do, you can simply use any scientific calculator to figure it out. But it's a lot easier in hexadecimal.
(This is the last table, I promise!!)
Binary
Hexadecimal
000000001 (1)
01
000000010 (2)
02
000000100 (3)
04
000001000 (4)
08
000010000 (5)
010
000100000 (6)
020
001000000 (7)
040
010000000 (8)
080
100000000 (9)
0100
As you can see, there's a bit of a pattern in the hexadecimal column. You might be thinking, there seems to be some sort of pattern of the numbers 1, 2, 4 and 8. And you would be right. Another detail you may notice is the zeros in front of the hexadecimal numbers (like 0100, rather than just 100). In SPHERE, that 0 tells the script "Hey, this number is HEX!" 0100 and 100 are very different numbers.
Let's say, for a SPHERE script, you need to set the 13th bit of a number (FLAGS, for example), you could write something like this:
SRC.FLAGS |= 8192
But would you really remember that 8192 is 2 to the 13th power? I didn't think so. What would be easier is to go down through your list in your head, until you reach the 13th number. (Remember, START AT ZERO when you're counting!)
01
02
04
08
010
020
040
080
0100
0200
0400
0800
01000
02000
2^0
2^1
2^2
2^3
2^4
2^5
2^6
2^7
2^8
2^9
2^10
2^11
2^12
2^13
And there you have it. The first 14 powers of two in hexademical.
SRC.FLAGS |= 02000
The above code is identical to the previous example. 8192 (decimal) is EQUAL to 02000 (hexadecimal)
8192 = 02000
You may be saying, "How do I know he's just not making all of this up?" Well, our wonderful friends at Microsoft have provided us with a nice tool that converters from decimal to hexadecimal to binary to octal (ANOTHER numbering system that is useless in SPHERE, so we will not deal with it). It's called the Calculator. You may find it by clicking your start button, going to Programs, then Accessories. Calculator should be sitting there looking pretty. Once in the calculator program, go to the View menu, and click Scientific. You'll see the display drastically change. To convert a number between numbering systems, simply click on the original system (Dec), type a number (8192), then click on the button for the other system (Hex). Automagically, Windows will convert your decimal number to hexadecimal. Stick a zero on the front, and SPHERE will be perfectly happy with it.
This is probably the hardest thing in all of SPHERE scripting to understand. Luckily, because of the next section, you won't have to deal with scary numbers most of the time. If I still have you at the end of this lesson, I know you're going to do great!
Onward to some SPHERE scripting!
Defnames
Here's a list of scary numbers you might encounter while programming in SPHERE.
The Scary Number
What it means
0eed
ID of a gold coin
0dda
ID of a red moongate
1650,1440
Coordinates of Britain
021
The code number for red
04000
The invisible color
04000efad
An item's serial number
4
The PLEVEL of a GM
2048 (or 0800)
Flag for incognito spell
010 (or 16)
Memory type for aggressors
Obviously, no one is going to want to remember those numbers. Back in the old days, before SPHERE and TUS (pre-.50 SPHERE) and even into the mists of Grayworld (pre-.41 TUS), we all had to remember those numbers. I know all of those numbers I just said (except the serial number which I just made up), plus a couple dozen more, by heart. Luckily for those of you who don't like to sit around remembering numbers all day, SPHERE has developed a system whereby things can be identified by names instead of numbers.
Actually, the things are still identified by numbers. It's the numbers which are identified by the name.
In the game, type .add 0eed and press enter. A target will come up and you'll create a single gold piece.
Now type .add i_gold and press enter. You will create the same single gold piece.
Now which is easier to remember, 0eed or i_gold. I would say that i_gold wins by a long shot. But how does this magic happen? Let's take a look at the script definition for a piece of gold. Don't worry about understanding it. I'll explain item scripts in full in the next section! You can find this script in the file sphere_item_resources.scp.
[ITEMDEF 0eed]
//gold coin
DEFNAME=i_gold
TYPE=T_GOLD
VALUE=1
CATEGORY=Provisions - Miscellaneous
SUBSECTION=Coins
DESCRIPTION=Gold Coin
DUPELIST=0eee,0eef
I have highlighted in red the line that really matters for the purposes of this lesson. Take note of the 0eed in the top line of the script, and then ignore the rest of it. That 0eed is the real item number of this item. We'll cover item numbers more in the next section.
But the real line we want to see the
DEFNAME=i_gold
line. This is where the script tells the server, "I want item 0eed to be identified by the text i_gold from here on." If you tried to refer to i_gold before the server read this script (more on reordering scripts in
Chapter 2
, the server would spit out an error, but now it knows what that refers to, so you can use it in the game or in another script.
You should ALWAYS give items you create a DEFNAME that fits the item. Usually the defname will be defined in the [ITEMDEF] identifier itself (again, more on this later), but if you insist upon using numbers, be sure you give it an easy-to-remember name (not golden_gulash for a viking sword). It makes it easier to remember names than numbers.
A second way to define a DEFNAME is by using the [DEFNAME] tag in a script. Here is an example of that:
[DEFNAME colors]
color_blue 02
color_red 021
color_green 041
You'll find a script similar to this in spheredefs.scp, another file that should be loaded before any other file.
Here's the rundown on this script, line by line:
Line 1
: This is where the type of script and the defname (yes colors is the defname of this script) is defined. This tells the server what type of script to expect between this and the next identifier (identifiers are the lines contained in square brackets). All identifiers have this format. The first parameter is the script type. These are numerous, and I will go over them as we get to them. The second parameter is either an ID number or a defname. In most cases, in the scripts you write, it will be a defname. The only exceptions to this I can think of would be if you used a program to insert a new item into the client files.
Lines 2-4
: These set up your individual DEFNAME pieces. It says that color_blue is equal to 02, color_red is equal to 021, and color_green is equal to 041. You may have any number of spaces between the name and the value. The definitions contained in spheredefs.scp are among the most useful you will encounter, as they prevent you from writing the long scary numbers we went over in the previous section. These include things like names for flags, names for item attributes, names for the built-in MIDI or MP3 music, names for memory types, and many other things. Look through the file to see what it offers you.
That's about it for DEFNAMEs. You'll see more of these later as we cover other types of scripts.
Now go on to learn about items.
ITEMDEF
Or, how to make a mountain from a molehill, SPHERE style
Most people make item scripting much harder than it needs to be. For the purposes of this tutorial, since there is a more advanced one later, we will simply go over the basics of an ITEM script, line by line. We'll be using the gold script from the previous lesson, provided I can find it again....
Ah, here it is, conveniently color coded for your viewing pleasure!
[ITEMDEF 0eed]
//gold coin
DEFNAME=i_gold
TYPE=T_GOLD
VALUE=1
CATEGORY=Provisions - Miscellaneous
SUBSECTION=Coins
DESCRIPTION=Gold Coin
DUPELIST=0eee,0eef
This is the simplest of item scripts, since it has no additional behaviors beyond existing. I will go through this line by line, describing to you what each line does, and how it affects the end result.
Line 1
: [ITEMDEF 0eed]
The first lines of an item script are frequently the most important. Basically, this line tells the server "Hey this is an item and I want it to be called 0eed!" The server then looks through one of the client files (specifically art.idx), and identifies whether or not this item is one of the built-in items. I think all items below 04500 are defined as built-in items, so never define a new item in that range. By typing this line, you tell the server that an item script is following. You also define 0eed as a valid item, which will definitely help later on when you try to give gold to players!
Line 2
: // gold coin
This is the SPHERE version of comment. C programmers will recognize the format immediately. If you type // on any line of code, everything beyond that is ignored by the script reader. This can be on a line by itself, or at the end of a line to explain what the specific line does. In all cases, it won't affect your program, just make it easier to read.
Line 3
: DEFNAME=i_gold
You should know by now what this does! If you don't, go back and read the previous lesson! It tells the server that i_gold and 0eed mean the same thing. In item scripts, all parameters are defined in that format:
variable=value
You will see later on, when we get into scripting, how that format will help you more than you would believe. Items have a good number of variables that you can define, including:
DEFNAME
ID
TYPE
VALUE
RESOURCES
Other variables depend on the value of the TYPE. Which leads us right into...
Line 4
: TYPE=t_gold
The first thing you might say is "What the heck is t_gold?" Well it's a DEFNAME. Actually it's a number. And that number is 72. If you want to check me on this, look in spheredefs.scp, it's there! Writing TYPE=72 would have the exact same effect.
There are, currently, 183 built-in item types. These are hardcoded item types that contain predefined actions for an item. If an item has no type, when you click it, you get the "You cannot think of a way to use that item" message. There is a complete list of types, and how to set them up, here . All you need to know for now is that setting the type of this item to t_gold has no effect other than to make the item act like a gold coin (i.e. you can buy stuff with it!) Setting another item to type t_gold would probably make the server think that you can buy stuff with that item too. I've never tried this. It might be an interesting way to have unique currencies...
Line 5
: VALUE=1
This defines how much the item costs when purchased, in gold. Of course, this is one gold piece, which is worth, well, one gold piece. So the value of the item is one.
Lines 6-8
: CATEGORY, SUBSECTION, DESCRIPTION
These are lines used only by SPHERE's GM tool, Axis, which actually saves you a lot of work by typing ".add i_gold" for you. More importantly, it types ".add 01737" and things like that for you, for items that were not important enough to get their own separate DEFNAME.
Line 9
: DUPEITEM
It would be a ton of work for the SPHERE team to define all 8000 items that came with the game, especially when many of them are the same. (For an example of this, use the .xflip command on a door or sign. It cycles through all of the DUPEITEMs for that the item being flipped.) The numbers listed here are item numbers, which probably have not been defined yet. Here is the script for item 0eee:
[ITEMDEF 0eee]
//gold coins
DUPEITEM=0eed
CATEGORY=Provisions - Miscellaneous
SUBSECTION=Coins
DESCRIPTION=Gold Coins
As you can see, there is only one parameter for this whole item. It reiterates the DUPEITEM and sends the server looking to our 0eed (or i_gold) item for more information, such as TYPE and VALUE. DUPEITEM only exists to save typing. You probably won't use it.
CHARDEF
Or, what it takes to make a naked man who can stand around and say "Huh?"
NPCs... They make the world go around. They are what makes UO a unique multiplayer game. The monsters and NPCs you create make your server unique from any other. This section of chapter one will cover how to create a simple naked man who walks around and says little more than "Huh?" (or "Stop thief!" if you tell him to!).
First of all, we'll look at the script for a simple naked man. I'm pulling this out of spherechar_human.scp.
[CHARDEF 0190]
DEFNAME=c_man
Name=Man
ICON=i_pet_MAN
CAN=MT_EQUIP|MT_WALK|MT_RUN|MT_USEHANDS
RESOURCES=i_flesh_head, i_flesh_torso, i_flesh_right_arm, i_flesh_left_arm
FOODTYPE=15 t_food, t_fruit
DESIRES=i_gold,e_notoriety
AVERSIONS=t_TRAP,t_eerie_stuff
SHELTER=r_house
BLOODCOLOR=0

TSPEECH=spk_human_prime
TSPEECH=spk_human_default
TEVENTS=e_Human_HearUnk
DESCRIPTION=Man
SUBSECTION=Miscellaneous
CATEGORY=Civilized
As you can see, it doesn't look a lot different than the item scripts we examined in the previous section. There are a lot of variables set that are the same, including DEFNAME, DESCRIPTION, and the other Axis variables.
But, there are a lot of new things here that we will again go over, one line at a time! And it's longer this time! Let the good times roll! (Sorry if you're not American.. All my American clichés are probably growing irritating!)
Line 1
: [CHARDEF 0190]
Surprise surprise! It's an identifier, telling the server that we are going to be defined a character between this and the next [identifier]. And we also tell it that our character, or NPC, will have the ID 0190. The server knows that this ID is one of the built-in IDs. In fact, it's the ID of a naked man. You also know that 0190 is hexadecimal is 400 in decimal right?  :) Well why didn't you know that! Oh I'm just kidding, you don't need to know things like that.
Line 2
: DEFNAME=c_man
Nothing new here. c_man is now the same as 0190. Most character DEFNAMEs will begin with C and then an underscore (c_) like you see above.
Line 3
: Name=Man
Oh oh! Something new! Items come with default names, built in to the server. Characters don't. So we have to assign him a name. We can give him any name we want, but since this isn't a specific man, we just give him a name telling us what he is. In this case "Man".
Line 4
: ICON=i_pet_man
It took me a while to figure this one out. ICON defines what little picture you see when you're using the Tracking skill and all those little miniature creatures appear in the window. Those are actually items, all the i_pet items. To find out what the i_pet item for your creature should be, create him in the game using .addnpc, then use the .shrink command on him. The ID of the item that he becomes is your i_pet item.
Line 5
: CAN=mt_*
(In case you don't know, * means "anything" for those who use Linux.)
This is one of the most important lines of your character script, next to the ID we give him in the first line. First, because it allows us to tell the game what our NPC can do and what he can't do. There are only a few mt_* items, all of which are defined in spheredefs.scp. For the purpose of the lesson, I am going to copy them here. (The purple comments are mine.)
MT_NONMOVER        0 // We can't move at all
MT_GHOST          01 // We can walk through doors and such, like a ghost
MT_SWIM           02 // I can swim! (Water elementals, dolphins, etc)
MT_WALK           04 // I can move. Set this if you want your creature to move.
MT_FLY           010 // Moves through (supposed to be over) trees
MT_FIRE_IMMUNE   020 // Immune to damage by fire. Setting this on a player is bad.  :)
MT_EQUIP       00100 // Can equip things
MT_USEHANDS    00200 // Can use his hands to carry things (or open doors)
MT_MALE            0 // Is a male
MT_FEMALE      00800 // Is a female
MT_NONHUM      01000 // Non-human. I'm not sure what this does.
MT_RUN         02000 // Can move really fast!
According to this chart, we can see that if we don't give a creature a CAN flag, it will be an MT_MALE and an MT_NONMOVER (the two zeros). You can see from the example that by putting a | (found by pressing shift+backslash) between two CAN flags, we can give him more than one. In this case, we allow our man to equip things, walk, run, and use his hands. (An interesting fact is, even creatures that don't have hands can be set to use their hands, thus allowing them to carry light sources. Fire elementals do this. That's how they glow.)
Line 6
: RESOURCES
Resources is a very morbid name for this setting. Especially for a person. These are the items that you get whenever you chop up this creature's corpse. Scary eh?  :)
Line 7-10
: FOODTYPE, DESIRES, AVERSIONS
FOODTYPE
: Defines what kind of food the npc will eat and if NPC_AI_FOOD is on it'll make the npc look for this food + grass when he's hunger.
DESIRES
: Defines what kind of items will the npc be interested in, if NPC_AI_EXTRA is on it'll show what items the npc will loot of players corpses or walk towards when it's on the ground.
AVERSIONS
: No idea, but I think it tells the npc what sort of NPCs he'll try to fight, for example: I have a horse with e_horse as an event, and an imp without any events, if the npc has AVERSIONS=e_horse it'll prefer to fight the horse.
Line 11
: BLOODCOLOR
Ever wanted to make your players have green blood? This is where you do it! A color number or a color defname will work fine. (Try to learn the numbers for common colors, it makes it so much easier.)
The rest of it: TSPEECH and TEVENTS
We're going to cover these in sections of their own. They are probably the most complex topics in scripting! (How many times do you suppose I'm going to say that before it's actually true?)
Some other things:
On 56B we have some other fields like MOVERATE,RESLEVEL,RESDISPDNID and RESDISPDNHUE. They sound some difficult and strange thing but they aren't. Here's the explanation for them:
MOVERATE
: This setting (that can only be writed at the npc chardef) controls how fast the npc moves. The smaller the value, the faster the npc is. For example, if I have a horse chardef with default moverate (100) and another with moverate=60, the one with 60 will walk and run a lot faster than the other horse. This is great for making really difficult monsters to kill.
RESLEVEL
: This tells sphere what version of uo this monster is from, for example, a Wanderer of the Void will have RESLEVEL=3 (3=AOS) (see sphere_defs.scp for a complete list), so only accounts with RESDISP 3 or bigger can see this monster as he really is.
NOTE
: If you set a lower value for RESLEVEL, if the player doesn't have this npc anim he'll crash.
RESDISPDNID
: As you probably have seen, I used a lot of "as he really" is, exactly because of this setting, this tells the client what monster will the player see instead of the correct one. For example, this Wanderer of the Void will show as Wanderer of the Void for those who has ACCOUNT.RESDISP=3 or bigger, but for those who has smaller values it'll show as a c_spectre (if you so define).
RESDISPDNHUE
: This defines what color will the player see the monster if the RESDISPDNID id is shown to him (have an account.resdisp lower than the reslevel of this char)
Here's an example for those new settings:
[CHARDEF 310]
DEFNAME=c_Wailing_Banshee
NAME=Wailing Banshee
SOUND=snd_monster_zombie1
ICON=i_pet_wailingbanshee
DAM=11,16
RESDISPDNID=c_spectre
RESLEVEL=3
RESDISPDNHUE=01
ARMOR=20
CAN=MT_WALK|MT_FLY
DESIRES=i_gold,e_notoriety,e_horses,c_man,c_woman,t_corpse
CATEGORY=New Monsters
SUBSECTION=AOS
DESCRIPTION=Wailing Banshee

ON=@Create
    NPC = brain_monster
    FAME = {100 3000}
    KARMA = {-5000 -6999}
    STR = {126 166}
    INT = {86 115}
    DEX = {41 75}
    MAGICRESISTANCE = {75.0 95.0}
    TACTICS = {45.0 75.0}
    WRESTLING = {50.0 70.0}
    
ON=@NpcRestock
    ITEM = i_gold, {50 100}
    ITEM = i_reag_daemon_bone, {2 6}
And there you have it. A simple character script and some new things. Read the chapter that is all about making NPCs later in the tutorial.
TEMPLATE
Or, how to put great laggy quantities of items into one unlaggy container.
You've all seen it. Those shards out there that don't use TEMPLATEs. When you kill, say, a dragon, on those shards, and go to loot him, you find that rather than neatly organized containers, there are 100 potions scattered about the loot window. Not only that, but all your magical weapons are buried neatly beneath them!
How do we solve this problem? Well, SPHERE has given us the handy tool of TEMPLATEs. These allow you to define a container item, AND the items inside of it, AT THE SAME TIME. Isn't that neat? I thought so too, when I first figured out what they were. Let's do our traditional take-apart-the-script section. I'll place a nice TEMPLATE from the file spheretemp_loot.scp.
[TEMPLATE 101505]
DEFNAME=backpack_poor
CATEGORY=Item Templates
SUBSECTION=Loot Templates
DESCRIPTION=Poor Backpack
CONTAINER=i_backpack
ITEM={ random_food 1 0 3 },{ 1 3 }
ITEM={ random_bottle 1 0 8 }
ITEM={ random_light 1 0 8 }
ITEM={ random_male_tops 1 0 4 }
COLOR=colors_all
ITEM={ random_male_pants 1 0 4 }
COLOR=colors_all
ITEM=POOR_GOLD_PILE
Wow, that looks confusing. But don't worry, by the time we're done, you'll know exactly what it means!
[TEMPLATE 101505]
: First of all, we look at the header for our template. An interesting thing about templates is that the item name cannot be a DEFNAME like all other scripts. It must be a ridiculously high number like 101505.
DEFNAME=backpack_poor
: Of course, SPHERE developers are not entirely evil, and have provided us with the ability to give these scary numbers a DEFNAME for easier access. You tell me, which would you rather type? ".add 101505" or ".add backpack_poor"? I thought so.
Note:
Since .56c, move DEFNAME to [TEMPLATE ...], e.g. [TEMPLATE backpack_poor]
CATEGORY, SUBSECTION, DESCRIPTION
: Axis crap. Optional. See the previous sections for a description of what these do.
CONTAINER=i_backpack
: Ahh, now we're getting down to the meat of this thing. This specifies the holding container that all other items in this template will be in. When you add the item in game, you will see this container. In this case, it's a backpack. Simple enough. This can be any valid item with a TYPE of t_container or t_container_locked.
ITEM={ random_food 1 0 3},{1 3}
Well, that's certainly cryptic. I think we need to break this line down even further.
But first, we're going to cover RANDOM SELECTORS! Sounds like fun doesn't it? Nah, it doesn't sound fun to me either, but it's absolutely necessary to a good shard.
Basically, they are an easy way to get different numbers with one command. What fun would a shard be where you killed a dragon and got a Platemail of Magic Stuff and a Super Duper Sword of Power every single time? Everyone would be running around with them. What we need is some variety!
There are two types of random selectors: weighted random and ranged random. Weighted random makes a statement like this: "Ok, 1 out of 10 times pick Number A, 3 out of 10 times pick Number B, and 6 out of 10 times pick number C". Ranged random makes a statement like this: "Pick any number between the two numbers I give you".
Our example actually has an example of both ranged random and weighted random. We'll cover them in the order they appear:
{ random_food 1 0 3}
This is a weighted random selector. The way to interpret these is to take the numbers that appear between the parentheses and divide them into sets of two:
random_food 1
0 3
Add up the second numbers in both sets, and we get 4. This tells SPHERE, "Ok, 1 out of four times, I want you to pick random_food, and 3 out of four times, I want you to pick zero." You can even have random sets within random sets, but then it just gets confusing.
{ { random_food 1 0 3} 1 random_clothing 1}
Can you figure it out?
random_clothing 1
{ random_food 1 0 3} 1
2 is our magic number in this case. One out of two times, SPHERE will pick random_clothing, and one out of two times, SPHERE will pick our previous random selector, which will then select one of its own options. If you're confused at this point, don't worry. This is extremely rare, and we'll see in a moment how templates help us to solve this problem.
I did mention, though, that there is another type of random selector, and you can probably see what it is:
{1 3}
NOTE: Spacing here is important. There must be ZERO spaces between the { and the first number, or the } and the last number. It will behave strangely otherwise.
This tells SPHERE "Pick a number between 1 and 3, inclusive". Inclusive means that SPHERE can pick 1, 3, or any number in between. In this case, the range is rather limited. SPHERE will give you a 1, 2 or 3 here. Ranged random selectors are actually more often used inside of weighted random selectors.
{ {1 3} 3 {4 9} 1}
"One out of four times, pick a number between 4 and 9. Three out of four times, pick a number between 1 and 3."
And with that out of the way, we're going to analyze the actual line of the script from above. The Piece What the Line does ITEM=
This tells the script "Ok, we're going to add an item to this container. Anything after the = tells the script exactly what it is we're adding and in what amounts. You could easily say ITEM=i_platemail_chest, or something like that, without the mysterious { } sections, but the reason templates are interesting is because they can vary greatly.
{ random_food 1 0 3}
This is the item you will be creating. As we can see from our weighted random selector lesson, 1 out of 4 times, it will be random_food, and 3 out of 4 times, it will be zero. If an ITEM is zero, nothing will be created this time. Basically this is saying "There will be a one in four chance of getting random_food in this container." What is random_food you ask? Well, it happens to be another TEMPLATE, defined in spheretemplate.scp, I believe.
{1 3} This is the amount of the item that will be created. You should recognize this as a ranged random selector. This tells SPHERE to put between 1 and 3 of this item into the container. Of course, if the item is zero as selected above, this has no effect since one nothing and three nothings are still nothing.
So basically, that is a template script. You then fill it with as many items as you want. You may also notice the following construction:
ITEM=i_sword_long,R11
This is a shorthand way of writing this:
ITEM={ i_sword_long 1 0 10 }
R11 means "one out of 11 chance of finding this item". And you can add an amount selector to the end of that as well, which makes it look long and scary:
ITEM=i_sword_long,R11,{4 5}
But why would you want 4 or 5 long swords in one item? That would be bizzare.  :)
And that's about it for templates. Congratulations, you're finished with chapter 1. Now you should be able to understand the examples to follow on the next section. You may also have some questions which are addressed in the common questions area. If you have a question which is not addressed there, perhaps it is too advanced of a topic for chapter 1. I assure you almost every aspect of SPHERE scripting will be covered in later chapters.
(A template example by Belgar)
[TEMPLATE tm_necromancer]
CONTAINER=i_bag
ITEM=random_necro_scroll
ITEM=random_necro_scroll
ITEM=random_necro_reagent, {5 12}
ITEM=random_reagent, {5 12}
ITEM=random_necro_reagent, {5 12}
Examples
Or, um. Well I guess there really isn't another way to say "Examples".
This shall be my attempt to create the most basic new items available. You will see things in these examples that are NOT mentioned in the tutorials. The major factor will be ON=@Create, which is the primary topic of Chapter 2. Just know for now that things you can change in game (color, etc) must go under ON=@Create.
Example 1
: A Red Sword
[ITEMDEF i_sword_red]
ID=i_sword_viking
TYPE=t_weapon_sword
NAME=The Red Sword
CATEGORY=Weapons
SUBSECTION=New Swords
DESCRIPTION=Red Sword
ON=@Create
COLOR=colors_red // This is a comment. Comments are ignored by SPHERE.
Wait, what is this weird
//
thing we've got going here? That's called a comment. It's completely ignored by SPHERE, so you can write whatever you want to the end of the line after //. You cannot have multi-line comments in SPHERE unless you use a new //, so don't even try it. SPHERE will give funky errors and then you'll have fun finding them.
Example 2
: A blue ettin
[CHARDEF c_ettin_blue]
ID=02 // You could just as easily use c_ettin here.
NAME=My Blue Ettin
ON=@Create
COLOR=02 // This is a dark blue color. It's often used for Counselor robes. Remember it.
Example 3
: A template from the file, since I'm too lazy to write one myself
[TEMPLATE 101521]
DEFNAME=goodie_meager_1
CATEGORY=Item Templates
SUBSECTION=Loot Templates
DESCRIPTION=Meager Goodie 1
ITEM={ meager_gold_pile 1 backpack_meager 1 pouch_meager 1 }
ITEM={ random_boots 1 0 4 }
ITEM={ random_gorget 1 0 4 }
ITEM={ random_staff 1 0 4 }
ITEM={ random_necklace 1 0 4 }
ITEM={ i_cape 1 0 9 }
COLOR=colors_all
You may notice something new here (especially since I highlighted it in red), and yes, it is legal. Any lines between ITEM= lines will affect the previously created item. The COLOR= line here affects the ITEM created by the line
ITEM={ i_cape 1 0 9 }
Remember, the best way to learn this type of scripts is to read the scripts provided for you in files like sphereitem_colorarm.scp and sphereitem_beers.scp.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
spheretables.scp
2
Sphere.ini
3
sphere_region.scp
4
sphere_mapX.scp
5
sphere_book.scp
6
sphere_name.scp
7
sphere_newb.scp
8
sphere_skill.scp (SKILLCLASSES)
9
sphere_serv_triggers.scp
spheretables.scp
Spheretables.scp is the very first file read by SPHERE after SPHERE.ini, and therefore it is the most important. Almost all of the secondary settings are contained within this file, wich makes this very important. Now, let's talk about this very important file in topics:
==
[RESOURCES]
==
The first thing you'll see when you open this file is a list of resources. This is marked by (SURPRISE!) a [RESOURCE] tag. It looks something like this:
[RESOURCES]
scripts/sphere_defs.scp
scripts/sphere_book.scp
scripts/sphere_backward_compatibility.scp
scripts/sphere_events_human.scp
scripts/sphere_events_npcs.scp
scripts/npcs/
...
This tells sphere what files to load and in what order to do so. You must change it carefully sometimes, put scripts with a lot of DEFNAMES, REGIONS, and other global used settings first, to avoid errors when sphere starts (although those errors won't harm your server). For example, we looked at a gold script in Chapter 1 that had a line like this:
TYPE=t_gold
Now, unless SPHERE loads sphere_defs.scp before the script containing the gold, it will have no idea what t_gold means, and will give you an error. This is because t_gold is defined within sphere_defs.scp.
Item files should be loaded before template files, and finally character files. Other files may come after this, but these particular files must load in that order. The loot on monsters is comprised of items and templates, and unless SPHERE has already loaded the file containing these items and templates, you will get hundreds of fun errors to track down and correct. Actually, it isn't very hard to correct, but it's irritating to start up the program and have a thousand errors scroll up your screen.
Note
:
You can make sphere load a full folder instead of putting each file, that's why we have this
scripts/
as the last file on the [RESOURCES] tag, so sphere loads all other scripts that might have been out of the list.
==
[OBSCENE]
==
The next section is self-explanatory, [OBSCENE]. This defines "illegal names". If a player creates a character with a name on this list, it will tell him that the name is unavailable and to pick another. If you are a punk who enjoys cussing at others, this list might be a good place to expand your knowledge of obscenities.
==
[NOTOTITLES]
==
This defines the title that will be shown related to the player's karma. Do not touch this section. If you remove a line inadvertently, your server WILL NOT RUN. Only change them.
==
[PLEVEL X]
==
These sections define the commands available to the various account plevels. Any command not listed is automatically assumed to be in the plevel 4 category. This includes self-defined functions (see
Chapter 6
). As you can see, there is quite an extensive list of functions and commands.
Note
:
You don't have to put every function you make in this section as you can have various sections in different scripts, although I recommend that you put them here just for organization purposes.
==
[RUNES]
==
This is the list of those words you say when casting a spell (An, Lor, In, etc). You can play with them, but it'll become very confusing. =P
Sphere.ini
Sphere.ini contains all of the internal options for the Sphere emulator. In order to configure your shard, this is the file you will start with. In order to explain this better, I'm just going to add more explanatory comments throughout the file. My comments and additions/changes will be in
bold text
.
//****************************************************************************
// SPHERE by : Menasoft 1997-2003
// www.sphereserver.com
// All SPHERE script files and formats are copyright Menasoft & Partners.
// This file may be freely edited for personal use, but may not be distributed
// in whole or in part, in any format without express written permission from
// Menasoft & Partners. All donations and contributions
// become the property of Menasoft & Partners.
//****************************************************************************
///////////////////////////////////////////////////////////////
//////// General Information
///////////////////////////////////////////////////////////////
[SPHERE]
// Name of your Sphere shard
ServName=
WarAngel's Test Centre
// The IP of your server, this will be 127.0.0.1 almost always
ServIP=127.0.0.1
// The port of your server, this is 2593 by default
ServPort=2593
// Admin's contact email
AdminEmail=
warangel999@msn.com
// Web page for this server
URL=www.myshard.com Replace www.myshard.com with your shard's URL'
// GMT offset, from -12 to +12 [London=0, EST=5, etc]
TimeZone=
-5 Eastern Time (US & Canada). Change this to fit your timezone
// Official staff language
Lang=English
// Start this as a system service on Win2000, XP, NT
NTService=0
Enabling this removes the ability to use the console.
// MySql configuration.
//MYSQL=0
Set this to =1 to enable MySQL
//MySqlHost=
localhost This will almost always be localhost if the MYSQL host is located on the same computer as your shard
//MySqlUser=
//MySqlPassword=
//MySqlDatabase=
///////////////////////////////////////////////////////////////
//////// File Locations
///////////////////////////////////////////////////////////////
// Directory where spheretables.scp is located, from there we will
// load any additional scripts
ScpFiles=scripts/
// Where your sphereworld.scp and spherechars.scp are located
WorldSave=save/
// Where your sphereaccu.scp and sphereacct.scp is located
AcctFiles=accounts/
// Where your UO installation is located. This need: map0.mul, statics0.mul,
// staidx0.mul, multi.mul, multi.idx, hues.mul, tiledata.mul.
// Optional files: verdata.mul, mapX.mul/staticsX.mul/staidxX.mul for higher
// maps support (Malas, etc).
//
// Note that if not set, sphere will scan windows registry to auto-detect it
//MulFiles=mul/
// Where your log files will be saved by sphere
Log=logs/
///////////////////////////////////////////////////////////////
//////// World Save Information
///////////////////////////////////////////////////////////////
// How often for Sphere to save your world (minutes)
SavePeriod=20
// How many backup levels to keep. Each level means 7 backups done for it.
// So, 10*7 = 70 backup saves will be storied.
BackupLevels=10
// On would save in the background quietly over a longer period of time, and not interrupt the game
// Off would notify "World save has been initiated" and save faster, but pause the game momentarily
SaveBackground=0
///////////////////////////////////////////////////////////////
//////// Account Management
///////////////////////////////////////////////////////////////
//Code for servers account application process
// 0=Closed, // Closed. Not accepting more.
// 2=Free, // Anyone can just log in and create a full account.
// 3=GuestAuto, // You get to be a guest and are automatically sent email with u're new password.
// 4=GuestTrial, // You get to be a guest til u're accepted for full by an Admin.
// 6=Unspecified, // Not specified.
// To enable auto account you must set this to 2
AccApp=0
// Store password hashed with MD5
MD5 is a safer encryption method for saving passwords. More information on it
here
Md5Passwords=0
// local ip is assumed to be the admin
LocalIPAdmin=1
// Number of chars allowed per account
MaxCharsPerAccount=5
// Min time for a char to exist before delete allowed (in seconds)
MinCharDeleteTime=3*24*60
// Max number of Guest accounts allowed
GuestsMax=0
///////////////////////////////////////////////////////////////
//////// Client Management
///////////////////////////////////////////////////////////////
// What client protocol version used
// Comment out the ClientVersion line to allow any client that is supported.
//ClientVersion=2.0.3
// Set this to 0 to block login to encrypted clients
Default client uses encryption
UseCrypt=1
// Set this to 1 to allow login to unencrypted clients
You can use tools such as
UO Rice
and
UOGateway
to remove encryption on a client
UseNoCrypt=0
// Maximum total open connections to server
ClientMax=256
// Maximum open connections to server per IP
ClientMaxIP=16
// Maximum total (not-in-game) connections to server
ConnectingMax=32
// Maximum total simultaneous (not-in-game) connections to server per IP
ConnectingMax=8
// How long logged out clients linger in seconds
ClientLinger=15
// Walk limiting code: buffer size (in tenths of second)
WalkBuffer=75
// Walk limiting code: regen speed (%)
WalkRegen=25
// Only commands issued by this plevel and higher will be logged
CommandLog=0
0 means that all commands will be logged
// Prefix for ingame commands
CommandPrefix=.
// Use the built in http server
UseHttp=1
// Use the built in god port
UseGodPort=0
This is for use with the God client
// Default setting for all accounts specifying default resdisp. Recommended
// specifying at least 1 (T2A) here.
//AutoResDisp=0
0=automatic detect, 1=T2A, 2=LBR, 3=AoS, 4=SE, 5=ML
// Default setting for new accounts specifying default priv level
//AutoPrivFlags=010
///////////////////////////////////////////////////////////////
//////// Game Mechanics
///////////////////////////////////////////////////////////////
// Do not allow entering under roof being on horse?
MountHeight=0
// Archery does not work if too close (0 = not checked)
ArcheryMinDist=2
// Maximum Distance for Archery
ArcheryMaxDist=15
// Speed scale factor for weapons
Formula is now DELAY = SPEEDSCALEFACTOR /((DEX + 100) * SPEED)
SpeedScaleFactor=15000
// This is the percent of max weight at which stamina is lost half the time
// (200 = no effect)
StaminaLossAtWeight=150
// Weight penalty for running +N% of max carry weight (0 = no effect)
RunningPenalty=50
// Show people joining/leaving the server
ArriveDepartMsg=1
// Are house and boat keys newbied automatically
AutoNewbieKeys=1
// Maximum number of items allowed in bank
BankMaxItems=1000
// Maximum weight in stones allowed in bank
BankMaxWeight=1000
// If 1 vendors will take gold only from backpack
PayFromPackOnly=0
If set to 0, vendors also take gold from the bank
// Disable weather effects?
NoWeather=1
// Default light level in dungeons
DungeonLight=27
0 is brightest, 30 is darkest
// Day light level 0-30
0 is brightest, 30 is darkest
LightDay=0
// Night light level 0-30
LightNight=25
// Wool Regen Time (in minutes)
WoolGrowthTime=30
// Suppress player speech with 75% of capital letters
SuppressCapitals=0
// Extra combat flags to control the fight (default:0, 0.55i compatible)
// COMBAT_NODIRCHANGE 00001 // not rotate player when fighting (like was in 0.51a)
// COMBAT_FACECOMBAT 00002 // allow faced combat only (recommended)
//CombatFlags=0
If both of these are enabled, it means the player has to keep turning to face his opponent in order to strike
///////////////////////////////////////////////////////////////
//////// NPC/Item/Player Management
///////////////////////////////////////////////////////////////
// Distance in tiles before an NPC that's wandered too far from it's home will teleport back
LostNPCTeleport=50
// Wether PCs get a resurrection robe when they get resurrected.
NoResRobe=0
// Time for a NPC corpse to decay mins
CorpseNPCDecay=10
// Time for a playercorpse to decay mins
CorpsePlayerDecay=15
// Base decay time in minutes for items
DecayTimer=30
// Put [NPC] tags over chars
or [TAME], if the creature is tamed
CharTags=0
// Flip dropped items
FlipDroppedItems=0
// Monsters run when scared of death
MonsterFear=0
// Monsters may fight each other
MonsterFight=0
// Percent setting of the all NPC move rate, default 100
MoveRate=100
// Do players receive sounds
GenericSounds=1
// Max number of items to sell to one person at once
VendorMaxSell=255
// Max level npc trainers can go
NPCTrainMax=300
300 is 30.0 skill
// Percent of own ability npcs can train to
NPCTrainPercent=30
// Max level of skill trainable on dummies, archery butte ect..
SkillPracticeMax=300
300 is 30.0 skill
// Max skill player's will start with on skills they haven't chosen during char create
MaxBaseSkill=200
Set this to 0 for players to start with no skills other than the selected ones
// Time in seconds for hitpoint regeneration
Regen0=40
// Time in seconds for mana regeneration
Regen1=20
// Time in seconds for stamina regeneration
Regen2=10
// Time in seconds for food degeneration
// 60*60*24 = 1 day of real life time
Regen3=60*60*24
// Speech block associated to players
SpeechSelf=spk_player
// Speech block associated to pets
SpeechPet=spk_pet
// When player skills/stats goes this times more than skillclass allowed, drop
// them to skillclass level. Setting this to 0 disables the action.
OverSkillMultiply=2
// NPC AI settings
// NPC_AI_PATH 0001 NPC pathfinding
// NPC_AI_FOOD 0002 NPC food search (objects + grass)
This makes npcs look for food (specified on their FOODTYPE sections) and grass to eat
// NPC_AI_EXTRA 0004 NPC magics, combat, etc
//NPCAI=0
///////////////////////////////////////////////////////////////
//////// Crime/Murder/Karma/Fame/Guard Settings
///////////////////////////////////////////////////////////////
// Karma when player goes from good to neutral (from -10000 to 10000)
PlayerNeutral=-2000
// How many minutes are criminals flagged for
CriminalTimer=3
// Times a player can snoop before becoming a criminal
SnoopCriminal=20
// Seconds time to decay a murder count (default 8*60*60 is 8 hours)
MurderDecayTime=8*60*60
// Amount of murders before we get title
MurderMinCount=1
// Looting or carving a blue player is a crime
LootingIsaCrime=1
// Flag players criminal for helping criminals?
HelpingCriminalsIsaCrime=1
// How long do guards linger about in minutes
GuardLinger=3
// Will guards kill instantly or follow normal combat rules
GuardsInstantKill=1
// Limits the MAXHITS/MAXMANA/MAXSTAM changes
// STAT_FLAG_NORMAL 0x00 // MAX* status allowed (default)
// STAT_FLAG_DENYMAX 0x01 // MAX* denied
// STAT_FLAG_DENYMAXP 0x02 // .. for players
// STAT_FLAG_DENYMAXN 0x04 // .. for npcs
StatsFlags=0
///////////////////////////////////////////////////////////////
//////// Server Mechanics
///////////////////////////////////////////////////////////////
// Experimental flags
// Flags for options that affect server behaviour and which might affect compatibility
// See the revisions.txt file for more details on this
// EF_DiagonalWalkCheck = 00000001
// EF_UNICODE = 00000002 // No on Linux
Enables new Unicode fixes
// EF_Scripts_Ret_Strings = 00000004
// EF_New_Triggers = 00000008
// EF_Scripts_Parse_Verbs = 00000010
// EF_Intrinsic_Locals = 00000020 //
Allows locals to be referenced differently. For example: <local.X> can be referenced as just <X>
// EF_Item_Strict_Comparison = 00000040 //
Disables similars items being compared instead of specific items, such as cloth, leather, hides, log, boards, arrow, bolt being compared when the server tries to find an arrow.
// EF_WalkCheck = 00000100
//Fixes a lot of house looting bugs, and other walkchecking related problems.
// EF_Script_Profiler = 00000400
// EF_Size_Optimise = 00000800
// EF_Minimize_Triggers = 00001000 //Minimize trigger calls (use only 0.51 triggers)
Experimental=00000
// Option flags
// Flags for options that affect server behaviour but not compatibility
// See the revisions.txt file for more details on this
// OF_Magic_IgnoreAR = 00000001 //
Does magic ignore a players armor statistics?
// OF_Magic_CanHarmSelf = 00000002 //
Can a player harm himself with magic? (using Magic Arrow to unparalyze oneself, for example)
// OF_Magic_StackStats = 00000004
// OF_Archery_CanMove = 00000010 //
Can a player move and shoot at the same time?
// OF_Magic_PreCast = 00000020 //
Allow pre-casting of spells, or freeze a player in place while they cast?
// OF_Items_AutoName = 00000040
// OF_FileCommands = 00000080 //
This enables all file commands, such as writefile, etc.
// OF_NoItemNaming = 00000100 //
If enabled, prevents Sphere from naming crafted items such as "sword craft by Player
// OF_NoHouseMuteSpeech = 00000200 //
Can players inside a house hear players outside, and vice-versa?
// OF_Multithreaded = 00000400 //
Do not set while server is running !!! (Make *Nix server unstable) Puts account handling in a second thread
// OF_Advanced_LOS = 00000800
// OF_Flood_Protection = 00001000
OptionFlags=0200
// FeatureT2A, used to control T2A expansion features ( default 03 )
// FEATURE_T2A_UPDATE 01 // Monster and Lost lands
// FEATURE_T2A_CHAT 02 // In game chat
FeatureT2A = 03
// FeatureLBR, used to control LBR expansion features ( default 0 )
// FEATURE_LBR_UPDATE 01 // Lbr Monsters
// FEATURE_LBR_SOUND 02 // MP3 instead of MIDI
FeatureLBR = 0
// FeatureAOS, used to control AOS expansion features ( default 0 )
// Enabling one of them automagically enables AoS basic features
// FEATURE_AOS_UPDATE 01 // Basic AoS feature
// FEATURE_AOS_POPUP 02 // Popup infos
// FEATURE_AOS_DAMAGE 04 // Damage shown on hit
// FEATURE_AOS_PALNECRO 08 // Fightbook and Paladin/Necro on char creation
// FEATURE_AOS_TOOLTIP 010 // Tooltips
FeatureAOS = 0
// FeatureSE, used to control SE expansion features ( default 0 )
// FEATURE_SE_UPDATE 01 // Basic SE features
// FEATURE_SE_NINJASAM 02 // Ninja and Samurai
FeatureSE = 0
// FeatureML, used to control ML expansion features ( default 0 )
// FEATURE_ML_UPDATE 01 // Basic ML features
FeatureML = 0
// In game effects to turn on and off
// Messages echoed to the server console while in debug mode
// DEBUGF_NPC_EMOTE = 0x0001
// DEBUGF_ADVANCE_STATS = 0x0002
// DEBUGF_WALKCODES = 0x0080 // try the new walk code checking stuff
// DEBUGF_NPCAI = 0x0100 // some NPC AI debugging
// DEBUGF_EXP = 0x0200 // experience gain/loss
// DEBUGF_LEVEL = 0x0400 // experience level changes
DebugFlags=0
// Console Hears all that is said on the server
HearAll=1
// Secure mode attempts to ignore errors, protect from accidently shutdowns
Secure=1
// Value from 1 to 32, set sectors inactive when unused to conserve resources
SectorSleep=10
// Disconnect inactive socket in x min
DeadSocketTime=5
// Always force a full garbage collection on save
ForceGarbageCollect=1
// Time before restarting when server appears hung (in seconds)
FreezeRestartTime=60
// Length of the game world minute in real world in seconds
GameMinuteLength=60
// Bit Mask of the subjects you want to log when logging is on
// LOGM_ACCOUNTS 0x00080
// LOGM_SAVE 0x00200 // world save status.
// LOGM_CLIENTS_LOG 0x00400 // all clients as they log in and out.
// LOGM_GM_PAGE 0x00800 // player gm pages.
// LOGM_PLAYER_SPEAK 0x01000 // All that the players say.
// LOGM_GM_CMDS 0x02000 // Log all GM commands.
// LOGM_CHEAT 0x04000 // Probably an exploit !
// LOGM_KILLS 0x08000 // Log player combat results.
// LOGM_HTTP 0x10000
// 01ffff log everything
LogMask=01ec80
// Amount of time to keep map data cached in sec
MapCacheTime=120
// Max NPC chars for a sector to prevent lag
MaxComplexity=32
// Amount of items in one tile so start showing "too many items here"
MaxItemComplexity=25
// Amount of items in one sector to start showing "x items too complex"
MaxSectorComplexity=1024
// Limit the number of cycles the while/for loop can proceed. Setting this to
// zero disables the limitation
MaxLoopTimes=0
///////////////////////////////////////////////////////////////
//////// Magic/Effects Settings
///////////////////////////////////////////////////////////////
// Allow casting while equipped
EquippedCast=1
// Words of power for player using magic
WOPPlayer=1
// Words of power for staff using magic
WOPStaff=0
// Reagents lost if magic fails
ReagentLossFail=0
// Magic requires reagents
ReagentsRequired=0
// What % of hitpoints players will resurrect with. Note, that if you set this
// too low, people with little STR will have problems resurrecting.
HitPointPercentOnRez=33
// How many % of hits will the character loose when starving. 0 disables
//HitsHungerLoss=0
// Amount of skill of lock picking needed to unlock a magically locked door
MagicUnlockDoor=900
// Teleport effect for GMs and players. Setting 0 disables the effect
TeleportEffectStaff=03709
TeleportEffectPlayers=0372a
///////////////////////////////////////////////////////////////
//////// Experience and Level system
///////////////////////////////////////////////////////////////
// Enable experience system
//ExperienceSystem=0
// Experience system settings:
// 0001 gain experience in combat
// 0002 gain experience in crafts
// 0004 allow experience to go down
// 0008 limit experience decrease by a range witheen a current level
// 0010 auto-init EXP/LEVEL for NPCs if not set in @Create
// 0020 allow trigger @ExpChange
// 0040 allow trigger @ExpLevelChange
//ExperienceMode=0
// If combat experience gain is allowed, use these percents for gaining exp in
// Player versus Monster and Player versus Player combats. Value 0 disables gain.
//ExperienceKoefPVM=100
//ExperienceKoefPVP=100
// Enable levels system (as a part of experience system)
//LevelSystem=0
// Level system settings:
// linear = 0 (each NextLevelAt exp will give a level up)
// double = 1 (you need (NextLevelAt * (level+1)) to get a level up)
//LevelMode=1
// Amount of experience to raise to the next level
//LevelNextAt=0
///////////////////////////////////////////////////////////////
//////// Webpage Settings
///////////////////////////////////////////////////////////////
// Note, that you can catch error codes by creating sphere404.htm and so on
// for all HTTP error codes sphere support.
[WEBPAGE 1]
// Determines what html file is used as base for the status page
WebPageSrc=scripts\web\spherestatusbase.html
// Determines where the status page is saved
WebPageFile=scripts\web\status.html
// In seconds, how often the status file is updated
WebPageUpdate=60
// Required PLevel to view this page (0 = anyone, 6 = admins only)
PLevel=0
///////////////////////////////////////////////////////////////
//////// Abuse Control
///////////////////////////////////////////////////////////////
// Block these ips from the server
// 255 is a wildcard, so 255.255.255.255 disables anyone connecting.
[BlockIP]
//123.34.45.56
//123.45.56.78
///////////////////////////////////////////////////////////////
//////// Connection Information
///////////////////////////////////////////////////////////////
//First line should be the name of your shard (this is what people see when they connect)
//Second line should be the IP of your shard (this is almost always 127.0.0.1)
//Third line should be the port of your shard (this should be whatever ServPort is set to)
//Uncomment next 3 lines below this if you have a router
//First line should be a name different than your shard name above this
//Second line should be your real/external IP (www.whatismyip.com)
//Third line should be the shard port (this should be whatever ServPort is set to)
[SERVERS]
WarAngel's Test Centre
127.0.0.1
2593
//External
//my.ip.goes.here
//2593
[EOF]
MAPx
It isn't present in sphere.ini, but it can be used (just check REVISIONS.txt). You use it like that:
MAPx=max_x,max_y,sector_size,real_map_number.
For example: MAP1=7168,4096,512,-1
will change map 1 size to 7168,4096, the sector sizes of map 1 to 512 tiles and the -1 means it'll call the default mul file for that map.
Another example:
MAP50=7168,4096,64,3
Will activate a map number 50 that has 7168,4096 as size, 64 as sector size and loads map3.mul, statics3.mul and staidx3.mul as it's map file.
sphere_region.scp
This script deals with the caracteristics of the places, like what you can mine or lumber, what happens when you enter that place and that kind of things. It also contains most of the resources sections.
Let's start by explaining those:
[REGIONRESOURCE x]
This section contains the the skill needed to gather that resource, what resource it gives to the player and the time for it to regen.
Let's take a look at this example (you'll see a commented text "//t_tree" if you have read the previous chapter you'll surelly know what this is, it's a defname)
[REGIONRESOURCE mr_tree]
// lumberjacking default
// t_tree
SKILL=1.0,80.0
AMOUNT=9,30
REAP=i_log
REGEN=60*60*10
Basically this section defines a resource, something that you can gather from the landscape. It compares skill and amount. This particular one says that you may gather a maximum of 9 logs at 1.0 skill and a maximum of 30 logs at 80.0 skill. Anything after that simply increases your chances of getting 30 logs. See that SKILL line? The syntax is SKILL=lower,high. And the AMOUNT line sets the AMOUNT=min,max.
How does it know what to give you? This line:
REAP=i_log
. This tells the server to create an i_log item if this resource is taken. So you can put anything you want to be gatherable in this REAP setting.
The next line, REGEN, defines how long this resource will take to reappear, in seconds. As we can see here, it's 60*60*10 seconds, or 10 hours. As a GM, if you walk around where players have been chopping wood or mining, you'll see little worldgem bits all over the ground. They look like spawnpoints, but are really resource markers. They mark where a specific resource has been gathered, how much has been gathered, and what type of resource it is. They also have a
TIMER
which counts down from this very high number (36000) and then decay when it reaches zero.
[REGIONTYPE r_default_rock t_rock]
//Random rocks
RESOURCES=100.0 mr_nothing
RESOURCES=500.0 mr_iron
//RESOURCES=6.0 mr_rusty
//RESOURCES=6.0 mr_old_copper
//RESOURCES=6.0 mr_dull_copper
//RESOURCES=4.5 mr_bronze
RESOURCES=5.0 mr_copper
RESOURCES=2.0 mr_gold
RESOURCES=1.0 mr_rose
RESOURCES=2.0 mr_agapite
RESOURCES=1.0 mr_bloodrock
RESOURCES=1.0 mr_silver
RESOURCES=0.5 mr_verite
RESOURCES=0.2 mr_Valorite
RESOURCES=0.1 mr_mytheril
RESOURCES=0.1 mr_blackrock
RESOURCES=0.1 mr_diamond
Wow, you must be saying. What are all these things? mr_iron? mr_agapite? I don't see those anywhere in the file. Now, I bet you'll go to sphere_defs.scp to see if they are DEFNAMEs for something else. And the truth is, they are, but the definitions can be found in sphereitem_ore.scp.
RESOURCES=50.0 mr_iron
This should look slightly familiar. Would it look even more familiar if the whole thing looked like this?
RESOURCES={ mr_iron 50 mr_copper 5 mr_gold 2 mr_rose 2 ...etc... }
I bet it would, if you were paying attention during the earlier lessons in Chapter 1. This is a weighted list of resources, in a slightly different format than you're used to. But it works exactly the same way. It's also one of the ONLY places in SPHERE scripting that you can use fractional numbers like 0.1 or 0.2. Actually you can't use them here either, but SPHERE successfully hides this as long as you use them in ALL of the
RESOURCES
. (By the way, do not try to script a
RESOURCES
identifier as a random selector. SPHERE wont like that. Use the format provided to you.)
[REGIONTYPE r_default_rock t_rock]
Understanding:
That r_dafault_rock defines the defname of that
REGIONTYPE
, which is how you'll access it in other scripts (wait for next section =P). The t_rock is the defname (see
sphere_defs.scp
for it) of the type of a rock, which shows sphere where your players can gather that resource (you could change it to t_water so they could mine ores on water, which isn't a good idea actually :P)
Hopefully that clears up the sphere_region.scp file for you. We'll tell you in the next section how to use these REGIONTYPE settings to make resources actually available in game.
sphere_mapX.scp
Welcome to one of the easiest files in all of SPHERE. This is the spheremap.scp file. It's also the only file that's almost completely done for you. It is a very rare occasion that you need to change this file.
Actually, on that note, I might as well say it from the start. If you change this file, you must restart your server for the changes to take effect. If you do a resync, you'll get over 1000 "Conflicting region" errors.
This section will tell you how to make new regions, like that you go with the .go command.
There are currently 5 files in the default scripts pack, one for each map (Fellucca, Trammel, Ilshenar, Malas and Tokuno) being each one enumerated from 0 to 4 (sphere_map0,sphere_map1,and so on).
I'll use the region of Fellucca as an example for this part of the tutorial, and now here's the script:
[AREADEF a_world]
NAME=Felucca
EVENTS=r_default,r_default_rock,r_default_water,r_default_tree,r_default_grass
GROUP=ALLMAP
P=1323,1624,55,0
RECT=0,0,6144,4096,0
Let's understand those lines now:
[AREADEF somedef]
: As you have probably noticed a_world is a defname which defines the region for the server so it can be processed.
Name
: This line contains the name of the region, which is shown when you do .where inside the region and it also makes you go to that place when doing .go "region name" (do not make 2 regions with the same name, the last that has been loaded will replace the first when you do .go command (which can fuck up a lot of things)).
Events
: This defines what will happen in that region and what resources are gatherable here (remember the REGIONTYPE section? It can be used as an event here.). Besides the resources gatherable it'll also show sphere what triggers to call from the events (you've probably realized now that the REGIONTYPE section is an event for regions :P), like the @Enter trigger and the others (see
Triggers
).
Group
: This is just an axis setting, this separates the regions in groups (duh) when you go to the Travel Menu.
P
: This is the place you go when you do .go "region name". Almost all regions will have a P value and it's usually a convenient location in the region to teleport to, or else it's the center of the region. If you are making your own new region, be sure to pick a place you'd like to teleport to.
RainChance
: This defines the chance to rain on that region when a weather is called (RainChance=50 means 50% chance of raining), the others 50% means it'll snow.
Rect
: This describes the exact boundaries of this region, by coordinates. The first two numbers are the coordinate of the upper left corner of the region, and the second two are the coordinates of the lower right. In the case of Fellucca it stretches from 0,0 to 6144,4096 (RECT=0,0,6144,4096). Since 56B you also need to add a fith argument, the map this region uses so it's RECT=0,0,6144,4096,0 (if the map is 0 you can leave it empty, otherwise you MUST NOT leave it empty or you'll have conflicting regions.
Flags
: The region flags allow you to control what goes on in a particular region. They describe whether or not a region is to be guarded, what types of magic are allowed to be cast there, who can be harmed here, or whether or not it is allowed to rain there. Basically anything you could ever want. Here's how you use them:
Just add this line to a region script:
FLAGS=#
Of course you're going to want to replace that # with an actual number! Where do we get those numbers? They're predefined in the game, but they give us a nice handy list. I just showed it to you.
Say we want to make a region that is guarded and safe from harm. We would simply add the two numbers together:
region_flag_safe    (02000)
+
region_flag_guarded (04000)
=
06000
There you go. Your
FLAGS
would be set to 06000. "But.. but.." you're saying. "Didn't you tell me that
DEFNAMEs
were supposed to prevent me from working with scary numbers?" (See
Chapter 1
.) Of course I did! And there's a way to do this without using any scary number at all. Here it is:
FLAGS=region_flag_safe|region_flag_guarded
That's it. Now your region is both safe and guarded.
Which, as you may learn quickly as a new admin, is a big mistake. Making a region safe and guarded at the same time prevents the guards from actually killing anything, so they pile up and call each other, and soon you have a huge laggy mess of guards hacking at something that can't be killed (because it's a safe region). Just take my word for it and don't make a region safe and guarded.
Here's a quick list for the region flags (you should check you sphere_defs.scp for more, cause they may be changed):
[DEFNAME region_flags]
region_antimagic_all 00001        //
all magic banned here.
region_antimagic_recall_in 00002  //
teleport,recall in to this, and mark
region_antimagic_recall_out 00004 //
can't recall out of here.
region_antimagic_gate 00008       //
can't open gates from or to this place.
region_antimagic_teleport 00010   //
can't teleport into here.
region_antimagic_damage 00020     //
just no bad magic here
region_flag_ship 00040            //
this is a ship region. ship commands
region_flag_nobuilding 00080      //
no building in this area
region_flag_globalname 00100      //
make sure the name is avail globally.
region_flag_announce 00200        //
announce to all who enter.
region_flag_insta_logout 00400    //
instant log out is allowed here. (hotel)
region_flag_underground 00800     //
dungeon type area. (no weather)
region_flag_nodecay 01000         //
things on the ground don't decay here.
region_flag_safe 02000            //
this region is safe from all harm.
region_flag_guarded 04000         //
try tag.guardowner
region_flag_no_pvp 08000          //
players cannot directly harm each other here.
And that's about it for the
sphere_mapX.scp
files.
sphere_book.scp
Spherebook.scp is one of the most pointless files you will ever encounter. How many times, when you logged onto a shard, did you actually stop to READ those tips, or to READ the updates screen that comes up every time? I know most of my players refused to. But, in any case, that is what's in this file. And books. Did I mention books? Those impossible-to-write-correctly, rarely-used items that waste RAM in-game?
[SCROLL SCROLL_MOTD]
[SCROLL SCROLL_NEWBIE]
[SCROLL SCROLL_GUEST]
These are the sections that define the messages that pop up when you log in. Anything written after these tags will appear in the appropriate message. You'll have to figure out exactly what spacing is best for those little info boxes. It does take some time, and there's really no way to explain it. Just do it and you'll figure it out. Remember, there is no wordwrap. Or at least there wasn't in the past.
[TIP X]
You guessed it. These are the tips that pop up on startup. "War is unhealthy for children and other living things." is one of them. Very appropriate right now, I would say.
[BOOK title]
[BOOK title x]
Creates a book with a DEFNAME of title. Putting a page number x after the DEFNAME will add your text to that particular page. Look at the example books for clues on how to do this. The major difficulty with books is that the game uses a variable-width font, so you don't know an exact number of letters you can have on one line. For example, you can fit more i's on one line than w's or M's, since those letters are bigger. You can start a paragraph by typing a TAB text (clicking yout TAB button :P)
sphere_name.scp
This is an easy file. It's just lists of names under sections with various
DEFNAMEs
. It's these names that are important, not the contents, since you will almost NEVER write your own list of names. I've been using this emulator for two years now, and I have never modified this file once.
To access this list of names, you write this in a script:
NAME=#NAMES_HUMANMALE
It will automatically replace it with a random name from the
NAMES_HUMANMALE
list.
To make a list of names, it'll look like that:
[NAMES A_DEFNAME_YOU_WANT]
NUMBER_OF_NAMES
NAMES
for example:
[NAMES NAMES_SPECIAL]
2
Hil
Hol
Difficult file huh? I almost didn't give it a section to itself.
sphere_newb.scp
There! I did it! No vain attempt at humor under the title! :)
In any case, this is another file that a lot of questions are asked about. "How do I make players start with 10000 gold?" people ask. Or, "How do I give all blacksmiths 800 ingots?" Now, I'm not saying I would like to play on a shard where you start with 10000 gold or blacksmiths start with 800 ingots. But this file would be the place to do it.
[NEWBIE MALE_DEFAULT]
// Male Generic Starting Clothes
ITEMNEWBIE=i_shirt_plain
COLOR=colors_all
ITEMNEWBIE=random_pants
COLOR=colors_neutral
ITEMNEWBIE=random_shoes
COLOR=colors_neutral
ITEMNEWBIE=i_dagger
ITEMNEWBIE=i_candle
ITEMNEWBIE=i_book_sm
ITEMNEWBIE=i_gold,100
This is what a typical script looks like. It looks kinda like a template doesn't it? Well there's a good reason for that. It really is a template. It just uses the
ITEMNEWBIE
tag rather than the
ITEM
tag. Look at the section in Chapter 1 on Templates for more information on how to structure this file!
The only real item of note is that these sections MUST have specific names that the server looks for. You cannot add a new newbie section, no matter how much you'd like to. Sorry!
sphere_skill.scp (SKILLCLASSES)
Skill classes are what defines how much you can train at each skill/stat and you can also add triggers to it.
A SkillClass script would look like this:
[SKILLCLASS 0]
// undeclared class.
// max skills for players of this skill class.
// might want this to be all 50.0 to make people declare a class?
DEFNAME=Class_undeclared
NAME=undeclared
// EVENTS=e_ClassUndeclared
STATSUM=300
SKILLSUM=10000.0
STR=100
INT=100
DEX=100
ALCHEMY=100.0
ANATOMY=100.0
ITEMID=100.0
ARMSLORE=100.0
and so on...
Now let's understand it:
EVENTS
: It means everyone with this skillclass will also call the events specified in this field (to add more events just use a ",", for example: EVENTS=e_1,e_2,and so on)
STATSUM
: This is how much the som of your players stats can be, for example, if I have 100 str, 100 dex and 100 int, I've reached 300 stats, so I've reached STATSUM and can't have more (except for magic items and such things)
SKILLSUM
: The same thing as STATSUM but for skills.
STR/DEX/INT
: This is how much can the player have at this specific stat (except for magic items and such)
ALCHEMY
: The same thing as the STR, DEX and INT fields, but for skills (in this case alchemy, but of course you can change to any other)
sphere_serv_triggers.scp
This file hold special trigger "functions" that are fired by the server its self at certain times depending on the function, below are a list of the functions found in this file and a breif explain of what the function will do for you.
f_onaccount_login
This function is called after the client has entered the password.
ARGS --> username of the client logging in
ARGO --> the client logging in
RETURN 0 --> normal action (login)
RETURN 1 --> disconnect the client
f_onaccount_delete
This function is called before an account is being deleted.
ARGS --> username of the account being deleted.
RETURN 0 --> normal action (delete)
RETURN 1 --> account not deleted
f_onchar_create
f_onchar_delete
f_onserver_start
f_onserver_save
f_onserver_save_ok
f_onserver_save_fail
f_onserver_save_finished
f_onserver_exit
f_onserver_blockip
Chapter 3

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
NPC Evolution
2
Advanced Item Scripting
3
TYPEs
4
ATTRs
5
Cool Commands
NPC Evolution
Remember in Chapter 1 when we looked at that basic NPC script? It was a generic script to create a naked man (or a naked player). And it looked something like this:
[CHARDEF 0190]
DEFNAME=c_man
Name=Man
ICON=i_pet_MAN
CAN=MT_EQUIP|MT_WALK|MT_RUN|MT_USEHANDS
RESOURCES=i_flesh_head, i_flesh_torso, i_flesh_right_arm, i_flesh_left_arm
FOODTYPE=15 t_food, t_fruit
DESIRES=i_gold,e_notoriety
AVERSIONS=t_TRAP,t_eerie_stuff
SHELTER=r_house
BLOODCOLOR=0
TSPEECH=spk_human_prime
TSPEECH=spk_human_default
TEVENTS=e_Human_HearUnk
DESCRIPTION=Man
SUBSECTION=Miscellaneous
CATEGORY=Civilized
As you can see, this is a rather incomplete script. It's actually one of the least complete of any of the scripts available in the spherechar_*.scp files. Here is a more complete example of an NPC script:
[CHARDEF 0490]
DEFNAME=C_H_ALCHEMIST
NAME=#NAMES_HUMANMALE the Alchemist
ID=C_MAN
DESIRES=i_gold,e_notoriety,t_magic
AVERSIONS=t_TRAP,t_eerie_stuff
TSPEECH=spk_human_prime
TSPEECH=jobalchemist
TSPEECH=spk_shopkeep
TSPEECH=spk_needs
TSPEECH=spk_rehello
TSPEECH=spk_human_default
TEVENTS=e_Human_HearUnk
TEVENTS=e_Human_ConvInit
TEVENTS=e_Human_Greet
TEVENTS=e_Human_Space
TEVENTS=e_Human_Needs
TEVENTS=e_Human_Refuse
TEVENTS=e_Human_Environ
CATEGORY=Civilized
SUBSECTION=Tradesmen
DESCRIPTION=Alchemist (male)
ON=@Create
NPC=brain_vendor
COLOR=colors_skin
STR={36 50}
DEX={36 50}
INT={51 65}
ALCHEMY={55.0 78.0}
TASTEID={55.0 78.0}
WRESTLING={15.0 38.0}
MAGICRESISTANCE={25.0 48.0}
TACTICS={15.0 38.0}
POISONING={35.0 55.0}
ITEMNEWBIE=random_male_hair
COLOR=colors_hair
ITEMNEWBIE=random_facial_hair
COLOR=match_hair
ON=@NPCRestock
ITEM=i_expcoin,3
ITEM=i_shirt_plain
COLOR=colors_all
ITEM=random_pants
COLOR=colors_all
ITEM=i_robe
COLOR=colors_red
ITEM=random_shoes
COLOR=colors_neutral
ITEM=random_coin_purse
SELL=VENDOR_S_ALCHEMIST
BUY=VENDOR_B_ALCHEMIST
[CHARDEF 0490]
We've seen this before. It says "Hey SPHERE! Everything after this line until the next header is going to define a character!" What is this character going to be? Well, right now we have no idea, it's just 0490 to SPHERE. The 0490 also shows the client what anim to show (except for monsters with the ID field, which will show the ID field anim). You can also use the char defname in the [CHARDEF x] field instead of a number (which is better for new npcs), for example: [CHARDEF c_new_monster]
DEFNAME=C_H_ALCHEMIST
This is the
defname
for this script, obviously. We've seen things like this so many times, I don't believe I need to go over it. But now at least we have a more memorable name for this script. It's obviously a character (C), a human (H), and an alchemist (
C_H_ALCHEMIST
). Try to make your
DEFNAMEs
make sense based on what the character is. Calling this c_robed_man would have absolutely no memorable qualities.  :)
NAME=#NAMES_HUMANMALE the Alchemist
This is where SPHERE does some funky stuff. First of all, if you remember from the
SPHERE_NAME.SCP
lesson in
Chapter 2
, it is going to replace #NAMES_HUMANMALE with an actual name for this NPC, such as "Fritz", "Bob" or the ever popular "Roderick". The second thing it is going to do is divide this name into a
NAME
and a
TITLE
. Where does it do this division? At the word "the". So writing this line is equivalent to:
NAME=#NAMES_HUMANMALE
TITLE=the Alchemist
ID=C_MAN
Here is where we actually tell SPHERE what this thing is. What is C_MAN? It's a
DEFNAME
obviously, but for what? Look up toward the top of this file, and you'll see the definition of the
C_MAN
character.
And so on. As you can see, we're just duplicating what we've written in the previous section. But with the newer versions of SPHERE we don't need to do that. Our character 0490 automatically gets everything that comes default on a C_MAN, including abilities, icons, and sounds, UNLESS WE SAY OTHERWISE. In programming, this is called inheritance. The new, more specific character inherits the properties of the less specific one.
You'll notice that we respecify
DESIRES
and
AVERSIONS
. Why do we do this if
C_MAN
has already told us what this type of character wants and doesn't want? Well I'm not sure in the case of AVERSIONS, because, well, they're the same. But the DESIRES of an alchemist are different than the DESIRES of a generic man, so we tell SPHERE, "Hey, replace the
C_MAN
desires with our new ones!"
TSPEECH=
What do you suppose those cryptic names are following this statement? Of course, they're DEFNAMEs, but for what? If you look through your files, chances are you won't find those defined anywhere.. But what's this? We have a folder called speech that comes preconstructed in the zip file. Looking through those files reveals a wealth of
[SPEECH]
block definitions. The default ones can be found at the SPEECH folder on your scripts folder.
We'll look at a very simple speech script right now. I am not taking this from any file.
[SPEECH spk_human_test]
ON=*hello*
SAY Cheese!
In our script, if we were to write
TSPEECH=spk_human_test
, our NPC would respond with "Cheese!" any time we said "hello" to him. You might be wondering why I have surrounded this word with stars
(*)
. In programming lingo, a star means
"ANYTHING"
. So you could say "I want to eat you hello goodbye" and the NPC would still respond with "Cheese!", because the word "hello" was present.
Of course, SPEECH is much more complicated than that and we'll look at it again when we reach the chapter on basic event scripting. Just know for now that you can have as many TSPEECH lines as you wish in a CHARDEF section.
TEVENTS=
We've already covered this in a very very tiny amount of detail in Chapter 1. This is where events for the creature are defined. As you can see, this creature contains a great deal of events. They define everything from what he says when he hears an unknown word ("Huh?"), to what he does when he sees a new player. We'll look at an event script in Chapter 8. You should learn the basics of item scripting before you try NPC event scripting. For now just know that you can retrieve all the TEVENTS of a npc by using <[REF].TEVENTS>.
ON=@Create
Actually, I lied. @Create is an event, and we're going to talk about it right now. But it's a special event, as is the next one we're going to discuss. Basically, @Create causes every line after it to be processed (the entire section highlighted in red) when an object is Created. Creative eh? (Ha, ha.) In this case, I'm not going to concentrate on most of the lines following, as they should all make sense to you now. All you need to know at this point about @Create is that things you can change IN GAME go under this section. This includes stats, skills, unlootable items, colors, brain types, and TAGs (Although tags can be defined on CHARDEF too, it's a great way to set a tag to all npcs with that chardef without needing to do a restock or change one by one) (You don't know what a TAG is? Good, I haven't taught you yet.).
ALCHEMY={55.0 77.0}
This line is very deceiving, and the reason for the deception is the way that SPHERE processes numbers. SPHERE cannot, ever, read a decimal number. 55.0 means nothing to SPHERE, and it simply strips out the decimal point. Now, isn't it convenient that internally, skills are stored as big numbers? Look at your skills menu in-game right now. Find a skill that isn't zero, obviously, and look at the value.
It looks like this: 42.0
Now, in-game again, type this command: .set [skillname] 42 (Of course, replacing [skillname] with the skill of your choice. Refer to spheretables.scp if the name you're typing doesn't work.) What happened? Your skill suddenly went to 4.2!! Is this an error in the game? No, actually it's because skills are stored by removing the decimal point. If you have 100.0 in blacksmithing, your skill is actually set to 1000. If you have 75.2 in a skill, that skill is 752.
This may seem like a simple concept, but it also applies to the REST of scripting as well. Any time you type a number like 55.0, SPHERE eliminates the decimal. So our example line above is actually this:
ALCHEMY={550 770}
Isn't that sneaky?
One of the times you might want to remember this is later, if you are multiplying numbers:
4 * 0.5
Sphere translates this as "4 times 5" and you get 20, rather than the 2 you were expecting. As you can see, this may cause serious problems. I'll show in later chapters how to get around this problem. I just wanted to point out here that it exists. (Look back at the resource tables in sphereregion.scp for another example of where sneaky decimal points are used.)
NPC=brain_vendor
Ok, so I'm out of order. Deal with it.
All NPCs in the game are controlled by specific intelligences, which direct the way they act in certain situations. For instance, this alchemist is a brain_vendor, which means he responds to commands like "buy" and "sell" by opening up a trade window. It also means that he is allowed to have extra storage space for information dealing with the items he can buy and sell. (Actually they are additional containers stored on the vendor, but we shall see that later.) Here is a list of the other intelligences available (I bet you can't guess which file I pulled this from):
[DEFNAME brains]
BRAIN_NONE 0               // Players: No brain. Convenient eh?  :)
BRAIN_ANIMAL 1             // Animals: wander, attack only if attacked
BRAIN_HUMAN 2              // Human: wander and speak
BRAIN_HEALER 3             // Healer: heal ghosts in proximity
BRAIN_GUARD 4              // Guard: attack bad guys I see
BRAIN_BANKER 5             // Banker: you can access your bank through him
BRAIN_VENDOR 6             // Vendor: buys and sells things
BRAIN_BEGGAR 7             // Beggar: follows players around asking irritating questions
BRAIN_ANIMAL_TRAINER 8     // Trainer: can stable animals
BRAIN_THIEF 9              // Thief: no effect right now
BRAIN_MONSTER 10           // Evil: attack all players we see
BRAIN_BERSERK 11            // Crazy: attack anything we see
BRAIN_UNDEAD 12            // Undead: same as evil, just used for identification
BRAIN_DRAGON 13            // Dragon: breathes fire (set this on a rabbit)
BRAIN_VENDOR_OFFDUTY 14    // No idea what the difference is here
BRAIN_TOWNCRIER 2          // Same number as brain_human, same effect
brain_beserk brain_berserk //Same thing as brain_berserk, just to avoid some errors by typos
ITEMNEWBIE=
This creates the specified item with the attr_newbie on the char.
ON=@NPCRestock
I lied twice! This is the SECOND event you're going to learn in this script. This event is triggered when a "restock" happens in-game. This occurs once every few real-time hours, or if a staff member types "
.sector.restock
". What you should put here is anything lootable from this NPC, along with the definitions of things they buy and sell. Once again, this is just a template in most cases, so you should know how to deal with it. I'm going to examine two lines though:
SELL=VENDOR_S_ALCHEMIST
BUY=VENDOR_B_ALCHEMIST
This defines what the vendor buys and sells? But where are these mysterious lists of items coming from? Actually, they're templates, in the file
spheretemp_vend.scp
. (Templates for vendors. Those developers are so creative.) Actually it's a good thing to name files after what's inside of them.  :)
Price is not defined anywhere on these BUY and SELL lines. Price is defined in a VALUE= line in an individual item script. If an item script does not have a VALUE= line, price is determined by multiplying the value of the resources in that item by the number of resources required. For example, if an item takes 8 iron ingots to make, and each ingot has a VALUE of 8 gold pieces, the entire item is going to be worth 64 gold. By default, things sell for half of the price you can buy them for.
I think that's all you need to know for now about scripting a new NPC. Right now, with your abilities, you can create new vendors, new monsters, and new animals that wander your world. But they don't do anything unique yet. They just behave like stronger or weaker versions of the same monsters. And they're probably pretty colors, too, judging from the recent use of my hues.mul file for colors 077a and 07a1. (I really should release a DEFNAME script for those.)
Now that you know how to make a decent NPC, let's explore ways to make unique items to put on him as loot. In the next section, we're going to make a SUPER DUPER BOW OF FIRE AND BRIMSTONE! *trumpet fanfare*
Advanced Item Scripting
The Super Duper Wand of Fire and Brimstone!
[ITEMDEF i_wand_sdwfb]
NAME=Super Duper Wand of Fire and Brimstone
ID=i_wand_1
TYPE=t_wand
RESOURCES=i_wand,10 i_scroll_flamestrike
ON=@Create
ATTR=attr_magic
MOREX=s_flamestrike
MOREY=50.0
MORE2=10
I tricked you that time! We STARTED with the script. No funny introductions. No livening up the article. Just a script. And a very interesting script it is too. You won't find it in any of your files. (In case you're wondering, SDBFB stands for "Super Duper Wand of Fire and Brimstone").
Now, what does this thing do? Well it's one of those handy predefined types that makes it do what it's supposed to do. Actually, it's not the only thing here that makes it do what it's supposed to do, but we'll see that in a moment!
[ITEMDEF i_wand_sdwfb]
You should be able to tell me what this does by now. We're making a new item with DEFNAME i_wand_sdwfb.
Notice that we don't explicitly declare the DEFNAME, but put it in the ITEMDEF. It's the same thing.
NAME=
Duh.  :)
ID=i_wand_1
Once again, we're inheriting some properties here, including animation, skill type (macefighting oddly enough), etc from the definition of i_wand_1.
TYPE=t_wand
Remember in our NPC script, I said that the different brain types caused the NPCs to act different ways in certain situations. Well, in items, TYPE does the same thing. Only there are more of them. A lot more. Here are the specifications of the "t_wand" type. As you can see, we use all of them in the @Create section. Note: this line wouldn't be necessary since we're getting type=t_wand from the itemdef i_wand_1 too.
MOREX
= the spell this wand will cast
MOREY
= the skill with which the spell will be cast
MORE2
= the number of charges this wand has left
Every item does something different with the MOREs. Actually this is a good time to go through the variables available to you on an item. In a simple list:
MORE1 (or MORE)
MORE2
MOREP
COLOR
TYPE
CREATE
LAYER
ATTR
LINK
CONT
TOPOBJ
LINK
As we'll see, a few of these have special functions that will allow us to do a lot more. But that doesn't come until advanced scripting. And there are also a lot more things which you'll know in future chapters.
One of these properties (MOREP) has the weirdness that it can hold a coordinate of the form (x, y, z, m). Which means that it can be broken down into MOREX, MOREY, MOREZ, and MOREM. For example, if you write this line:
MOREP=1,2,3,4
It is exactly the same as writing:
MOREX=1
MOREY=2
MOREZ=3
MOREM=4
This is what you call in C++ programming a "union", basically meaning there are going to be restrictions on the amount of data you can store in each of these variables. MOREX and MOREY can both hold numbers up to 0FFFF. MOREZ can hold numbers from -128 to 127, and is always displayed in decimal. MOREM can hold numbers from 0 to 255, and is also always displayed in decimal.
Be sure that when you're writing a script, or an item, you don't use both MOREP and one of the other MOREP pieces (MOREX, etc). It won't work together, since one will overwrite the other.
MOREP=10,42,51,53
MOREX=78
MOREY=89
MOREM=56
MOREP now is equal to 78,89,51,56.
So you see, it doesn't work to use these together.
Another strangeness of SPHERE is that they have given us the properties MORE1L, MORE1H, MORE2L, and MORE2H. These are not entirely visible to you, but just know that they are pieces of the MORE1 and MORE2 properties. As such, you should not be using both MORE1 and either of the MORE1 properties, or the same for the MORE2 properties, on a single item.
MORE1=0FFFFFFFF
MORE1L=01234
MORE1H=0F0
Now MORE1 is 000F01234. Which would totally screw up any script you were writing involving the MORE1 property. So don't use both in the same script. (If you don't understand where that number came from, don't worry about it. I've never used MORE1L and MORE1H in a script, and chances are neither will you.)
We'll also see later how to use the ATTR property to give your item special properties (like being unmovable, or magical, or blessed). I'll put that in my massive chart that's going in the next section, which lists all the TYPEs and all of the ATTR values.
From what I've just explained to you, the rest of the item script, after the @Create event, should be obvious. We're setting the pieces of MOREP to be what we need them to be so our wand functions properly. And if you create this item in the game, and double-click it, you'll get a target to cast Flamestrike. That's all you need to do.
By the way, you could just as easily have written:
MOREP=s_flamestrike,50.0
MORE2L=10
Think about it.  :)
(Anyone know why the developers decided to have 10 variables named MORE? Standing for "MORE information about an item" perhaps?)
Understanding the @Create trigger
You're probably wandering why I didn't set the item properties (such as the mores) directly on the itemdef, that's because not everything can be set there, only general properties for the items with that id.
"But hey, I can set different names for an item with the same id"
Yes you can, but mostly you won't, another thing that can be set there but you can also change are TAGs (you'll see more on other chapters).
Things that you can't change for example are WEIGHT, VALUE, RESOURCES and of course the DEFNAME. There are more, but just to make you get the idea.
TYPEs
This section explains how you can use
built-in item types
, how to override the built-in types, and how you can make your own.
If you want to override a built-in typedef, that is indeed possible, just define its new behavior it in a script and since the scripts are loaded after the server starts, your new definition will take precedence.
A TYPEDEF is essentially a collection of triggers, and can be written to reference other aspects of the ITEMDEF, CHARDEF, or REGION that it is assigned to.  To assign a TYPEDEF to an item, you can simply set TYPE=t_mytype in the ITEMDEF (Note: An item can only have one TYPE.)
Here is an example TYPEDEF:
[TYPEDEF t_horseshoes]
ON=@DClick
   TARGET What animal needs this item?
   RETURN 1
ON=@Targon_Char
   IF (<SRC.TARG.DEX> > 100)
      SRC.SYSMESSAGE @032 That animal does not need this item.
      RETURN 1
   ENDIF
   IF (<SRC.TARG.OBODY>==(c_horse_pack|c_llama_pack|c_horse_gray|c_horse_brown_dk|c_horse_brown_lt|c_llama))
      SRC.SYSMESSAGE @032 Now the animal is faster.
      SRC.TARG.MODDEX += <MORE1>
      SRC.EFFECT=3,0374a,6,15,1
      REMOVE
   ELSE
      SRC.SYSMESSAGE @032 That animal can not wear this item.
   ENDIF
   RETURN 1
Here is an example item that uses the t_horseshoes TYPEDEF shown above:
[ITEMDEF i_horse_shoes_magic]
ID=0fb6
NAME=magic horseshoes
TYPE=t_horseshoes
VALUE=35
WEIGHT=8.0
RESOURCES=8 i_ingot_iron
SKILLMAKE=Blacksmithing 30.0
CATEGORY=Items by Professions
SUBSECTION=Blacksmiths
DESCRIPTION=Magic Horse Shoes
ON=@Create
   MORE1={10 15}
   ATTR=attr_magic
ATTRs
This is a list of the ATTR flags available and what they do. I pulled it right out of
spheredefs.scp
Value
DEFNAME
Description
01
attr_identified
Someone has used the Item ID skill on this item so it will display the full magic name "+7 Sword of Ruin of Flamestrike".
02
attr_decay
The item will decay when the internal decay timer, or the item's TIMER reaches zero.
04
attr_newbie
The item will not be placed in a corpse upon death.
08
attr_move_always
Anyone can pick this up, even if they shouldn't be able to normally. The item will not decay unless the decay flag is also set.
010
attr_move_never
Locked down. Probably the one you'll use most often. It will never decay, even if the decay flag is set.
020
attr_magic
This item has been enchanted
040
attr_owned
This is owned by the town, and trying to pick it up will count as stealing. You will be flagged criminal if you try to use the Stealing skill on this item. It will never decay.
080
attr_invis
Invisible to non-GM clients
0100
attr_cursed
Cursed item, casts curse on the wearer while it's equipped
0200
attr_cursed2
I have no idea what the difference is.. strength maybe?
0400
attr_blessed
Casts bless on the person who is equipping it (stat gain)
0800
attr_blessed2
?
01000
attr_forsale
In a vendor's sell-box or buy-box.
02000
attr_stolen
This item has been stolen (from the town probably)
04000
attr_can_decay
I think this is used to get rid of those irritating errors "TIMER has expired without decay flag".
08000
attr_static
Makes it so an item doesn't highlight when a player passes the mouse over it. (Items will still highlight for GMs no matter what.)
You can, of course, have multiple ATTRs on a single item like this:
ATTR=attr_magic|attr_decay|attr_move_never
If you have a @Timer script on an item, you must have an attr_decay on that item.  Otherwise you will get scary errors.  You can always RETURN 1 from the @Timer script to prevent decay, but the flag must still be there.
Cool Commands
Or, how to make a huge number of NPCs die at once
There are a few often overlooked commands in the SPHERE scripting language, and the in-game command set. These are:
.nuke
.nukechar
.region.sectors restock
You may not understand the format of the last command yet, but I will tell you how to use it anyway.
One thing that make SPHERE scripters do not realize is that the
.nuke
and
.nukechar
commands can take parameters, and that those parameters will be applied to any items within the targetted area.
Type
.nuke
and target a box. All the items disappear.
Now type
.nuke color 02
and target a box. All the items in the box turn blue.
.nuke dupe
is an interesting command that creates a duplicate of any item in the box.
.nukechar
works the same way:
.nukechar kill
will kill any NPC you target inside of the box.
Note:
BOX can mean the world too, but if you target the ground it'll ask for a second targetting and will peform the actions in all chars/items in the area you selected)
Now, after you have spawned your world, if you make massive changes to your Vendor files, the changes WILL NOT take effect on already-spawned NPCs. And I'm sure you don't want to go around the world resetting every single vendor. But there's an easier way. Do these two commands in order:
.go 11 11 .region.sectors restock
or just
.region.restock
(since from 56b region.X will automatically access all the sectors of this region too)
Magically, all your Vendors will be restocked!
NOTE TO VETERANS:
NEVER, EVER TYPE
.region.restock all
!!! It will freeze the server!
Extra:
If you want to respawn all of your npcs across all maps you need to create a function to do that, here's an example:
[FUNCTION redospawns]
GO 1,1
FOR 0 4 //make loop through all 5 maps
MAP = <LOCAL._FOR> //set the map
FORCHARS 8000 //loop through all chars in the world (unless EA makes a map bigger than 8000x8000 squares)
REF1 = <MEMORYFINDTYPE.memory_ispawned.LINK> //set REF1 to the spawngem of that npc
IF (<REF1>) //checks if the npc has the spawn memory
REF1.TIMER = <EVAL {<REF1.MOREX> <REF1.MOREY>} * 60> //set the spawn memory timer to the values specified when creating it
ENDIF
ENDFOR
ENDFOR

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Introduction to Objects
2
Making Decisions
3
[SPEECH] for Dummies
4
The Difference Between = And ==?
Introduction to Objects
Your first glimpse of real scripting!
First and foremost, you MUST understand the object structure of the SPHERE system. Now, because SPHERE interacts with something visible, most of these objects are relatively easy to understand. But first, you must understand this simple fact about object-oriented programming (a term I'm sure all you programmers havel come to know and fear):
OBJECT-ORIENTED SCRIPTING IS CENTERED AROUND OBJECTS.
Duh.
Actually, it isn't as "Duh" as you may think. Here is a list of the objects available to you in a SPHERE script:
Who
What
SRC
The
"source"
of an event. If an item is damaged, the SRC is whatever damaged it. If a player is hit, the SRC is whoever hit the player. If an item is double-clicked, the SRC is the player who double-clicked it. The ONLY event that does not have a SRC, as we shall see later, is @Timer, for good reasons. Note that usually on functions the SRC isn't always the one who called the functions, but the default object (I or just an empty thing, eg: <I.NAME> or <NAME> are the same thing.
ACT
The last object acted upon by the referenced character, for example on that char trigger @ItemDclick, ACT is the item the player double-clicked.
TARG
The object targetted by the character.
CONT
The container of the object.
TOPOBJ
If an object is buried in several containers within containers, this is always the top-level container before you get to the world. If an item is buried in a player's backpack, TOPOBJ is the player.
ACCOUNT
The account of a player, obviously.
REGION
The current region/area a player is in.
SECTOR
The world is divided into 64 by 64 tile sectors (by default but you can change it by setting the MAPx settings (look at sphere.ini section for this)). This is the player's current sector.
SERV
used to call server commands, like serv.save, serv.allclients, etc.
Object references from SERV
LASTNEWITEM
The last item created from NEWITEM/NEWDUPE functions.
LASTNEWCHAR
The last character created by NEWNPC/NEWDUPE functions.
LINK
The object referred to in the LINK property of an
item
.
UID.x
The object with UID equal to X.
FINDLAYER.X
The object in layer X.
FINDCONT.X
The xth object in the container referenced.
FINDID.x
The first object with ID of x in the container.
FINDTYPE.x
The first object with TYPE of X in the container.
NEW
The newer object created from NEWITEM/NEWNPC/NEWDUPE functions.
OBJ
An empty object variable, which you need to set to use, eg:
OBJ = <FINDLAYER.
layer_bankbox
>
OBJ.SAY HEHE
will make I's bank box say hehe.
NOTE
: OBJ is a global variable so it can possibly interfere with other scripts.
It's best to set it back to nothing when not in use in a certain script.
REFx
This works in the same way as OBJ except the reference is local and will not interfere with other scripts. 'x' is a number between 1 and 65535, allowing you to reference as many objects as you need simultaneously (e.g. REF1 = <FINDLAYER.layer_bankbox>).
FILE
Call the file commands on the current FILE object.
DB
See
MySQL
PARTY.MEMBER.x
The xth party member of the referenced party.
GUILD.MEMBER.x
The xth guild member of the referenced guild.
As you can see, we're rather limited in what we can do! Actually, not really. With the current scripting system, you can do almost anything imaginable with SPHERE. It might run slow or be laggy, but it can be done. Those last five events (the ones with the x in them) are complex and I don't expect you to know how to use them yet.
Now that we know the objects, we need to know how to access the properties of those objects, and above all, do things to those objects. We use the dot operator (.) to access properties of objects. For example:
SRC.STR
ACT.MOREP
SRC.ACT.MOREP
SRC.TARG.HITS
SRC.DAMAGE {1 5} 01 <ACT>
SERV.NEWITEM i_gold
NEW.AMOUNT 10000
SRC.TARG.KILL
CONT.KILL
FINDLAYER.layer_backpack.FINDID.i_gold.AMOUNT
I don't expect you to understand what all of these things do yet, but you will by the end of this chapter.
Some notes
: You must also understand that OBJECTS aren't ITEMS, when someone say OBJECT they probably mean a character/item/some of those in the table. The objects can also be called REFERENCE, for example, ACT.STR 100 the reference is ACT.
Here is the next principle of SPHERE scripting:
ALL ACTIONS ARE TRIGGERED BY EVENTS OR FUNCTIONS, WHICH DEFINE THE OBJECTS
Nothing happens in a SPHERE script that just sits there. A player, or something else in the game, must do something to an item or a character for a script to execute. For example, being hit executes the @GetHit script on the person being hit, and @Hit on the hitter. Stepping on an item executes the @Step script on the item and the @ItemStep script on the player. When an item is double-clicked, @DClick is executed on the item and @ItemDClick is executed on the player.
If the player is the one who double-clicks the ITEM, he becomes SRC. If he targets an item, in the @Targon_Item script, the player is SRC, and the item he targeted is SRC.TARG.
We refer to an event like this:
ON=@DClick
Following that line would be everything that we want to happen when the player clicks the item.
We'll see examples in the next section of the use of both events and objects.
Making Decisions
It was an amazing day when someone showed this script to me. This was actually the script that tested the "new" scripting system in version .37. SPHERE wasn't even SPHERE then. It was called "Grayworld" and was on menasoft.com. Actually, I believe it was in the Admin FAQ that they used to have on the website. Here it is, updated to 56b format:
[TYPEDEF T_VEND_MACHINE]
// Some other trigger.
// Vending machine.
ON=@DCLICK
IF (<SRC.RESTEST 10 i_gold>)
SERV.NEWITEM={ i_HAM 1 i_fruit_apple 1 i_bread_loaf 1 i_bacon_slice 1 i_RIBS_COOKED 1 i_SAUSAGES 1}
SRC.BOUNCE <NEW.UID> // put it in your pack.
SRC.CONSUME 10 i_gold
SRC.MESSAGE That will be 10 Gold Thank Thee.
SOUND 0F7
ELSE
MESSAGE You lack 10 Gold to pay.
ENDIF
RETURN 1
Put this script into one of your files and resync your server. I like to use spheretrig.scp for test triggers like this. Now, in the game, type
.set type t_vend_machine
and target any item (like a door). Then double-click it and watch what happens. If you get the "not enough gold" message,
.add
yourself some i_gold, and try again.
See the result of this simple little script? It's got a lot that we've dicussed, and even more that we haven't. First, you may notice the use of this strange IF construction. You will use this again and again, so pay attention! The IF structure looks like this:
IF (1 or 0)
// Execute these lines if 1
ELIF (1 or 0)
// Execute these lines if the first wasn't 1, but this one is
// You can have as many ELIFs as you need
ELSE
// Execute if none of the above are 1
ENDIF
Always, always, always, always pair your IF with an ENDIF. It doesn't matter what's in the middle. You can have eight hundred ELIFs and an ELSE. But ALWAYS be sure your IF is paired somewhere with an ENDIF. Actually those are the only two required parts of this construction. ELSE and ELIF are completely optional, and you should only use them if they are absolutely needed.
So what is this "1 or 0" thing? How does it help me in my scripting if I'm just typing a 1 or a 0 in there? Actually, you will NEVER type a 1 or a 0 in there, and this is a perfect time to introduce the equivalence test operators. Here they are:
==
equal to
!=
not equal to
>
greater than
<
less than
<=
less than or equal to
>=
greater than or equal to
1 = true
0 = false
I've put this table in bold since it's so incredibly important. And here is another SPHERE principle:
Do not use == and = interchangably in an IF statement. SPHERE actually allows this, but you will get confused and use == where you mean =, and vice versa.
Here is an example of using a equivalence operator in an IF statement:
IF (<SRC.STR> == 75)
Read this "If src.str is equal to 75". Want to know something interesting? Internally, if SRC.STR is in fact equal to 75, SPHERE will replace the ENTIRE part inside the parentheses with a 1. If it is not equal to 75, SPHERE will replace that part with a 0. That's where your 1 and 0 comes from.
Now you may be wondering, what the < > brackets around <SRC.STR> are doing there. Actually, this is one of the most elusive concepts in SPHERE scripting. The < > brackets mean "Replace whatever is inside with the actual value of that thing." This is done before any testing is executed. Say SRC.STR has been set to 71. Here are the steps SPHERE takes in simplifying this IF statement:
1. IF (<SRC.STR> == 75)
2. IF (71 == 75)
3. IF (0)
Notice above in the example script that we have this statement:
<SRC.RESTEST 10 i_gold>
"What the heck is
RESTEST
?"
RESTEST
is what we call a function. It takes parameters (in this case an amount and an item ID) and returns a value. SPHERE replaces the entire function statement <SRC.RESTEST 10 i_gold> with that value. RESTEST checks to see if the player has an amount of the item specified greater than the amount specified:
"Does the player have an amount of i_gold equal to or greater than 10?" is what the function asks. Internally SPHERE says "Yes" and replaces it with a 1, or "No" and replaces it with a 0.
Say the player had 9 gold in his backpack. Here is the simplification of the IF statement:
1. IF (<SRC.RESTEST 10 i_gold>)
2. IF (0)
We'll see in later chapters how to define our own functions, give them parameters and have them return a value!
I hope you have a general understanding of the
IF
statement now. Here is a more complex example for you to analyze:
IF (<SRC.STR> > 60)
SRC.SYSMESSAGE Your strength is greater than 60.
ELIF (<SRC.STR> > 40)
SRC.SYSMESSAGE Your strength is greater than 40, but less than 60.
ELIF (<SRC.STR> > 20)
SRC.SYSMESSAGE You are a weakling with between 20 and 40 strength.
ELSE
SRC.SYSMESSAGE Start lifting weights because your strength is less than 20!
ENDIF
What does this do? Well first, SPHERE looks at the IF statement, and says "Is the value of SRC.STR greater than 60?" If the answer is no, SPHERE replaces that with a 0, and jumps down to the first ELIF. "Is the value of SRC.STR greater than 40?" If not, it jumps down to the next one. "Is the value of SRC.STR greater than 20?" If not, it looks for further ELIFs. Unable to find them, it jumps to the ELSE statement, since nothing above was true.
SYSMESSAGE prints out a message to the corner of the screen of the referenced object. In this case, that's SRC. Earlier, you saw an example involving the MESSAGE function. It prints the message above the object referenced. If the object is inside of a closer container, it does a SYSMESSAGE to the topmost container object. This means that if an item in a backpack is given a MESSAGE command, and the backpack is not opened, the player will see the message in the corner of his screen.
SYSMESSAGE
[text]
MESSAGE
[text]
RESTEST
[amount] [item]
NEWITEM
[item]
BOUNCE
// Put an item into the character's backpack
Your first five functions. Congratuations. Actually, you saw another one in an earlier script! Remember what it is?
SAY
[text]
This, of course, causes the object to SAY (so everyone can hear it) the text given. With MESSAGE and SYSMESSAGE, the text is private to a single client. MESSAGE text is only visible to the SRC. (In other words, LINK.MESSAGE or SRC.TARG.MESSAGE will show a message over LINK or SRC.TARG that only SRC can see!)
So finally, what is this weird
RETURN 1
at the end of the script?
RETURN is used in a variety of ways. In the case of an event script, if you RETURN 1, it prevents the default action from happening. For example, if you put this on an item in the game and double-click it, it doesn't actually try to use the item too. It just executes the double-click script. (To a player it would look like he was using the item, but we know better.) If you change it to RETURN 0, it would try to use the item too, realize it had no idea what to do with this item, and say "You are not sure how to use this item" or something like that. Either way, the script ends as soon as it sees a RETURN statement. The distinction between RETURN 1 and RETURN 0 is even more clear in character events, and I shall make an effort to point that out at the time.
[SPEECH] for Dummies
I say "Hello" you say "Goodbye", or "Cheese", or "You are a bad scripter"
Well, it's time to introduce you to your newest concept in SPHERE scripting:
NPC SPEECH is an event.
A long time ago there was supposed to be a @Hear trigger, and we waited and waited and waited, and it was going to be the next big thing in TUS (SPHERE's name before version .50), but nothing ever came of it. Then came SPHERE with all these new scripting revelations, and we said "Hey! We don't even need @Hear! Speech works just like any other event!
For example:
[SPEECH spk_human_test]
ON=*hello*
SAY @55 Cheese!
You should recognize that from a previous chapter when we created this script and set it on an NPC. But what if we want that NPC to do more than say "Cheese!" in a yellow colored font. What if we want him run away as fast as he possibly can, or drop his gold on the ground and faint?
We could easily do this:
[SPEECH spk_human_test]
ON=*hello*
IF (<SRC.KARMA> < <SERV.PLAYERNEUTRAL>) // Are they less than good?
SAY You are evil! Get away from me!
FLEE // Causes an NPC to run away from SRC (this can have an argument (the one to flee from))
ELSE
SAY Cheese!
BOW //Makes him bow to src (this can have an argument (the one to be bowed to uid))
ENDIF
RETURN 1
If you don't RETURN 1, the processing will pass through to the default handler, which will make the NPC say something like "Huh? I don't understand thee!"
In an NPC speech event,
SRC
is the player who triggered the event, the speaker who said "hello" in this case. The default object is the NPC with the event on him, as you can see from the script above. That is why SAY works without an object reference.
You can have ANYTHING in a speech script that you can have in a normal script. Just remember, there are no items involved. No MORE, no MORE2, no MOREP. But I'll tell you in a little bit how to get as many variables as you want on both NPCs and humans.
This section doesn't need to be any longer, does it? You already know how to write an event, and you already know some basic statements, like
IF
. That should provide some very robust NPC speaking on your shard!
The Difference Between = And ==?
In most programming languages, = is called the "assignment operator".  == is called the "equals sign".
Here are my style guidelines, for better readability of your scripts, and so on.  (If we can't read your scripts, we can't help you with them.)
== should only be used in test statements, like an IF
IF (<SRC.STR>
==
75)
= should be used for assignments, like setting a variable to a value
MORE
=
3
MOREP
=
45 65 12 4
And that's about it.  I'm pretty lenient huh?
As a comparison, my Java class at school has style guidelines in a set of pages the size of this entire tutorial.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Tags
2
CTags
3
Useful TAG/CTAG Functions
4
Vars
5
Locals
6
Floats
7
Functions
Tags
All these things you have learned so far seem rather restrictive don't you think? Well, I personally don't think they are very restrictive and I was able to script most things that people are scripting today in about version .40. But think about it. Items are restricted to MORE, MORE2, etc. Those poor characters only have PLOT2 to store stuff in before you have to start resorting to storing information on the variables of their backpack.
So SPHERE developers gave us a long-awaited feature:
The TAG.
Important TAG principle number one, even before you know how to use them:
ALL TAGS ARE STRINGS. PERIOD.
They are also just about the simplest part of SPHERE you will ever use. Here is an example of a tag:
SRC.TAG.JOE = 1
What did we just do? We just CREATED a variable on the SRC of this script. This variable is named TAG.JOE and has a value of 01. (Keep in mind that is the string 01, not the number 01.) It will be saved with the character and we can put ANYTHING WE WANT into it.
How's that for powerful?
Here are some more examples of TAGs:
ON=@DClick
SRC.TAG.CLICKS += 1
RETURN 1
ON=@Equip
SRC.TAG.GOOFYTAG = This is a really stupid tag.
SRC.SYSMESSAGE <SRC.TAG.GOOFYTAG>  // Will see "This a really stupid tag."
RETURN 0 // Allow them to equip
ON=@UnEquip
SRC.TAG.GOOFYTAG = // remove the tag
RETURN 0 // Allow them to unequip
In those three examples, you have the three ways you can use a TAG.
A TAG can store a number as in the first example. Unfortunately, it stores that number as a string, so we must use EVAL every time we want to use that number.
A TAG can store a string, as in the second example. Actually TAGs always store strings, but this one is obviously a string.
You can delete a TAG. We do this by typing the name of the tag and then an equal sign with nothing after it. Why would we ever want to delete a TAG? Well, TAGs, like everything else, use memory. The more memory you use, the more lag your server has.
TAG principle number two:
ALWAYS DELETE A TAG YOU ARE FINISHED USING.
You may not be finished using a TAG at the end of a script. Or even when the server shuts down. In fact, there are some TAGs you'll want to stay on the character forever. However, if you finish using a TAG for any reason, DELETE IT. It conserves memory and is good scripting practice in general.
Here is another important TAG principle. While the TAG is a very powerful feature, it has its limits. A TAG can ONLY be used on the following objects:
Characters.
Items.
Regions. Yes, regions can have TAGs.
It's very hard to give examples of the use of TAGs without going into a complex system. Most complex systems will use two, three, or more PERMANENT tags. For example, a system involving experience points might store numbers in TAG.CURRENT_EXPERIENCE_POINTS and TAG.CURRENT_LEVEL. You'll find a good example of when to use TAGs to your advantage in chapters from now on, as I present more and more complex scripts. BTW, when you're dealing with tags, sometimes you need to check if a tag exists or if it has a value. If it doesn't exist SPHERE gives a stupid error on the console. To avoid that, we make TAG's default to 0 by using TAG0 instead of TAG if the tag doesn't exist. If you want to you can always use TAG0 instead of TAG to be safe. Say you write this line of code:
MORE = <EVAL <TAG.JOE>>
If TAG.JOE contains no value (or hasn't been defined yet), you will get an error on the console that says something like this: Undefined value ' '. To complicate matters, the value of MORE will not change, which will severely screw up your script. To prevent this, use the following method:
MORE = <EVAL <
TAG0
.JOE>>
In this case we have used TAG
0
to access the TAG value. Accessing the TAG in this manner will return the value as normal, except for when TAG.JOE is undefined a "0" will be returned rather than a script error being raised.
The same trick can also be used when setting the value of a TAG. For example:
TAG0.JOE = <MORE>
As you may expect, this sets the value of TAG.JOE to whatever value is held in MORE. The difference however is that because we have used TAG0 when setting the value, if the value of MORE is zero then TAG.JOE will actually be cleared! This may initially sound undesirable but it offers the benefit of reducing the number of TAGs stored on the object. Since we can use TAG0 to retrieve a value of zero when a tag doesn't exist then you may be wasting memory by storing a large number of TAGs all with a value of zero. Of course if you do decide to use TAG0 when setting the value of a TAG then you should ensure that you also use TAG0 when reading that value back, or else you will quickly run into the aforementioned "Undefined value" script error.
CTags
CTAGs are temporary versions of TAGs that are only available with objects (i.e. online player characters). CTAGs are not saved and will be cleared when the player logs out. This means that you don't have to worry about removing the tag after using it, assuming the player logs out one day :). You can use CTAG0 too, used just the same as you can with TAG0. In short, if you are going to use tags that will no longer be needed after logging out, it is probably a good idea to consider using a CTAG.
Note:
CTAG can only be used with online players. Attempting to read from or write to a CTAG on a logged out player
will
raise a script error.
Useful TAG/CTAG Functions
CLEARTAGS
Removes all TAGs on an object, eg SRC.CLEARTAGS. Be careful with this as once the tag is gone there is no way to get it back.
CTAGLIST
Displays a list of tags on a client to SRC.
CTAGLIST LOG
Displays a list of tags on a client to the Sphere console (but not into logfile).
TAGAT.x.KEY
Returns the name of the TAG at position x. (the first TAG is at position 0)
TAGAT.x.VALUE
Returns the value of the TAG at position x. (the first TAG is at position 0)
TAGCOUNT
This function returns the number of TAGs on an object.
TAGLIST
Displays a list of tags on an object to SRC.
TAGLIST LOG
Displays a list of tags on an object to the Sphere console (but not into logfile).
Vars
Perhaps you're wondering if there is a less memory-consuming method. Of course you were, don't deny it.
And here I present it to you:
VAR.CHEESE = 1
Important VAR principles:
Like TAGs, VARs are always stored as strings.
Unlike TAG, VARs are not attached to any particular object. You never EVER use [obj].VAR.BLAH.
VAR variables are GLOBAL, meaning they can be accessed from any script.
Never assume a VAR has a specific value stored at the beginning of an event, especially if the same VAR is used in multiple scripts.
Like TAGs, VARs can have any name. VAR.CHEESE, VAR.BLAH, VAR.WORLD_TIME, VAR.HELLO_WORLD
If you don't need a value to be permanent, but need a place to store it temporarily during a script, use LOCAL, not TAG, not VAR.
VARs are global TAGs. That's about it.
If you want to get list of all VARs on your server type (into client or console):
SERV.VARLIST
, and if you want to log them into console write
SERV.VARLIST LOG
(this will not be saved into logfile).
If you want to remove all server variables (VARs) type
SERV.CLEARVARS
.
And that's your entire lesson on the VAR feature. I told you it would be short. As with TAG0 and CTAG0, you can also do VAR0. It works just like TAG0 or CTAG0 does. If that variable has no value then VAR0 will return 0 instead of nothing.
Locals
LOCALs are like VARs except they are only accessible within the script block they are defined in (i.e. a function or trigger) and then they are immediately cleared. The advantage is that they are much faster than VARs and you also don't have to worry about different scripts interfering with each other.
The following script demonstrates why you may want to use a LOCAL rather than a VAR:
[FUNCTION f_var_joe]
VAR.NAME = Joe
F_VAR_BOB
SYSMESSAGE <VAR.NAME>
RETURN
[FUNCTION f_var_bob]
VAR.NAME = Bob
SYSMESSAGE <VAR.NAME>
RETURN
The idea with the two functions above is that F_VAR_JOE will show the message "Joe" and F_VAR_BOB will show the message "Bob". However, if you were to go ingame and type
.F_VAR_JOE
, you would receive two messages saying "Bob". Why is this?
Well, if you look closely at F_VAR_JOE you will see that after setting VAR.NAME to Joe, it then executes the function F_VAR_BOB and inside F_VAR_BOB we then set VAR.NAME to Bob. Because VARs are global variables, this inadvertently affects the behaviour of F_VAR_JOE and we don't get the output that we were after. Another flaw you may have not spotted with this script is that we haven't cleared VAR.NAME before the script ends and so Sphere still has VAR.NAME stored in memory (which in this particular case is a waste of resources as we have no further use for VAR.NAME).
In this particular scenario we could modify the functions to use different VAR names but unless we intend to manually check every script on the server we could easily end up using a VAR that another script is using and prevent that from working instead.
This is where the LOCAL comes in to play, see the following example:
[FUNCTION f_local_joe]
LOCAL.NAME = Joe
F_LOCAL_BOB
SYSMESSAGE <LOCAL.NAME>
RETURN
[FUNCTION f_local_bob]
LOCAL.NAME = Bob
SYSMESSAGE <LOCAL.NAME>
RETURN
The above functions are identical to the previous ones, except they use LOCAL instead of VAR. This time when you type
.F_LOCAL_JOE
ingame you will receive "Joe" and "Bob" messages as we originally intended.
This is because the LOCALs only exist within the functions that define them. When F_LOCAL_BOB attempted to use LOCAL.NAME it received its own version of the variable that doesn't interfere with the one defined in F_LOCAL_JOE. When F_LOCAL_BOB returns, F_LOCAL_JOE still has its original LOCAL.NAME with "Joe" still stored inside it.
Of course there may come a time where you
do
want to share LOCALs with another function, and this can be accomplished by using the
CALL
command. When you use the CALL command to run a function instead of running the function directly the LOCALs are shared between both scripts, for example:
[FUNCTION f_bla]
LOCAL.DUDE = Bob
RETURN
[FUNCTION f_bleep]
CALL F_BLA
NAME = <LOCAL.DUDE>
RETURN
When we run the
F_BLEEP
function above, the CALL line allows LOCAL.DUDE to be set in F_BLA and be accessible to F_BLEEP afterwards. Therefore, the
NAME = <LOCAL.DUDE>
line will set the name of the object to whatever the F_BLA function set LOCAL.DUDE to (in this case "Bob").
Unlike TAGs, CTAGs and VARs, LOCALs
do not
have a LOCAL0 equivalent. This is because LOCALs will always return 0 when they empty (and so, they can
never
be blank/empty).
Floats
This is the most simple. Since you know many variables at this point and know how to use them. FLOATs are almost the same as LOCALs, just a difference. LOCALs store only text or entire numbers (34 or 12), while FLOATs stores decimals (23.1 or 45.3). Another difference is the EVAL here is changed to FLOATVAL. This is one example of FLOAT used to calculate hit speed:
[EVENTS e_test]
ON=@HitTry
FLOAT.FSPEED = <FLOATVAL <SERV.SPEEDSCALEFACTOR> / ((<DEX> + 100) * <ARGO.SPEED> + 1)>
ARGN1 = <FLOAT.FSPEED>
Functions
What's your [FUNCTION]?
The single most powerful SPHERE scripting tool to date.
You have a wealth of built-in object functions available to you. However, there seems to be some limits. For example, let's take a look at the following example of a very poorly written script:
ON=@DClick
SERV.NEWITEM=ispell_7_water_sparkle
NEW.P = <SRC.TARG.P>
NEW.LINK = <SRC.UID>
NEW.MORE = 017a6
NEW.MOVE -1 -1
SERV.NEWITEM = ispell_7_water_sparkle
NEW.P = <SRC.TARG.P>
NEW.LINK = <SRC.UID>
NEW.MORE = 017a3
NEW.MOVE -1 0
SERV.NEWITEM = ispell_7_water_sparkle
NEW.P = <SRC.TARG.P>
NEW.LINK = <SRC.UID>
NEW.MORE = 017a8
NEW.MOVE -1 1
SERV.NEWITEM = ispell_7_water_sparkle
NEW.P = <SRC.TARG.P>
NEW.LINK = <SRC.UID>
NEW.MORE = 0179f
NEW.MOVE 0 -1
SERV.NEWITEM = ispell_7_water_sparkle
NEW.P = <SRC.TARG.P>
NEW.LINK = <SRC.UID>
NEW.MORE = 0179b
NEW.MOVE 0 0
SERV.NEWITEM = ispell_7_water_sparkle
NEW.P = <SRC.TARG.P>
NEW.LINK = <SRC.UID>
NEW.MORE = 017a1
NEW.MOVE 0 1
SERV.NEWITEM = ispell_7_water_sparkle
NEW.P = <SRC.TARG.P>
NEW.LINK = <SRC.UID>
NEW.MORE = 017a5
NEW.MOVE 1 -1
SERV.NEWITEM = ispell_7_water_sparkle
NEW.P = <SRC.TARG.P>
NEW.LINK = <SRC.UID>
NEW.MORE = 0179d
NEW.MOVE 1 0
SERV.NEWITEM = ispell_7_water_sparkle
NEW.P = <SRC.TARG.P>
NEW.MORE = 017a7
NEW.LINK = <SRC.UID>
NEW.MOVE 1 1
RETURN 1
Do you notice anything about this script? How about the fact that it's repeating the same few lines over and over? Do you think we could do anything to fix this problem? I thought so too. We need a way to write a set of code once, like this:
SERV.NEWITEM = ispell_7_water_sparkle
NEW.P = <SRC.TARG.P>
NEW.MORE = 017a7
NEW.LINK = <SRC.UID>
NEW.MOVE 1 1
And have a way to "call" this code over and over again. I give you.... the [FUNCTION]!
[FUNCTION create_sparkle]
SERV.NEWITEM = ispell_7_water_sparkle
NEW.P = <TARG.P>
NEW.MORE = 017a7
NEW.LINK = <UID>
NEW.MOVE 1 1
RETURN
And in a script, we could go like this:
ON=@DClick
SRC.CREATE_SPARKLE
SRC.CREATE_SPARKLE
SRC.CREATE_SPARKLE
SRC.CREATE_SPARKLE
SRC.CREATE_SPARKLE
SRC.CREATE_SPARKLE
SRC.CREATE_SPARKLE
SRC.CREATE_SPARKLE
RETURN 1
Once you have learned how to use FOR loops, you could also reduce this script even further to:
ON=@DClick
FOR 8
SRC.CREATE_SPARKLE
ENDFOR
RETURN 1
Doesn't that look slightly more pretty than the previous version? We managed to cut about 40 lines down into 3 or so. But do you notice a problem? Our code is fixed. Those items are going to be created and moved 1 square down and one square right, every single time. We need a way to specify some parameters to our function!
And so we have the ARG* commands. There are three types of arguments we can give to a function: numeric, string, or object. I recommend always using the string arguments and using EVAL to get whatever else you need. What variables are associated with these arguments?
ARGN, ARGS, and ARGO respectively. N for "number", S for "string" and O for "object".
Let's rewrite our function and event using this new information:
[FUNCTION create_sparkle]
SERV.NEWITEM = ispell_7_water_sparkle
NEW.P = <TARG.P>
NEW.MORE = 017a7
NEW.LINK = <UID>
NEW.MOVE <ARGS>
[SOME ITEMDEF GOES HERE]
ON=@DClick
SRC.CREATE_SPARKLE -1 -1
SRC.CREATE_SPARKLE -1 0
SRC.CREATE_SPARKLE -1 1
SRC.CREATE_SPARKLE 0 -1
SRC.CREATE_SPARKLE 0 1
SRC.CREATE_SPARKLE 1 -1
SRC.CREATE_SPARKLE 1 0
SRC.CREATE_SPARKLE 1 1
RETURN 1
Get it? Every time we call the function with our new
create_sparkle
command, we "pass" it the values following the command. SPHERE automatically puts those values in ARGS, without any help from us.
There is another problem with functions that many new scripters do not understand, and that is the concept of the default object. In a normal script, the default object is the object on which the script is being executed. In a @DClick script, it's the item being double-clicked. In an @Equip script, it's the item being equipped. But what are the objects available in a function. Well, it all depends on how you call it.
The default object in a function is the object that called the function. In the case of our above example, SRC called the function, so the SRC becomes the default object. You'll notice that I removed any mention of SRC from the lines inside of the function itself. We could easily have said this instead:
CREATE_SPARKLE
Then, the default object would have been the item and SRC would still be SRC. But its a lot easier to see it the other way, at least in my opinion. That way you don't get confused either. If you WERE to include the SRC, and accidentally call your function with something like this:
SRC.ACT.CREATE_SPARKLE // Not a really likely occurrence in this case, but in other cases it is
Then you would no longer have a SRC and you would get a lot of scary errors that would be kinda difficult to track down, since you probably wouldn't think to check the function call. Functions generate enough scary errors as it is when you screw them up. Don't make it worse.  :)
There is still another problem with my script. It's assigning the same MORE value to each of the newly created items, and as you can see from the original long script, this isn't what I wanted it to do. I wanted each item to have a specific MORE value, which is used elsewhere in the script. So what are we to do? Well there are a number of solutions, but the most obvious would be to utilize that VAR feature we discussed in the previous section. Let's take a look at the completed script:
[FUNCTION create_sparkle]
SERV.NEWITEM = ispell_7_water_sparkle
NEW.P = <TARG.P>
NEW.MORE = <EVAL <VAR.MORE_VALUE>>
NEW.LINK = <UID>
NEW.MOVE <ARGS>
[SOME ITEMDEF GOES HERE]
ON=@DClick
VAR.MORE_VALUE = 017a6
SRC.CREATE_SPARKLE -1 -1
VAR.MORE_VALUE = 017a3
SRC.CREATE_SPARKLE -1 0
VAR.MORE_VALUE = 017a8
SRC.CREATE_SPARKLE -1 1
VAR.MORE_VALUE = 0179f
SRC.CREATE_SPARKLE 0 -1
VAR.MORE_VALUE = 017a1
SRC.CREATE_SPARKLE 0 1
VAR.MORE_VALUE = 017a5
SRC.CREATE_SPARKLE 1 -1
VAR.MORE_VALUE = 0179d
SRC.CREATE_SPARKLE 1 0
VAR.MORE_VALUE = 017a7
SRC.CREATE_SPARKLE 1 1
VAR.MORE_VALUE =
RETURN 1
The value of the VAR is carried over, since VAR variables, as we know, are global. We've managed to reduce a 40 line script into a 20 line script and keep the original functionality. And this is only for calling a function 8 times. The more you use a function, the more space it saves later.
And that is my chapter on functions. Later on, we'll see very useful purposes for doing this, other than eliminating a lot of lines of typing.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
The LINK object
2
The @Timer Event
2.1
TRYSRC
3
TARGETs
4
FINDCONT, FINDID, FINDTYPE
The LINK object
How to affect one object with another
The biggest problem the early scripters had to overcome, was the lack of ability to access other objects via a script.  The only two objects possible to access were the SRC and the default object.  And the LINK.  The LINK made it possible to do things in version .40 that most people don't suspect are possible even in SPHERE .55i.
The LINK property of an item holds the UID of another object.  Then, it serves as an object reference to directly access that object.  The LINK property can be set in-game or in a script.  Here's an example:
[ITEMDEF i_link_test]
ID=01828
NAME=Link Test
ON=@DClick
MESSAGE The LINK's name is <LINK.NAME>.
RETURN 1
Now, create this item in-game and set its LINK to the UID of another object.  (Use the
.info
command or
.xshow uid
to get the UID.)  Double-click the Link Test item.  It will say the name of the object you linked it to.  This obviously has very little use, so here I offer you a piece of a script I wrote a while ago that uses the LINK object.  (The items have been changed to protect the innocent.)
[ITEMDEF i_tile_sender]
ID=01828
NAME=Sender tile
ON=@DClick
IF (!<LINK.UID>)  // If there is no link yet
TARGET Select an object to link to.
RETURN 1
ELSE
LINK.SAY <SRC.NAME> is knocking at your door!
RETURN 1
ENDIF
ON=@TargOn_Item
LINK = <SRC.TARG.UID>  // Put the UID of the targeted item into LINK
RETURN 1
ON=@TargOn_Char
LINK = <SRC.TARG.UID>  // Put the UID of the targeted character into LINK
RETURN 1
This script has no real apparent use either, but put the item in front of a house, and let the house owner link it to an item of his choosing. (He would probably want to link it to his backpack because he'll have that with him all the time. He might even want to link it to himself.) When someone comes to his house, they can double-click the tile, and the house owner will get a "Knock knock" style message so he can go see what's happening at his house.
Do you understand the script? You should understand the part dealing with the IF statement, and the TARGET function. If you don't, reread the script until you do, or the earlier chapters dealing with those particular aspects of scripting. The only part here that's new is the
LINK.SAY
function, which causes the LINKed item to SAY whatever the scripter wants.
Another use for a LINKed object becomes apparent in the next chapter when we discuss the @Timer event. @Timer has no SRC, so you must find another way to access items outside of the script. LINK is just the tool for that. Read onward!
The @Timer Event
Or, how to irritate a large number of newbie Admins
This is definitely the event that causes the most confusion in scripts, on the boards, and elsewhere. Here are some things you should remember about the @Timer event:
It is triggered when the TIMER property of an ITEM (not a character) reaches zero.
The TIMER property is decreased by ONE approximately every second. If you have a huge number of items, it may be more or less than a second, which leads to some problems we will see later.
It is not always connected with the decay of an item, but to have an @Timer event work properly, the item must have attr_decay set.
There is no SRC in an @Timer event.
There is a SRC in an @Timer event if you are using TRYSRC. :)
Here's an example of the use of an @Timer event:
[ITEMDEF i_timer_test]
ID=01828
NAME=Timer Test item
ON=@Create
TIMER = 1
MORE = 0
ON=@Timer
TIMER = 1 // reset it for next time
SAY The current MORE value is <MORE>.
MORE = <MORE>+1
RETURN 1   //  If you return 0, the item WILL decay!
The beginning of the script should not cause ANY problems for you right now. Notice that we set TIMER to 1 when the item is created. One second later, the @Timer event will fire.
In the @Timer event, we make the item say the current value of the MORE property. It also sets the TIMER back to one, meaning that one second later, @Timer will execute again. This will continue until you either manually set TIMER to -1, or you destroy the item.
Here is an example of code that will not work:
[ITEMDEF i_timer_test]
ID=01828
NAME=Timer Test item
ON=@Create
TIMER = 1
MORE = 0
ON=@Timer
TIMER = 1 // reset it for next time
SRC.SAY The current MORE value is <MORE>.
MORE = <MORE>+1
RETURN 1   //  If you return 0, the item WILL decay!
You will get an error with this script. There is no SRC object in an @Timer script. None. Don't ever ever use it. I will severely berate you on the scripting boards if I see it. Then I will tell you to read this page.
So what can you do with timers?  Well you can do any number of things.  Here is an example of a useful tool using @Timer:
[ITEMDEF i_cool_stick]
ID=i_staff_black
NAME=cool stick
ON=@DClick
IF !(<SRC.TAG0.COOLSTICK>)
SRC.SYSMESSAGE You have used the cool stick. You must wait ten seconds before using it again.
TIMER = 10
SRC.TAG.COOLSTICK = 1
LINK = <SRC.UID>
ELSE
SRC.SYSMESSAGE You cannot use the cool stick right now!
ENDIF
RETURN 1
ON=@Timer
// Uh oh!  What do we do now?  We have no way to refer to the player!
// But look!  We set the LINK of the item to the player's uid.
LINK.TAG.COOLSTICK = 0
TIMER = -1
RETURN 1
What does this script do? It is a cool stick, which doesn't allow you to use it for 10 seconds after you use it the first time. It's a relatively useless item as it stands, but you might want the stick to do something, like a very powerful magic effect, or restoring mana, and then restrict its use for a while. We will see another way to do this in another section that is easier to understand. It also uses @Timer.
So let's break the script down. The entire middle section needs some commenting, so I shall cut and paste it here and add comments. It's easier than taking it line by line.
ON=@DClick
// We set the player's TAG.COOLSTICK to 1 when they use the stick the first time.
// If you don't put that 0 in there, console errors will occur sometimes ("Undefined symbol ")
// We're testing here if the TAG.COOLSTICK is set.  Remember, an IF statement only must become true or false.
// Notice that we have this:  !(0<SRC.TAG.COOLSTICK>).  In an IF statement, ! means not, so we're testing
// the opposite of what it actually is.  So if it's false, it's true, and vice versa.
IF !(<SRC.TAG0.COOLSTICK>)
SRC.SYSMESSAGE You have used the cool stick.  You must wait ten seconds before using it again.
// Set the TIMER to 10, for a 10 second pause.
TIMER = 10
SRC.TAG.COOLSTICK=1
// Set the LINK on the item to the UID of the SRC.
LINK = <SRC.UID>
ELSE  // SRC.TAG.COOLSTICK was not zero
SRC.SYSMESSAGE You cannot use the cool stick right now!
ENDIF
RETURN 1
I did an interesting thing there that you may not have picked up on. It is ALWAYS good scripting practice to indent the contents of a code block, particularly in complex scripts where it can be difficult to keep track of what is going on. Like so:
IF <blah>
. . . indent these lines
ELSE
. . . indent these lines
. . . IF <blah>
. . . . . . indent these lines further
. . . ENDIF
ENDIF
It makes it much easier to read. It also makes it easier to see if you have the same number of IFs and ENDIFs, which is always useful. Some text editors will automatically do the indenting for you.
Now, the @Timer script on this item accesses the player through the LINK object. It resets the player's TAG.COOLSTICK to zero.  The next time the player double-clicks on the cool stick, it will recognize that, and the player will use the cool stick again.
TRYSRC
There is one very hot thing about timers. It is TRYSRC. The correct syntax is: TRYSRC <uid_of_something_what_you_want_to_become_src> <function_or_command>. TRYSRC allows you to change SRC for that line only. So to contradict the above rules:
There is an SRC in an @Timer event if you are using
TRYSRC
:)
For example:
ON=@Timer
// display a message over the LINK object that can be seen by TOPOBJ (TOPOBJ is a reference to the top-most
// object that contains this object, for example the character that has the item equipped)
TRYSRC <TOPOBJ.UID> LINK.MESSAGE Hello There! // if you recall, the MESSAGE function only shows a message to SRC
RETURN 1
And another:
ON=@Timer
// place 5000 gold coins in LINK's backpack
SERV.NEWITEM i_gold
NEW.AMOUNT = 5000
TRYSRC <LINK.UID> NEW.BOUNCE // the BOUNCE function places an item into SRC's backpack
RETURN 1
That's about all you need to know about @Timer events. Later on we will move on to another confusing set of events.
TARGETs
@Targon events explained TARGETF function explained
There are four of these events:
@TargOn_Item
@TargOn_Char
@TargOn_Ground
@TargOn_Cancel
That seems rather self-explanatory doesn't it?  The event is triggered when a player targets the object type specified after the _ character. (@TargOn_Item fires when a player targets an item, for example.) Since this is very obvious, this section will be very short.
When a @TargOn event is triggered, the following objects are created:
SRC
The player doing the targetting
ARGO
The item or character that SRC has targeted
[default]
The item this script is on
Note: You can also use SRC.TARG instead of ARGO.
I believe this doesn't even require an example, but I'll give one anyway.  It's a very simple, relatively useful example, too.
[ITEMDEF i_hitching_post]
NAME=Hitching Post
ID=014e7
WEIGHT=500
ON=@DClick
SRC.SYSMESSAGE Target the creature to hitch.
TARGET
ON=@TargOn_Item
SRC.SYSMESSAGE Items can not be hitched!
RETURN 1
ON=@TargOn_Char
IF (<ARGO.BODY> == c_man) || (<ARGO.BODY> == c_woman)
SRC.SYSMESSAGE You can not hitch a human!
RETURN 1
ELSEIF (<ARGO.FLAGS> & 040000) && (<ARGO.ISMYPET>)
ARGO.FLAGS = <ARGO.FLAGS> &~ 040000
SRC.SYSMESSAGE You have released <ARGO.NAME> from the hitching post!
RETURN 1
ELSE
ARGO.FLAGS = <ARGO.FLAGS> | 040000
SRC.SYSMESSAGE <ARGO.NAME> is hitched!
RETURN 1
ENDIF
Yes, this was made by Trunks and all credit goes to him.  I found it in my script files a while back.  Not sure how it got there.
But in any case, let's analyze his script.
[ITEMDEF i_hitching_post]
First of all, this is an item.  Notice the very high weight to prevent players from picking it up and carrying it away with everyone's pets trapped on it.
@DClick
When you trigger the @DClick event on the item, it asks you which creature you wish to tie to the hitching post. Then, it pops the target up on your screen. Notice that Trunks uses TARGET and not SRC.TARGET. If you experiment with this, you'll see that SRC.TARGET gives you funny errors like "Targeted item is gone ??". Then come two @TargOn events, one for items and one for characters.
@TargOn_Item
This trigger simply exists to inform the user that he cannot target an item with this script. If this event were not present, and the user targeted an item, he would get a message similar to "You can't think of a way to use that item," which is not very clear to him.  It's better to put in @TargOn events for the things you don't want them to target as well, just for information.
@TargOn_Char
This is the meat of this item.  When the player targets a character, it first checks to see whether or not the creature is a c_man or c_woman. If it is either of those, it immediately exits the script so we cannot hitch players and NPC humans. Hitching people seems rather inhumane, doesn't it?
The next section, separated by an ELSEIF (which is the same as ELIF) statement, checks to see whether or not the creature is the user's pet, AND (&&) whether or not the creature is already hitched to the post. If both are true, it releases the animal from the hitching post. There is a slight error in Trunks' script right here. Can you find it? I'll tell you what it is at the end of the article.
The next section, after the ELSE, shows what happens if none of the above is true.  This is where your pet is hitched to the post.  I believe FLAGS 040000 is statf_stone, which holds a creature in place and prevents him from being unparalyzed by magic. Notice that we're referring to ARGO when we modify the flags, not SRC. We don't want the user targeting his pet only to find himself hitched to the post! Wouldn't that be an amusing twist?
Anyway, that covers both @TargOn_Item and @TargOn_Char. Here is a similar example for @TargOn_Ground, which is one of my test items.  It also uses a function.
[ITEMDEF i_test_targetg]
ID=01828
NAME=test targetg
ON=@DClick
TARGETG Select ground
RETURN 1
ON=@TargOn_Ground
POINT_INFO <ARGO.P>
SRC.SYSMESSAGE The point you targetted was: <VAR.TI_P>
DOSWITCH <VAR.TI_LOS>
SRC.SYSMESSAGE The point is not in your line of sight.
SRC.SYSMESSAGE The point is in your line of sight.
ENDDO
SRC.SYSMESSAGE The distance between you and that point is <EVAL <VAR.TI_DISTANCE>> tiles.
RETURN 1
[FUNCTION point_info]
IF !<ARGS>
VAR.TI = 0 // Failed
RETURN 0
ENDIF
SERV.NEWNPC = c_man
NEW.FLAGS = 04
NEW.P = <ARGS>
NEW.FIX
VAR.TI = 1 // Success
VAR.TI_P = <NEW.P>
VAR.TI_X = <NEW.P.X>
VAR.TI_Y = <NEW.P.Y>
VAR.TI_Z = <NEW.P.Z>
VAR.TI_LOS = <NEW.CanSeeLOS>
VAR.TI_SEE = <NEW.CanSee>
VAR.TI_RFLAGS = <NEW.REGION.FLAGS>
VAR.TI_DISTANCE = <NEW.DISTANCE>
NEW.REMOVE
VAR.TI_TEMP =
RETURN 0
You'll notice that all of my test items are these little alchemical tiles.  I just find 01828 easy to remember, so I use it for almost anything I'm testing. Either that or i_memory, which we haven't discussed yet.
This is a rather complicated script, especially the function.  It makes it so I don't have to type all of that stuff over and over every time I want to use a @TargOn_Ground function.  Actually, it's very useful for a lot of things, because it breaks down a point into its respective information. Here's the information returned in VAR variables from the function:
VAR.TI
1 or 0 depending on whether or not it was a success (TI = target info)
VAR.TI_P
the <P> style coordinate (x, y, z, m) of the point targeted
VAR.TI_X
the X coordinate
VAR.TI_Y
the Y coordinate
VAR.TI_Z
the Z coordinate
VAR.TI_LOS
Is the targeted location within line of sight with the user?
VAR.TI_SEE
Is it targeted item on the user's screen?
VAR.TI_RFLAGS
the flags in the region where the ground was targeted
VAR.TI_DISTANCE
the distance in tiles between the user and the targeted point
As you can see, this is an enormously useful quantity of information, and may introduce you to a number of new functions. DISTANCE returns a numerical value, and CANSEE/CANSEELOS return 1/0 boolean values.. But we're getting off track. We'll discuss those further later. Let's see what our item does.
Well first, it brings up a target with another new command:  TARGETG... basically, "Target Ground". This tells the client that you're allowed to target ground tiles rather than only items and characters. When the user actually does target the ground, the first thing that happens is that [FUNCTION point_info] is called.  This fills those wonderful VARs with the data about our point.
NOTE: If you want to gather resource or item type data about a map location keep reading, in one of the next sections there will be a method of how to get it (SERV.MAP)
.
I don't think I need to explain the rest of the code.  Refer to the table of events in chapter four for more information about the data and objects you can retrieve from the @TargOn_Ground event.
@TargOn_Cancel
This trigger is called when a player cancels the target by hitting the escape (ESC) key.
TARGETF
This is the most powerful way to target something or someone. Now you do not need any memory item for targeting.
There are two types of TARGETF function:
TARGETF f_myfunction - Allows you to target only characters and non-static items.
TARGETFG f_myfunction - Allows you to target characters, items, and ground.
TARGETFW f_myfunction - Allows you to target only characters and non-static items, and will warn against criminal action
After targeting, f_myfunction will be called with ARGO being a reference to the targeted item/NPC, and if the client is able to target ground then that position will be TARGP in the function. You can also pass arguments into the function as you can with other functions. Here is an example of a script using TARGETF, ARGO and passing arguments:
ON=@Start
TARGETFG F_MYFUNCTION <SRC.UID>, <SRC.ACTION>, <SRC.KILLS>, <SRC.ACCOUNT.LASTIP>
[FUNCTION f_myfunction]
SERV.B <name> targeted <argo.name>. Arguments are: UID <ARGV[0]> ACTION <ARGV[1]> KILLS <ARGV[2]> LASTIP <ARGV[3]>
FINDCONT, FINDID, FINDTYPE
These three commands are both functions and objects.  More specifically, they are functions that return an object, but you can think of them as objects only if you wish. Because they work like an object. Here is a summary of what they do:
FINDLAYER.x
Returns the object contained in layer x on the specified character, or zero if there is no item there.
FINDCONT.x
The value passed to this function is an integer which refers to the position of the item in the "list" of items contained within a container.  There is absolutely no way you can access this list in any particular order, or gain information about it.  It's all internal. Therefore, this function is only useful in loops (next section) to affect every item in a container.
FINDID.id
This function receives an ID and returns the first item in the container's item list with that ID.  This is faster than looping through a container looking through a particular item and is often useful for searching the character's memory items (see later chapters).
FINDTYPE.type
This function finds the first instance of a particular type in a pack.  Belgar's arrow changing script uses this function to find the first instance of a magical arrow in the user's pack.
Here are examples of the use of each.  You'll notice I use two different formats here.  Both are perfectly legal, and it's just a matter of which you prefer.  I prefer using the ( ) method, and Belgar and Swindler both prefer the . method.
SRC.SYSMESSAGE SRC.FINDLAYER(21).FINDCONT(0).NAME
SRC.SYSMESSAGE <SRC.FINDLAYER.21.FINDCONT.0.NAME>
SRC.SYSMESSAGE <SRC.FINDLAYER(21).FINDTYPE(t_arrow).UID>
SRC.SYSMESSAGE <SRC.FINDLAYER(21).FINDTYPE.t_door.UID>  // Odd example eh?
SRC.MESSAGE <SRC.FINDLAYER(layer_collar).ID>
IF (<FINDCONT(0)>)  // If this is false, the container is empty
SRC.SYSMESSAGE The container is empty.
ELSE
SRC.SYSMESSAGE The container is not empty.
ENDIF
[NOTE: layer 21 is the backpack. you could also use the
layer_backpack
defname]

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Recursive Functions
2
FOR
2.1
FOR
2.2
FORCHARLAYER
2.3
FORCHARMEMORYTYPE
2.4
FORCHARS
2.5
FORCLIENTS, FORPLAYERS
2.6
FORCONT
2.7
FORCONTID
2.8
FORCONTTYPE
2.9
FORINSTANCES
2.10
FORITEMS
2.11
FOROBJS
3
WHILE
4
TRY
4.1
TRY
4.2
TRYP
4.3
TRYSRC
4.4
TRYSRV
5
SERV
5.1
CHARDEF
5.2
ITEMDEF
5.3
LOG
5.4
MAP
5.5
NEWDUPE
5.6
NEWITEM
5.7
NEWNPC
5.8
NEWSUMMON
5.9
SKILL
Recursive Functions
I discovered this very seldom explored extension of SPHERE scripting while reading messages on the boards. Someone was trying to create a function that counted the number of items in a container using this sort of thing, and it worked for the most part. I was very amazed, because before that, no one had even thought of using functions that looped back upon themselves.
Which is what a recursive function is. I'll say it one more time.
A recursive function is one that calls itself, or recurs. Surprise!
So how do we do this? It's as simple as calling a function:
[FUNCTION recursive_test]
recursive_test
This very small piece of code in fact IS a recursive function. As you can see, the function will call itself and start over from the beginning, which will proceed to call the function again, and again, and again, and on and on. In this case, we don't have any way to stop it. This is called an infinite loop, one that will continue forever without stopping. Your server will die a flaming death.
Lesson 1: How to NOT create an infinite loop
Let me tell you right now. You will write a script that implements an infinite loop. You will test it. Your server will die. It's guaranteed. No programmer can say that they have never accidentally written an infinite loop. (RANDOM NOTE: All windows programs are in fact infinite loops. Your SPHERE server is an infinite loop.) In a SPHERE script, however, here's what happens:
The function is called.
Some stuff takes place
The function is called from within itself. Being a good scripting language, it records where it left off so it can go back later. This is called the stack.
Go back to number 1.
This "stack" builds up very very quickly, and soon the server cannot allocate any more memory for it, and will crash when it tries. Fun stuff, I tell you.
Anyways, here is one way to avoid creating an infinite loop. Let's say we want to make a function that executes SRC.SYSMESSAGE Hello World 35 times. Here would be an example of how one could do this:
[FUNCTION recurse_hello]
IF (<ARGN1> < 1)
    RETURN 1
ENDIF
SYSMESSAGE Hello World
RECURSE_HELLO <EVAL <ARGN1> - 1>
RETURN 1
Then, in another script, we would execute this command:
SRC.RECURSE_HELLO 35
Remember what ARGN is from the previous chapter? It's the argument to the function stored as a number. Initially, as you can see, it's 25 because we made it be that way. However, every time the function calls itself, or "recurses", it sets ARGN1 to be one less than itself. Here's the step-by-step analysis of this:
The function is called. ARGN1 is 35 because we said so.
It checks to see if ARGN1 is less than one. If it is, we immediately RETURN 1 and set off the chain reaction that stops the recursive function.
The next part should be fairly obvious. We're sending a SYSMESSAGE to the default object. Because we used SRC when we initially called the function, the default object is SRC.
This is where the recursion takes place. The function calls itself with an argument ONE LESS than the current one. This starts the whole thing over at step 1. This is a NEW FUNCTION CALL, remember. The original function call STILL EXISTS and the program will "rewind" back down the stack to that location later. That is why I have a RETURN 1 after the function call.
That's your example of a recursive function. It isn't very practical. Let's look at a more practical example. See if you can figure it out for yourself. This is courtesy of Belgar, for the most part:
[FUNCTION pack_to_bank]
IF (<FINDLAYER.21.FINDCONT.0.UID> == 0)
    RETURN 1
ENDIF
FINDLAYER.21.FINDCONT.0.CONT = <FINDLAYER.layer_bankbox.UID>
PACK_TO_BANK
RETURN 1
(As you can see, we don't always need an ARGS to make a function loop. In this case, we use a backpack with an unknown number of items inside and only stop when the pack no longer contains items.)
Recursive functions are very useful. Be sure you don't overuse them, though! Remember, while a script is running, YOUR SERVER IS FROZEN. If a recursive function takes too long to complete, your server will lag. A good method is to make sure that no function should be looping more than about 500 times. (Actually other server emulators such as POL have a mechanism to catch "runaway scripts" like this and halt them in their tracks.)
FOR
FOR
FOR is a powerful way to create a recursive function, and it allows a simpler level of control over your recursions.
Usage:
[FUNCTION for_display]
FOR X 1 20
    SYSMESSAGE <LOCAL.X> //Will sysmessage the current for count.
ENDFOR
The loop will loop through 20 times, starting at 1 and ending at 20. X is the variable containing the current FOR count. If no variable is declared, the count can be accessed using <LOCAL._FOR>
Changing LOCAL._FOR or whatever you declared as count, will not change the loop's behaviour. But be aware that if you "stack" FOR loops without giving them different loop variables, the innermost loop will overwrite the loop variables of its successors, usually leading towards a completely messup of the whole loop stuff.
FORCHARLAYER
FORCHARLAYER is another type of FOR loop. Basically it allows you to loop through each item that is stored on the specified layer of a character. This can be useful for when you want to manipulate all of the spell runes or memory items on a character as an alternative to using FINDLAYER.x in a loop.
Something to be aware of here is that whilst inside the loop, the default object will be temporarily changed to the item in the loop. As you can see in the following example, we must store a reference to the original default object (the character) so that we can still reference it from within the loop:
[FUNCTION get_mitems_names]
REF1 = <UID> // store the default object in REF1
FORCHARLAYER 30
    REF1.SYSMESSAGE <NAME> is a memory item in layer <LAYER>
ENDFOR
FORCHARMEMORYTYPE
FORCHARMEMORYTYPE is a very useful type of FOR loop. You may want to use it for experience systems, and some player and NPC killing systems. It loops through every memory item on a character that has a specified flag.
For example, a character has 4 memory items with the following names and flags:
Ellessar
02000
Sorea
022bc
Introvert
0740d
Enrath
0c40d
Script:
[FUNCTION get_harmedby_mems]
REF1 = <UID> // As with FORCHARLAYER, the default object changes within the loop
FORCHARMEMORYTYPE memory_harmedby // Loop through memory items with flag 00010=memory_harmedby
    REF1.SYSMESSAGE There is a memory item with name <NAME>, uid <UID>, flags <COLOR> and one of its flag is also 00010.
ENDFOR
Result:
On your screen you would see:
There is a memory item with name Ellessar, uid 04f000001, flags 02000 and one of its flag is also 02000.
There is a memory item with name Sorea, uid 04f000002, flags 022bc and one of its flag is also 02000.
There is a memory item with name Introvert, uid 04f000003, flags 0740d and one of its flag is also 02000.
</tt>
Note that there are only three messages, because the memory item "Enrath" does not have the flag 02000.
FORCHARS
FORCHARS is a FOR loop that you can use to check all mobiles (online player and NPC) within a set radius of an object.
The correct syntax being
FORCHARS x
where
x
is the radius in tiles the loop will cover.
FORCHARS 2
would check any mobile within a 2 tile radius
FORCHARS 18
would check the area inside your screen
FORCHARS 6144
would check the entire world map
One example of a function using FORCHARS
[FUNCTION kill_vendors]
FORCHARS 6144 // checks entire map
    IF (<BRAIN> == brain_vendor) //argument for what will be acted upon within this function
        KILL // action
    ENDIF
ENDFOR
As with all FOR loops you have to stipulate inside the loop what it is to act upon, if you are restricting it to certian players/npcs (or in the case of FORITEMS, items) otherwise it will perform the action upon all online players/npcs within the radius of the loop.
In this case the loop checks for any Vendor npc's and kills them.
FORCLIENTS, FORPLAYERS
FORCLIENTS and FORPLAYERS are FOR loops, both are used to affect a clients/players in certain radius. If you do not set the radius, radius 18 is used as default. While FORCLIENTS only acts on player characters who are logged in, FORPLAYERS acts on each and every player character, even if logged off.
Usage:
[FUNCTION radius_players]
FORCLIENTS 25
    IF (<ACCOUNT.PLEVEL> <= 1) // Affects only logged in players, not staff
        SAY I am here!
    ENDIF
ENDFOR
FORCONT
FORCONT is a type of FOR loop. It loops through every item in a container. The default object inside the loop will be the item currently being looped over.
Usage:
[FUNCTION rem_spellbooks]
FORCONT <FINDLAYER.21.UID> 10 // <FINDLAYER.21.UID> - UID of a container, 10 - how many subcontainers the function goes through, if set 0, it affects only items in container with UID
    IF (<BASEID> == i_spellbook)
        REMOVE
    ENDIF
ENDFOR
FORCONTID
FORCONTID is a FOR loop that works in a similar way to FORCONT, except that it will only cycle through items that have a specific BASEID. You can set the amount of subcontainers to loop through, like the FORCONT example.
Usage:
[FUNCTION rem_spellbooks2]
FORCONTID i_spellbook 10
    REMOVE
ENDFOR
FORCONTTYPE
This is another FOR loop that is almost identical to FORCONTYPE. The only difference is that instead of looping through items with a specific BASEID, it will loop through items with a specific TYPE. Following the spellbooks remover example:
Usage:
[FUNCTION rem_spellbook3]
FORCONTTYPE t_spellbook
    REMOVE
ENDFOR
FORINSTANCES
You may have seen scripts that do something like the following:
[FUNCTION removespawns]
FORITEMS 9999
    IF (<BASEID> == i_worldgem_bit)
        REMOVE
    ENDIF
ENDFOR
At a glance this script looks like a fairly useful script that can be used to remove all of your i_worldgem_bit (spawn) items from the server. If you attempt to run it you will most certainly notice that your server pauses for a signicantly long time (on a well-populated server you may even end up waiting a whole minute for the script to run), even if you only have several instances of the item on the server! The reason that this happens is because
FORITEMS 9999
will loop through
every
item within the 9999 tile radius, so the code will be looping hundreds or thousands of times when you only wanted to affect a handful of items!
To resolve this issue we have FORINSTANCES. This is a special loop which will loop through all instances of a given character or item BASEID that exist on the server. This offers the following advantages over using
FORITEMS/FORCHARS 9999
:
Sphere will only run your script for objects with the BASEID you are interested in.
Sphere knows how many instances of the object exist, so can abort the loop at an appropriate time.
Items inside containers (e.g. character backpacks or player banks) will not be missed out.
So with this in mind, the above script can be rewritten to the following:
[FUNCTION removespawns]
FORINSTANCES i_worldgem_bit
    REMOVe
ENDFOR
Now when you run this script you should notice a significant drop in the execution time.
Note:
Since Sphere still has to internally search for references to the objects you're after you may find that on well-populate servers there is still a noticable pause. If you need to use this kind of loop then you should do so sparingly, and if you need to regularly use this then you may wish to consider finding a more optimal way of implementing your script(s).
FORITEMS
FORITEMS works in much the same way that FORCHARS does, except it checks for ITEMS within the set radius as opposed to characters. Default obejct is set to the item which can be affected.
A basic example of a function using FORITEMS:
[FUNCTION Spawn_remover]
FORITEMS 6144 //once again it checks the entire map
    IF (<TYPE> == t_spawn_char) //if this arguement is met
        REMOVE //remove it
    ENDIF //end the IF arguement
ENDFOR //end the FOR loop
FOROBJS
FOROBJS works in the same way that FORITEMS and FORCHARS does with the exception that this loop will find both characters
AND
items within the specified radius.
WHILE
WHILE is a
conditional loop
, a block of code that will repeat itself whilst a given condition is true. Basically you can think of this as being an IF..ENDIF block that will run indefinately until the IF statement returns false.
ALWAYS AND ALWAYS:
End WHILE blocks with ENDWHILE.
Perform some action within the WHILE block that will change the outcome of the conditional statement.
For example:
[FUNCTION remove_all_mems]
WHILE (<FINDID.i_memory.UID>)   // continue to loop whilst an i_memory item is found inside the object
FINDID.i_memory.REMOVE  // remove a memory item
ENDWHILE
Whilst inside the loop, LOCAL._WHILE can be used to access the number of times that the script has looped so far. In some situations you may want to use this to impose a 'limit' on how many times your WHILE block can loop before it is forced to exit. An example of this could be:
[FUNCTION random_health]
WHILE (<HITS> > 10) && (<LOCAL._WHILE> < 20)  // loop whilst the character has more than 10 health, but no more than 20 times
HITS = <R1,100>    // set the character's health to a random value between 1 and 100
ENDWHILE
Since random numbers are.. random.. it is in theory possible that the health will never be set to a value less than or equal to 10. By checking LOCAL._WHILE inside the WHILE condition we add protection against the script looping indefinately and freezing the server.
TRY
TRY
TRY can be used to execute a line of script where the left hand side (i.e. a property being set or a function being called) is based on the value of an expression.
For example, we may have the following script:
LOCAL.TEST = 05
SRC.TAG0.MYTAG_<LOCAL.SOME> = 1234
Sphere will add a TAG named "MYTAG_<LOCAL.SOME>" with a value of "1234", when really we were hoping for "MYTAG_05". We can use TRY to accomplish this:
LOCAL.TEST = 05
TRY SRC.TAG0.MYTAG_<LOCAL.SOME> = 1234
This causes Sphere to evaluate the entire line first, as "
SRC.TAG0.MYTAG_05 = 1234
" and then run it, giving us the "MYTAG_05" TAG as we were after.
Note:
Since 27-11-2006 the TRY function has become obsolete. Sphere will now always evaluate the entire line before executing it.
TRYP
This is the same as the TRY function, except that a PLEVEL parameter is also supplied. If SRC's PLEVEL is less than this value then the line will not be executed, for example:
TRYP 4 UID.<TAG.CHARUID>.NAME Yerk
The above line will not be executed if SRC's PLEVEL is less than 4, so it will not run for players but it will to GM and above. This is almost the same as writing:
IF (<SRC.ACCOUNT.PLEVEL> >= 4)
    UID.<TAG.CHARUID>.NAME Yerk
ENDIF
However, with TRYP the line will also run if there is no SRC (in an @Timer trigger, for example). So a more accurate scripted equivalent would be:
IF !(<SRC>)
    TRY UID.<TAG.CHARUID>.NAME Yerk
ELSEIF (<SRC.ACCOUNT.PLEVEL> >= 4)
    TRY UID.<TAG.CHARUID>.NAME Yerk
ENDIF
TRYSRC
As already mentioned in a previous chapter, the TRYSRC function can be used to override the SRC object for a given line.
The syntax for this function is
TRYSRC uid command
, where
uid
is the UID of the character who you want to become SRC, and
command
is the command you want to execute.
ON=@Timer
    // place 5000 gold coins in LINK's backpack
    SERV.NEWITEM i_gold
    NEW.AMOUNT = 5000
    TRYSRC <LINK.UID> NEW.BOUNCE // the BOUNCE function places an item into SRC's backpack
    RETURN 1
TRYSRV
TRYSRV is similar to the TRYSRC command except that rather than running a command with a specific character as SRC, the command is instead executed with SRC set to the SERV object.
This can be desirable in the following situations:
Certain properties of accounts, such as passwords, are protected against being accessed unless SRC has a PLEVEL of 7 (owner). It would be incredibly dangerous and unwise to set a player's PLEVEL to 7, even temporarily, but the SERV object is always considered to have a PLEVEL of 7.
Certain functions/commands behave differently with a character as SRC, for example:
SERV.NEWNPC will automatically set the new NPC's position to beside the SRC character. By using
TRYSRV SERV.NEWNPC
you can avoid players seeing an NPC 'flicker' on and off their screen.
SERV
CHARDEF
Let's say you wanted to retrieve the DAM property from, say, a Liche. Because DAM isn't a character property, we can only get the property from the CHARDEF. (Technically, there is a DAM property for characters, but it is not what we're looking for.)
[FUNCTION f_return_char_prop]
LOCAL.DAM = <SERV.CHARDEF.<ARGS>.DAM>
With the above example, Sphere will take the argument passed (ARGS), then try to store the DAM property from the corresponding CHARDEF into LOCAL.DAM.
Pretty simple, right?
ITEMDEF
This works similar to SERV.CHARDEF, only it works on ITEMDEFs. Let's say you wanted to get the SKILL property from a character's equipped weapon.
Here's an example:
[FUNCTION f_return_wep_skill]
LOCAL.WEP_SKILL = <SERV.ITEMDEF.<ARGS>.SKILL>
That would store the SKILL property of whatever ITEMDEF passed (ARGS) into LOCAL.WEP_SKILL. And this can get much more complex. As an example, I recently wrote a script that does the following:
Use QVAL to find the equipped weapon.
Store the weapon found in REF1.
Check to see if REF1 returned a weapon UID.
Store the DAM property for the weapon in LOCAL.WEP_DAM.
[FUNCTION f_weapon_dam]
REF1 = <QVAL <FINDLAYER.1.UID> ? <FINDLAYER.1.UID> : <FINDLAYER.2.UID>>
IF (<REF1>) // REF1 is true; weapon found.
    LOCAL.WEP_DAM = <SERV.ITEMDEF.<REF1.BASEID>.DAM>
ENDIF
RETURN <LOCAL.WEP_DAM>
That's not too complex, is it?
LOG
This functions is very good if you want to see when a player makes something or say something or when want to know the result of formulas in your scripts. This, is for writing messages onto the console (and logs). It is really simple to use:
SERV.LOG Hi world
And when you look at console it shows something like:
21:56:(YourScript.scp,2)Hi world
Easy and useful.
Note:
If for some reason you don't want the script name to appear in the log, prefix your log message with the '@' character (prefix the message with two '@' characters (@@) if you actually want to start the message with the @ symbol.
MAP
The SERV.MAP function allows you to read the properties of a specific point on a map. There are two syntaxes that can be used:
<SERV.MAP(x,y,map)>.KEY
<SERV.MAP(x,y,z,map)>.KEY
You may notice a slight 'peculiarity' in these syntaxes and you should be aware of them so that they don't catch you out: When there are 3 parameters given, the third parameter is used as the map number to access. When 4 parameters are given, the third parameter is the height (Z) and the fourth becomes the map number.
The KEY can be a number of things:
ISNEARTYPE type distance checkmulti
Returns 1 if an item exists near the point within <distance> tiles. If <checkmulti> is 1 then multi components will also be checked.
REGION
Access the REGION at the map point.
ROOM
Access the ROOM at the map point.
SECTOR
Access the SECTOR at the map point.
STATICS
The number of static items at the map point.
STATICS.n.ID
The ID of the nth static item at the map point (n starts at 0)
STATICS.n.COLOR
The COLOR of the nth static item at the map point (n starts at 0)
STATICS.n.Z
The Z level of the nth static item at the map point (n starts at 0)
STATICS.n.*
If the STATICS.n.KEY does not match any of the above properties, the value will be taken from the static's ITEMDEF in the scripts
TERRAIN
The ID of the terrain at the map point.
TYPE
The type of terrain at the map point.
X, Y, Z, M, MAP
Access the X/Y/Z/MAP values at the map point.
COMPONENTS
The number of components items at the map point.
COMPONENTS.n.ID
The ID of the nth component item at the map point (n starts at 0)
COMPONENTS.n.Z
The Z level of the nth component item at the map point (n starts at 0)
NEWDUPE
When you use the
.DUPE
command you can create a 'clone' of a targeted item. The NEWDUPE function allows this functionality to be reproduced within scripts.
The syntax of the function is
NEWDUPE uid
, where uid is the UID of the object you want to clone. After running this function, the SERV.NEW reference will be set to the newly cloned item. You should know that it creates the 'duped' item exactly on the same spot where the targeted item exists. So you may have to move it anywhere else or it will maybe crush your stack.
Here is an example, the script below will clone the character's weapon and place it in their backpack:
[FUNCTION f_dupeweapon]
IF (<WEAPON.UID>)
    SERV.NEWDUPE <WEAPON>
    BOUNCE <NEW.UID>
ENDIF
NEWITEM
This is an easy function, used to create items. Many of you learned in 55i tutorials the format of NEWITEM, well, this changed on 56b and this is mainly to explain that change.
Now, you can't use this function on some player, you have to create it on SERV. Also, the reference to the new item isn't SRC.ACT anymore. It changed to NEW, so, if i want to create an item with the color 9, it will look like this:
SERV.NEWITEM i_example
NEW.COLOR 9
As you can see, it is really easy to use. There are also additional parameters that can be optionally passed into NEWITEM:
NEWITEM id, amount, cont, triggerEquip
So if I want to create 3 i_test in SRC's backpack I should do:
SERV.NEWITEM i_test, 3, <SRC.FINDLAYER.21.UID>,1
Easy, uh?
NEWNPC
This function can be used to create NPCs in the world. The syntax is
NEWNPC id
, where
id
is the BASEID of the character you wish to create. The newly created character can be accessed via the NEW reference.
The following function creates a headless and moves it to within 10 tiles of the default object.
[FUNCTION f_createnpc]
SERV.NEWNPC c_headless
NEW.MOVENEAR <UID> 10
Note
It is also possible to create player characters this way, by setting the ACCOUNT property after creating the new character.
NEWSUMMON
This function similar to NEWNPC but is specific to summons. This will allow you to create a new summoned creature for a specific time.
[FUNCTION f_createsummon]
SERV.NEWSUMMON=c_ogre,15
NEW.P=<p>
This example will summon and Ogre for 15 seconds at your current location.
SKILL
Well, this is an easy function, like the others. This one refers to the SKILL section.
You can see the skill properties in sphere_skills.scp. I'll explain how it works:
LOCAL.SKILL = <SERV.SKILL.<ACTION>.KEY>
With that line you get the Skill Key (Alchemy, ex.).
There are 3 ways to use SERV.SKILL: Key, Defname, Number.
Any of them are accepted, and if you see, in most of the cases people use Action to get the Key and get the player skill amount.
You can find many uses for it, all you need is some imagination.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Skill Menus
2
Menus
3
UOFiddler
4
Gumps
4.1
Part 1
4.2
Part 2
4.3
Part 3
4.3.1
Using DOrigin
4.3.2
Dynamic Dialogs using Loops and Functions
4.3.3
Dynamic Buttons
Skill Menus
One of the most common requests by newbie admins is the ability to create new things via the craft skills. I've noticed that it is also one of the first things that players check out about a shard. If your shard has awesome craftable items, chances are the player will stick around longer and gain skill so he can see them. Craftable houses are the ultimate in cool. And this section will show you how to make one. First, we'll just look at how the crafting system works.
There are about 9 built-in section names, for each of the various crafting skills. This script is called from within the server, and if those sections don't exist, you will receive many scary errors. Here is the list, which I grabbed from the top of sphereskill.scp.
// Hard coded ref names: (called directly form server)
// sm_alchemy = dclick on alch tools
// sm_summon
// sm_polymorph = polymorph menus
// sm_cartography = dclick on blank map
// sm_bowcraft = knife on wood
// sm_bolts = dclick on arrows or shafts
// sm_blacksmith = dclick on tool
// sm_carpentry = dclick on carp tool
// sm_tailor_leather = dclick on sewing kit
// sm_tailor_cloth
// sm_tinker = dclick on tinker tools.
// sm_inscription = dclick on blank scroll
// sm_cook = ??? NOT USED YET
Here is the syntax of a SKILLMENU section, like every other section in a SPHERE script:
[SKILLMENU sm_alchemy]
Now, a skill menu is the little box that pops up that contains the pictures of the items that you can scroll through and select. There are several attributes of this box which obviously need defined. The first is the title. It goes immediately underneath the [SKILLMENU] tag.
[SKILLMENU sm_alchemy]
What sort of potion do you want to make?
That line will be displayed across the top of the menu, as the title. In the case of the alchemy skill, we simply want to ask the user what type of potion he wishes to make. The next parts of the script are a little shaky, and contain some new constructs that you may or may not recognize. In reality, it's just a series of events, which occur depending on which menu item the user picks. Here's the part of the rest of the alchemy script:
[SKILLMENU sm_alchemy]
What sort of potion do you want to make?

ON=i_potion_Agility <name> (<resmake>)
    MAKEITEM=i_potion_Agility
    
ON=i_potion_AgilityGreat <name> (<resmake>)
    MAKEITEM=i_potion_AgilityGreat
    
ON=i_potion_CureLess <name> (<resmake>)
    MAKEITEM=i_potion_CureLess
    
ON=i_potion_Cure <name> (<resmake>)
    MAKEITEM=i_potion_Cure
    
ON=i_potion_CureGreat <name> (<resmake>)
    MAKEITEM=i_potion_CureGreat
    
ON=i_potion_ExplosionLess <name> (<resmake>)
    MAKEITEM=i_potion_ExplosionLess
    
ON=i_potion_Explosion <name> (<resmake>)
    MAKEITEM=i_potion_Explosion
    
ON=i_potion_ExplosionGreat <name> (<resmake>)
    MAKEITEM=i_potion_ExplosionGreat
    
ON=i_potion_HealLess <name> (<resmake>)
    MAKEITEM=i_potion_HealLess
As you can see, we still use the ON= event construction for these menus as well. The different is what follows. Let's dissect it:
ON=i_potion_HealLess <name> (<resmake>)
This line tells the server a number of things. The first parameter, immediately following the = sign, is the ID of the item to display. So, what will be displayed here is the DISPID of the i_potion_HealLess item. It happens to be a yellow potion. As soon as you specify this item, it becomes the default item for the rest of that line. The server knows that
<NAME>
refers to the name of the potion item, and that
<RESMAKE>
is a string which tells what it takes to make that item. Both of those are specified in the script for i_potion_HealLess (which is in sphere_item_provisions_potions.scp) and can easily be changed there (looks for NAME= to change the name and SKILLMAKE= to change the skill and difficulty).
MAKEITEM=i_potion_HealLess
Well if this isn't obvious, you shouldn't be reading this chapter. It simply begins the construction of the specific item. Wait, you may be asking, how does the server know which skill to use or how much skill is required, or even what to consume (1 empty bottle) when creating this item. Well, I'm glad you asked. To answer that, we need to look at the script for the item we're constructing. Ah, here it is....
[ITEMDEF i_potion_HealLess]
NAME=Lesser Heal
ID=i_bottle_YELLOW
RESOURCES=i_reag_ginseng, i_bottle_EMPTY
SKILLMAKE=ALCHEMY 0.1
TYPE=T_POTION
TDATA1=i_bottle_empty

ON=@Create
    MORE1 = s_heal
    MORE2 = 50.0
The two important lines are the
RESOURCES
and
SKILLMAKE
lines. These two lines work with the skill system to tell SPHERE what items are used to make this item. Basically, it says that when you create the item, you need 1 i_reag_ginseng and 1 i_bottle_empty. Incidentally, if you don't have the resources to make an item, it won't even appear on the list when you look at the SKILLMENU in-game. The next line tells the server which and how much skill is required to make this item. In this case, it says we need 0.1 in the alchemy skill. It IS just a lesser heal, after all.
Take your new i_potion_HealLess to a store and try to sell it. Magically, it seems to have a price. Where did that price come from? Well, it came from the RESOURCES. The value of a lesser heal potion is the combined value of the i_reag_ginseng and the i_bottle_EMPTY. Both of these are defined in sphere_item_resources.scp. This brings us to a point so important, I am going to put it in bold:
An item MUST have either a VALUE or resources with a VALUE, or it will not appear in a SKILLMENU!
Many newbie scripters ask on the boards about why their item is not appearing in an otherwise perfect SKILLMENU section. It has nothing to do with the SKILLMENU. Look at your item scripts before whining to us on the boards.
Another important point is this: You may have any number of lines between ON= events in a [SKILLMENU] section. It just happens that MAKEITEM does everything for us that we need it to do, so most scripts only have one line. However, you could print out a SYSMESSAGE or KILL a player within a SKILLMENU, just as easily as you could do it in any other event.
Now that we know this fact, let's build that craftable house I was referring to! First, we need to figure out what sort of RESOURCES we might want to use to craft a house. I would say a large amount of wood, maybe some metal for a doorknob, a deed to write on, and some magic just for the heck of it. We'll take a resources like that looks like this:
RESOURCES=1000 i_board, 100 i_ingot_iron, 5 i_reag_garlic, i_deed
We also need a SKILLMAKE definition, and for this we'll use the Carpentry skill. Say, 95.0. Then we'll put those lines into the ITEMDEF for the deed we want to make craftable:
[ITEMDEF i_craftable_deed]
ID=i_deed
NAME=Deed to a Small Stone House
RESOURCES=1000 i_board, 100 i_ingot_iron, 5 i_reag_garlic, i_deed
SKILLMAKE=CARPENTRY 95.0

CATEGORY=Provisions - Deeds
SUBSECTION=House Deeds
DESCRIPTION=Small Stone House

ON=@Create
    MORE1 = i_multi_house_stone_small
This, if you haven't figured it out, is a copy of item 04202, which has been renamed and edited. You can find the original script in sphere_item_deed.scp. Now, our item has a SKILLMAKE definition, and a VALUE definition (through the RESOURCES). It is craftable. We need to stick it into one of the existing Carpentry [SKILLMENU] sections now. Let's look at one of them:
[SKILLMENU sm_carpentry]
Carpentry

ON=i_board boards
    MAKEITEM=i_board
    
ON=i_chair_throne Chairs
    SKILLMENU=sm_wood_chairs
    
ON=i_chest_wooden_brass Containers & Shields
    SKILLMENU=sm_wood_containers_shields
    
ON=i_table_nightstand Table
    SKILLMENU=sm_wood_tables
    
ON=i_staff_gnarled Weapons & Tools
    SKILLMENU=sm_wood_weapons_tools
    
ON=i_armoir_dk Furniture
    SKILLMENU=sm_wood_furniture
    
ON=i_portrait_7 Paintings
    SKILLMENU=sm_wood_paintings
    
ON=i_trophy_deerhead Trophies
    SKILLMENU=sm_wood_trophies
    
ON=i_saddle Rancher Types
    SKILLMENU=sm_wood_rancher
    
ON=i_BED_9 Beds
    SKILLMENU=sm_wood_beds
    
ON=i_bulletin_board Miscellaneous
    SKILLMENU=sm_wood_misc
Like I said earlier, you can have any lines after an ON= section. In this case, it just happens to be a SKILLMENU line which opens up another menu. This is a hierarchical menu, because you choose from upper menu options like these, and go through lower menus, until you finally reach an item you can craft. Now, we're going to add the following two lines to the end of this script:
ON=i_craftable_deed <name> (<resmake>)
    MAKEITEM=i_craftable_deed
Guess what? We're done. That's all you need to do. Now, in most cases, you would make a new [SKILLMENU sm_houses] or something similar, and then add all of your items to that. In that case, the line you'd add to the main Carpentry menu (or one of the submenus) is the following:
ON=i_deed Craftable Houses
    SKILLMENU=sm_houses
That's all. Easy, isn't it? It's one of the easiest things to script, and one of the coolest. Unfortunately, it is so easy and repetitive that it takes FOREVER to make a good crafting system. If you are going to create one for your shard, start now. You should be finished in about a month. :)
Menus
If you paid attention in the previous section, this section should be very simple for you. It is so much easier to make a simple menu than a skillmenu. And, when you see how to read from buttons in a GUMP, you will see how similar it is to this. Basically, in SPHERE, there are occasions when you may want to bring up a menu for the user to choose from. Say, when they choose the "Help Desk from Hell" option on your help menu.
Do that. Right now. See how a menu pops up and asks if the user really wants to go to the help desk from hell? He can choose Yes, or No, and something different will happen in each case. Here's what the script for that menu might look like:
[MENU m_helpdesk]
Do you REALLY want to go to the Help Desk from Hell?  You will be stuck until a GM comes to free you!

ON=0 Yes
    SRC.GO Help Desk from Hell
    
ON=0 No
    SRC.SYSMESSAGE Help request cancelled.
    
ON=0 I'm a monkey.  Kill me.
    SRC.KILL
It looks awfully familiar, doesn't it? Here's what each part does. (I'll only take the first four lines, because the next ones are self-explanatory if you understand the first four.
[MENU m_helpdesk]
This is rather obvious. In a script, you would call this menu like this:
MENU m_helpdesk
Difficult eh?  :)
Do you REALLY want
...
Like the skillmenu, this is the title of this section. The next thing I am about to discuss will determine where it is displayed.
ON=0 Yes
Aha, this is the new part. Remember what the first parameter to this section in a [SKILLMENU] was? Well, it's the same thing. That is the ITEM ID that the menu is supposed to display. However, we don't want a scrolling item-based menu, but rather a menu where we can select an option from a list. When you put a 0 for the ITEM ID, SPHERE will automatically assume that you want to create a text-based MENU. However, the catch is, you must put 0 for EVERY SINGLE OPTION in your menu, or else you will get a scrolling item menu like a SKILLMENU. In our case, we want to give the user options in text format, because our menu wouldn't make much sense with scrolling items for its purposes.
SRC.GO Help Desk of Hell
You know what this does. I just want to point out that the user of the menu is SRC, and the default object is whatever the MENU was called upon.
That's about all it takes to make a menu. Of course, you can put any commands you want after the
ON=
section, and there can be much more than one line. In fact, for most menus, there will be. That was easy, wasn't it? :)
UOFiddler
UO comes with almost 4000 gumps. You aren't going to want to try each one in a script until you figure out which is which. You're going to need some sort of a program that shows you the gump. That program is UOFiddler, which has come to be as useful to SPHERE scripting as a sword to a warrior. Here's a link to download it:
Download UOFiddler
It's a zip file so you need WinZip or a similar tool to extract it. Unzip it to your main SPHERE directory (where SphereSvr.exe is). If you are running a Linux server, just unzip it to somewhere on your Windows computer. It doesn't run in Linux, sorry. Now, when you run the program, you will need to enter the paths of your MUL files. In most cases, that's your the folder where you installed UO (hopefully). Go to the View menu and select File Paths. Sometimes, it will automatically detect the location of your files, in which case you don't have to do anything.
Now, click on the GUMPS button along the sidebar and wait for it to load the index file. It will have a huge list of gumps from 00000001 to some other large number. Look down through them, write some interesting ones down, because you won't want to search back through the list every time you need a specific gump ID.
Also, you're going to be needing backgrounds, which come in 9 parts. I'll explain that when we get there, but if you see a series of items, which look like they'd fit together, write that down, because it would make an excellent background.
One more thing to note before we move on to the next section: The gump IDs you see here are in HEXADECIMAL. SPHERE will only accept gump IDs in decimal. This is one of those times when you need to break out the Windows Calculator and do some conversions.
Note:
UOFiddler is the most popular tool for viewing the contents of the UO files but it is not the only one out there. Check out the
Third Party Tools
page for a list of other programs which you may want to use.
Gumps
Congratulations. If you've made it this far, you're way past where many scripters reach. Unfortunately, this is also where many scripters hit a brick wall. Gump scripting, especially gump designing, is one of the hardest things for a scripter to do. Rather than easy-to-remember scripting commands such as REMOVE and NEWITEM, you get cryptic looking strings of letters and numbers, which are made even more complex when they use variables. Due to the difficulty, I've split the Gump Scripting 101 section into three parts. The first part shows the setup and syntax of some of the commands. The second part shows the rest of them. The third part will explain some more advanced techniques that can be used to create dynamic dialogs using relative coordinates, loops and dynamic buttons.
Part 1
First, we need to look at the setup of a gump script, which is different than any script you've seen so far. The tag SPHERE uses to recognize a gump script is
DIALOG
. I will use the words dialog and gump interchangeably throughout these sections. Unfortunately, GUMPs come in three parts: The dialog itself, the strings that go into the dialog, and the button responses. Those couldn't all be in one section, so SPHERE has divided things up like this:
[DIALOG d_test_dialog]
... Code for the dialog layout goes here ...

[DIALOG d_test_dialog TEXT]
... The text that will be displayed in the dialog goes here ...

[DIALOG d_test_dialog BUTTON]
... The events that are triggered when buttons are pressed goes here ...
Now, dialogs are made up of a number of different types of objects. You can have text boxes, buttons, checkboxes, text entry boxes (which you can change), and other various other things. They're each identified with a syntax that looks a lot like a function call. Here is the list of all the commands you can use with dialogs. I'll explain each of them in detail later.
Dialog Objects
resizepic <x> <y> <gumpback> <width> <height>                                // can come first if multi page. put up some background gump
dorigin <x> <y>                                                                                              // Sets a dynamic origin point
checkertrans <x> <y> <width> <height>                                                                        // add a trasparent layer (only for clients >= 3)
gumppic <x> <y> <gump> <hue>                                                                                 // put gumps in the dlg. (hue only for clients >= 3, otherwise ignored)
gumppictiled <x> <y> <width> <height> <gump>                                                                 // tile a gump
tilepic <x> <y> <item>                                                                                       // put item tiles in the dlg.
tilepichue <x> <y> <item> <hue>                                                                              // put colored item tiles in the dlg.
text <x> <y> <color> <stringindex>                                                                           // put some text here.
dtext <x> <y> <color> <text>                                                                                 // put some text here.
croppedtext <x> <y> <width> <height> <color> <stringindex>
dcroppedtext <x> <y> <width> <height> <color> <text>
htmlgump <x> <y> <width> <height> <stringindex> <hasbackgroud> <hasscrollbar>                                // add an html gump that show a text
dhtmlgump <x> <y> <width> <height> <hasbackgroud> <hasscrollbar> <text>                                      // add an html gump that show a text
xmfhtmlgump <x> <y> <width> <height> <clilocid> <hasbackgroud> <hasscrollbar>                                // add an html gump that show a cliloc text
button <x> <y> <Down_gump> <Up_gump> <pressable(1/0)> <pagedest> <id>
buttontileart <x> <y> <up_gump> <down_gump> <pressable> <page> <id> <tileid> <tilehue> <x offset> <y offset> // Add a button with tileart.
textentry <x> <y> <width> <height> <color> <id> <startstringindex>                                           // Height should be 20
dtextentry <x> <y> <width> <height> <color> <startstringindex> <text>                                        // Height should be 20
textentrylimited <x> <y> <width> <height> <color> <id> <startstringindex> <limit>                            // Textentry with a limit of characters
dtextentrylimited <x> <y> <width> <height> <color> <id> <limit> <text>                                       // Textentry with a limit of characters
tooltip <clilocid>                                                                                           // popup a tooltip over a gump object (only for clients >= 4)
radio <x> <y> <gump1> <gump2> <starting_state> <id>
checkbox <x> <y> <gumpcheck> <gumpuncheck> <starting_state> <checkid>
page <page_number>                                                                                           // for multi tab dialogs.
group                                                                                                        // used to group groups of radio buttons - Group 1, Group 2, etc.
nomove                                                                                                       // The gump cannot be moved around.
noclose                                                                                                      // The gump cannot be closed
nodispose                                                                                                    // not really used  (modal?)Yes, those look complicated now, and if you want to stick with easier scripting for a while, I don't blame you. As you can see, we have all of the required objects to make a nice form, like on a website, or even to make a website-type interface. I'll show you in a later chapter how make hidden buttons and such things like that. It's not as hard as it seems.
Now, we have to discuss design. All gumps should start out like this:
[DIALOG d_test_gump]
0,0
page 0
... Some objects here ...
page 1
... More objects here ...
0,0 is the position that the dialog will start on the screen. 0,0 means this dialog will appear with its upper left corner in the upper left corner of the game screen. It is possible to make a dialog start elsewhere, but it is really pointless unless the dialog is small.
Dialogs are divided into pages, and only one page can be displayed at a given time. I'll show you later how to switch between pages with buttons. However, page 0 is always displayed under the other pages. If you have something that you don't want to change between pages (like a background or a title on top of the gump), you put it on page 0. Otherwise, it goes on another page. Page 1 is displayed by default when a dialog appears.
Now, let's add a background to our gump. Since it's something we want to stay, we'll put it in page 0. Open up your InsideUO and we'll find a good background. The piece that you're looking for is that top left corner piece. (Most things in gumps deal with the top left corner of an object.) Find the one numbered A3C in the gump list of InsideUO. That's the background we're going to use. Actually this is a background you'll use a lot, because it's plain black with a gold border. Translating that number into hexadecimal, we get 2620. Remember that number, it's important.
The command used for backgrounds is resizepic. Look at the chart above, and you'll see what information we need to give it for a resizepic: an x coordinate, a y coordinate, a gump id, a width, and a height. We have all of those things. We'll put it at (0,0) for coordinates, and let's say we make it 500 width and 300 height. Here's the new script:
[DIALOG d_test_gump]
0,0
page 0
resizepic 0 0 2620 500 300
page 1
That's all. Now put that into a script and type
.dialog d_test_gump
in-game. You'll see that we have a nice black background. It's good to be in-game while you're creating gumps, because you can test it after each new addition. Sometimes if you're off by as little as 25 in your coordinates, things will look strange. It's much easier to fix things one at a time than it is to type the entire gump script, then find out you screwed up somewhere.
Now, let's add some text to our gump. We'll say "Hello World" because that seems to be the standard for making new things in programming! There are two ways to store text, either inside the dialog or in the TEXT section. If your text is going to be used often, it's better to put it in the [DIALOG d_test_gump TEXT] section so you don't have to edit the same word every single time you want to change it. Otherwise, you can just add the text directly into the main dialog section. Here is an example of both:
Using the TEXT section:
[DIALOG d_test_gump TEXT]
<VAR.BLANKLINE>
Hello World
Each line has an index, starting with zero. For the first line, I always like to make a string that will evaluate to nothing, because sometimes you want empty text. I'll show you why later. Also, it makes it easier to think of your first line of text as 1 rather than 0. In our case, because Hello World is in position 1, we refer to it with text id 1. Here's what the whole script will look like now. Obviously, we're going to use that text object from the chart. We will put it at (50,50) and give it a color of 1152 (which happens to be white). We're also going to put it in page 1, because we don't want it to be there forever. Actually, I'll show you something else while we're at it.
Using text inside the main gump:
It's much simpler than adding it to the TEXT section. Just use the
dtext
object:
dtext 50 50 1152 Hello World
Much simpler! I'll be using both examples from here on. Here's what our whole script looks like now:
[DIALOG d_test_gump]
0,0
page 0
resizepic 0 0 2620 500 300
page 1
dtext 50 50 1152 Hello World
text 50 70 3 1

[DIALOG d_test_gump TEXT]
<LOCAL.BLANKLINE>
Hello World

[DIALOG d_test_gump BUTTON]
// Nothing here yet!
See how easy it is to add text? You can also reuse text by using the same text id. If you look at this dialog in-game, you'll see that "Hello World" is written twice, because we have two text objects with Hello World. The second one is displayed 20 pixels (dots on the screen) below the first. As a general rule, all text should be assumed to be 20 pixels in height. (It's actually closer to 16, but some big letters take up more space.)
You'll also see that they are in different colors. As a general rule, the color ID for dialog text is the color ID in-game minus 1. So black is 0, dark blue is 1, etc. New colors (like my hues.mul colors) will not display in any expected manner in a dialog, so stick to the default colors. Also, these colors are in DECIMAL, so you're going to need to convert things again. (Incidentally, color 1152 decimal is 0480 hexadecimal which happens to be that ice-blue color on an item.)
Now that we've added text, we can experiment with a button. Obviously, we're going to use the button object to add a button to our gump. We need a lot of information for this button object, so I'll just copy the definition here for your reference. I'll go over each part in turn.
button <x> <y> <gump id (down)> <gump id (up)> <active> <page #> <index>
Here is what each does:
<x> <y>
This is the position of the top left corner (see?) of the button image. Try to keep dialog pieces off one another, because they will overlap in the order they are placed in the script. We're going to put our button at (50, 90), right below the second line of text.
<gump id>
When you press a button, it changes the picture to show that the button is in a "down" position. For our button IDs, we'll use 9A8 (2472) and 9A9 (2473). This is a red diamond shaped button that is rarely used. It has the same gold border as our background, so it'll look nice. Notice that the order is down, then up. The order of the images is up (2472), down (2473), so we'll have to switch the numbers in our script.
<active>
This is a switch determining whether or not the button will return an event (1) or switch pages (0). Until we discuss pages in a later section, this will always be 1. (Thanks Belgar!)
<page #>
If the button will be used to switch pages, this is the page that will be displayed. Keep in mind that you should put something on the other page to switch back to the first one. You don't want to frustrate your users with a crappy interface. Put 0 if the button doesn't switch pages.
<index>
This is used in responding to events, as we'll see shortly. Make it a high number, probably starting in the thousands. Since this is our first button, we're going to call it button 1000. Index 0 is RESERVED, meaning you shouldn't use it for an ordinary button (we'll see why later).
Here is the whole script now:
[DIALOG d_test_gump]
0,0
page 0
resizepic 0 0 2620 500 300
page 1
dtext 50 50 1152 Hello World
text 50 70 3 1
button 50 90 2473 2472 1 0 1000

[DIALOG d_test_gump TEXT]
<LOCAL.BLANKLINE>
Hello World

[DIALOG d_test_gump BUTTON]
ON=1000
    SYSMESSAGE You pressed button 1000!
Ooh! A new construct! The
ON=1000
you see in the button section of our dialog is how you respond to a button press. It acts just like any other ordinary event after that line. It means "When the button with ID 1000 is pressed, execute this event." In an ON event, SRC is the player operating the dialog and the default object is whatever the
DIALOG
command was used on. (On the sidenote, you can also use ONBUTTON= instead of ON=)
Thus ends the first section on gumps and dialogs (which are the same thing). With this information you should be able to make just about any sort of gump you want, by playing with text and button positions. The possibilities are almost endless, and after you read Part 2, they will be endless. I have only used the information you will read in Part 2 twice in my entire long scripting career.
Part 2
You've survived the first part of dialog scripting, and you're well on your way to designing some spectacular gumps I'm sure. OSI has provided us with a huge array of gumps, any of which you may use in your scripting. You might be surprised to see that all of the clothing and paperdoll type items are gumps and are listed with the others in InsideUO (at the bottom). There's even a leather dominatrix type uniform in there, and a whip, but that doesn't seem to have ever been used in UO as an item. Too bad.
As you know, no form would be complete without text-boxes to fill in, checkboxes to click, and radio buttons to select from. There is no shortage of gump IDs to use for these purposes, but most of them don't really fit on a normal gump (because they were made for other purposes). What I like to do is use a different background than the one we were using, and then stretch ANOTHER resizepic of the type we were using over top of the first one. Here, look at this example from my messaging system to see what I mean:
page 0
resizepic 0 0 5100 640 170
resizepic 15 155 5100 175 40
button 100 161 <eval g_btn_gray_apply> <eval g_btn_gray_apply_press> 1 0 901
button 20 161 5200 5201 1 0 900
text 5 10 1152 1
resizepic 5 30 2620 600 35
textentry 15 36 600 20 1152 1 0 // 4 text fields now
resizepic 5 57 2620 600 35
textentry 15 63 600 20 1152 2 0
resizepic 5 84 2620 600 35
textentry 15 90 600 20 1152 3 0
resizepic 5 111 2620 600 35
textentry 15 117 600 20 1152 4 0
Don't worry about the name or the TEXT and BUTTON sections. Notice that I have constructed a rather odd gump here. As you can see, for each textentry object, I have another resizepic object. Put this in a script (with the appropriate header tags) and look at it to see what it does.
Look carefully at the coordinates, widths, and heights of each highlighted part. If you're going to use this method, there is a particular place that you must position each so the text doesn't overlap other parts of the dialog when the player begins typing. That is called an offset. If one object is at (5, 30), and another is at (15, 36), that is an offset of (10, 6). I've discovered that the (10, 6) offset works well for space between the gold-bordered background and a textentry object.
textentry <x> <y> <gump width> <gump height> <color> <index> <text id>
Anyways, notice that the text id of each textentry field is 0. By default, the textentry field will be filled with whatever text id you give it. The player would then have to erase that to type something new, and that gets irritating. So, that's why I made the <VAR.BLANKLINE> be text id 0. There is nothing in the box when it appears, which is handy. See? There is rhyme to my reason, you just have to wait a while to get it.
You can also use
dtextentry
, which acts similar to dtext and doesn't require something under the TEXT section. See below for an example.
Now, when your gump returns, you're going to get a lot of data from each of those textboxes. Notice how each of them have an index? SPHERE has provided us with a nice variable array (yes, a REAL array) called ARGTXT which contains all of the text returned. You use
ARGTXT[x]
to refer to the text from textentry index x. Here is a full dialog example (actually it's the same one as above, but with some modifications).
[DIALOG d_test_textentry]
page 0
resizepic 0 0 5100 640 170
resizepic 15 155 5100 175 40
button 100 161 <eval g_btn_gray_apply> <eval g_btn_gray_apply_press> 1 0 901
button 20 161 5200 5201 1 0 900
text 5 10 1152 1
resizepic 5 30 2620 600 35
textentry 15 36 600 20 1152 1 0 // 4 text fields now
resizepic 5 57 2620 600 35
textentry 15 63 600 20 1152 2 0
resizepic 5 84 2620 600 35
textentry 15 90 600 20 1152 3 0
resizepic 5 111 2620 600 35
dtextentry 15 117 600 20 1152 4 // using dtextentry, you can ommit the text or add some as you wish.

[DIALOG d_test_textentry TEXT]
<VAR.BLANKLINE>
Enter the message you wish to send.

[DIALOG d_test_textentry BUTTON]
ON=901 // The apply button
    SRC.SYSMESSAGE You type <ARGTXT[1]> in textentry index 1!
    SRC.SYSMESSAGE You type <ARGTXT[2]> in textentry index 2!
    SRC.SYSMESSAGE You type <ARGTXT[3]> in textentry index 3!
    SRC.SYSMESSAGE You type <ARGTXT[4]> in textentry index 4!
    RETURN 0 // Yes, you can have RETURNs in a dialog
This script should work fully. I did remember something while I was typing it, so I'll tell you now. The client depends on the information being sent by SPHERE, which you provide in your script, especially with the [DIALOG TEXT] section. If you refer to a text id that is not there, your client WILL crash. It is easier to crash a client with dialogs than anything else in the game. On my old server, if there was a player I didn't like, I would put an event on his character so a client-crashing gump would appear every time he logged in, no matter what. The GMs used to go crazy trying to fix that. :)
My example should help you understand the syntax of getting data from a textentry box. Now you can make forms rather than just still-life dialogs. Remember, you don't need the resizepic background, because a textentry will work no matter what. It just helps the player know where to type.
Part 3
Here I'm going to add a few tips and tricks to make scripting your dialogs easier, as well as explaining some of the newer features.
Using DOrigin
DOrigin lets you set a dynamic origin point while still retaining your static origin which you set at the top of the dialog. When setting the x,y coordinates of other elements such as dtext you can specify them as offsets of dorigin rather than using fixed coordinates.
[DIALOG d_test]
50,50 // This is your static origin point
Page 0

resizepic 0 0 9300 150 100
dtext 10 10 1152 This is a test dialog

dorigin 10 10           // this is your dynamic origin point
dtext *0 *20 100 Test 1 // here I set this text to display at 10x 30y
dtext +50 -0 100 Test 2 // now I offset this text by +50x and keep the same y as the last entry to use *'s. It appears now at 60x 30y
dtext *0 *20 100 Test 3 // here I set the text to display at 10x 50y
dtext +50 -0 100 Test 4 // As with Test 2 it is offset by +50x and same y, so in theory it's really at 60x 50y
dtext *0 *20 100 Test 5 // Same as Test 3 but now at 10x 70y
dtext +50 -0 100 Test 5 // Same as Test 4 but now at 60x 70y
What makes this so powerful is that we can now simply copy and paste the last two lines over and over to add more rows without having to each time calculate the x's and y's. This gets especially usefull when you have more than two columns and will prove even more useful when using loops (more on that later). You can now also move the whole "block" of Test text left, right, up or down by simply changing the dorigin. Try it out for yourself, set dorigin to 50 30 and all your text will move 40 right.
There are three different ways that you can specify relative coordinates:
Syntax
Description
-n
n is subtracted from the origin, the origin point does not change
+n
n is added to the origin, the origin point does not change
*n
n is added to the origin, the origin is changed to the new position
You can also mix and match different relative and fixed coordinates types. Here are some examples, assuming that DOrigin has been set to 50 50:
Example
Line Result
DOrigin Result
dtext -10 -20 100 Text
dtext 40 30 100 Text
50 50
dtext +10 +20 100 Text
dtext 60 70 100 Text
50 50
dtext *10 *20 100 Text
dtext 60 70 100 Text
60 70
dtext *20 100 100 Text
dtext 70 100 100 Text
70 50
dtext +30 *20 100 Text
dtext 80 70 100 Text
50 70
dtext +0 *20 100 Text
dtext 50 70 100 Text
50 70
Dynamic Dialogs using Loops and Functions
Lets take the dialog above and see if you can make it shorter in the script but at the same time have 20 lines of Test text! Sounds impossible? Not at all, Sphere can use functions inside dialogs, so anything you can do in a script you can do in a dialog.
[DIALOG d_test]
50,50
page 0

resizepic 0 0 9300 150 440
dtext 10 10 1152 This is a test dialog

dorigin 10 10
FOR 20
    dtext *0 *20 100 Test <dLOCAL._FOR>
    dtext +70 -0 100 Test <dLOCAL._FOR>.1
ENDFOR
Now imagine that we have to use these FOR loops lots of times inside our whole dialog, or maybe even in more than one dialog. Isn't there an even easier way to do this? Yep there is, using a function:
[FUNCTION f_test_text]
FOR 20
    dtext *0 *20 100 Test <dLOCAL._FOR>
    dtext +70 -0 100 Test <dLOCAL._FOR>.1
ENDFOR
Now we just add it to our dialog, but this time we're going to add a second set of text to the left by creating another dynamic origin point!
[DIALOG d_test]
50,50
page 0

resizepic 0 0 9300 350 460
dtext 10 10 1152 This is a test dialog

dorigin 10 10
dtext *0 *20 100 Left Columns
F_TEST_TEXT

dorigin 100 10
dtext *0 *20 Right Columns
F_TEST_TEXT
Pretty cool isn't it! This is just the beginning, the rest I'll leave to your scripting talent! :)
Dynamic Buttons
Lets take the same dialog and function as before and just modify it slightly so it all looks like this:
[DIALOG d_test]
50,50
page 0

resizepic 0 0 9300 350 460
dtext 10 10 1152 This is a test dialog

dorigin 10 10
dtext *0 *20 100 Left Columns
F_TEST_TEXT 100

dorigin 200 10
dtext *0 *20 100 Right Columns
F_TEST_TEXT 130

[DIALOG d_test BUTTON]
ON=100 120	// handle button IDs 100 to 120
    SRC.SYSMESSAGE You have pressed button <EVAL (<ARGN1> - 100)> from the left column!
    DIALOG d_test
    
ON=130 150	// handle button IDs 130 to 150
    SRC.SYSMESSAGE You have pressed button <EVAL (<ARGN1> - 100)> from the right column!
    DIALOG d_test
    
[FUNCTION f_test_text]
FOR 20
    button *0 *20 5603 5607 1 0 <EVAL (<LOCAL._FOR> + <ARGN1>)>
    dtext +50 -0 100 Test <dLOCAL._FOR>
ENDFOR
As you can see I have added a parameter (aka argument) to the
f_test_text
function. In this case it is to be the button starting range that I want for the button that is replacing one Test text column.
In the BUTTON part of the dialog I have regrouped the buttons, from 100-120 will be the 20 buttons of my left column and from 130-150 there will be the my 20 right column buttons. When pressing a button,
<ARGN1>
is the button number, hence using the EVAL in the BUTTON section to find out what the "virtual" button is (the real one remaining <ARGN1>).
It's pretty simple and with a bit of playing around you should get this to work easily. Good luck!

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
How to "install" [EVENTS]
2
The order of event handling
3
Item-based events
4
Environmental Events
4.1
Information for Advanced Scripters
5
The Clicky Events
6
NPC-based Events
7
The Elusive @Death Event
8
Combat Events
How to "install" [EVENTS]
A basic event looks like the following:
[EVENTS defname]
code
Looks just like every other thing we've done so far doesn't it? Well events work the same way. They can be installed either in-game our through a script using the following:
EVENTS +defname
EVENTS=defname
EVENTS -defname
These are three very different commands. Some people tend to confuse them. Here is what they do:
EVENTS +DEFNAME
Adds the event to the character's list of events. Yes, a character can have more than one event. Both of the following will respond to triggers called on the character:
SRC.EVENTS +e_death_event
SRC.EVENTS +e_ctf_event
EVENTS=DEFNAME
This method is should not be used. It will erase all other events on the character in place of this one.
EVENTS -DEFNAME
This will remove the specified event from the character.
THE DEFAULT OBJECT OF AN [EVENTS] SCRIPT IS THE CHARACTER ON WHICH THE SCRIPT IS INSTALLED.
The order of event handling
There are quite a few ways to add events to items or characters. These are:
EVENTS +DEFNAME
Can be set by a function, another event, a player action, or inside a trigger (for example, the @Create trigger).
TEVENTS=DEFNAME
In the body of the ITEMDEF or CHARDEF. There may be as many of TEVENTS lines as you wish.
TYPE=DEFNAME
(Items only) In the body of the ITEMDEF. There can only be ONE base type definition. TYPEs are not only events, they also determine some basic behaviour of the item, and it's capabilities (for example, if an item is not of an equippable type, it cannot be equipped).
DIRECT TRIGGERS
Poor man's events: As events are generally assortments of triggers what can be added to an item or character. You may also "hardcode" some trigger actions in the ITEMDEF/CHARDEF itself.
ORDER OF FIRING
Look at these simple code examples:
[ITEMDEF i_triggertester]
ID=i_floor_wood
TYPE = t_testtype
NAME=TriggerTester
TEVENTS=e_tev_test

ON=@Create
    EVENTS +e_ev_test
    
ON=@DClick
    SERV.LOG item dclick from direct trigger
    
[TYPEDEF e_ev_test]
ON=@DClick
    SERV.LOG dclick from event
    
[TYPEDEF e_tev_test]
ON=@DClick
    SERV.LOG item dclick from tevent
    
[TYPEDEF t_testtype]
ON=@DClick
    SERV.LOG item dclick from base typedef
This gives the following results:
item dclick from event
item dclick from tevent
item dclick from base typedef
item dclick from direct trigger
The same for characters:
[CHARDEF c_testorc]
ID=c_orc
NAME=TestOrc
TEVENTS=e_tev_character

ON=@Create
    STR = 100
    
ON=@NPCRestock
    EVENTS +e_ev_character
    
ON=@DClick
    SERV.LOG char dclick from direct trigger
    
[EVENTS e_tev_character]
ON=@DClick
    SERV.LOG char dclick from tevent
    
[EVENTS e_ev_character]
ON=@DClick
    SERV.LOG char dclick from event
The results:
char dclick from event
char dclick from tevent
char dclick from direct trigger
Item-based events
There are two main types of events:
ITEM EVENT
Triggered when any player interacts in a certain way with a given item.
PLAYER EVENT
Triggered when a given player interacts in a certain way with ANY item or performs certain tasks, such as moving, casting a spell, crafting an item, etc.
In the item script, the item is the default object. In the player script, the player is the default object.
So what are these events? Well here's a short list of some of them:
@itemDClick  - Triggered when the player double-clicks any item.  The reference object for the item is ACT.
@itemEquip   - Triggered when the player equips any item.  The reference object for the item is ACT.
@itemUnEquip - Triggered when the player unequips any item.  The reference object for the item is ACT.
@itemClick   - Triggered when the player double-clicks any item.  The reference object for the item is ACT.
@itemStep    - Triggered when the player steps on any item.  The reference object for the item is ACT.
Notice anything similar between those descriptions? If you don't, I think you need to go back and take reading lessons. That's right. In ANY script beginning with @item, ACT is the item acted upon. How about that. Why do you suppose they called it ACT?
In any case, for @item scripts, the following is true:
ACT = the item acted upon
SRC = the character doing the acting (the player with the event)
[]  = the character doing the acting (the player with the event)
Notice that in this case, SRC and the default object both refer to the character. THIS IS NOT ALWAYS THE CASE. If you want to refer to the character, get in the habit of using the default object rather than SRC in an event. Now, let's take a look at a rather useless event:
[EVENTS e_test_events]
ON=@itemStep
    SYSMESSAGE You have stepped on <ACT.NAME>!
    RETURN 0
Put this script in one of your files and resync your server. Now, go in-game and type:
.xevents +e_test_events
Target yourself. Congratulations, you just installed an event on yourself. From this point forward, until you remove the event, any time you walk on an item, you'll get an irritating message. Try it. Go around walking on things! Make an item called "a bug" and walk around stepping on them.
Ok stop walking on things and continue reading now. :)
Here's a little secret I bet you've already guessed: ALL ITEM EVENTS (except @Timer) HAVE AN @item COUNTERPART. This means that @itemPickUp_Pack, @itemTargOn_Char, @itemTargOn_Item, and all others should all (in theory) work.
Environmental Events
This chapter serves to explain only one event, because we need to introduce some concepts beforehand. The first concept we're going to introduce is that of the
SECTOR
. In the game, the map is divided not only into regions, but into sectors as well. Sectors represent portions of the map that by default are 64 tiles wide and 64 tiles high. They can overlap between regions (for example, one sector is the upper corner of Britain and most of the Britain graveyard). They hold information such as light level, weather, and complexity information.
Also, the world is divided vertically into bands, which we shall call LOCAL areas here. This is used for the purpose of realistic fading of light during sunsets and a real "revolving" world effect.
How do we manipulate these sectors? Well, there is a SECTOR object that is available to you in any script, and it refers to the sector in which the specific object sits. This SECTOR object has a VERY limited number of variables and functions:
COMPLEXITY
Returns the number of characters (both PC and NPC) in the sector. This is useful if you have a huge effect-based script and you don't want to lag up everyone in a sector. It's also useful so NPCs don't spam huge portions of speech in crowded areas. If you look in the speech files provided with the game, you'll see this in use.
SEASON <integer>
One of the most interesting features of the SECTOR, this controls which "seasonal" graphics the client displays. The values you can pass to this function are:
Value
Description
0
Spring time season (lots of flowers)
1
Summer time season (this is the default)
2
Fall season (all trees have "fall" leaves and there are a lot of mushrooms)
3
Winter season (the ground is covered in snow and the trees have no leaves)
4
Dead season (no leaves on trees, gravestones and gore everywhere)
LIGHT <level>
Holds a value between 0 and 30 that represents the light level, with 0 being full daylight and 30 being pitch black. On pre-T2A clients, 18 is the darkest LIGHT value. If you give it a value, it will set the light to that level. If not, it will set the light level to whatever its default value happens to be at that time. (See LOCALLIGHT.)
LOW
Actually used - COMPLEXITY.LOW. Returns 1 if the complexity is within the "low" level.
MEDIUM
Actually used - COMPLEXITY.MEDIUM. Returns 1 if the complexity is within the "medium" level.
HIGH
Actually used - COMPLEXITY.HIGH. Returns 1 if the complexity is within the "high" level.
ALLCLIENTS <function call>
This can be used just like SERV.ALLCLIENTS or REGION.ALLCLIENTS. Any function given here will be executed on any player in the SECTOR. This is not a wise one to use, because the player could in fact be in a different sector than you expect.
RAIN
This makes it rain for all players in the sector.
SNOW
Makes it snow for all players in the sector. (Doing SECTOR.RAIN, then SECTOR.SNOW is interesting. You get this weird rain/snow mix.)
DRY
Turns off both rain and snow.
RESTOCK
Causes all spawnpoints to double-click themselves and reset any spawns in the area. Useful if you just changed the loot on something.
ISDARK
Tests the light level of the sector to see if it is below a "dark" threshold.
ISNIGHTTIME
There is a clock that is kept in LOCAL areas, like timezones in real life. This checks the clock to see if it is "night" in the area. It does not necessarily have to be dark.
LOCALTOD
Returns the LOCAL time of day for this "time zone".
LOCALTIME
Returns the LOCAL time in a format like this: "quarter past seven in the evening"
LOCALLIGHT
The light level in unaltered sectors in this LOCAL area. Used by LIGHT when you call that function without parameters.
Now, back to what we were originally discussing.
The event associated with the SECTOR is
@EnvironChange
. This is a surprisingly useful event because it fires every time ANY of those sector variables are changed. That includes LOCALTIME, meaning that @EnvironChange will fire approximately once every ten seconds. (It depends on the speed of the game clock on your server.)
This makes @EnvironChange the only repeating event for characters. (Actually there is another, but you haven't learned about REGION functions yet.) This may not seem very useful, but let's take a look at a script from the sphere_events_human.scp file.
[EVENTS e_Human_Environ]
ON=@EnvironChange	// 1
    IF (<FLAGS> & statf_war)	// 2
        RETURN 0
    ENDIF
    IF !(<SECTOR.ISDARK>) || (<FLAGS> & statf_nightsight)	// 3
        IF (<FINDLAYER.layer_hand2>)	// 4
            IF (<FINDLAYER.layer_hand2.TYPE> == t_light_lit)
                FINDLAYER.layer_hand2.BOUNCE
            ENDIF
        ENDIF
        RETURN 0
    ENDIF
    // already have a lit light ? (5)
    IF (<FINDLAYER.layer_hand2>)	// 6
        IF (<FINDLAYER.layer_hand2.TYPE> == t_light_lit)
            RETURN 0
        ENDIF
    ENDIF
    // type to use a torch or light source if I have one. (and it's dark) (7)
    IF (<FINDTYPE.t_light_out>)	// 8
        FINDTYPE.t_light_out.EQUIP
        FINDTYPE.t_light_out.USE
    ENDIF
    RETURN 0
Well, this is different. This is our first rather complicated example script, so let's take it slowly. First of all, you can see it's in an [EVENTS] section, with the defname of e_Human_Environ. (If you look through spherechar_human.scp, you'll see this event installed a lot on the NPCs.) This script makes the character equip a torch, if he has one, based on the light level. It's a cool event when it becomes night and all your NPCs are walking around town with torches to light their way. Basically, this script has the following steps:
When the SECTOR changes, the event fires
We check to see if the character is in war mode by checking his FLAGS using the & operator. If he is, we don't want him to do anything, so we RETURN from the script immediately.
Next, we check the character's sector to see if it's dark. In the same IF statement we check to see if the NPC has the Nightsight FLAGS set. If he does, he can't tell that it's dark anyway, and so it doesn't matter if he has a torch or not. According to the structure of our IF statement, it becomes true if SECTOR.ISDARK is NOT true (!) OR (||)
<FLAGS> & statf_nightsight
evaluates to true.
If it is NOT dark outside, OR the character has nightsight on, we don't want him to have a torch equipped, so we check his hand (layer_hand2) for a torch. IF he has one, we use the BOUNCE function on the torch to place it in the character's backpack. The script then RETURNs.
The next section of the script is only reached if it is BOTH dark outside and the character does not have nightsight on.
It checks to see if there is already a light in the character's hand (layer_hand2). If there is, we don't need to equip another one so the script exits. You must always do a check like this in these kinds of scripts. Remember, @EnvironChange will take effect almost once every ten seconds. We don't want him equipping a new torch every ten seconds.
The only possible way to reach this point in the script is if the following conditions have been met: it is dark outside, the character does NOT have nightsight, and there is no torch equipped on the character.
The very last section checks to see if the character has any torches equipped in his backpack. Remember, FINDTYPE will return the first instance of an object of a given type (in this case t_light_out) in the character or any sub-containers (his backpack).
So what's a REAL use for this event that doesn't involve torches? Well, if you look through sphereevents.scp, you'll find another [EVENTS] section called e_undead, which makes dead creatures very very weak when it's light outside, and their normal strength at night. It uses a TAG to temporarily store their normal strength.
You'll see another use for the @EnvironChange event at the end of the chapter. I take advantage of the fact that it's a periodic event (that is, it repeats a lot).
And a final piece of advise for you to think about:
Be careful when calling functions that change the environment (i.e. changing season, weather, light), from within the @EnvironChange trigger
.
Remember that the @EnvironChange triggers fires when SECTOR properties change? What do you think might happen if you if used the following script?
// don't run this!
ON=@EnvironChange
    SECTOR.LIGHT += 1
    RETURN 0
Do you see what is going to happen? The sector's light is going to be incremented by 1 when the trigger fires, but when this happens the trigger will fire again because the environment has been changed, and this will cause the light to be incremented again, which will cause the trigger to fire again, which will cause the light to be incremented again... Quite clearly, this is not a good thing and your server will crash or freeze within seconds of this script running. If you must insist on changing the environment under the @EnvironChange trigger then you must put in a conditional statement which will prevent the server from entering an infinite loop, for example:
ON=@EnvironChange
    IF (<SECTOR.LIGHT> != 5)
        SECTOR.LIGHT = 5
    ENDIF
    RETURN 0
This will set the light level to 5, but only if it is not 5 already (Sphere is already intelligent enough to not fire the trigger again if you set the LIGHT to the same value it already had, but the idea should be clear)
Information for Advanced Scripters
There is a way to refer to all of the sectors within a region. It works a little like ALLCLIENTS, in that it will run a function on all sectors. This is a good way to change the season for an entire region. If a region is contained within another (i.e. Britain contained within Britain Territory), it will be affected if you use this command on the surrounding region.
REGION.SECTORS
For example:
REGION.SECTORS SEASON 3
This will set all sectors in the region to the "winter" season. Keep in mind that sectors can "overlap" regions, meaning that you may get some winter in other surrounding regions as well.
The Clicky Events
@DClick, @Click, and @Profile
These events are surprisingly underused since they have so many specific purposes. Here's a summary of what they do:
@Click
User has been clicked by someone.
@DClick
User has been double-clicked by someone.
@Profile
Someone is trying to look at the user's profile.
Now, these are three events where the RETURN value is exceedingly important. All of them have very expected default actions, such as the following:
Trigger
Default Action
@Click
The character's name pops up above his head (An allnames macro counts as @Click)
@DClick
The character's paperdoll pops up
@Profile
The character's personal profile pops up
Now, if you RETURN 0 or 2 from any of these events, the default action will take place. The user's name will pop up as usual, or their paperdoll will appear on the clicker's screen. But there are occasions where you don't want this to happen. For example, I created an event for one of my custom spells which allowed the user to double-click any creature for a given amount of time and shoot fireballs at that player.
Here's an example script for the @Click event. This puts [MURDERER] above the player's name when he's clicked if his kills are above a certain amount. I had something similar on my server Talocon where new players (players with skills below a certain level) received a [NEWBIE] tag and certain protections.
[EVENTS e_murderer]
ON=@Click
    IF (<KILLS> > 5)
        MESSAGE [MURDERER]
    ENDIF
    RETURN 0  // Display his name
We want to use a message here, rather than a SYSMESSAGE or a SAY so the text appears above the default object. In this case that's the player containing this event. SRC happens to be the player doing the clicking. It could be the same if someone clicks him- or herself, but that's usually not the case.
(Remember, to install the events, we use the command in-game .events +e_murderer. In a script we use the same command without the dot.)
We RETURN 0 from this event so that the player's name will actually be displayed. We could easily use a MESSAGE to put the player's name above his head, but it wouldn't be in the specific color necessary.
Here's an example of the @DClick event. The effect of this event is to prevent players from seeing paperdolls of those outside of their guild. You'll also learn here how to check whether or not two people are in the same guild.
ON=@DClick
    IF (<SRC.UID> == <UID>) // did the player double click himself?
        RETURN 0
    ELSEIF (<SRC.MEMORYFINDTYPE.memory_guild.LINK.UID>) && (<SRC.MEMORYFINDTYPE.memory_guild.LINK> == <MEMORYFINDTYPE.memory_guild.LINK>)
        SRC.SYSMESSAGE You are in the same guild.  You may view this paperdoll.
        RETURN 0 // let them see the paperdoll
    ENDIF
    RETURN 1         // don't
I don't know if you'd want to use this event in your shard or not. Remember, it's up to you what your shard is like!
Perhaps the most unused event is @Profile. It could be incredibly useful for various applications on a server.
ON=@Profile
    DIALOG d_info
    RETURN 1
You should have learned about dialogs in
Chapter 8
. For now you need to know that this script would make a dialog called d_info appear on the screen of the SRC (the profile clicker). Perhaps contained in this dialog could be information about the person whose profile has been clicked. It may be that you want to include an IF statement like so:
ON=@Profile
    IF (<SRC.ISGM>)
        DIALOG d_info_gm
    ELSE
        DIALOG d_info
    ENDIF
This would check first to see if the user was a GM and display a different amount of information. You've seen in
Chapter 8
how you can customize the appearance of this dialog down to the most detailed level.
These are just a few applications of these events. As you can probably imagine, as with anything else in SPHERE, the applications are limitless.
NPC-based Events
Hmm, you may be saying. How do we tell if an event can be used on a player or just on NPCs? (Remember, " NPC " means any computer-controlled character, be it a monster, a vendor, a banker, or anything)
Well, there's a rather easy way. Let's look at a list of some NPC-only events:
@NPCAcceptItem   // NPC accepts item (needs)
@NPCHearGreeting // hear greeting (can be triggered by most speech i found)
@NPCHearNeed     // someone mentions sopmething i want (needs)
@NPCHearUnknown  // rather obvious
@NPCRefuseItem   // NPC don't want this (needs)
@NPCRestock      //vendor/ npc restocks.. Auto called at on=@Create
@NPCSeeNewPlayer // see new player
@NPCSeeWantItem  //see something i want (needs)
Those aren't my comments. :) Something else you'll notice is that some of them comment about this concept of NEEDS. We'll cover that in this section as well. Actually, why don't we cover that first?
If you look in an NPC script, it'll have a property called DESIRES. It looks something like this:
DESIRES=i_gold
This means that the NPC wants gold. It's a NEED of this NPC to acquire gold. He wouldn't be happy otherwise. And we all know what happens when you get an NPC angry. (They say "Shut up and fight, coward!") Other NPC needs are, for example, fire for fire elementals, or t_crops for crows. Sometimes there's even t_grass for animals like sheep. But humans don't need to eat. All they need is money. I believe that an NPC will also accept any item that it sells (someone verify this).
Now that you understand this concept of desires and needs, here's a more descriptive list of these events:
@NPCAcceptItem   - An item is dropped onto the NPC and identified as one of the NEEDS of this NPC. RETURN 1 will bounce the item back to where it came from. The item is stored in ACT.
@NPCHearGreeting - Someone speaks directly to this NPC who hadn't spoken to him before. The NPC will remember for a short time that the player talked to him. (See later chapters on memory.)
@NPCHearNeed     - Someone says the name of one of the needs of the NPC. Such as "gold". In this event, the variable <needname> will print out the name of the need that was spoken.
@NPCHearUnknown  - Someone says something the NPC does not understand. This is where the "Huh?" and "I don't understand thee!" come from.
@NPCRefuseItem   - An item is dropped onto the NPC that he has no NEED for. The item is bounced back to where it came from. The item is stored in ACT.
@NPCRestock      - This occurs about once every half hour. BUY and SELL items should be placed under this event, along with any loot and clothing you want on your NPC. This is also called on creation of the NPC (since technically, he IS restocking for the first time).
@NPCSeeNewPlayer - The most useful of the NPC events, this one fires when the NPC sees a player he didn't previously see. RETURN 1 from this event will prevent the NPC from remembering that he has seen the player, and RETURN 0 will let him remember.
@NPCSeeWantItem  - The NPC sees something he wants on the ground and walks toward it.
Now let's see some examples of the use of these events. The examples that come with SPHERE (i.e. in sphereevents.scp in the 55i package) are huge and complex and deal with a lot of sector complexity and karma issues to determine which response to give. Each event has about 30 potential spoken responses.
So here's a simpler example using what I see as the most useful of events. This could, for example, be placed on a new NPC to give him special abilities. We're going to assume that when this NPC is standing still, he is invisible. Actually in the last section, you're going to see the completed script for this NPC.
ON=@NPCSeeNewPlayer
    IF (<DISTANCE> > 5) // If the player is more than 5 steps away
        RETURN 1  // Don't remember him so the event fires when he gets closer
    ENDIF
    // We can only get this far if he is closer than 5 steps away
    SAY Boo!
    INVIS 0
    ATTACK // Attacks the SRC of the event
    RETURN 0
This simple script would make a surprisingly diverse number of creatures with just a few variations. Do you understand it? Well, if you don't here's my explanation:
The NPC sees a player it doesn't remember seeing before and the event takes place.
We check to see how far away the player is. DISTANCE will return the distance the object referenced (in this case the default object) is from the SRC of the event (in this case the player who is being seen). If the player is too far away, we don't want the NPC to react. This event fires as soon as the creature first notices a player nearby, meaning up to about 12 tiles away depending on the player's resolution. We return 1 here so the NPC will forget that he saw the player and the event will fire again a second or so later.
If the player is close enough, the NPC appears (INVIS 0) and says "Boo!" to scare the player. It then proceeds to attack him. We RETURN 0 at the end of this second section because we don't need the NPC to forget the player again.
This is a rather simple script, and you'll see one big example that utilizes almost every useful character-based event.
The Elusive @Death Event
Here are the object references available to you from within the @Death trigger:
@Death Objects
SRC = the creature being killed
[] = the creature being killed
Any experienced admin will have encountered a particular obstacle when using this trigger. How do we know who killed the player? For a long time ACT was considered to be the killer, and many still believe this is the case. In fact, if you were to right now add an @Death trigger to a player, kill them, and check their ACT. You would more than likely discover that ACT did indeed point to the killer, yet here I am telling you that
ACT is _NOT_ the killer in @Death!
You can protest all you like, but it is a simple fact that the ACT reference is completely meaningless within the @Death trigger. ACT is used by various internal systems and means different things. For example if you were to get a player to craft an item and then target them
.xhits 0
they will die, and you will discover that ACT actually points to the item the player was crafting with!
If you want to determine who killed someone, there are two safe ways of doing so:
Use the
@Kill
trigger, which fires when one character kills another (not discussed in this chapter)
Use the
ATTACKER
property, which allows you to access a full list of characters which have harmed a character.
Anyway, back to the topic at hand.
Have you ever played Asheron's Call or Everquest? When you die in either of those games, you are returned to a particular location of your choosing, but you must choose the location prior to death. We're going to make a system similar to that. Here's the script, and then I'll explain it:
[PLEVEL 1]
deathpoint

[FUNCTION deathpoint]
IF (<REGION.FLAGS> & region_flag_guarded)  // Are they in a guarded area?
    // If so, we need to set this as their new death location.
    TAG.DEATH_LOC = <P>
    EVENTS +e_death
ENDIF
RETURN 1

[EVENTS e_death]
ON=@Death
    IF (<BRAIN>)  // We don't want this script on NPCs by accident (player brain  = 0 = false)
        RETURN 0
    ENDIF
    RESURRECT // Prevent death
    IF !(<ISEMPTY <TAG.DEATH_LOC>>) // make sure the TAG has is not empty/blank
        GO <TAG.DEATH_LOC>
    ELSE  // No tag, send them to a default location, such as Britain
        GO Britain
    ENDIF
    RETURN 1 // No death recorded, no corpse left behind
I think that this requires a little explanation. First, we use a function differently than we've seen in the past:
This is an in-game command. You use it by typing .deathpoint in-game. In an in-game function, the objects are as follows: The person executing the function is the SRC. If they would type .xdeathpoint rather than .deathpoint, they would get a target. The target of the function is the default object.
When the player uses this function, we check to see if he's in a town. The purpose of this function is to let the player decide the place he goes when he dies. It can be any location as long as it's within the guarded area. So if he is in a guarded area, we simply store his current position into a TAG. We also install the event e_death on the player. Look over it until you understand what's going on. There's nothing here we haven't seen before.
The next part is an [EVENTS] section, which contains an @Death event. (Duh.) I think that the only part of this script that isn't things we've done before (or explained rather clearly in the comments) is the purpose of the <ISEMPTY ...> function in the middle of the event. Say, by some strange fluke in the game, this player has the e_death event installed, but the value for TAG.DEATH_LOC hasn't been set yet. When the @Death script is triggered (by the death of the player), we run into the following statement:
GO <TAG.DEATH_LOC>
If TAG.DEATH_LOC has no value, this statement is meaningless and you WILL get an error. So we use the following statement to check if it has a value:
IF !(<ISEMPTY <TAG.DEATH_LOC>>)
If the tag does have a value, this will evaluate to some scary number, which is not blank and therefore true. If it has no value, the statement simply becomes
IF !(<ISEMPTY >)
, which of course is false.
The @Death event can be a powerful tool if used wisely. A few other things it could be used for:
Special race abilities (i.e. Last Chance, Final Attack type abilities)
A leveling system where NPCs have the @Death event to give experience to the killer
What you just saw up above
Like I said in the beginning, this tutorial isn't here to give you free scripts. It's here to teach you HOW to script. Although in two more sections you're going to get a free script all for yourself! Can you wait?  :)
Combat Events
@Hit, @GetHit, @SpellEffect, @SpellCast
These are some fun events. They can also cause your server to crash, which we'll get to in just a minute here. Let's look at the objects associated with each one now:
@Hit
SRC = The character being hit
[] = The character doing the hitting
ACT = The character being hit
@GetHit
SRC = The character doing the hitting
[] = The character being hit
ARGN1 = The amount of damage done
ARGN2 = The type of damage done
@SpellEffect
SRC = The character casting the spell
[] = The character being hit by the spell
ARGN1 = The spell number (or defname, look in sphere_spells.scp)
ARGN2 = The spell strength
@SpellCast
SRC = The character casting the spell
TARG = The target of the spell
ARGN1 = The spell number (or defname)
These are very useful events, especially the @Hit and @SpellEffect events. You can use @Hit to make an NPC do a spell-type attack rather than a normal attack, if you wanted to. I'm going to show you an example that Swindler and I came up with a while back. You can use @SpellEffect to make a character immune to certain spells, or make certain spells do more damage. You can use @SpellCast to prevent the character from casting certain spells.
Here's the full text of the @Hit portion of one of our scripts:
ON=@Hit
    IF !(RAND(10))
        SRC.EFFECT = 3,i_fire_column,6,31,0
        SRC.DAMAGE {20 40}
        SFX = snd_spell_flamestrike
        ELIF !(RAND(15))
        SFX = 0054
        SERV.NEWITEM = i_sakara_fire
        NEW.TIMER = 15
        NEW.P = <SRC.P>
        NEW.MOVE <EVAL (RAND(6))> <EVAL (RAND(6))>
        SERV.NEWITEM = i_sakara_fire
        NEW.TIMER = 15
        NEW.P = <SRC.P>
        NEW.MOVE <EVAL (RAND(6))> <EVAL (RAND(6))>
        SERV.NEWITEM = i_sakara_fire
        NEW.TIMER = 15
        NEW.P = <SRC.P>
        NEW.MOVE <EVAL (RAND(6))> <EVAL (RAND(6))>
        SERV.NEWITEM = i_sakara_fire
        NEW.TIMER = 15
        NEW.P = <SRC.P>
        NEW.MOVE <EVAL (RAND(6))> <EVAL (RAND(6))>
        SERV.NEWITEM = i_sakara_fire
        NEW.TIMER = 15
        NEW.P = <SRC.P>
        NEW.MOVE <EVAL (RAND(6))> <EVAL (RAND(6))>
        SERV.NEWITEM = i_sakara_fire
        NEW.TIMER = 15
        NEW.P = <SRC.P>
        NEW.MOVE <EVAL (RAND(6)) - (RAND(6))> <EVAL (RAND(6)) - (RAND(6))>
        SERV.NEWITEM = i_sakara_fire
        NEW.TIMER = 15
        NEW.P = <SRC.P>
        NEW.MOVE <EVAL (RAND(6)) - (RAND(6))> <EVAL (RAND(6)) - (RAND(6))>
        SERV.NEWITEM = i_sakara_fire
        NEW.TIMER = 15
        NEW.P = <SRC.P>
        NEW.MOVE <EVAL (RAND(6)) - (RAND(6))> <EVAL (RAND(6)) - (RAND(6))>
        SERV.NEWITEM = i_sakara_fire
        NEW.TIMER = 15
        NEW.P = <SRC.P>
        NEW.MOVE <EVAL (RAND(6)) - (RAND(6))> <EVAL (RAND(6)) - (RAND(6))>
        SERV.NEWITEM = i_sakara_fire
        NEW.TIMER = 15
        NEW.P = <SRC.P>
        NEW.MOVE <EVAL (RAND(6)) - (RAND(6))> <EVAL (RAND(6)) - (RAND(6))>
    ENDIF
You obviously don't have the rest of this script, but just know that i_sakara_fire is a valid item and it won't cause an error. Actually it's a fire field-looking item that does a lot of damage if you step on it.
You'll see a few interesting things in here. First of all is Swindler's creative use of the RAND function in an IF statement. This assures that the special effects only happen rarely. The two effects we're dealing with here, if you can't tell from the script, are:
A single flamestrike on the player (1 in 10 chance of happening)
An explosion that leaves i_sakara_fire scattered all over the place (1 in 15 chance)
The IF statements assure that we only have a 1 in 10 chance for the first event to happen. When RAND(10) is evaluated (all statements in an IF are sent through EVAL), it picks a number from 0 to 9. In this particular situation, we're looking for that 1 in 10 chance that the RAND(10) evaluates to zero. This makes the IF statement false, but look, we have the NOT (!) symbol in there:
IF (! false) becomes IF (true)
If the first random statement results in a zero, we get the flamestrike effect. There are several methods of doing this, but Swindler chose to use an EFFECT (see the command list) statement and some damage. He also added a sound effect, which is something I always forget to do in my scripts. It makes it very impressive to those who actually play with their sound on.
If the first statement results in anything other than a zero, it becomes false, thanks to the NOT symbol. We skip to the next section, which begins with ELIF. This is the section which creates a lot of items and uses SRC.ACT.MOVE to move them relative to their original position. These items happen to be i_sakara_fire items, which cause some damage when a player steps on them. Here's the part you may be having some trouble with:
SRC.ACT.MOVE <EVAL (RAND(6)) - (RAND(6))> <EVAL (RAND(6)) - (RAND(6))>
This is Swindler's very interesting way to get values between -5 and 5. You could just as easily write a random selector {-6 6}. However Swindler's method seems to have this interesting factor built in that the numbers tend be more likely to be closer to zero than -5 or 5. Let's see how that works:
RAND(X) will return a number between 0 and (X - 1). For example RAND(9) returns any number between 0 and 8. So the lowest possible value of Swindler's RAND(6) is 0 and the highest possible value is 5. Notice that we have two of them:
RAND(6) - RAND(6)
We're subtracting one number between 0 and 5 from another. If one happens to be 0 and the other is 5, the answer will be 0 - 5  =  -5. If it is the other way around, the answer will be 5 - 0 = 5. However, as we get closer to the middle, the numbers are the same. There is more of a chance of receiving a small number (3 - 2 = 1, 2 - 1 = 1, 4 - 3 = 1, etc) than a large one. This makes the script more interesting! :) Don't deny it. It's interesting. Say it. "This script is interesting." Now shut up and keep reading.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Basic String Explanation
2
String Functions
2.1
EXPLODE
2.2
STRARG
2.3
STREAT
2.4
STRCMP
2.5
STRCMPI
2.6
STRLEN
2.7
STRPOS
2.8
STRREVERSE
2.9
STRSUB
2.10
STRTOLOWER
2.11
STRTOUPPER
2.12
STRTRIM
2.13
STRMATCH
2.14
STRREGEX
Basic String Explanation
This section will explain how to handle strings (separation, comparing, transforming, reversing, storing). Hope you enjoy it.
First, we're gonna start with the separations ways of Sphere. The most common and simple is using comma (,). Most of Sphere's functions use it as a separator and it is easier than using a space. Also, the space is a valid one but not really used at all. With this function you can see why:
[FUNCTION f_test]
SERV.LOG Arguments :: <ARGV>
SERV.LOG Arg. 1 :: <ARGV[0]>
SERV.LOG Arg. 2 :: <ARGV[1]>
SERV.LOG Arg. 3 :: <ARGV[2]>
SERV.LOG Arg. 4 :: <ARGV[3]>
If we enter "
.f_test Hello to all World
" in-game we should see something like this in the Sphere console:
23:01:(Test.scp,2)Arguments :: 1
23:01:(Test.scp,3)Arg. 1 :: Hello To all World
23:01:(Test.scp,4)Arg. 2 ::
23:01:(Test.scp,5)Arg. 3 ::
23:01:(Test.scp,6)Arg. 4 ::
This means that we have only 1 argument and it's our complete string. This is not too useful because later we will have to cut it using the
STRARG
or
STREAT
functions. But if we check what happens if we use commas, by typing "
.f_test Hello,to,all,World
":
23:02:(Test.scp,2)Arguments :: 4
23:02:(Test.scp,3)Arg. 1 :: Hello
23:02:(Test.scp,4)Arg. 2 :: To
23:02:(Test.scp,5)Arg. 3 :: All
23:02:(Test.scp,6)Arg. 4 :: World
We now have the whole string separated into arguments ready for our script. Pretty Simple, uh? Well, this is just the start.
We can do almost whatever we want with a string: Comparing, cutting, removing, moving, etc.. To see all of the valid functions check the
list below
. They're heavily explained.
String Functions
EXPLODE
The EXPLODE function can be used to convert a string into a comma-delimited list based on one or more delimiters. The resultant string can then be passed into a function where you can then use ARGV to access the individual pieces.
The syntax for the command is:
EXPLODE separators, string_to_separate
See the following example, which separates a string by both the "-" and "+" characters and logs the output to the Sphere console:
[FUNCTION f_explode]
F_EXPLODE_LOG <EXPLODE -+,<ARGS>> // separate string by - and +, passing result into the F_EXPLODE_LOG function

[FUNCTION f_explode_log]
SERV.LOG ARGV Length = <ARGV>           // output number of comma-separated arguments
FOR 0 <EVAL (<ARGV> - 1)>               // loop through each argument
    SERV.LOG ARGV[<LOCAL._FOR>] = <ARGV[<LOCAL._FOR>]>	// output individual arguments
ENDFOR
STRARG
STRARG can be used to extract the first word from a string. The following example demonstrates this:
[FUNCTION f_strarg]
SERV.LOG <STRARG One Two Three>
You will see the word "One" output to the console.
STREAT
STREAT is the counterpart function to STRARG. Whereas STRARG gives you the first word in a string, STREAT will 'eat' the first word from a string and return the remaining text. The following code shows the difference:
[FUNCTION f_streat]
SERV.LOG <STREAT One Two Three>
You will see the text "Two Three" output to the console.
STRCMP
Sooner or later you may find the need to compare one string to another. You may start out by attempting to write the following line:
IF ("String1" == "String2")
If you tried to do that you would find an ugly looking error on the Sphere console, and your IF statement would simply not work correctly at all. This is because IF statements are designed to compare numerical values, and so cannot understand how it can compare two strings.
So you need to find out if "String1" is equal to "String2", right? Well, that's why we have STRCMP. Let's look at the basics of it.
STRCMP(string1, string2)
Now, before you start to use this you should be aware that this function does not simply compare two strings for equality. STRCMP actualls compares two strings to determine if they are less than, greater than, or equal to each other! Therefore, this function has three different return values:
Return Value
Meaning
-1
string1 is less than string2
0
The two strings are equal
1
string1 is greater than string2
It's important to bear these return values in mind when using the function, as you will quickly discover, the function actually returns
false
(0) when the two strings are equal to each other!
Take a look at the following at the following example:
IF !(STRCMP(<SRC.NAME>, Tiny))
    SRC.SAY My name is Tiny!
ENDIF
You might be asking, "Why didn't you have to surround the function with < > there?".
Well, STRCMP is not a 'normal' function. It is known as an
intrinsic function
, a special kind of function that can only be used inside an <EVAL ...> statement and rather than being surrounded by < > it instead has its arguments surrounded by brackets ( ).
"Wait, but that STRCMP
isn't
inside an EVAL!?" you may say, but this is not actually the case. Inside conditional statements (such as
IF
and
WHILE
), Sphere automatically treats the entire line as if it were inside an EVAL function, and so the above script will work fine for comparing strings.
Another thing you should remember is that STRCMP is case-sensitive, and so "STRING1" will not be equal to "string1". If you want to perform a case-insensitive comparison, use
STRCMPI
instead.
STRCMPI
The STRCMPI function can be used to compare two strings, ignoring their case. Apart from being case-insensitive this function is identical to
STRCMP
.
STRLEN
This function can be used to count the number of characters in a string. For example:
LOCAL.LENGTH = <EVAL STRLEN(<ARGS>)>
Let's say the value of ARGS is "This one has 26 characters". The value of LOCAL.LENGTH will be 26.
STRPOS
The STRPOS function can be used to locate the position of a particular character within some text. The syntax of the command is:
STRPOS pos ch string
Parameter
Meaning
pos
The position to start searching from (first character is position 0)
ch
The character to search for, or the ASCII code of the character
string
The text to search in
Here are a couple of examples:
LOCAL.POS = <STRPOS 0 32 Where is the first space>  // returns 5
LOCAL.POS = <STRPOS 3 e Where is the first 'e'>     // returns 4
STRREVERSE
This function simply reverses the order of a string. For example:
SERV.LOG <STRREVERSE Hello>
The above line of code will output "olleH" into the console.
STRSUB
STRSUB is used to extract a series of characters from a string. Why is it useful? Well I can't think of a specific reason right now, but I'm sure you'll be able to handle that.
[FUNCTION TestStrSub]
SERV.LOG <STRSUB 0 1 Hello>
As you can see, STRSUB takes three parameters. The first parameter is the start location (zero-based). The second parameter is the length. Finally, the third parameter is the string in question.
If you were to use that function in-game, then look at your Sphere console, you'll see that it prints the first character from the third position. One thing I need to point out is the index (first parameter) is zero-based. If you wanted to start at the first character of the string, you'll need to use zero. The second parameter simply tells Sphere how many characters we need returned, starting from the index.
Specifying a negative value for the index will tell Sphere to begin at the end of the string, and count backwards from there. Here's an example:
[FUNCTION TestStrSub]
SERV.LOG <STRSUB -1 1 Hello>
Use the function in-game once again, then look at your Sphere console. Amazingly, it prints the last character of the string.
That isn't too difficult, is it?
STRTOLOWER
This function simply converts all uppercases characters to lowercase. A simple example would be:
LOCAL.LOWER = <STRTOLOWER StRiNgS ArE fUn To PlAy WiTh>
The function will return "strings are fun to play with".
STRTOUPPER
This function performs the opposite action to
STRTOLOWER
. It converts all lowercase characters to uppercase. Following on from the previous example:
LOCAL.UPPER = <STRTOUPPER StRiNgS ArE fUn To PlAy WiTh>
The function will return "STRINGS ARE FUN TO PLAY WITH".
STRTRIM
This function be used to strip all whitespace (spaces, tabs, newlines) from the start and end of a string.
The following script demonstrates this:
[FUNCTION f_strtrim]
LOCAL.TEXT = "     TEST     "
SERV.LOG 1. <LOCAL.TEXT>
SERV.LOG 2. <STRTRIM <LOCAL.TEXT>>
When run, the following output will be seen on the Sphere console:
1.      TEST
2. TEST
STRMATCH
The STRMATCH function enables you to check if a string matches a simple expression using wildcards (*), which you have more than likely encountered before.
The syntax of this function is
STRMATCH(pattern, string)
. It will return 1 if the string matches the pattern, and 0 if it doesn't. Look at the following example script:
[FUNCTION f_strmatch]
IF (STRMATCH(*ex*, <ARGS>))
    SERV.LOG ARGS contains 'ex'!
ELSE
    SERV.LOG ARGS does not match.
ENDIF
In the Sphere console type
F_STRMATCH Mexico
. You will see the message "ARGS contains 'ex'!". You can try experimenting with different arguments and changing the pattern around until you get the hang of this.
Had fun? STRMATCH is actually slightly more powerful than this. * isn't actually the only special character that you can use inside the pattern text:
Pattern
Meaning
*
Matches any number of characters, including none
?
Matches any one single character
[\*]
Matches the '*' character
[abcdef]
Matches any of the characters in the list
[!abc]
[^abc]
Matches any characters not in the list
[a-z]
Matches any character between A and Z.
That's everything there is that you need to know about STRMATCH. A finally note however, is that the pattern will be case-insensitive. (the
*ex*
example will match on "TEXT")
Note:
Some users have also found that the STRMATCH function is a convenient way of determining if two strings are equal (i.e
IF (STRMATCH(string1, string2))
). This is not how the function was intended to be used and you will be at a disadvantage for doing so:
Sphere will still attempt to perform a pattern match, wasting CPU resources.
When a wildcard is used in the first string, you may not get the result you want (imagine something similar to
STRMATCH(<ARGS>, SOMETEXT))
,, and ARGS happens to contain
*MET*
)
If you want to check the equality of two strings, use either the
STRCMP
or
STRCMPI
function.
STRREGEX
As useful as STRMATCH is, it is unfortunately not powerful enough to match more precise patterns.
Imagine you want to check if a string contains a floating point number (a number that may have one or more decimal places). Using STRMATCH we may start out with something like this:
[FUNCTION f_fpmatch]
IF (STRMATCH([0-9].[0-9], <ARGS>))
    SERV.LOG <ARGS> is a floating point number.
ELSE
    SERV.LOG <ARGS> is NOT a floating point number.
ENDIF
If we type
F_FPMATCH 1.0
in the Sphere console the match will be successful, however if we attempt to enter a number larger than 9.9 or a number that doesn't have exactly 1 decimal place then it will not match. We could add more "[0-9]"s in the STRMATCH but this would not solve the problem since we'd have to enter a fixed amount of numbers regardless. For example if we tried
STRMATCH([0-9][0-9][0-9].[0-9][0-9][0-9], <ARGS>)
Then we'd have to enter 001.500 for the match to work for 1.5!
STRREGEX solves this problem by using the regular expression language to perform advanced pattern matching. In fact, it is so advanced that the patterns are almost a language of their own, and there would be way too much to document here! To learn about the regular expression patterns, you want to visit one of the many websites that are dedicated to documenting regular expressions, such as
regular-expressions.info
.
To match a floating point using regular expressions, we can use the following pattern:
^[-+]?[0-9]*\.?[0-9]+$
If you don't understand the regular expression language then that will probably look like a random set of symbols, and believe me when I say that is actually a simple example of a regular expression! Fortunately, you can trust for now that the pattern is correct, and that we can use this in STRREGEX. The function above can be modified to the following:
[FUNCTION f_fpmatch]
IF (STRREGEX(^[-+]?[0-9]*\.?[0-9]+$, <ARGS>))
    SERV.LOG <ARGS> is a floating point number.
ELSE
    SERV.LOG <ARGS> is NOT a floating point number.
ENDIF
As complicated as that looks it does the job well. For example it matches values such as "1.5", "-250.002", "50", and even ".007"!

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Common Mistakes Explained
1.1
Target Functions
2
Comparing Strings & Tags
3
= vs. ==
Common Mistakes Explained
This tutorial is a revised copy of Maximus's "Common Mistakes Explained" tutorial from the SphereServer forums for Sphere 56b.
Ideally, the following information should cut down on help requests that have already been asked and answered many times in different threads.
This tutorial is very simple and easy to read, and is a MUST for all beginner scripters... let's begin!
Target Functions
Probably the most common mistake I've seen since in my time with Sphere is with targets being called directly from functions, like this:
[FUNCTION target_test]
TARGET Select target

ON=@TargOn_Item
    // code here
This isn't going to work too well :) 56b has introduced a new targeting function, eliminating the need for memory targets -
TARGETF
and its 3 different variations:
TARGETF
allows you to target characters and non-static items
TARGETFG
same as above only this one allows you to target the ground
TARGETFW
targst characters and non-static items, and also warns against criminal action
Syntax:
TARGETF[GW] function_to_be_called
Some things to note:
In the called function, ARGO is the targetted object
You CAN pass arguments through the function (ex.
TARGETF F_WHATEVER <UID>
, <UID> being the argument) and that argument can be referenced in the called function
If ground is targeted, those coordinates will be TARGP
Here is an example:
[FUNCTION target_fun]
SYSMESSAGE Select target. // message displayed with target
TARGETF f_target_fun // calls the target and the function

[FUNCTION f_target_fun]
ARGO.SAY MY NAME IS <ARGO.NAME> AND I  AM A CLOWN!!
IF (<ARGO.ISITEM>)
    ARGO.SAY I am an item too!
ENDIF
Comparing Strings & Tags
Sphere utilizes many different methods for comparing two pieces of information. What many users don't realize is that storage variables such as TAGs, VARs and LOCALs hold information as if it were a value, rather than either a number or a word.
For example, say you have a TAG on a player, TAG.TEST, that holds a word, and you want to use an IF statement to check to see if that word is "blue". Many users new to Sphere might try to do something like this:
IF (<TAG.TEST> == blue)
Sphere wants to compare the tag to a value, rather than a string, and so an error will be shown on the Sphere console because Sphere cannot translate "blue" into a numeric value.
For comparing strings, the most common string comparison keywords are STRCMPI and STRMATCH.
Proper syntax for the above comparison could be:
IF !STRCMPI("<VARIABLE>", "STRING")
    IF !STRCMPI("<TAG.TEST>", "blue")
-OR-
IF STRMATCH("STRING", "<VARIABLE>")
    IF STRMATCH("blue", "<TAG.TEST>")
The reason for the ! (means "does not", put simply) is that STRCMPI compares two strings and returns -1 if the first string is 'less than' the second, 1 if the first string is 'greater than' the second, or 0 if the two strings are equal. So for this function we need to check if it returns FALSE (0) to see if the two strings are equal.
= vs. ==
I can see why many scripters could be confused about the difference between a single equals sign and two of them in a row. In short, a single equals sign is an assignment operator, while the double equals sign is, well, the equals sign.
The single sign should only be used when "assigning" variables, locals, tags, etc... while the double equals sign should be used in conditional (e.g.
IF
,
WHILE
) statements:
LOCAL.IMNAKED = 1 // correct
LOCAL.IMNAKED == 1 // incorrect

IF (<LOCAL.IMNAKED> == 1) // correct
    IF (<LOCAL.IMNAKED> = 1) // incorrect

--- PAGE BREAK ---

When you run Sphere, in most cases you will get two different Monitoring IP and it will stay directly on the net. The only thing you need to do is go in to the sphere.ini and change the numbers:
[SERVERS]
MyShard //This one is the name
Your_IP //This one is the IP
2593 //This one is the port
So you will NOT need to add a
SERV.SERVIP
statement anywhere. But, where is the problem? If you don't have a static IP, you will need to change it every time, so: Get a
noip.org
account and its software, so you will get a free static ip. Easy, uh?
Instead, if you receive the Shard Selection Screen and then it stops there's something wrong. Of course this problem is not specific, it could be your (client) router, packet filtering, proxy software on server, something else at port 2593 or weird stuff with your server's network interface. (There are hundreds of ways to break). So, before reading all the text below, be sure that you have no internal problems. Now, let's go on!
If you have a router, Sphere is only able to determine your Local IP (and maybe your external IP changes all the time), then do the following:
Register an account at
NoIP.org
, you will need it if you don't want to change the files all the time. Get a hostname.
Install their software, and run it, of course.
Properly configure you router so it forwards port 2593 (or your Sphere Port, alas, i recommend the default one) to your internal IP (in my case: 192.186.0.175, you can find yours if you check your network connection properties).
Configure your Sphere.ini:
[SPHERE]
// Name of your Sphere shard
ServName=Three-Head Monkey
// The IP of your server, this will be 127.0.0.1 almost always
ServIP=127.0.0.1
// The port of your server, this is 2593 by default
ServPort=2593
Go to the lower part of it, and comment every line under [SERVERS], for example:
[SERVERS]
//Three-Head Monkey
//127.0.0.1
//2593
//

[EOF]
Now, go to your "scripts/sphere_serv_triggers.scp", and edit it like this:
[FUNCTION f_onaccount_login]
SERV.SERVIP yourno-ip.homedns.org

[FUNCTION f_onserver_start]
SERV.SERVIP yourno-ip.homedns.org

[FUNCTION f_onserver_save_ok]
SERV.SERVIP yourno-ip.homedns.org

[FUNCTION f_onserver_timer]
F_DATE
Just change every "yourno-ip.homedns.org" with your registered hostname at NoIP.org (Self-Descriptive Name, uh).
Ok, why there's an F_DATE function in there? Well, it refreshes Sphere's external IP to "yourno-ip.homedns.org", in case it changes. That will keep your connection with the players safe. Just go to the ini and change the option "TimerCall" to 5 (instead of 0). Then in a script file, add this:
[FUNCTION f_date]
SERV.SERVIP yourno-ip.homedns.org
That's it, at the Login.cfg you should put your hostname registered from NoIP.org and the port you used. And it should work, here an example:
LoginServer=yourno-ip.homedns.org,2593

--- PAGE BREAK ---

Help
Available languages
Missing languages
The script below is in no way complete, all it does at the moment is retransmit what the player said (from the player's point of view nothing happened). It is up to you to add what you want to the script and make it work the way you want to.
In your
sphere.ini
look for the line:
SpeechSelf=spk_player // make sure it is equal to spk_player
In sphere_speech.scp you'll find the
[SPEECH spk_player]
block. Under it add the code as shown below:
[SPEECH spk_player]
ON=*
    IF !(<ISGM>)
        VAR.MODE = <ARGN1>
        CAPTURE_SPEECH <ARGS>
        ARGN1 = talkmode_prompt
    ENDIF
    RETURN 0
talkmode_prompt
prevents speech from appearing above the player's head, but allows npc's to react to things like "buy" and other commands.
Next, in a seperate file you can script the capture_speech function. Here's the outline of what it looks like:
[FUNCTION capture_speach]
REF1 = <UID>

// Get player speach modes
LOCAL.MODE = <VAR.MODE>

// Get hearing distance based on speech mode
IF (<LOCAL.MODE> == talkmode_system)
    LOCAL.HEAR_DIST = 15	// normal hearing distance
ELSEIF (<LOCAL.MODE> == talkmode_yell)
    LOCAL.HEAR_DIST = 30	// yell hearing distance
ELSEIF (<LOCAL.MODE> == talkmode_whisper)
    LOCAL.HEAR_DIST = 2 	// whisper hearing distance
ENDIF

LOCAL.SENTENCE = <ARGS> // do things with your sentence here

FORCLIENTS <LOCAL.HEAR_DIST>
    // here you can define who hears what, changing the sentence to whatever you want, changing the color ect..
    REF1.TRYSRC <UID> MESSAGEUA 0 0 0 0 <LOCAL.SENTENCE>
ENDFOR
Good luck!

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Scripted Skills
2
Fighting Skills
3
Crafting Skills
4
Magician Skills
Scripted Skills
First of all, we need to cancel all the default behavoiur. How to do this? Simple, "SKF_SCRIPTED" (Add this flag to the Skill). This flag cancels all of the hardcoded behaviour of Sphere and leaves the work up to us on our triggers. You only need that and this explanation of how skills are played:
[SKILL 55]
DEFNAME=SKILL_APPRAISE
FLAGS=SKF_SCRIPTED
KEY=ItemID
TITLE=Merchant
PROMPT_MSG=What do you wish to appraise and identify?
DELAY=1.0
ADV_RATE=2.5,50.0,200.0
STAT_STR=0
STAT_INT=85
STAT_DEX=0
BONUS_STR=0
BONUS_DEX=0
BONUS_INT=100
BONUS_STATS=25
ON=@Select
    // Fires when a player selects the skill in the menu.
    // RETURN 1   - Prevent using the skill
    // RETURN 0/2 - Allow skill to be used
    
ON=@Start
    // Fires when the skill begins.
    // RETURN 1    = Prevent using the skill
    // RETURN 0/2  = Allow skill to be used
    // ACTION = -1 = Fail (@Fail).
    // ACTDIFF     = Skill required to succeed (0-100). Set to a negative value to fail the skill.
    
ON=@Success
    // Fires when the skill successfully finishes
    // RETURN 1    = Abort the skill
    // RETURN 0/2  = Proceed with allowing player to gain skill
    
ON=@Fail
    // Fires when a character fails the skill
    // RETURN 1    = Prevent skill gain
    // RETURN 0/2  = Allow skill gain
    
ON=@Abort
    // Fires when a character aborts the skill (going into war mode, for example)
    
ON=@Gain
    // Fires when a character has a chance of gaining skill
    // ARGN2       = The chance to gain skill (0-1000, writable)
    // ARGN3       = The maximum skill level the character can gain to (writable)
    // RETURN 1    = Block skill gain
    // RETURN 0/2  = Allow skill gain calculation to continue
    
ON=@UseQuick
    // Fires when the skill is used with the USEQUICK function
    // ARGN2    = Skill difficulty (0-100, writable)
    // ARGN3    = Whether or not attempt is successful (writable)
    // RETURN 1 = Fail the skill attempt without skill gain
    // RETURN 0 = Succeed the skill attempt without skill gain
    // RETURN 2 = Proceed with skill gain (use ARGN3 to set fail or success)
Fighting Skills
Now, we're going to create a Fighting Skill. This one is easier since the work to make the success, speed, etc are all hardcoded. So, the trick here is "SKF_FIGHT", add that flag to your skill and you got it! Now, the only tweak needed is to the weapon, so if my skill is called AxeFighting, my weapon should look like this:
[ITEMDEF 0df0]
DEFNAME=i_staff_black
TYPE=T_WEAPON_MACE_STAFF
FLIP=1
DAM=12,14
SPEED=37
SKILL=AxeFighting
//<-- Here you set your Skill Name.
REQSTR=35
TWOHANDS=Y
WEIGHT=4
Crafting Skills
In this case, the calculations and formulae are hardcoded. So, in this chapter we're going to use a new skill flag, it is named: SKF_CRAFT. You could imagine what to do now you have this flag added. Yes, change the item SKILLMAKE, so we're going to replace the old skill with the new. Let's say this skill is named Herbalist, this is how it should look:
[ITEMDEF 04554]
DEFNAME=i_GOLDEN_PLATEMAIL_ARMS
NAME=Golden Platemail Arms
ID=i_platemail_arms
ARMOR=30
REQSTR=40
WEIGHT=5
RESOURCES=18 i_ingot_gold
SKILLMAKE=Herbalist 64.5
CATEGORY=Provisions - Armor - Colored
SUBSECTION=Golden
DESCRIPTION=Platemail Arms
Magician Skills
This one use the flag SKF_MAGIC. And the logic here is go to the SPELL section and change the SKILLREQ. But this is a tutorial and I should add an example, I named the skill "MagicalMan", the spell should look like this:
[Spell 2]
DEFNAME=s_create_food
NAME=Create Food
SOUND=snd_SPELL_CREATE_FOOD
RUNES=IMY
CAST_TIME=1.0
RESOURCES=i_reag_garlic,i_reag_ginseng,i_reag_mandrake_root
RUNE_ITEM=i_rune_CREATE_FOOD
SCROLL_ITEM=i_scroll_CREATE_FOOD
FLAGS=SPELLFLAG_TARG_XYZ
EFFECT_ID=0
EFFECT=0
DURATION=0.0
MANAUSE=4
SKILLREQ=MagicalMan 10.0
INTERRUPT=100.0,100.0

--- PAGE BREAK ---

Help
Available languages
Missing languages
For the longest time, we've all been needing or wanting to replace that stupid teleport command to something that looks and sounds much cooler, or change the way .KILL kills you. With the release of 56b came a useful feature found in your sphere.ini called
CommandTrigger
.
How it works:
If enabled, when a command is used by a player in the game, Sphere calls the function defined by the "CommandTrigger" setting BEFORE it actually executes the command in question.
Open up your sphere.ini file and scroll down to the
Client Management
section. Towards the bottom of the section, you will see this:
// Function to call if client is executing a command to override the default.
//CommandTrigger=f_oncommand
If you want to override a default command, uncomment the second line. Make sure it looks just like that. Now go make a new file in your scripts and create a new function called "f_oncommand" This is the function you will use to make your changes. Now, whenever ANYONE executes a command, they will also execute the function f_oncommand, before the command is even run. (it doesnt HAVE to be f_oncommand, just make sure that the function matches the setting in the .ini file)
Now, when the server calls
f_oncommand
, the original command will be stored in ARGS. So say you want to prevent the .TELE command from ever being used, you'd do this:
[FUNCTION f_oncommand]
IF (STRCMPI("<ARGS>", "TELE") == 0) // if command was .tele
    SYSMESSAGE Tele command has been disabled.
    RETURN 1 // stop default command
ELSE // if command was not .tele
    RETURN 0 // allow default command
ENDIF // end of if block
That's pretty much it... With this setting and function, you can pretty much change any of the hardcoded commands. You can even completely re-script the commands, maybe you want .KILL to actually resurrect the player, or something like that... it's all possible!

--- PAGE BREAK ---

Most dedicated administrators are determined to keep their server running at its full potential. One way to help do this is rebooting the system. Personally, I like to reboot my system every morning.
Scheduling
As I stated before, I like to reboot my system at least once per day. However, what if I'm not at home? What if I'm going to be gone for days? A timer object would be very useful here.
[ITEMDEF i_reboot_system_obj]
ID=i_crystal_ball
NAME=Reboot [DO NOT REMOVE]
WEIGHT=200
TYPE=t_eq_script

ON=@Create
    ATTR=attr_decay
    TIMER=60
    
ON=@Timer
    LOCAL.HOUR = <SERV.RTIME.FORMAT %H>
    IF (<LOCAL.HOUR> == 06)
        SERV.SAVESTATICS
        SERV.SAVE
        SERV.SHUTDOWN 1
        LOCAL.SPAWN = <SYSSPAWN C:\Windows\System32\shutdown.exe -r -t 120>
    ENDIF
    TIMER = 60
    RETURN 1
Fortunately for us, there is an internal FORMAT function that extends RTIME to return more specific information. It just so happens that the argument %H will return the hour, so we can take advantage of this. If you'll look at the IF statement, you'll notice that I'm looking for hour 06. At this point, we'll announce the daily reboot, perform a save on the statics, as well as a world save. Finally, we'll use SYSSPAWN to call the external program.
Restarting Sphere
I bet now you're thinking, "OK, so he figured out how to reboot, but how the heck is he going to start the server again?" There are quite a few ways to approach this:
Use the Startup folder.
Run Sphere as a service.
I've never tried running Sphere as a service, so we'll use the first method. Follow these directions:
Open your Sphere folder.
Create a shortcut from SphereSvr.exe (right-click > Create Shortcut).
Single-click the shortcut, then Cut (Ctrl+X).
Now you need to navigate to your Startup folder (
C:\Documents and Settings\<USER_NAME>\Start Menu\Programs\Startup or Start > All Programs > Startup
). Paste the shortcut into this folder (Ctrl+V). You're done! Sphere should now start on every boot.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Installation
2
Sphere Commands
2.1
DB Properties
2.2
DB Methods
3
Examples
3.1
Creating a Table and Inserting Data
3.2
Simple MySQL and PHP Output Tutorial
3.2.1
Introduction
3.2.2
Create The Table
3.2.3
Insert The Data
3.2.4
Read The Data
3.2.5
Output
3.2.6
Conclusion
Installation
In order to use MySQL for your SphereServer, you must first install MySQL onto your computer. You can find a tutorial on how to install MySQL in the
MySQL Reference Manual
.
After you have installed MySQL, you will need to configure Sphere to connect to your MySQL server. Open Sphere.ini, and scroll down until you see the section beginning with "// MySql configuration." This is where you will fill in all of your basic MySQL information.
Replace these lines with the correct information corresponding to your server:
MySql=1  // This must be set to 1 for MySQL to be enabled.
MySqlHost=localhost    // The address to your MySQL db host.
MySqlUser=root         // Replace this with your MySQL username.
MySqlPassword=password // Replace this with your MySQL password.
MySqlDatabase=sphere   // This is the name of your MySQL database.
You will also need to navigate to your scripts folder, and open the file sphere_serv_triggers.scp. You now need to find the definition for the function
f_onserver_start
, and place the following line inside the function:
DB.CONNECT
This will make sure Sphere connects to the MySQL database. You can also add some error checking to make sure it is connected by adding the following lines after that:
IF (<DB.CONNECTED>)
    SERV.LOG MySQL debug: MySQL successfully connected!
ELSE
    SERV.LOG MySQL debug: MySQL not connected!
ENDIF
If you find the line "
MySQL debug: MySQL not connected!
" in your console, this means that Sphere could not connect, and there is probably an error in either your Sphere.ini configuration, or your MySQL installation.
Sphere Commands
MySQL has a number of basic commands you will need to know. In Sphere, these commands differ slightly in use, because they have to be used in conjunction with Sphere commands.
In Sphere, all MySQL commands will begin with the
DB
object. You can view a full list of all the properties and functions of the DB object in the
Database
object page of the
Reference Compendium
.
DB Properties
Syntax: <DB.<
property
>>
Property
Description
CONNECTED
Returns 1 if the server is connected to MySQL, and 0 if it is not.
ROW.NUMROWS
The number of rows returned by the last query.
ROW.NUMCOLS
The number of columns returned by the last query.
ROW.*
A list of all of the columns returned by the last query. Both column names and numbers are saved in the list, so you can reference them using indexes (1,2,3) or column names (id, name, etc.).
DB Methods
Syntax: DB.<
method
>
Method
Description
CLOSE
Disconnects from the MySQL server.
CONNECT
Connects to the MySQL using the information supplied in Sphere.ini.
EXECUTE
Executes the given MySQL commands without returning any information.
QUERY
Returns information from the MySQL database, filling the ROW.* properties.
Examples
Creating a Table and Inserting Data
This section is just a few basic examples to get you started into the MySQL+Sphere world.
What you'll need to do to begin with MySQL is to create a table to put your data in. The following is an example, with an explanation afterwards.
DB.EXECUTE "create table demo (id int unsigned not null auto_increment primary key,account varchar(15),
name varchar(15),guild text,kills int,fame int,karma int);"
DB.EXECUTE
This is just Sphere's command to execute a statement in MySQL.
create table demo
This tells MySQL to create a table named 'demo', with the enclosed information.
id int unsigned not null auto_increment primary key
This creates a column named 'id', that holds the id number for the entry. You could really just use the row number for the id number, but this allows us to access it through PHP if you wanted to also make a PHP website through your shard (PHP tutorials will come later). The 'not null auto_increment' part means that whenever you add a new row, you will just set id as 'NULL' and MySQL will replace it with the next id number. So if you have 3 rows and you insert a new one, MySQL will automatically set it as id '4'.
account varchar(15)
varchar(15) means that it can be a text-entry with 15 characters or less. Most accounts only consist of a few characters, so it shouldn't ever really be longer than 15.
name varchar(15)
Same as 'account varchar(15)'.
guild text
This is where the name of the guild goes. Since some guild names can be quite long, I simply set this as "text", because it allows it to be of an infinite length.
kills int
Just an integer column for holding the number of kills a player has.
fame int
An integer column for holding the fame a player has.
karma int
An integer column for holding the karma a player has.
Now that the fields have been explained, we need to insert information into the table. To do this, we'll use the following command:
DB.EXECUTE "INSERT INTO demo(id, account, guild, kills, fame, karma) values (NULL,<ACCOUNT>,<MEMORYFINDTYPE.MEMORY_GUILD.NAME>,<KILLS>,<FAME>,<KARMA>);"
This command will make the table of information look something like this:
demo
id
account
guild
kills
fame
karma
row.1
1
warangel
Staff_Ownage
2
15,000
-7,000
Simple MySQL and PHP Output Tutorial
Introduction
This article is designed to be a tutorial to explain how to use Sphere's MySQL capabilities to create output to your shard's webpage via PHP.
Create The Table
The first thing we will need to do is to create the table which we will use to store our information. This table will store the following information for our sample system: the integer 'id', used to store the id number of the added row; the varchar 'account' with a length of 30, used to store the current account name; the varchar 'name' with a length of 30, used to store the current player name; the text block 'guild', used to store the current guild's name; the integer 'kills', used to store the amount of kills the player has; the integer 'fame', used to store the amount of fame the current player has; and the interger 'karma', which is used to store the amount of karma the current player has. The code I used to create this table is the following:
[FUNCTION create_table]
DB.EXECUTE "create table demo (id int unsigned not null auto_increment primary key, account varchar(15), name varchar(15), guild text, kills int, fame int, karma int);"
Insert The Data
The next thing we will need to do is insert some information into the table we just created. The following function will insert data about your own character into the table:
[FUNCTION insert_info]
DB.EXECUTE "insert into demo (id, account, name, guild, kills, fame, karma) values (NULL, '<ACCOUNT>', '<NAME>', '<MEMORYFINDTYPE.memory_guild.LINK.NAME>', <KILLS>, <FAME>, <KARMA>);"
Read The Data
Now that we actually have some information in our MySQL table, we need to create a PHP file to read the information from the table and display it. Create a file named sphere_info.php, and then insert the following code into it.
<html>
<head>
<title>sphere_info</title>
</head>

<body>
<?php

	//fill in your mysql information here
	$hostname = "localhost";
	$username = "root";
	$password = "password";
	$database = "database_name";

	//the tablename demo was used for this tutorial. change this to the actual name of the table.
	$table = "demo";
	
	//connects to mysql and selects the corresponding database.
	mysql_connect($hostname,$username,$password);
	mysql_select_db($database);

	//selects all rows from the provided table name.
	$query = "select * from $table";
	$result = mysql_query($query);

	//this if makes sure there is information in the table. if there isn't, there will be no output.
	if (mysql_num_rows($result) > 0)
	{	
                //this creates a variable named $query_data and fills it with the information from the first row.
                //using a while statement, this will repeat for each row the table contains.
		while ($query_data = mysql_fetch_array($result))
		{
			//we create new variables for each different column in the row.
			$id = $query_data['id'];
			$account = $query_data['account'];
			$name = $query_data['name'];
			$guild = $query_data['guild'];
			$kills = $query_data['kills'];
			$fame = $query_data['fame'];
			$karma = $query_data['karma'];
  
			//this is where you can format your output using html.
			$echo = "$id - $account - $name - $guild - $kills - $fame - $karma<br>";
		  
			//this displays the actual output.
			echo $echo;
		 }
	}

?>

</body>
</html>
Output
The output we receive using this method of reading the table should look something like the following:
1 - god - God - PWNAGE - 1 - 1000 - 1000
2 - warangel - WarAngel - 4HM - 15 - 1000 - 5000
Conclusion
This method of writing to the table and reading using PHP can be used to create nearly anything you can imagine in terms of data storage and retrieval systems. Something like this could be combined to make an online interactive control panel for your shard administrators, a duel system that shows scores online, or any number of things. Where there's a will there's a way, and with this article you now have both.

--- PAGE BREAK ---

Bitwise operations are used to perform an action on the bits (the 1's and 0's) of a number.
In this article a "binary" formatted number (which represents the "bits" of a number) will be written with a
2
... and a decimal number with a
10
Contents
1
Limitations
2
Flags
3
The OR Operator (inclusive OR): |
4
The AND Operator (logical and): &
5
The XOR Operator (exclusive OR): ^
6
The NOT Operator (bitwise not): !
7
Left and right shift
Limitations
In Sphere, numbers are stored in something called a "DWORD".  The largest number a DWORD can store is constrained by the fact that a DWORD is 32 bits wide. That means the largest number it can store is 2^32-1.
In Binary that's 11111111111111111111111111111111.
In Hex it's FFFFFFFF.
In Decimal that's 4294967295.
To store a 'signed' number in a DWORD (in other words, a number that can be positive or negative), the first bit is used to indicate the sign (a 1 is negative).  Which means the largest 'signed' positive number is 2^31-1
In Binary that's 01111111111111111111111111111111.
In Hex it's 7FFFFFFF.
In Decimal that's 2147483647.
In sphere script language, the EVAL function outputs a signed DWORD, and the UVAL outputs an unsigned DWORD.
[FUNCTION Mathtest]
LOCAL.Number0=2147483647
LOCAL.Number1=4294967295
LOCAL.Number2=8589934588
SERV.LOG eval0=<EVAL <LOCAL.Number0>> eval1=<EVAL <LOCAL.Number1>> eval2=<EVAL <LOCAL.Number2>>
SERV.LOG uval0=<UVAL <LOCAL.Number0>> uval1=<UVAL <LOCAL.Number1>> uval2=<UVAL <LOCAL.Number2>>
The output of this test is:
13:37:(test.scp,10)eval0=2147483647 eval1=-1 eval2=-4
13:37:(test.scp,11)uval0=2147483647 uval1=4294967295 uval2=4294967292
Notes:
The output is limited to align with the limitation of the DWORD itself.
Since there are 32 "bits" in a DWORD, there can only be 32 flags in a set.
Be careful when manipulating flags using EVAL, because the 32nd flag could get lost.
Flags
In the Sphere server, quite a few concepts are implemented using "flags".  You can see examples of flags being defined in the Sphere.ini file, or the sphere_defs.scp files.  For example:
[DEFNAME attr_flags]
attr_identified       01
attr_decay            02
attr_newbie           04
attr_move_always      08
attr_move_never      010
attr_magic           020
attr_owned           040
attr_invis           080
attr_cursed         0100
attr_cursed2        0200
attr_blessed        0400
attr_blessed2       0800
attr_forsale       01000
attr_stolen        02000
attr_can_decay     04000
attr_static        08000
attr_exceptional  010000
attr_enchanted    020000
attr_imbued       040000
attr_questitem    080000
attr_insured     0100000
attr_nodrop      0200000
attr_notrade     0400000
attr_lockeddown  0800000
attr_secure     01000000
This technique is a very efficient way to store a number of Boolean values using as little memory as possible.  Let's tip that list on it's side and chart the first 8 flags:
Flag Name:
attr_invis
attr_owned
attr_magic
attr_move_never
attr_move_always
attr_newbie
attr_decay
attr_identified
Flag Position
8th position
7th position
6th position
5th position
4th position
3rd position
2nd position
1st position
Binary Number:
10000000
01000000
00100000
00010000
00001000
00000100
00000010
00000001
Hex Number:
080
040
020
010
08
04
02
01
Decimal Number:
128
64
32
16
8
4
2
1
Now you can probably see the pattern... the numbers 1,2,4,8,16,32,64,128,... are all multiples of 2 and they are special because they all have a single 1 in them when converted to binary.  To enable or disable an individual flag on an object is accomplished using the bitwise operators AND, OR, XOR, and NOT.
The OR Operator (inclusive OR): |
A
bitwise OR
takes two bit patterns of equal length and performs the logical
inclusive OR
operation on each pair of corresponding bits. When you perform this operation, the result in each position is 0 if both bits are 0, and the result is 1 if either (or both) the bits were 1. For example:
0101 (decimal 5)
OR 0011 (decimal 3)
 = 0111 (decimal 7)
In Sphere, this technique is commonly used to set a
flag
in a register, while preserving the existing flags.  So, 0010 (decimal 2) can be considered a set of four flags, where the first, third, and fourth flags are clear (0) and the second flag is set (1). The fourth flag may be set by performing a bitwise OR between this value and a bit pattern with only the fourth bit set:
0010 (decimal 2)
OR 1000 (decimal 8)
 = 1010 (decimal 10)
In the following example Sphere code, we create a new object, then set that objects flags to equal 010, then we enable the 4th flag as well:
SERV.NEW=i_log
ATTR=010
ATTR|=01000
...that same example, using flag names:
SERV.NEW=i_log
ATTR=attr_decay
ATTR|=attr_move_always
The AND Operator (logical and): &
A
bitwise AND
takes two equal-length binary representations and performs the
logical AND operation
on each pair of the corresponding bits, by multiplying them. If both bits in the compared position are 1, the bit in the resulting binary representation is 1 (1 × 1 = 1); otherwise, the result is 0 (1 × 0 = 0 and 0 × 0 = 0). For example:
0101 (decimal 5)
AND 0011 (decimal 3)
  = 0001 (decimal 1)
The operation may be used to determine whether a particular bit is set (1) or clear (0). For example, given a bit pattern 0011 (decimal 3), to determine whether the second bit is set we use a bitwise AND with a bit pattern containing 1 only in the second bit:
0011 (decimal 3)
AND 0010 (decimal 2)
  = 0010 (decimal 2)
Because the result 0010 is non-zero, we know the second bit in the original pattern was set. This concept is often called
bit masking
.  In Sphere, this is often used in an IF statement to check if a specific flag is enabled or not.  For example, the sphere code to check if an object is identified is done by applying a AND of the object's ATTR to the attr_identified flag like this:
IF (<ATTR>&attr_identified)
The XOR Operator (exclusive OR): ^
A
bitwise XOR
takes two bit patterns of equal length and performs the
logical exclusive OR
operation on each pair of corresponding bits. The result in each position is 1 if only the first bit is 1 or only the second bit is 1, but will be 0 if both are 0 or both are 1. In this we perform the comparison of two bits, being 1 if the two bits are different, and 0 if they are the same. For example:
0101 (decimal 5)
XOR 0011 (decimal 3)
  = 0110 (decimal 6)
The bitwise XOR is often used to invert selected bits in a register (also called toggle or flip). Any bit may be toggled by XORing it with 1. For example, given the bit pattern 0010 (decimal 2) the second and fourth bits may be toggled by a bitwise XOR with a bit pattern containing 1 in the second and fourth positions:
0010 (decimal 2)
XOR 1010 (decimal 10)
  = 1000 (decimal 8)
The NOT Operator (bitwise not): !
The
bitwise NOT
, or complement, is an operation that performs a logical negation on each bit, forming the
ones' complement
of the given binary value. Bits that are 0 become 1, and those that are 1 become 0. For example:
NOT 0111  (decimal 7)
  = 1000  (decimal 8)
The bitwise complement is equal to the two's complement of the value minus one. If two's complement arithmetic is used, then:
NOT x = −x − 1.
For unsigned integers, the bitwise complement of a number is the "mirror reflection" of the number across the half-way point of the unsigned integer's range. For example, for 8-bit unsigned integers, NOT x = 255 - x, which can be visualized on a graph as a downward line that effectively "flips" an increasing range from 0 to 255, to a decreasing range from 255 to 0.
Left and right shift

--- PAGE BREAK ---

So you've got a problem with a script and you don't know where to turn? Or everyone you've spoken to doesn't have the answers you seek? You're about to start pulling out your hair, you feel alone and lost, and no one can seem to help you. Well worry no more, you're about to help yourself! Let's talk about debugging your script
We'll go through some examples here to explain how one could get helpful information that will lead them to their solutions. Each situation will have it's own unique methods to help you use the tools at your disposal to fix the problem, or guide you to finding out more helpful information.
Problems Understanding A Trigger
Uncertain how a trigger works?
This is a great example from MalucoBeleza that illustrates the concept of logging out your results to the console for further insight into what objects a trigger is referencing. This can help you make sure that you are referencing the right object in game and that whatever follows will behave as expected.
Let's say you want to use a trigger that will fire when you kill someone, and when you kill that person you want to give the killer some experience points. You need to reference both the person being killed and the person that killed them.
The trigger in this example is
@Kill
. One may think that they will use the default object I as the killer and that SRC will be the person being killed. or that ACT would be the person being killed. But it is best not to assume any of these triggers will use any object reference the same as another, or even the same as a similar trigger. The best practice is to take yourself to the Spherewiki (as YOU already have) and pull up the trigger you are looking for under the Reference Compendium >
Objects
>
Characters
, this will give you a very good idea of what references you can make in that trigger. Once you have that information you can begin to see what you are able to work with and how you can work with it.
As MalucoBeleza points out, this practice is required to get proper knowledge to work with a trigger
When dealing with a trigger that is new to you... its essential to check the wiki and do tests like this:
ON=@Kill
 SERV.LOG NAME: <NAME>
 SERV.LOG I.NAME: <I.NAME>
 SERV.LOG SRC.NAME: <SRC.NAME>
 SERV.LOG ARGO.NAME: <ARGO.NAME>
 SERV.LOG <NAME> (<UID>) HAVE JUST KILLED <ARGO.NAME> (<ARGO>)
Debugging is also a great tool when you are performing calculations. Let’s say that you want to create your own combat system, such as:
ON=@Hit
   SERV.LOG <NAME> HAVE JUST HIT <SRC.NAME>
   IF (<WEAPON>)
       SERV.LOG A WEAPON WAS USED: <WEAPON.NAME>
       SERV.LOG <WEAPON.NAME>'S DAMAGE IS <WEAPON.DAM.LO> - <WEAPON.DAM.HI>
   ELSE
       SERV.LOG NO WEAPON WAS USED.
       SERV.LOG <NAME>'S DAMAGE IS <DAM>
   ENDIF
   
   SERV.LOG DAMAGE STARTED AS <ARGN1>
   
   SERV.LOG THE SKILL USED IN THIS ATTACK IS <ACTION>
   IF (<ACTION> == WRESTLING) || (<ACTION> == MACEFIGHTING)
       ARGN1 = <EVAL <ARGN1> + (<STR>/8)> //APPLY YOUR FORMULA HERE
   
   ELIF (<ACTION> == ARCHERY) || (<ACTION> == FENCING)
       ARGN1 = <EVAL <ARGN1> + (<DEX>/8)>
   
   ELIF (<ACTION> == SWORDSMANSHIP)
       ARGN1 = <EVAL <ARGN1> + (<DEX>/16) + (<STR>/16)>
   
   ENDIF
   
   SERV.LOG DAMAGE AFTER STATS BONUS ACCORDING TO THE SKILL IS <ARGN1>
   
   IF (<SRC.ISPLAYER>) //PLAYER HITS ANOTHER PLAYER
       SERV.LOG THE ARMOR OF THE DEFENDANT IS <SRC.ARMOR>
       LOCAL.DAMAGE_REDUCTION = <EVAL <SRC.ARMOR>/20> //APPLY YOUR FORMULA HERE
       
   ELSE //PLAYER HITS A NPC
       SERV.LOG THE ARMOR OF THE DEFENDANT IS <SRC.AC>
       LOCAL.DAMAGE_REDUCTION = <EVAL <SRC.AC>/20> //APPLY YOUR FORMULA HERE
   
   ENDIF
   ARGN1 -= <LOCAL.DAMAGE_REDUCTION>
   SERV.LOG AFTER DAMAGE REDUCTION OF <LOCAL.DAMAGE_REDUCTION>, DAMAGE IS <ARGN1>
Console Errors Regarding Scripts
You are getting errors on your console, and it's telling you about a script but you aren't quite sure what to do. Let's see one as an example :
00:17:ERROR:(i_dye_tubs.scp,52)Range isn't closed by a '}' character.
Okay from this error we can see the filename 'i_dye_tubs' and the line number is 52. The error is that the 'Range isn't closed by a '}' character.' so let's go see what this line looks like and what we the appropriate line fix is:
So here's what line 52 from i_dye_tubs.scp looks like :
color={047e 049a
We can see above that its missing a } at the end just like the console error notified us about. The fix is to simply add the missing }.
this is a very elementary example but this explains the process of breaking down a console error. It's always the same for these script errors : "filename, line number, error description". With large complicated systems paying attention to the exact nature of your console error will guide you towards figuring out how to fix it.

--- PAGE BREAK ---

Definitions are blocks of script that define the basic behaviour of certain objects, for example the
ITEMDEF
block defines the basic properties of an
item
.
Pages in this category document the various definition scripts that exist in Sphere.
Pages in category "Definitions"
The following 14 pages are in this category, out of 14 total.
A
AREADEF
C
CHARDEF
D
DIALOG
E
EVENTS
I
ITEMDEF
M
MENU
R
REGIONTYPE
ROOMDEF
S
SKILL
SKILLCLASS
SKILLMENU
SPAWN
SPELL
T
TYPEDEF

--- PAGE BREAK ---

Help
Available languages
Missing languages
A CHARDEF block defines the basic properties of a
character
.
Contents
1
Properties
2
INI Overrides
3
Others
4
Examples
Properties
Here is a list of all character definition properties.
Name
Read/Write
Override†
Description
ANIM
RW
??
Gets or sets a mask of animations that the character supports.  The default value is 0ffffff.
ARMOR
RW
??
Gets or sets the character's base defense without armour.
AVERSIONS
RW
??
Gets or sets a list of things that the character does not like.
BASEID
R
??
Gets the defname of the character if set, otherwise the ID.
BLOODCOLOR
RW
??
Gets or sets the character's blood colour (a value of -1 prevents the creature from bleeding at all.)
CAN
RW
??
Gets or sets attributes for the character. See can_flags in sphere_defs.scp.
COLOR
RW
??
Gets or sets the character colour.
DAM
min,max
RW
??
Gets or sets the base damage that the character will deal without a weapon.
DAM
.LO
R
??
Gets the minimum base damage the character will deal without a weapon.
DAM
.HI
R
??
Gets the maximum base damage the character will deal without a weapon.
DEFNAME
RW
??
Gets or sets defname of the character.
DESIRES
RW
??
Gets or sets a list of things that the character likes.
DEX
RW
??
Gets or sets the dexterity that is set when a character polymorphs into this character.
DISPID
R
??
Gets the ID that the character displays as.
FOODTYPE
RW
??
Gets or sets a list of things that the character can eat.
HEIGHT
RW
??
Gets or sets the height of the character.
HIREDAYWAGE
RW
??
Gets or sets how much gold is needed to hire the character for one day.
ICON
RW
??
Gets or sets the item that can be used to represent the character in figurine form.
ID
RW
??
Gets or sets the ID of the character to inherit property values from.
INSTANCES
R
??
Returns the number of this character that exist in the world.
INT
RW
??
Gets or sets the intelligence that is set when a character polymorphs into this character.
JOB
R
??
Gets the character's job title.
MAXFOOD
R
??
Gets the maximum food level that the character can have.
MOVERATE
RW
Y
Boost or limit the movement speed (based on DEX) with the specified rate.  The higher it is, the faster the NPC will be.  50 means 50% of speed, 200 means double speed.
NAME
RW
??
Gets or sets the name of the character.
RANGE
min, max
RW
Y
Gets or sets the attack range of the character.
RANGEH
R
??
Gets the maximum attack range of the character.
RANGEL
R
??
Gets the minimum attack range of the character.
RESDISPDNHUE
RW
??
Gets or sets the colour to display as to clients who don't have a high enough
RESDISP
to see the character.
RESDISPNID
RW
??
Gets or sets the character ID to display as to clients who don't have a high enough
RESDISP
to see the character.
RESLEVEL
RW
??
Gets or sets the minimum
RESDISP
required for a client to see the character.
RESOURCES
RW
??
Gets or sets the resources that the character is made of.
RESOURCES
.COUNT
R
??
Gets the number of different resources that the character is made of.
RESOURCES
.n.KEY
R
??
Gets the
BASEID
of the nth resource that the character is made of. (zero-based)
RESOURCES
.n.VAL
R
??
Gets the amount of the nth resource that the character is made of. (zero-based)
SOUND
RW
??
Gets or sets the generic sound that the character makes. can be splitted into SOUNDHIT, SOUNDGETHIT, SOUNDDIE, SOUNDIDLE, SOUNDNOTICE, splitted values are optional, and when set it will have priority over default SOUND value.
SOUNDIDLE
RW
??
Gets or sets the iddle sound that the character makes. (can have -1 as value to prevent action-related sound to be played)
SOUNDNOTICE
RW
??
Gets or sets the notice sound that the character makes. (can have -1 as value to prevent action-related sound to be played)
SOUNDHIT
RW
??
Gets or sets the hit sound that the character makes. (can have -1 as value to prevent action-related sound to be played)
SOUNDGETHIT
RW
??
Gets or sets the get hit sound that the character makes. (can have -1 as value to prevent action-related sound to be played)
SOUNDDIE
RW
??
Gets or sets the die sound that the character makes. (can have -1 as value to prevent action-related sound to be played)
STR
RW
??
Gets or sets the strength that is set when a character polymorphs into this character.
TAG
.name
RW
??
Gets or sets the value of a TAG.
TAG.BARDING.DIFF (X branch only)
RW
??
determine the difficulty of Enticement, Peacemaking and Provocation skills. If this tag isn't set, the old behaviour is used.
THROWDAM
min,max
RW
y
Gets or sets a range of damage used for thrown objects.
THROWDAM
dam
RW
y
Gets or sets the constant damage used for thrown objects.
THROWDAMTYPE
damage flags
RW
y
Gets or sets the damage flags used for thrown objects.
THROWOBJ
id
RW
y
Gets or sets the ID of an object to be thrown by NPCs.
THROWRANGE
min,max
RW
y
Gets or sets the range that an object can be thrown at.
THROWRANGE
max
RW
y
Gets or sets the range that an object can be thrown at with a default min of 2.
TSPEECH
speech_defname
RW
??
Gets a list of speech handlers for the character, or adds a speech handler to the character.
TEVENTS
event_defname
RW
??
Gets a list of event handlers for the character, or adds an event handler to the character.
†
Some properties can be overridden on a individual character basis.  For example, you can set TAG.OVERRIDE.MOVERATE on a specific NPC to speed up or slow down the speed at which that one NPC will move.
INI Overrides
Name
Description
TAG.OVERRIDE.RUNNINGPENALTY
This special tag overrides the INI setting of the same name on a per character basis.
TAG.OVERRIDE.STAMINALOSSATWEIGHT
This special tag overrides the INI setting of the same name on a per character basis.
Others
Name
Description
TAG.NoMoveTill
doesn't allow char to move if TAG.NoMoveTill > SERV.Time
Examples
This first example shows a "base" CHARDEF... these are identified by the fact that the CHARDEF keyword is followed by a number:
[CHARDEF 01]        // This is a "base" chardef for character animation 01 (from the mul/uop files)
// This is the start of the "base" properties.
// Values set in the base properties cannot have a range (you cannot use {1 10})
DEFNAME=c_ogre                    // The DEFNAME is a friendly name to reference this CHARDEF
NAME=ogre                         // This is the creature's name as seen in-game
ICON=i_pet_ogre                   // If the creature is shrunk, this is the item that will result
SOUND=snd_monster_ogre1           // This is the start of the sound entries for this creature
CAN=MT_WALK|MT_USEHANDS|MT_EQUIP  // These flags are defined in the can_flags area of sphere_defs.scp
DAM=18,22                         // This is the range of damage they creature will cause when not using a weapon
ARMOR=30                          // ARMOR is the physical damage resistance *before* additional armor is equipped
DESIRES=r_forests,t_gold,t_coin,t_gem,t_arock
AVERSIONS=t_trap,r_civilization
FOODTYPE=35 t_meat_raw            // This is the maximum amount (and types) of food the creature eats
RESOURCES=2 i_ribs_raw            // If this creature's corpse is carved, these resources will be created
BLOODCOLOR=colors_blood           // This is the color of this creatures blood
MOVERATE=100
TAG.Barding.Diff=48.8             // When a TAG is added to the "base properties", all existing creatures are affected
TAG.SlayerGroup=OGRE,REPOND
TEVENTS=e_carnivores2             // EVENTS are collections of triggers used by CHARDEFs. Each TEVENT must be on its own line.
CATEGORY=Monsters                 // CATEGORY, SUBSECTION, and DESCRIPTION are used by the GM tool "Axis"
SUBSECTION=Giants
DESCRIPTION=Ogre

// This is the end of the "base" properties, and the start of the "triggers".
// You can override *most* base properties in a trigger if necessary.

ON=@Create                        // This is the @Create trigger
    NAME=#NAMES_OGRE               // #NAMES_OGRE is an array of names defined in sphere_names.scp
    TITLE=the ogre
    NPC=brain_monster              // The available "brains" are defined in sphere_defs.scp
    FAME={1500 1999}               // The { } marks are used to set a range of possible values
    KARMA={-1500 -1999}
    STR={165 195}
    MAXHITS={100 120}              // If MAXHITS is not set, the default value is the same as STR
    DEX={45 65}
    MAXSTAM={45 65}                // If MAXSTAM is not set, the default value is the same as DEX
    INT={45 70}
    MAXMANA={45 70}                // If MAXMANA is not set, the default value is the same as INT
    MAGICRESISTANCE={55.0 70.0}
    PARRYING={60.0 70.0}
    TACTICS={60.0 70.0}
    WRESTLING={70.0 80.0}
    MODAR={0 5}                    // Setting MODAR in @Create lets us add o-5 more ARMOR to this creature
    RESCOLD={15 25}
    RESENERGY={15 25}
    RESFIRE={15 25}
    RESPOISON={15 25}
ON=@NPCRestock
    ITEM=loot_ogre                 // This references a TEMPLATE in the sphere_templates_loot.scp file

--- PAGE BREAK ---

Help
Available languages
Missing languages
A character can be either a player or an NPC.
Contents
1
References
2
Properties and Functions
3
Triggers
4
Players
4.1
References
4.2
Properties and Functions
5
NPCs
5.1
Properties and Functions
6
Clients
6.1
References
6.2
Properties and Functions
References
References return pointers to other objects (e.g. the REGION reference allows you to access the REGION that an object is in). These can either be accessed by using
<REFNAME>
to return the
UID
(1 for object types that don't have UIDs) of the object or 0 if it doesn't exist, or by using
<REFNAME.KEY>
where KEY is a valid property/function/reference for the
REFNAME
object. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
Sphere X only?
ACCOUNT
RW
Gets or sets the
account
that the character belongs to.
ACT
RW
Gets or sets the
character
or
item
that is related to the action the character is performing.
FINDCONT
.n
R
Gets the nth
item
equipped to the character. (zero-based)
FINDID
.item_id
R
Gets the first
item
found equipped to the character or inside their backpack, with the matching
BASEID
.
FINDLAYER
.layer
R
Gets the
item
that the character has equipped in a specified layer.
FINDTYPE
.type
R
Gets the first
item
found equipped to the character or inside their backpack, with the matching
TYPE
.
MEMORYFINDTYPE
.memory_flags
R
Gets a
memory item
with the specified flags.
MEMORYFIND
.
object_uid
R
Gets a
memory item
that is linked to the given object.
OWNER
R
Gets the character that owns this character. (RW in SphereServer-X Build)
SPAWNITEM
R
Gets the
spawn item
(t_spawn_char) that this character originated from.
WEAPON
R
Gets the
weapon
that the character currently has equipped.
P
RW
Gets or sets the
position
that the character is at.
REGION
R
Gets the
region
that the character is currently located in.
ROOM
R
Gets the
room
that the character is in.
SECTOR
R
Gets the
sector
that the character is in.
TOPOBJ
R
Gets the top-most
character
or
item
in the world that contains the character.
TYPEDEF
R
Gets the
CHARDEF
that defines the character.
Properties and Functions
Here is a list of all character properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples. If an attempt is made to access a property that does not exist on the character, the property from the
CHARDEF
will be accessed instead.
Name
Read/Write
Description
Sphere X only?
AC
R
Returns the character's total defense.
ACTARG1
RW
Gets or sets the character's ACTARG1 value. X branch only: for skills Enticement, Peacemaking and Provocation, if ACTARG1 is set to the UID of the instrument to play, it will be played the sound of that instrument.
ACTARG2
RW
Gets or sets the character's ACTARG2 value.
ACTARG3
RW
Gets or sets the character's ACTARG3 value.
ACTDIFF
RW
Gets or sets the difficulty of the character's current action.
ACTION
RW
Gets or sets the skill that the character is currently using.
ACTP
RW
Gets or sets the character's ACTP value. Can get x,y,z,position of the point in X branch.
ACTPRV
RW
Gets or sets the character's ACTPRV value.
ADDHOUSE uid
W
X branch only. Adds the given uid to the player's house. If the player current count of houses is greater than the limit he has, the house will be redeeded.
ADDSHIP uid
W
X branch only. Adds the given uid to the player's ship. If the player current count of ships is greater than the limit he has, the ship will be redeeded.
AFK
W
Gets or sets whether or not the character is in AFK mode.
AGE
R
Returns the age of the character since its creation, in seconds.
ALLSKILLS
amount
W
Sets all of the character's skills to the specified amount.
ANIM
anim_id
W
Plays the specified animation on the character.
ATTACKER
.properties
R
Gets the number of opponents who have damaged the character.
BANK
layer
W
Opens the character's bank (or the container at the specified layer) for SRC to view.
BANKBALANCE
R
Returns the total amount of gold in the character's bankbox.
BARK
sound_id
W
Plays the specified sound (or the character's generic sound if not specified) to nearby clients from this character.
BODY
RW
Gets or sets the character's body.
BOUNCE
item_uid
W
Places a specified item in the character's backpack.
BOW
W
Makes the character bow to SRC.
CAN
RW
Gets or Sets the Can flags for this chardef. Only readable in X branch.
CANCAST
spell_id, check_antimagic
R
Returns 1 if the character can cast a given spell, bypassing anti-magic field tests if
check_antimagic
set to 0.
CANMAKE
item_id
R
Returns 1 if the character has the skills and resources to craft a certain item.
CANMAKESKILL
item_id
R
Returns 1 if the character has the skills to craft a certain item.
CANMASK
RW
X branch only. Stores the CAN flags to be dynamically switched on or off from the base CAN property.
CANMOVE
direction
R
Returns 1 if the character can move in the given direction.
CANSEE
R
Returns 1 if SRC can see the character.
CANSEELOS
R
Returns 1 if SRC has line of sight to the character.
CANSEELOSFLAG
flags
R
Returns 1 if SRC has line of sight to the character, with flags to modify what tests take place.
COLOR
RW
Gets or sets the character's hue.
CONSUME
resource_list
W
Removes specified resources from SRC's backpack.
COUNT
R
Returns the number of items equipped to the character.
CREATE
RW (R only on X)
Gets or sets the character's age since creation, in seconds (Tenth of seconds on X).
CRIMINAL
W
Sets whether or not the character is a criminal.
CURFOLLOWER
RW
Gets or sets the number of current followers the character has,
DAMAGE
amount, type, source
W
Inflicts damage upon the character.
When using COMBAT_ELEMENTAL_ENGINE add the following parameters after
source
:
physical
,
fire
,
cold
,
poison
,
energy
. All the values are in %.
DELHOUSE uid
W
X branch only. Deletes the given uid from the player's list (Will not delete the house)(-1 clears the whole list).
DELSHIP uid
W
X branch only. Deletes the given uid from the player's list (Will not delete the ship)(-1 clears the whole list).
DESTROY
W
Deletes the object, not stopped by a return 1 in
@Destroy
DEX
RW
Gets or sets the character's total dexterity.
DIALOG
dialog_id, page, parameters
W
Displays a dialog to SRC.
DIALOGCLOSE
dialog_id button
W
Closes a dialog that SRC has open, simulating a button press.
DIALOGLIST
.COUNT
R
Gets the number of number of dialogs currently considered to be visible on SRC's screen.
DIALOGLIST
.n.ID
R
Gets the ID of the nth dialog that SRC has open (zero-based).
DIALOGLIST
.n.COUNT
R
Gets the number of instances of nth dialog SRC has open (zero-based).
DIR
RW
Gets or setes the direction that the character is facing.
DISCONNECT
W
Disconnects the character.
DISMOUNT
W
Dismounts the character from their ride.
DISPIDDEC
R
Gets the ID of the character as a decimal number.
DISTANCE
point_or_uid
R
Gets the distance between this object and either SRC, a map location or another object.
DCLICK
W
Double clicks the character, with SRC as the source of the event.
DCLICK
object_uid
W
Double clicks an object, with the character as SRC.
DRAWMAP
radius
W
Starts the cartography skill, drawing a map of the local area up to
radius
tiles.
DROP
item_uid
W
Drops a specified item at the character's feet.
DUPE
W
Creates a clone of the character.
EDIT
W
Displays an editing dialog for the character to SRC.
EFFECT
type, item_id, speed, loop, explode, color, rendermode
W
Displays an effect to nearby clients.
EFFECTLOCATION
x,y,z,type,itemid,speed,loop,explode,color,render
W
Similar to the EFFECT command but instead of an object it takes a terrain location as a target.
X
EMOTE
message
W
Displays a *You see* message to all nearby clients.
EMOTEACT
RW
Gets, sets or toggles whether or not the character will emote all of its actions.
EQUIP
item_uid
W
Equips an item to the character.
EQUIPARMOR
W
Equips the character with the best armour in their backpack.
EQUIPHALO
timeout
W
Equips a halo light to the character, lasting for
timeout
tenths of a second.
EQUIPWEAPON
W
Equips the character with the best weapon in their backpack.
EVENTS
event_defname
RW
Gets a list of events attached to the object, or adds or removes an event to or from the object.
EXP
RW
Gets or sets the character's experience points.
FACE
object_uid
(P coords in X branch)
W
Turns the character to face a specified object or SRC. Admits coordinates instead uid in X branch.
FAME
RW
Gets or sets the character's fame.
FAME
.fame_group
R
Returns 1 if the character's fame falls within the specified fame group.
FCOUNT
R
Returns the total number of items equipped to the character, including subitems
FLAGS
RW
Gets or sets the character's flags.
FIX
W
Re-aligns the character's Z level to ground level.
FIXWEIGHT
W
Recalculates the character's total weight.
FLIP
W
Rotates the character.
FONT
RW
Gets or sets the character's speech font.
FOOD
RW
Gets or sets the character's food level.
FORGIVE
W
Revokes the character's jailed status.
GETHOUSEPOS uid
R
Returns the position of the given UID on the houses list (-1 if not found).
GETSHIPPOS uid
R
Returns the position of the given UID on the ships list (-1 if not found).
GO
location
W
Teleports the character to the specified location.
GOCHAR
n
W
Teleports the character to the nth character in the world.
GOCHARID
character_defname
W
Teleports the character to the next characer in the world with the specified
BASEID
GOCLI
n
W
Teleports the character to the nth online player. (zero-based)
GOITEMID
item_defname
W
Teleports the character to the next item in the world with the specified
BASEID
.
GOLD
RW
Gets or sets the amount of gold the character has.
GONAME
name
W
Teleports the character to the next character or item in the world with the specified name, accepts wildcards (*).
GOSOCK
socket
W
Teleports the character to the online player with the specified socket number.
GOTYPE
item_type
W
Teleports the character to the next item in the world with the specified
TYPE
.
GOUID
object_uid
W
Teleports the character to the object with the specified
UID
.
GUILDABBREV
R
Returns the character's guild abbreviation.
HEAR
text
W
For NPCs, acts as if SRC had spoken the specified
text
. For players, displays
text
as a system message.
HEIGHT
R
Gets the character's height.
HITS
RW
Gets or sets the character's hitpoints.
HOME
RW
Gets or sets the character's home location.
HOUSE.n
R
X branch only.Access the house in the Nth position, eg: house.3.Redeed
HOUSES
R
X branch only. Returns the number of houses on the player's list.
HUNGRY
W
Displays this character's hunger level to SRC.
ID
R
Gets the character's ID.
INFO
W
Displays an information dialog about the character to SRC.
INT
RW
Gets or sets the character's total intelligence.
INVIS
W
Sets whether or not the character is invisible.
INVUL
W
Sets whether or not the character is invulnerable.
ISARMOR
object_uid
R
Returns 1 if the object is armour.
ISCHAR
R
Returns 1 if the object is a character.
ISCONT
R
Returns 1 if the object is a container.
ISDIALOGOPEN
dialog_id
R
Returns 1 if SRC has the specified dialog visible on their screen.
ISEVENT
.event_defname
R
Returns 1 if the object has an event attached to it.
ISGM
R
Returns 1 if the character is in GM mode.
ISINPARTY
R
Returns 1 if the player is in a
party
.
ISITEM
R
Returns 1 if the object is an item.
ISMYPET
R
Returns 1 if the character belongs to SRC.
ISNEARTYPE
type, distance, flags
R
Returns 1 if a nearby item has the given TYPE.
ISNEARTYPETOP
type, distance, flags
R
Returns a nearby world location of a nearby item which has the given TYPE.
ISONLINE
R
Returns 1 if the character is considered to be online.
ISPLAYER
R
Returns 1 if the object is a player.
ISSTUCK
R
Returns 1 if the character cannot walk in any direction.
ISTEVENT
.event_defname
R
Returns 1 if the object has an event attached to its
CHARDEF
.
ISTIMERF
.function
R
Returns the number of seconds left on the specified timerf if it exists.
ISVENDOR
R
Returns 1 if the character is a vendor.
ISVERTICALSPACE
location
R
Returns 1 if the ceiling at the given location is high enough for the character to fit under.
ISWEAPON
object_uid
R
Returns 1 if the object is a weapon.
JAIL
cell
W
Sends the character to jail, to a specified jail cell.
KARMA
RW
Gets or sets the character's karma.
KARMA
.karma_group
R
Returns 1 if the character's karma falls within the specified karma group.
KILL
W
Kills the character.
LEVEL
RW
Gets or sets the character's experience level.
LIGHT
RW
Gets or sets the character's personal light level.
LUCK
RW
Gets or sets the luck value for the character.
MAKEITEM
item_defname, amount
W
Begins an attempt to craft the specified quantity of the given item.
MANA
RW
Gets or sets the character's mana.
MAP
RW
Gets or sets the map that this object is located.
MAPWAYPOINT
"ObjectUID, WaypointType"
W
Add/remove waypoints on client radar map (enhanced clients only).
MAXFOLLOWER
RW
Gets or sets the maximum number of followers the character can have.
MAXHITS
RW
Gets or sets the character's maximum hitpoints.
MAXHOUSES
RW
Added to Accounts and Chars, when created they read this setting from the sphere.ini (if values on sphere.ini change, they will not reflect on already created accounts/chars).
X
MAXMANA
RW
Gets or sets the character's maximum mana.
MAXSHIPS
RW
Added Accounts and Chars, when created they read this new setting from the sphere.ini (if values on sphere.ini change, they will not reflect on already created accounts/chars).
X
MAXSTAM
RW
Gets or sets the character's maximum stamina.
MAXWEIGHT
R
Returns the maximum weight that the character can carry.
MEMORY
.object_uid
RW
Gets or sets the memory flags the character has for the given object.
MENU
menu_defname
W
Displays a menu to SRC.
MESSAGE
message
W
Displays a message above this character to SRC.
MESSAGEUA
colour, talkmode, font, lang_id, message
W
Displays a UNICODE message above this character to SRC.
MODAR
RW
Gets or sets a modifier for the character's armour rating.
MODDEX
RW
Gets or sets the character's dexterity modifier.
MODINT
RW
Gets or sets the character's intelligence modifier.
MODMAXWEIGHT
RW
Gets or sets the character's maximum weight modifier.
MODSTR
RW
Gets or sets the character's strength modifier.
MOUNT
R
Gets the UID of the character's mount.
MOUNT
mount_uid
W
Attempts to mount the character on to the specified mount.
MOVE
direction
R
Returns the movement flags for the tile in the given direction (see can_flags in sphere_defs.scp).
MOVE
direction, amount
MOVE
x y
W
Moves the object relative to its current position.
MOVENEAR
object_uid, distance
W
Moves the character to a random location near another object within a certain distance.
MOVETO
location
W
Moves the character to a specific location.
NAME
RW
Gets or sets the character's name.
NEWBIESKILL
skill_id
W
Distributes items that are associated with the specified skill, to the character.
NEWGOLD
amount
W
Generates
amount
gold in the character's backpack.
NEWLOOT
item_or_template_defname
W
Generates the specified item or template into the character's backpack, providing that they are an NPC that hasn't been summoned.
NIGHTSIGHT
RW
Gets or sets whether or not the character has nightsight enabled.
NOTOGETFLAG
viewer_uid, allow_incognito
RW
Gets the character's notoriety flags as seen by the specified viewer.
NPC
RW
Gets or sets the character's AI type.
NUDGEDOWN
amount
W
Decreases the character's Z level.
NUDGEUP
amount
W
Increases the characer's Z level.
OBODY
RW
Gets or sets the character's original body.
OPENPAPERDOLL
W
Displays the character's paperdoll to SRC.
OPENPAPERDOLL
character_uid
W
Displays a specified character's paperdoll to this character.
OSKIN
RW
Gets or sets the character's original colour.
ODEX
RW
Gets or sets the character's base dexterity (without modifiers).
OINT
RW
Gets or sets the character's base intelligence (without modifiers).
OSTR
RW
Gets or sets the character's base strength (without modifiers).
PACK
W
Opens the character's backpack for SRC to view.
POISON
strength
W
Poisons the character, with the specified poison strength.
POLY
character_id
W
Begins casting the polymorph spell, with
character_id
being the character to turn into.
PROMPTCONSOLE
function, prompt_message
W
Displays a prompt message to SRC and passes their response into a specified function.
PROMPTCONSOLEU
function, prompt_message
W
Displays a prompt message to SRC and passes their response into a specified function, supporting UNICODE response.
PRIVSET
plevel
W
Sets the PLEVEL of the character.
RANGE
R
Gets the combat range of the character.
RELEASE
W
Clears the character's owners.
REMOVE
allow_player_removal
W
Deletes the character.
REMOVEFROMVIEW
W
Removes the object from nearby clients' screens.
RESCOLD
RW
Gets or sets the character's resistance to cold.
RESCOLDMAX
RW
Gets or sets the character's maximum resistance to cold.
RESCOUNT
item_defname
R
Returns the total amount of a specific item equipped to the character or inside their baackpack.
RESENDTOOLTIP
sendfull
,
usecache
W
Forces Sphere to update the tooltips for nearby clients.  If sendfull is 1 the entire tooltip is sent and if 0 then just the header is sent.  If usecache is 1 then the cached version (if found) will be sent and if 0 then the cached version (if found) will be replaced and sent
RESENERGY
RW
Gets or sets the character's resistance to energy.
RESENERGYMAX
RW
Gets or sets the character's maximum resistance to energy.
RESFIRE
RW
Gets or sets the character's resistance to fire.
RESFIREMAX
RW
Gets or sets the character's maximum resistance to fire.
RESPOISON
RW
Gets or sets the character's resistance to poison.
RESPOISONMAX
RW
Gets or sets the character's maximum resistance to poison.
RESTEST
item_list
R
Returns 1 if all of the items in the list can be found equipped to the character or inside their backpack.
RESURRECT
force
W
Resurrects the character. If
force
is 1 then usual anti-magic checks are bypasses.
SALUTE
object_uid
W
Makes the character salute a specified object or SRC.
SAY
message
W
Makes the character speak a message.
SAYU
message
W
Makes the character speak a UTF-8 message
SAYUA
colour, talkmode, font, lang_id, text
W
MAkes the character speak a UNICODE message.
SDIALOG
dialog_id, page, parameters
W
Displays a dialog to SRC, providing that it is not already open.
SERIAL
R
Gets the item's unique ID in the world.
SEX
value_male:value_female
R
Returns
value_male
or
value_female
depending on the character's gender.
SEXTANTP
location
R
Converts the character's location or a specified location into sextant coordinates.
skill_name
RW
Gets or sets the character's skill level in
skill_name
.
SHIP.n
R
X branch only. Added to access the ship in the Nth position, eg: ship.3.Redeed
SHIPS
R
X branch only. Return the ships on the player's list.
SKILL
W
Begins using a skill.
SKILLADJUSTED
."number or skill_name" (X branch only)
R
Returns the skill value adjusted by the stat bonus. Example “SkillAdjusted.1” or “SkillAdjusted.Anatomy”.
SKILLCHECK
skill_id, difficulty
R
Performs a check for skill success, returning 1 if the attempt was successful.
SKILLBEST
.n
R
Returns the ID of the character's nth highest skill (0 = Highest)
SKILLGAIN
skill, difficulty
W
Invokes Sphere's skill gain for the specified skill, with the given difficulty (0-100)
SKILLTEST
skill_list
R
Returns 1 if the character possess all of the skills in the list.
SKILLTOTAL
R
Returns the total value of all the character's skills.
SKILLTOTAL
skill_group
R
Returns the total value of all the character's skills with the specified group flag(s).
SKILLTOTAL
-amount
R
Returns the total value of all the character's skills that are under
amount
.
SKILLTOTAL
+amount
R
Returns the total value of all the character's skills that are over
amount
.
SKILLUSEQUICK
skill_id, difficulty
R
Quickly uses a skill, returning 1 if the attempt was successful.
SLEEP
fall_forwards
W
Makes the character appear to sleep.
SOUND
sound_id, repeat
W
Plays a sound from this character.
SPELLEFFECT
spell_id, strength, source_character_uid, source_item_uid
W
Causes the character to be affected by a spell.
SPEECHCOLOROVERRIDE
value
RW
Override client speech hue.
STAM
RW
Gets or sets the character's stamina.
STEPSTEALTH
RW
Gets or sets the amount of steps a character can do while using the Stealth skill.
STONE
RW
Gets or sets whether or not the character is trapped in stone.
STR
RW
Gets or sets the character's total strength.
SUICIDE
W
Forces the character to commit suicide.
SUMMONCAGE
W
Teleports the character to SRC's, surrounded by a cage multi.
SUMMONTO
W
Teleports the character to SRC's position.
TAG
.name
RW
Gets or sets the value of a TAG.
TAGAT
.index
R
Gets a TAG at the given zero-based index.
TAGAT
.index
.KEY
R
Gets the name of the TAG at the given zero-based index.
TAGAT
.index
.VAL
R
Gets the value of the TAG at the given zero-based index.
TAGCOUNT
R
Gets the number of TAGs stored on the item.
TAGLIST
W
Outputs a list of the object's TAGs.
TARGET
FGMW
function
W
Displays a targeting cursor to SRC.
TIMER
RW
Gets or sets the length of time before the item's timer expires, in seconds.
TIMERD
RW
Gets or sets the length of time before the item's timer expires, in tenths of a second.
TIMERF
time, function
W
Scheduled a function to be executed on this object in
time
seconds.
TIMERF
CLEAR
W
Clears all scheduled functions from the character.
TIMERF
STOP, function
W
Stops the specified function from the character. (On X version wild character * is available for defining the function name or the argument)
TIMERMS
W
Set an object timer to elapse after the given number of milliseconds.
TITHING
RW
Gets or sets the number of tithing points the character has.
TITLE
RW
Gets or sets the character's title.
TOWNABBREV
R
Returns the character's town abbreviation.
TRIGGER
trig_name, trig_type
R
Fires a custom trigger and returns the RETURN value.
UID
R
Gets the item's unique ID in the world.
UNDERWEAR
W
Toggles the display of underwear on the character.
UNEQUIP
item_uid
W
Unequips an item from the character, placing it in their backpack.
UPDATE
W
Updates the state of the character to nearby clients.
UPDATEX
W
Updates the state of the character to nearby clients, removing it from their view first to ensure a full refresh.
USEITEM
W
Double clicks the character, with SRC as the source of the event, without checking for line of sight.
USEITEM
object_uid
W
Double clicks an object, with the character as SRC.
VISUALRANGE
RW
Gets or sets the character's sight range.
WEIGHT
R
Gets the weight of the character.
WHERE
W
Describes the character's location to SRC.
Z
R
Gets the Z position of the character.
Triggers
Here is a list of all character triggers. Click on the trigger name for more detailed information such as arguments and examples.
Name
Description
Sphere X only?
@AfterClick
Fires when the object has been single-clicked, just before the overhead name is shown.
@Attack
Fires when the character begins attacking another.
@CallGuards
Fires when the character calls for guards.
@CharAttack
Fires when the character is attacked by another character.
@CharClick
Fires when the character is clicked by another character.
@CharClientTooltip
Fires when the tooltips are about to be sent to the character.
@CharDClick
Fires when the character double clicks another character.
@CharTradeAccepted
Fires when another character accepts trade with the character.
@Click
Fires when the object has been single-clicked.
@ClientTooltip
Fires when tooltips for this character are about to be sent to a client.
@CombatAdd
Fires when someone is being added to my attacker list.
@CombatDelete
Fires when someone is deleted from my attacker list.
@CombatEnd
Fires when someone is being deleted from my attacker list and I don't have any more viable targets.
@CombatStart
Fires when adding first attacker to my list.
@ContextMenuRequest
Fires when a client requests the context menu options for the object.
@ContextMenuSelect
Fires when a client selects a context menu option for the object.
@Create
Fires when the object is initially created, before it is placed in the world.
@Criminal
Fires when the character becomes a criminal.
@DClick
Fires when the object is double-clicked.
@Death
Fires when the character's hitpoints reaches zero.
@DeathCorpse
Fires when a corpse is created for the character.
@Destroy
Fires when the object is being deleted.
@Dismount
Fires when the character dismounts their ride.
@Dye
Fires when the character is about to change their color or the color of an object.
@Eat
Fires when the character eats something.
@EnvironChange
Fires when the environment changes for the character.
@ExpChange
Fires when the character's experience points change.
@ExpLevelChange
Fires when the character's experience level changes.
@FameChange
Fires when the character's fame changes.
@GetHit
Fires when the character receives damage.
@Hit
Fires when the character hits another in combat.
@HitMiss
Fires when the character fails to hit another in combat.
@HitParry
X branch only. Fires when the character is attempting to parry a hit.
X
@HitTry
Fires when the character tries to hit another in combat.
@HouseDesignCommit
Fires when the character commits a new house design.
@HouseDesignExit
Fires when the character exits house design mode.
@Hunger
Fires when the character's food level decreases.
@ItemAfterClick
Fires when the character single-clicks an item, just before the overhead name is shown.
@ItemBuy
Fires when the character buys an item from a vendor.
@ItemClick
Fires when the character single-clicks an item.
@ItemClientTooltip
Fires when the tooltips are about to be sent to the client for an item.
@ItemContextMenuRequest
Fires when the character requests the context menu options for an item.
@ItemContextMenuSelect
Fires when the character selects a context menu option for an item.
@ItemCreate
Fires when an item is initially created, before it is placed in the world, and the character is in some way responsible for it.
@ItemDamage
Fires when the character damages an item.
@ItemDClick
Fires when the character double-clicks an item.
@ItemDropOn_Char
Fires when the character drops an item on to a character.
@ItemDropOn_Ground
Fires when the character drops an item on to the ground.
@ItemDropOn_Item
Fires when the character drops an item on to another item.
@ItemDropOn_Self
Fires when the character drops an item inside another item.
@ItemEquip
Fires when the character equips an item.
@ItemEquipTest
Fires when the characer is about to equip an item.
@ItemPickUp_Ground
Fires when the character picks an item up from the ground.
@ItemPickUp_Pack
Fires when the character picks an item up from inside a container.
@ItemPickUp_Self
Fires when the character picks an item up from inside another item.
@ItemPickUp_Stack
Fires when the character picks up an item from a stack.
@ItemSell
Fires when the character sells an item to a vendor.
@ItemSmelt
Fires when the character smelt an item.
X
@ItemSpellEffect
Fires when the character hits an item with a spell.
@ItemStep
Fires when the character steps on an item.
@ItemTargOn_Cancel
Fires when the character cancels an item's target cursor.
@ItemTargOn_Char
Fires when the character targets a character with an item's target cursor.
@ItemTargOn_Ground
Fires when the character targets the ground with an item's target cursor.
@ItemTargOn_Item
Fires when the character targets an item with an item's target cursor.
@ItemToolTip
Fires when the character requests old-style tooltips for an item.
@ItemUnEquip
Fires when the character unequips an item.
@Jailed
Fires when the character is sent to jail.
@KarmaChange
Fires when the character's karma changes.
@Kill
Fires when the character kills another character.
@Login
Fires when the character logs in.
@Logout
Fires when the character logs out.
@Mount
Fires when the character mounts a ride.
@MurderDecay
Fires when one of the character's kills is about to decay.
@MurderMark
Fires when the character is about to gain a kill.
@NotoSend
Fires the status bar/character notoriety color is sent to another players.
@NPCAcceptItem
Fires when the NPC receives an item.
@NpcActCast
Fires when the NPC is selecting the spell to cast.
X
@NPCActFight
Fires when the NPC makes a combat decision.
@NPCActFollow
Fires when the NPC follows another character.
@NPCAction
Fires when the NPC is about to perform an AI action.
@NPCActWander
X branch only. Fires each step an NPC does while wandering.
@NPCHearGreeting
Fires when the NPC hears a character for the first time.
@NPCHearUnknown
Fires when the NPC hears something they don't understand.
@NPCLookAtChar
Fires then the NPC looks at a character.
@NPCLookAtItem
Fires when the NPC looks at an item.
@NPCLostTeleport
Fires when the NPC is lost and is about to be teleported back to their
HOME
.
@NPCRefuseItem
Fires when the NPC refuses an item being given to them.
@NPCRestock
Fires when the NPC is having their items restocked.
@NPCSeeNewPlayer
Fires when the NPC first sees a player.
@NPCSeeWantItem
Fires when the NPC sees an item they want.
@NPCSpecialAction
Fires when the NPC is about to perform a special action (leaving fire trail, dropping web).
@PayGold
Fires when the character receives a payment. (Experimental Build Only)
@PersonalSpace
Fires when the character is stepped on.
@PetDesert
Fires when the character deserts its owner.
@Profile
Fires when a player attempts to read the character's profile from the paperdoll.
@ReceiveItem
Fires when the NPC receives an item from another character, before they decide if they want it or not.
@RegenStat
Fires when a character is going to regenerate any stat point.
@RegionEnter
Fires when the character enters a region.
@RegionLeave
Fires when the character leaves a region.
@RegionResourceFound
Fires after a resource has been selected and the resource bit has been created.
@Rename
Fires when the character renames another.
@Resurrect
Fires when the character is being resurrected.
@SeeCrime
Fires when the character sees a crime take place.
@SeeHidden
Fires when this character is about to see a hidden character.
@SkillAbort
Fires when the character aborts a skill.
@SkillChange
Fires when the character's skill level changes.
@SkillFail
Fires when the character fails a skill.
@SkillGain
Fires when the character has a chance to gain in a skill.
@SkillMakeItem
Fires when the character crafts an item.
@SkillMenu
Fires when a skill menu is shown to the character.
@SkillPreStart
Fires when the character starts a skill, before any hardcoded action takes place.
@SkillSelect
Fires when the character selects a skill on their skill menu.
@SkillStart
Fires when the character starts a skill.
@SkillSuccess
Fires when the character succeeds at a skill.
@SkillUseQuick
Fires when the character quickly uses a skill.
@SkillWait
Fires when Sphere wants to check if a character must wait before starting a skill.
@SpellBook
Fires when the character opens their spellbook.
@SpellCast
Fires when the character casts a spell.
@SpellEffect
Fires when the character is hit by the effects of a spell.
@SpellEffectAdd
Fires when a spell memory is added to the character.
X
@SpellEffectRemove
Fires the spell memory is removed from the character.
X
@SpellEffectTick
Fires when the character is hit the effect of a periodic spell (like Poison spell).
X
@SpellFail
Fires when the character fails to cast a spell.
@SpellSelect
Fires when the character selects a spell to cast.
@SpellSuccess
Fires when the character successfully casts a spell.
@SpellTargetCancel
Fires when the character cancels target selection for a spell they have just cast.
@StatChange
Fires when the character's STR, DEX or INT is changed through skill gain.
@StepStealth
Fires when the character takes a step whilst hidden.
@ToggleFlying
Fires when a Gargoyle Player is going to Fly or to Land.
@ToolTip
Fires when a player requests old-style tooltips for this character.
@TradeAccepted
Fires when the character accepts a trade with another player.
@TradeClose
Fires when a trade window is closed.
@TradeCreate
Fires when a player begins a trade with another player.
@UserBugReport
Fires when the player submits a bug report.
@UserChatButton
Fires when the player presses the Chat button on the paperdoll.
@UserExtCmd
Fires when the player sends an extended command packet. (used by some macros)
@UserExWalkLimit
Fires when the player's movement is restricted by the movement speed settings in Sphere.ini
@UserGuildButton
Fires when the player presses the Guild button on the paperdoll.
@UserKRToolbar
Fires when the player presses a button on the toolbar.
@UserMailBag
Fires when the player drags the mail bag on to another character.
@UserQuestArrowClick
Fires when the player clicks the quest arrow.
@UserQuestButton
Fires when the player presses the Quest button on the paperdoll.
@UserSkills
Fires when the player opens their skill menu, or a skill update is sent to the player.
@UserSpecialMove
Fires when the player uses a special move.
@UserStats
Fires when the player opens the status window.
@UserUltimaStoreButton
Fires when click on 'Ultima Store' button on new clients 7.0.62+
@UserVirtue
Fires when the player presses on the Virtue button.
@UserVirtueInvoke
Fires when the player invokes a virtue through macros.
@UserWarmode
Fires when the player switches between war and peace mode.
Players
Characters that are attached to an account become Player Characters. In addition to the basic character references, properties and functions they also receive the following:
References
References return pointers to other objects (e.g. the REGION reference allows you to access the REGION that an object is in). These can either be accessed by using
<REFNAME>
to return the
UID
(1 for object types that don't have UIDs) of the object or 0 if it doesn't exist, or by using
<REFNAME.KEY>
where KEY is a valid property/function/reference for the
REFNAME
object. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
GUILD
R
Gets the
guild stone
that the player belongs to.
SKILLCLASS
RW
Gets or sets the player's
skillclass
.
TOWN
R
Gets the
town stone
that the player belongs to.
Properties and Functions
Here is a list of all player properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
Sphere X only?
DEATHS
RW
Gets or sets the number of times the player has died.
DSPEECH
+/-speech_id
RW
Gets a list of attached speech handlers, or adds or removes a speech handler to or from the player.
GMPAGE
.n.DELETE
W
Deletes the nth GM page. (zero-based)
GMPAGE
.n.HANDLE
W
Sets the player as the handler for the nth GM page. (zero-based)
GMPAGE
.n.key
W
Executes the .page command with
key
as the arguments.
ISDSPEECH
.speech_id
R
Returns 1 if the player has the given speech handler attached.
KICK
W
Disconnects and blocks the player's account.
KILLS
RW
Gets the number of murders the player has committed.
KRTOOLBARSTATUS
RW
Gets or sets whether or not the KR toolbar is enabled for this player.
LASTUSED
RW
Gets the length of time since the player was last attached to a client, in seconds.
PASSWORD
W
Sets or clears the player's password.
PFLAG
RW
Gets or sets the player's PFLAG value.
PROFILE
RW
Gets or sets the text to display on the player's profile.
SKILLLOCK
.skill_id
RW
Gets or sets the lock state of the player's skill. 0 is Up. 1 is Down. 2 is Locked.
SPEEDMODE
RW
Gets or sets the speed that the player moves at. (0=Normal, 1=Double Speed on Foot, 2=Always walk, 3=Always Run on Foot/Always Walk on Mount, 4=Can not Walk or Run)
STATLOCK
.stat_id
RW
Gets or sets the lock state of the player's STR (0), DEX (2) or INT (1). [0 = up, 1 = down, 2 = locked]
NPCs
Characters that are not attached to an account are NPCs and are controlled by Sphere's AI. In addition to the basic character references, properties and functions they also receive the following:
Properties and Functions
Here is a list of all NPC properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
Sphere X only?
ACTPRI
RW
Gets or sets the NPC's motivation towards their current action.
BUY
W
Displays the shop window to SRC, in buy mode.
BYE
W
Ends the NPC's current action.
FLEE
distance
W
Begins moving the NPC away from its current location.
GOTO
location
W
Begins moving the NPC towards the specified location.
HIRE
W
Begins the hiring process between the NPC and SRC.
LEAVE
distance
W
Begins moving the NPC away from its current location.
NPC
RW
Gets or sets the NPC's AI type.
HOMEDIST
RW
Gets or sets the distance that the NPC can wander from its
HOME
position.
PETRETRIEVE
W
Enables SRC to retrieve their stabled pets from the NPC.
PETSTABLE
W
Enables SRC to stable their pet with the NPC.
RESTOCK
force
W
Clears all of the NPC's stock, repopulating it when it is next accessed (or immediately if
force
=1)
RUN
direction
W
Forces the NPC to run one tile in the specified direction.
SELL
W
Displays the shop window to SRC, in sell mode.
SHRINK
W
Shrinks the NPC into a figurine item.
SPEECH
+/-speech_id
RW
Gets the list of speech handlers attached to the NPC, or adds or removes a speech handler to or from the NPC.
SPEECHCOLOR
RW
Gets or sets the colour of the NPC's speech.
THROWDAM
min,max
RW
Gets or sets a range of damage used for thrown objects. (overrides chardef property)
THROWDAM
dam
RW
Gets or sets the constant damage used for thrown objects. (overrides chardef property)
THROWDAMTYPE
damage flags
RW
y
Gets or sets the damage flags used for thrown objects. (overrides chardef property)
THROWOBJ
id
RW
Gets or sets the ID of an object to be thrown by NPCs. (overrides chardef property)
THROWRANGE
min,max
RW
Gets or sets the range that an object can be thrown at. (overrides chardef property)
THROWRANGE
max
RW
Gets or sets the range that an object can be thrown at with a default min of 2. (overrides chardef property)
TRAIN
skill
W
Initiates training between the NPC and SRC.
VENDCAP
RW
Gets or sets the amount of gold a vendor will restock to.
VENDGOLD
RW
Gets or sets the amount of gold a vendor has.
WALK
direction
W
Forces the NPC to walk one tile in the specified direction.
Clients
When a client is controlling a character, the following references, properties and functions will be available:
References
References return pointers to other objects (e.g. the REGION reference allows you to access the REGION that an object is in). These can either be accessed by using
<REFNAME>
to return the
UID
(1 for object types that don't have UIDs) of the object or 0 if it doesn't exist, or by using
<REFNAME.KEY>
where KEY is a valid property/function/reference for the
REFNAME
object. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
Sphere X only?
GMPAGEP
R
Gets the
GM page
that the client is currently handling.
HOUSEDESIGN
R
Gets the
building
that is currently being designed by the client.
PARTY
R
Gets the
party
that the client is a member of.
TARG
RW
Gets or sets the
character
or
item
that the client has targeted.
TARGP
RW
Gets or sets the
location
that the client has targeted.
TARGPROP
RW
Gets or sets the character whose skills are shown in the client's skill menu.
TARGPRV
RW
Gets or sets the
character
or
item
that the client previously targeted.
Properties and Functions
Here is a list of all client properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
Sphere X only?
ADD
item_defname
W
Prompts the client to target a location to add the specified item at.
ADDBUFF
icon, cliloc1, cliloc2, time, arg1, arg2, arg3
W
Displays a buff icon in the client's buff icon bar.
ADDCLILOC
cliloc, args
W
Adds a cliloc to the tooltip being sent to the client. Only valid in @ClientTooltip triggers.
ADDCONTEXTENTRY
entry_id, cliloc, flags, colour
W
Adds an entry to the context menu being sent to the client. Only valid in @ContextMenuRequest triggers.
ALLMOVE
RW
Gets or sets whether or not the client has ALLMOVE privileges.
ALLSHOW
RW
Gets or sets whether or not the client is able to see disconnected characters.
ARROWQUEST
x, y, id
W
Displays an arrow on the client's screen that points to the specified world coordinates. If id is supplied multiple arrows can be displayed on the client at once (Newer clients only - 3.x+ clients confirm?).  You can cancel the arrow by passing 0 for x and y and your id.  Using ARROWQUEST without any arguments will cancel arrow with id 0 if present.
BADSPAWN
W
Teleports the client to the first invalid spawn point in the world.
BANKSELF
W
Opens up the client's bankbox.
CAST
spell_id'
W
Begins casting a spell.
CHARLIST
W
Displays the client's character list screen.
CLEARCTAGS
W
Removes all of the client's CTAGs.
CLIENTIS3D
R
Returns 1 if the client is using the 3D client.
CLIENTISKR
R
Returns 1 if the client is using the KR client.
CLIENTVERSION
R
Gets the client version the client is using, based on the encryption keys being used (unencrypted clients return 0).
CTAG
RW
Gets or sets the value of a CTAG.
CTAGCOUNT
R
Gets the number of CTAGs stored on the client.
CTAGLIST
W
Displays a list of the client's CTAGs to SRC.
CTAGLIST
LOG
W
Displays a list of the client's CTAGs on the server console.
DEBUG
RW
Gets or sets whether or not the client is in debug mode.
DETAIL
RW
Gets or sets whether or not the client receives additional detail, such as combat messages.
EVERBTARG
command
W
Prompts the client to enter a command, or arguments to the command if specified. The complete command with arguments is then executed on TARG.
EXTRACT
file, template_id
W
Extracts static items from a targeted area on the map and saves them into the specified file.
FLUSH
W
Forces queued network data to be immediately sent to the client.
GM
RW
Gets or sets whether or not the client is in GM mode.
GMPAGE
ADD message
W
Sends a GM page from the client with the specified message, or if no arguments provided will prompt the client for a message.
GOTARG
W
Teleports the client to their targeted item.
HEARALL
RW
Gets or sets whether or not the client can hear all player speech regardless of location.
INFO
W
Displays an information dialog to the client for an object they target.
INFORMATION
W
Displays server information to the client.
LAST
W
Forces the client to target the object referenced by
ACT
.
LASTEVENT
RW
Returns the time when data was last received from the client.
LINK
W
Allows the client to target two objects to link them together.
MENU
menu_id
W
Displays a menu to the client.
MIDILIST
music1, music2, ...
W
Selects a random music id from the given list and tells the client to play it.
NUDGE
dx, dy, dz
W
Allows the client to nudge an area of items by the given coordinates, relative to the items' position.
NUKE
command
W
Allows the client to execute
command
on all items in a targeted area.
NUKECHAR
command
W
Allows the client to execute
command
on all NPCs in a targeted area.
PAGE
W
Displays the GM page menu to the client.
PRIVSHOW
W
Gets or sets whether or not the client's privilege level should show in their name.
REMOVEBUFF
icon
W
Removes a buff icon from the client's buff icon bar.
REPAIR
W
Prompts the client to target an item for them to repair.
REPORTEDCLIVER
R
Gets the client version the client is using, based on what it has identified itself as to the server.
REPORTEDCLIVER
.FULL
R
Gets the client version the client is using, based on what it has identified itself as to the server, including the 4th digit.
RESEND
W
Forces a full refresh of the client's screen.
SAVE
immediate
W
Begins a world save. If background saving is enabled then
SAVE
1
will force a foreground save.
SCREENSIZE
R
Gets the client's screen size. (width,height)
SCREENSIZE
.X
R
Gets the width of the client's screen size.
SCREENSIZE
.Y
R
Gets the height of the client's screen size.
SCROLL
scroll_id
W
Displays a message scroll to the client.
SELF
W
Forces the client to target itself.
SENDPACKET
data
W
Sends a raw data packet to the client.
SET
command
W
Prompts the client to target an object to execute
command
on.
SHOWSKILLS
W
Refreshes the client's skills for the skill menu.
SKILLMENU
skillmenu_id
W
Displays a skillmenu to the client.
SKILLSELECT
skill_id
W
Simulates the client selecting a skill from their skill menu.
SUMMON
character_id
W
Casts the summon spell, with
character_id'; being the character to summon.
SYSMESSAGE
text
W
Displays a system message to the client.
SYSMESSAGELOC
hue, cliloc, args
W
Displays a localized system message to the client.
SYSMESSAGELOCEX
hue, cliloc, flags, affix, args
W
Displays a localized system message to the client with affixed text.
SYSMESSAGEUA
hue, font, mode, language, text
W
Displays a UNICODE system message to the client.
TARGETTEXT
RW
Gets or sets the client's target text.
TELE
W
Casts the teleport spell.
TILE
z, item1, item2, ...
W
Tiles the ground within a targeted area with the listed items, at the given Z level.
UNEXTRACT
file
W
Unextracts previously extracted statics, as dynamic items at a targeted location.
VERSION
W
Displays the server description to the client.
WEBLINK
url
W
Opens the client's web browser to send them to the specified url.
X
command
W
Prompts the client to target an object to execute
command
on.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Dialogs are a more advanced form of user interface whose layout can be completely customised.
Contents
1
Syntax
1.1
Layout
1.2
Text
1.3
Buttons
2
Examples
Syntax
The definition of a dialog consists of
three
different blocks of script; a layout, a list of text strings used in the dialog and a buttons section which handles button responses from the client.
Layout
The layout section of the dialog defines how the dialog will look to clients.
[DIALOG
defname
]
x, y
script
Name
Description
defname
The dialog's defname.
x, y
The screen coordinates to display the dialog at.
script
The dialog's layout script.
The script text can be a complete script that is executed in the same way as a function or trigger script, and can even contain conditional statements to display different layouts to different clients if desired. The default object is the
character
or
item
that the dialog has been called upon, and
SRC
is the
client
who is viewing the dialog. If the dialog ends with a "RETURN 1" then Sphere will cancel displaying the dialog.
In addition to the usual functions, properties and references you would have access to in a normal script, there are also functions that place elements on to the dialog. The following table lists all elements that can be used:
Name
Description
button
x y gump_down gump_up is_pressable page id
Places a button on to the page
buttontileart
x y gump_down gump_up is_pressable page id tile_id tile_hue tile_x tile_Y
Places a button on to the page, with an item image placed over the top as part of the button.
checkbox
x y gump_check gump_uncheck initial_state id
Places a checkbox on to the page.
checkertrans
x y width height
Adds a transparent area of the dialog.
croppedtext
x y width height colour text_index
Places some text on to the page that wraps to specified boundaries.
dcroppedtext
x y width height colour text
Places some text on to the page that wraps to specified boundaries. Accepts dynamic coordinates relative to
dorigin
using
-
,
+
,
*
prefixes.
dorigin
x y
Sets the origin coordinates for dynamically positioned elements.
dhtmlgump
x y width height has_background has_scrollbar text
Places some HTML text on to the page. Accepts dynamic coordinates relative to
dorigin
using
-
,
+
,
*
prefixes.
dtext
x y colour text
Places some text on to the page. Accepts dynamic coordinates relative to
dorigin
using
-
,
+
,
*
prefixes.
dtextentry
x y width height colour id text
Places a text entry field on to the page where the client can enter text. Accepts dynamic coordinates relative to
dorigin
using
-
,
+
,
*
prefixes.
dtextentrylimited
x y width height colour id limit text
Places a text entry field on to the page where the client can enter a limited amount of text. Accepts dynamic coordinates relative to
dorigin
using
-
,
+
,
*
prefixes.
group
id
Defines a new group ID, for grouping sets of radio buttons.
gumppic
x y gump hue
Places a gump on to the page.
gumppictiled
x y width height gump
Tiles a gump over an area of the page.
htmlgump
x y width height text_index has_background has_scrollbar
Places some HTML text on to the page.
noclose
Prevents the dialog from being closed when right-clicked.
nodispose
Prevents the dialog from being closed by the "Close Dialogs" macro.
nomove
Prevents the dialog from being moved around the screen.
page
num
Begins defining page
num
of the dialog. (page 0 content is shown on all pages)
radio
x y gump_check gump_uncheck initial_state id
Places a radio button on to the page.
resizepic
x y gump width height
Places a multi-part
gump
on to the page, often used for dialog backgrounds.
text
x y colour text_index
Places some text on to the page.
textentry
x y width height colour id text_index
Places a text entry field on to the page where the client can enter text.
textentrylimited
x y width height colour id text_index limit
Places a text entry field on to the page where the client can enter a limited amount of text.
tilepic
x y item_id
Places an item image on to the page.
tilepichue
x y item_id hue
Places a coloured item image on to the page.
tooltip
cliloc_id @args
Places a tooltip on to the page (multiple arguments separated by @).
xmfhtmlgump
x y width height clilod_id has_background has_scrollbar
Places some localised HTML text on to the page.
xmfhtmlgumpcolor
x y width height cliloc_id has_background has_scrollbar colour
Places some localised HTML text on to the page with the specified colour.
xmfhtmltok
x y width height has_background has_scrollbar colour cliloc_id @args@
Places some localised HTML text on to the page, with arguments to the cliloc (multiple arguments separated by @).
Text
The text section of the dialog simply lists the different text strings used in the dialog's layout. When using dialog elements that represent text, such as
text
or
htmlgump
, an index into the TEXT block will be specified so that the client knows which text to actually display on that dialog element. This dialog section is optional, and may be omitted if there are no text elements on the dialog or if the newer dialog text elements, such as
dtext
or
dhtmlgump
, are used because their text string is specified in the layout and Sphere will automatically populate the TEXT block for you.
[DIALOG
defname
TEXT]
string1
string2
string3
Buttons
This section contains button triggers that fires when the client presses a certain button on the dialog. There are two ways that a button press can be handled, the syntaxc for both is shown below:
[DIALOG
defname
BUTTON]
ON=
button_id
script
ON=
button_id_start
button_id_end
script
The first "
ON=
button_id
" will handle the button press for the button with the matching ID, the second will handle any button press where the ID is between
button_id_start
and
button_id_end
.
Note:
If the client cancels the dialog by right clicking it, the trigger for button 0 will be fired.
Inside the button triggers there are some arguments passed in that aren't available in normal functions and triggers. The following table describes each argument passed in to dialog button triggers:
Name
Description
ARGCHK
Returns the number of selected checkboxes/radio buttons.
ARGCHK
[
id
]
Returns 1 if the checkbox/radio button with a specified ID was pressed down.
ARGCHKID
The ID of the first selected checkbox/radio button, or -1 if none were selected.
ARGN1
The ID of the button pressed.
ARGTXT
Returns the number of text fields submitted.
ARGTXT
[
id
]]
Returns the submitted text for the text field with the specified ID.
Examples
//
// Simple travel dialog from default script pack.
//
[DIALOG d_TravelTown]
0, 0
resizepic 0 0 3600 215 200
page 0
text 40 17 0 0
text 40 37 1152 1
text 40 57 1152 2
text 40 77 1152 3
text 40 97 1152 4
text 40 117 1152 5
text 40 137 1152 6
text 40 157 0 7
button 20 40 1209 1210 1 0 1
button 20 60 1209 1210 1 0 2
button 20 80 1209 1210 1 0 3
button 20 100 1209 1210 1 0 4
button 20 120 1209 1210 1 0 5
button 20 140 1209 1210 1 0 6

[DIALOG d_TravelTown TEXT]
Which Town?
Britain
Serpent's Hold
Cove
Vesper
Bucaneer's Den
Papua

[DIALOG d_TravelTown BUTTON]

ON=0
    SYSMESSAGE Menu Aborted
    
ON=1 //BRITAIN
    SRC.GO 1427,1697,0
    
ON=2 //SERPENTS HOLD
    SRC.GO 3009,3363,15
    
ON=3 //COVE
    SRC.GO 2264,1202,0
    
ON=4 //VESPER
    SRC.GO 2892,686,0
    
ON=5 //BUCANEER'S DEN
    SRC.GO 2733,2160,0
    
ON=6 //PAPUA
    SRC.GO=5726,3205,-3

--- PAGE BREAK ---

Help
Available languages
Missing languages
An EVENTS definition contains a set of trigger scripts which can be attached to characters. There are different properties that can be used to attach an event block to a character or set of characters:
Character definitions
via their
TEVENTS
property
Characters
via their
EVENTS
property,
All
players
via the
EVENTSPLAYER
setting in Sphere.ini.
All
NPCs
via the
EVENTSPET
setting in Sphere.ini
Contents
1
Syntax
2
Examples
Syntax
The syntax for defining an event is:
[EVENTS
defname
]
ON=
trigger_name
script
ON=
trigger_name
script
Any number of triggers can be handled by one
EVENTS
definition, however it is not possible to handle the same trigger twice without using multiple definitions.
The trigger name can be the name of any
character trigger
. The return value from the script can affect Sphere's hardcoded behaviour in different ways. See the documentation for the trigger to discover what parameters are passed in to each trigger and what the return values do.
Examples
//
// When attached to a character, character speaks when double-clicked
//
[EVENTS e_exampleevent]
ON=@DClick
    SAY I have been double clicked!
    RETURN 2
//
// e_Human_Environ from default script pack
// Attached to NPCs to make them light a torch during the night
//
[EVENTS e_Human_Environ]
ON=@EnvironChange
    IF (<FLAGS> & statf_war)
        RETURN 0
    ENDIF
    IF !(<SECTOR.ISDARK>) || (<FLAGS> & statf_nightsight)
        IF (<FINDLAYER.layer_hand2>)
            IF (<FINDLAYER.layer_hand2.TYPE> == t_light_lit)
                FINDLAYER.layer_hand2.BOUNCE
            ENDIF
        ENDIF
        RETURN 0
    ENDIF
    // already have a lit light ?
    IF (<FINDLAYER.layer_hand2>)
        IF (<FINDLAYER.layer_hand2.TYPE> == t_light_lit)
            RETURN 0
        ENDIF
    ENDIF
    // try to use a torch or light source if i have one. (and it's dark)
    IF (<FINDTYPE.t_light_out>)
        FINDTYPE.t_light_out.EQUIP
        FINDTYPE.t_light_out.USE
    ENDIF
    RETURN 0

--- PAGE BREAK ---

Help
Available languages
Missing languages
An ITEMDEF block defines the basic properties of an
item
.
Contents
1
Properties
2
Multi Definitions
2.1
Properties
3
Examples
Properties
Here is a list of all item definition properties.
Name
Read/Write
Description
AMMOANIM
RW
Overrides TDATA4 for bow/crossbow type weapons.
AMMOANIMHUE
RW
Sets the color of the effect when firing bow/crossbow type weapons.
AMMOANIMRENDER
RW
Sets the render mode of the effect when firing bow/crossbow type weapons.
AMMOCONT
RW
Sets the container UID or ID where to search for ammos for bow/crossbow type weapons.
AMMOTYPE
RW
Overrides TDATA3 for bow/crossbow type weapons.
ARMOR
min,max
RW
Gets or sets the base protection that the armour will give.
ARMOR
.LO
R
Gets the minimum base protection the armour will give.
ARMOR
.HI
R
Gets the maximum base protection the armour will give.
BASEID
R
Gets the defname of the item if set, otherwise the ID.
BONUSSTR
|
BONUSDEX
|
BONUSINT
|
BONUSHITS
|
BONUSSTAM
|
BONUSMANA
|
BONUSSKILLx
|
BONUSSKILLxAMT
(X branch only)
RW
Increases (or decreases) the applicable Stat. Positive or negative integer.
For BonusSkill, x is a sequential number(1-4) and must assign a skill. Ex:bonusskill1=bowcraft and BonusSkillxAMT is the amount
CAN
RW
Gets or sets attributes for the item. See can_i_flags in sphere_defs.scp.
DAM
min,max
RW
Gets or sets the base damage that the weapon will deal.
DAM
.LO
R
Gets the minimum base damage the weapon will deal.
DAM
.HI
R
Gets the maximum base damage the weapon will deal.
DEFNAME
RW
Gets or sets defname of the item
DISPID
RW
Gets or sets the ID to display as to clients.
DUPEITEM
RW
Gets or sets the defname of the item that this is a duplicate/rotation of (see
DUPELIST
).
DUPELIST
item_defname, item_defname, ...
RW
Gets or sets a comma-separated list of items that this item will cycle through when rotated.
DYE
RW
Gets or sets whether or not the item can be dyed using dye tubs (1 or 0).
FLIP
RW
Gets or sets whether or not the item automatically rotates when dropped.
HEIGHT
RW
Gets or sets the height of the item.
ID
RW
Gets or sets the ID of the item to inherit property values from.
INSTANCES
R
Returns the number of this item that exist in the world.
ISARMOR
R
Gets whether or not the item is considered to be armour.
ISWEAPON
R
Gets whether or not the item is considered to be a weapon.
LAYER
RW
Gets or sets the layer that the item will occupy when equipped (1 or 0).
NAME
RW
Gets or sets the name of the item.
RANGE
min, max
RW
Gets or sets the range of the weapon.
RANGEH
R
Gets the maximum range of the weapon.
RANGEL
R
Gets the minimum range of the weapon.
REPAIR
RW
Gets or sets whether or not the item can be repaired (1 or 0).
REPLICATE
RW
Gets or sets whether or not multiple instances of the item can be crafted at once.
RESDISPDNHUE
RW
Gets or sets the colour to display as to clients who don't have a high enough
RESDISP
to see the item.
RESDISPDNID
RW
Gets or sets the item ID to display as to clients who don't have a high enough
RESDISP
to see the item.
RESLEVEL
RW
Gets the minimum
RESDISP
required for a client to see the item.
RESMAKE
R
Returns the names of the resources needed to craft the item.
RESOURCES
RW
Gets or sets the resources that are needed to craft the item.
RESOURCES
.COUNT
R
Gets the number of different resources that are needed to craft the item.
RESOURCES
.n.KEY
R
Gets the
BASEID
of the nth resource needed to craft the item. (zero-based)
RESOURCES
.n.VAL
R
Gets the amount of the nth resource needed to craft the item. (zero-based)
REQSTR
RW
Gets or sets the amount of strength needed to equip the item.
SKILL
RW
Gets or sets the skill that is used with the weapon.
SKILLMAKE
RW
Gets or sets the list of skills needed to craft the item.
SKILLMAKE
.n.KEY
R
Gets the name of the nth skill needed to craft the item.
SKILLMAKE
.n.VAL
R
Gets the amount of the nth skill needed to craft the item.
SPEED
RW
Gets or sets the speed of the weapon.
TAG
.name
RW
Gets or sets the value of a TAG.
TDATA1
RW
Gets or sets the TDATA1 value of the item.
TDATA2
RW
Gets or sets the TDATA2 value of the item.
TDATA3
RW
Gets or sets the TDATA3 value of the item.
TDATA4
RW
Gets or sets the TDATA4 value of the item.
TEVENTS
RW
Gets a list of events attached the item, or adds an event to the item.
TFLAGS
R
Gets or sets the flags of the item from tiledata.mul.
TWOHANDS
RW
Gets or sets whether or not the item occupies both hands when equipped (layer_hand2)
TYPE
RW
Gets or sets the item's type.
VALUE
RW
Gets or sets the base value of the item.
WEIGHT
RW
Gets or sets the weight of the item.
WEIGHTREDUCTION
RW
Gets or sets the percent of weight reduction of the item.
Multi Definitions
For multi items (t_multi, t_multi_custom, t_ship), the ITEMDEF has additional properties.
Properties
Here is a list of all multi definition properties.
Name
Read/Write
Override†
Description
BASECOMPONENT
R
??
Gets how many static components the multi has in the multi.mul file.
BASECOMPONENT
.n.KEY
R
??
Accesses the multi's static components directly from the multi.mul file. (ID,DX,DY,DZ,D,VISIBLE)
COMPONENT
R
??
Gets how many dynamic components have been defined for the multi.
COMPONENT
.n.KEY
R
??
Accesses the multi's dynamic components. (ID,DX,DY,DZ,D)
COMPONENT
item_defname, dx, dy, dz
W
??
Defines a dynamic component to the multi that will be spawned along with it (e.g. doors and house sign)
MULTIREGION
left, top, right, bottom
RW
??
Gets or sets the boundaries of the multi (t_multi, t_multi_custom, t_ship).
REGIONFLAGS
RW
??
Gets or sets the flags that will be set on the multi's region.
SHIPSPEED
period,tiles
RW
??
Gets or sets the speed (tenths) and tiles that a ship will move at. (t_ship only)
SHIPSPEED.TILES
RW
Y
Gets or sets the tiles that a ship will move at each movement. (t_ship only)
SHIPSPEED.PERIOD
RW
Y
Gets or sets the speed (tenths per each movement) that a ship will move at. (t_ship only)
TSPEECH
RW
??
Gets a list of attached
SPEECH
handlers, or adds a handler to the multi.
†
Some ITEMDEF properties can be overridden by using
Override_TAGs
.  For example, TAG.OVERRIDE.SHIPSPEED.PERIOD and TAG.OVERRIDE.SHIPSPEED.TILES can be set on individual ships in-game to affect their speed.
Examples
//
// Blue Gold
//
[ITEMDEF i_gold_blue]
ID=i_gold      // inherits from i_gold
NAME=Blue Gold // named Blue Gold
TYPE=t_gold    // is type t_gold
VALUE=10       // valued at gold

ON=@Create
    COLOR = colors_blue
    
    
    //
    // Small Stone and Plaster House (from default script pack)
    //
[ITEMDEF 04064]                           // item ID 0x4064 (in mul files)
DEFNAME=i_multi_house_stone_plaster_small
NAME=Small Stone and Plaster House
TYPE=t_multi
VALUE=43800                               // valued at 43800 gold
MULTIREGION=-3,-3,3,4                     // size of the region, relative to location of the item
COMPONENT=i_door_wood,0,3,7               // adds a door at 0,3,7 (relative to location of the item)
COMPONENT=i_sign_brass_2,2,4,5            // adds a brass sign at 2,4,5 (relative to location of the item)

--- PAGE BREAK ---

Help
Available languages
Missing languages
Generally speaking, there are two types of "things" in the game; characters and items. Compared to characters, items are very complex. Items have a number of different uses, for example a sword is an item that players can see and equip to increase the damage they can do in combat. Some items in the game can not be seen by the players, but they have as much impact on the player as their sword, for example, a memory item is equipped every time a player is under the effects of a spell. Some
special types of item
also have additional properties that can be accessed via scripts. The following tables detail the various properties of items in SphereServer:
Contents
1
References
2
Properties and Functions
3
Triggers
References
References return pointers to other objects (e.g. the REGION reference allows you to access the REGION that an object is in). These can either be accessed by using
<REFNAME>
to return the
UID
(1 for object types that don't have UIDs) of the object or 0 if it doesn't exist, or by using
<REFNAME.KEY>
where KEY is a valid property/function/reference for the
REFNAME
object. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
CONT
RW
Gets or sets the
character
or
container item
that the object is inside.  When an item's CONT is changed, it bypasses the typical behavior (for example, you can force an item to be "in" a container and bypass @dropon triggers, or force an item to be equipped to a player and bypass @equiptest and @equip triggers -- but be careful, because in this second scenario it may end up in an invalid layer.)
LINK
RW
Gets or sets the
character
or
item
that the item is linked to.  Note, you can make circular LINK's, but a single item cannot be linked to more than one other item.
REGION
R
Gets the
region
that the object is in.
ROOM
R
Gets the
room
that the object is in.
P
RW
Gets or sets the
position
that the object is at.
SECTOR
R
Gets the
sector
that the object is in.
TOPOBJ
R
Gets the top-most
character
or
item
in the world that contains the item.
TYPEDEF
R
Gets the
ITEMDEF
that defines the item.
Properties and Functions
Here is a list of all item properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples. If an attempt is made to access a property that does not exist on the item, the property from the
ITEMDEF
will be accessed instead.
Name
Read/Write
Description
ADDCIRCLE
spell_circle
W
Adds all of the spells in the given Magery circle to the spellbook.
ADDSPELL
spell_id
RW
Gets whether or not a spell exists in the spellbook, or adds a spell to the spellbook.
AMMOANIM
RW
Overrides TDATA4 for bow/crossbow type weapons.
AMMOANIMHUE
RW
Sets the color of the effect when firing bow/crossbow type weapons.
AMMOANIMRENDER
RW
Sets the render mode of the effect when firing bow/crossbow type weapons.
AMMOCONT
RW
Sets the container UID or ID where to search for ammos for bow/crossbow type weapons.
AMMOSOUNDHIT
RW
Overrides the hit sound on weapons.
AMMOSOUNDMISS
RW
Overrides the miss sound on weapons.
AMMOTYPE
RW
Overrides TDATA3 for bow/crossbow type weapons.
AMOUNT
RW
Gets the amount of items this icon represents (e.g. a pile of gold or any stacked item).
ATTR
RW
Gets or sets the item's attribute flags.
BOUNCE
W
Moves the item to SRC's backpack (triggering the
you put the item in your pack
message.
CAN
RW
Gets or Sets the can_flags (Setting can be only done in the Itemdef itself). Only readable in X branch.
CANMASK
RW
Stores the CAN flags to be dynamically switched on or off from the base CAN property.
CANSEE
R
Returns 1 if SRC can see the item.
CANSEELOS
point_or_uid
R
Returns 1 if SRC has line of sight to the item or character (uid) or point (location).
CANSEELOSFLAG
flags,point_or_uid
R
Returns 1 if SRC has line of sight to the item.  The
flags
are defined in the los_flags section of the sphere_defs.scp file and can be used to modify what tests take place.  The
point_or_uid
is an object or position that can be used to test line of sight to something other than SRC.  Note, the delimiter for FLAG values is ;
CLEARTAGS
prefix
W
Removes all TAGs from the item that start with the given prefix.
COLOR
RW
Gets or sets the object's hue.
CONSUME
amount
W
Deducts an amount from the item, deleting it at 0.
CONTCONSUME
resource_list
W
Deletes items from inside the container.
CONTGRID
RW
If in a container, gets or sets the grid number that the item occupies (in KR's grid view)
CONTP
RW
Gets or sets the position of the item within its container.
DAMAGE
chance, type, source
W
If
chance
is greater than (Rand(maxhits*16)), inflicts  damage of
type
(the damage type flags are defined in the sphere_defs.scp file) upon the item.  You can optionally specify the
source
of the damage.
DCLICK
W
Double clicks the item, with SRC as the source of the event.
DECAY
time
W
Sets the decay timer (in tenths of a second) for the item.
DESTROY
W
Deletes the object, not stopped by a return 1 in
@Destroy
DIALOG
dialog_id, page, parameters
W
Displays a dialog to SRC.
DISPID
RW
Gets or sets the ID that the item will appear as to players.
DISPIDDEC
RW
Same as
DISPID
, except it returns the ID as a decimal number.
DISTANCE
point_or_uid
R
Gets the distance between this object and SRC.  If
point_or_uid
is used, SRC can be replaced with a map location or another object.
DMGCOLD
RW
Gets or sets the amount of cold damage the weapon will give.
DMGENERGY
RW
Gets or sets the amount of energy damage the weapon will give.
DMGFIRE
RW
Gets or sets the amount of fire damage the weapon will give.
DMGPOISON
RW
Gets or sets the amount of poison damage the weapon will give.
DROP
W
Drops the item to the ground.
DUPE
W
Clones the item.
EDIT
W
Displays an editing dialog for the item to SRC.
EFFECT
type, item_id, speed, loop, explode, colour, rendermode
W
Displays an effect to nearby clients.
EMOTE
message
W
Displays a *You see* message to all nearby clients.
EQUIP
W
Equips the item to SRC.
EVENTS
event_defname
RW
Gets a list of events attached to the object, or adds or removes an event to or from the object.
FIX
W
Re-aligns the item or character's Z level to ground level (if items are on the ground, the top item's
Z+HEIGHT
is used).
FLIP
W
Rotates the item clockwise.
FRUIT
RW
Gets or sets the fruit that will be produced by the crops.
HEIGHT
R
Gets the height of the item.
HITS
RW
Gets or sets the number of hitpoints the item has.
HITPOINTS
RW
Gets or sets the number of hitpoints the item has.
ID
RW
Gets or sets the ID of the item.
INFO
W
Displays an information dialog about the item to SRC.
ISARMOR
object_uid
R
Returns 1 if the object is armour.
ISCHAR
R
Returns 1 if the object is a character.
ISCONT
R
Returns 1 if the object is a container.
ISEVENT
.event_defname
R
Returns 1 if the object has an event attached to it.
ISITEM
R
Returns 1 if the object is an item.
ISNEARTYPE
type, distance, flags
R
Returns 1 if a nearby item has the given TYPE and is within
distance
.
ISNEARTYPETOP
type, distance, flags
R
Returns a nearby world location of a nearby item which has the given TYPE and is within
distance
.
ISPLAYER
R
Returns 1 if the object is a player character.
ISTEVENT
.event_defname
R
Returns 1 if the object has an event attached to its ITEMDEF.
ISTIMERF
.function
R
Returns the number of seconds left on the specified timerf if it exists.
ISWEAPON
object_uid
R
Returns 1 if the object is a weapon.
LAYER
RW
Gets or sets the layer that the item occupies when equipped (possible layers are defined in the sphere_defs.scp file).
MAP
RW
Gets or sets the map that this object is located.
MAXHITS
RW
Gets or sets the maximum number of hitpoints the item can have.
MENU
menu_defname
W
Displays a menu to SRC.
MESSAGE
message
W
Displays a message above this item to SRC.
MESSAGEUA
colour, talkmode, font, lang_id, message
W
Displays a UNICODE message above this item to SRC.
MODAR
RW
Gets or sets a modifier for the item's armour rating if it is clothing, armor, or a shield. This gets or sets a modifier for the item's damage if it is a weapon type.
MORE1
RW
Gets or sets the MORE1 value for the item.
MORE1H
RW
Gets or sets the upper 4 bytes of the item's MORE1 value.
MORE1L
RW
Gets or sets the lower 4 bytes of the item's MORE1 value.
MORE2
RW
Gets or sets the MORE2 value for the item.
MORE2H
RW
Gets or sets the upper 4 bytes of the item's MORE2 value.
MORE2L
RW
Gets or sets the lower 4 bytes of the item's MORE2 value.
MOREM
RW
Gets or sets the MOREM value for the item.
MOREX
RW
Gets or sets the MOREX value for the item.
MOREY
RW
Gets or sets the MOREY value for the item.
MOREZ
RW
Gets or sets the MOREZ value for the item.
MOREP
RW
Gets or sets the MOREP value for the item.
MOVE
direction amount
MOVE
x y
W
Moves the object relative to its current position.  Possible
direction
values are N,S,W, or E.  Note, you can combine directions (like:  MOVE SW 1) but nonsensical directions (like: MOVE WE 2) have the nonsense removed.
MOVENEAR
object_uid, distance
W
Moves the object to a random location near another object within a certain distance.
MOVETO
location
W
Moves the object to a specific location (note, the AREADEF or ROOMDEF must have a P defined).
NAME
RW
Gets or sets the object's name.
NUDGEDOWN
amount
W
Decreases the object's Z level.
NUDGEUP
amount
W
Increases the object's Z level.
PROMPTCONSOLE
function, prompt_message
W
Displays a prompt message to SRC and passes their response into a specified function.
PROMPTCONSOLEU
function, prompt_message
W
Displays a prompt message to SRC and passes their response into a specified function, supporting UNICODE response.
REMOVE
W
Deletes the object.
REMOVEFROMVIEW
W
Removes the object from nearby clients' screens.
RESCOUNT
item_defname
R
Returns the total amount of a specific item inside a container.
RESENDTOOLTIP
W
Forces Sphere to update the tooltips for nearby clients.
SAY
message
W
Makes the object speak a message.
SAYU
message
W
Makes the object speak a UTF-8 message
SAYUA
colour, talkmode, font, lang_id, text
W
Makes the object speak a UNICODE message.
SDIALOG
dialog_id, page, parameters
W
Displays a dialog to SRC, providing that it is not already open.
SERIAL
R
Gets the item's unique ID in the world.
SEXTANTP
location
R
Converts the item's location or a specified location into sextant coordinates.
SOUND
sound_id, repeat
W
Plays a sound from this object.
SPELLEFFECT
spell_id, strength, source_character_uid, source_item_uid
W
Causes the item to be affected by a spell.
TAG
.name
RW
Gets or sets the value of a TAG.
TAGAT
.index
R
Gets a TAG at the given zero-based index.
TAGAT
.index
.KEY
R
Gets the name of the TAG at the given zero-based index.
TAGAT
.index
.VAL
R
Gets the value of the TAG at the given zero-based index.
TAGCOUNT
R
Gets the number of TAGs stored on the item.
TAGLIST
W
Outputs a list of the object's TAGs.
TARGET
FGMW
function
W
Displays a targeting cursor to SRC.
F
makes the
function
available, and when added, the function name must be the 1st argument.
M
allows you to place a
multi
item, in which case the multi number must be passed as an argument.
G
forces the target to only be the ground.
W
checks the criminal status of the player before (or after?) the target selection is made.
TIMER
RW
Gets or sets the length of time before the item's timer expires, in seconds.
TIMERD
RW
Gets or sets the length of time before the item's timer expires, in tenths of a second.
TIMERF
time, function
W
Schedules a function to be executed on this object in
time
seconds.
TIMERF
CLEAR
W
Clears all scheduled functions from the object.
TIMERF
STOP, function
W
Stops the specified function from the item. (On X version wild character * is available for defining the function name or the argument)
TRIGGER
trig_name, trigger_argtype, argument1, argument2, ...
R
Fires a custom trigger (trig_name), allowing you to define the behavior of the arguments (the types are defined under trigger_argtype in the sphere_defs.scp file).  The result of the trigger's RETURN value is returned.  For example:
LOCAL.result=<TRIGGER @CustomTrigger,<DEF.tat_as_argn>,1,2,3>
TYPE
RW
Gets or sets the item type.  You can use built-in or custom
TYPEDEFs
as a value.
UID
R
Gets the item's unique ID in the world.
UNEQUIP
W
Unequips the item and places it in SRC's backpack.
UPDATE
W
Updates the state of the item to nearby clients.
UPDATEX
W
Updates the state of the item to nearby clients, removing it from their view first to ensure a full refresh.
USESCUR
W
X branch only. Gets or sets the current uses of an item. Only partially supported.
USESMAX
W
X branch only. Gets or sets the maximum uses of an item. Only partially supported.
USE
check_los
W
Uses the item, as if SRC had double clicked it.
USEITEM
W
Double clicks the item, with SRC as the source of the event, without checking for line of sight.
WEIGHT
R
Gets the weight of the item.
Z
R
Gets the Z position of the item.
Triggers
Here is a list of all item triggers. Click on the trigger name for more detailed information such as arguments and examples.
Name
Description
Sphere X Only?
@AfterClick
Fires when the object has been single-clicked, just before the overhead name is shown.
@Buy
Fires when the item is being bought from a vendor.
@Click
Fires when the object has been single-clicked.
@ClientTooltip
Fires when tooltips are about to be sent to a client.
@ContextMenuRequest
Fires when a client requests the context menu options for the object.
@ContextMenuSelect
Fires when a client selects a context menu option for the object.
@Carve
Fires when a corpse item is being carved.
X
@Create
Fires when the object is initially created, before it is placed in the world.
@Damage
Fires when the item receives damage.
@DClick
Fires when the object is double-clicked.
@Destroy
Fires when the object is being deleted.
@DropOn_Char
Fires when the item has been dropped on to a character.
@DropOn_Ground
Fires when the item has been dropped on to the ground.
@DropOn_Item
Fires when the item is dropped on to another item.
@DropOn_Self
Fires when an item has been dropped on to this item.
@DropOn_Trade
Fires when an item is being dropped on a Trade Window.
@Dye
Fires when an item is having its colored changed.
@Equip
Fires when the item has been equipped.
@EquipTest
Fires when the item is about to be equipped.
@HouseDesignBegin
A trigger for t_multi_custom, called when the player enters on design mode.
X
@HouseDesignCommitItem
Fires for each commited item in house design system.
X
@PickUp_Ground
Fires when the item ihas been picked up from the ground.
@PickUp_Pack
Fires when the item is picked up from inside a container.
@PickUp_Self
Fires when an item has been picked up from inside the item.
@PickUp_Stack
Fires when the item is picked up from a stack.
@Redeed
Fires when multi item is about to redeed (t_multi, t_ship, t_multi_custom, t_addon).
@Sell
Fires when the item is sold to a vendor.
@Smelt
Fires when the item is being smelt.
X
@SpellEffect
Fires when the object is hit by the effects of a spell.
@Step
Fires when a character steps on the item.
@TargOn_Cancel
Fires when a target is cancelled from the item.
@TargOn_Char
Fires when a character is targeted from the item.
@TargOn_Ground
Fires when the ground is targeted from the item.
@TargOn_Item
Fires when an item is targeted from this item.
@Timer
Fires when the item's timer expires.
@ToolTip
Fires when old-style tooltips are requested for the item.
@UnEquip
Fires when the item is unequipped.

--- PAGE BREAK ---

Menus are a simple way of displaying a selection dialog to clients. Menus can be shown to players in one of two styles:
Text-based
Item-based
Contents
1
Text-Based Menu
2
Item-Based Menu
3
Triggers
4
Examples
Text-Based Menu
A text-based menu simply shows a list of text options the choose from in a vertical list. The player can select an option and then press a "Continue" button to submit it.
The syntax for defining a text-based menu is as follows:
[MENU
defname
]
title
ON=0
text
script
ON=0
text
script
Name
Description
defname
The menu's defname.
title
The title of the menu. Properties and references of the object the menu was called on can be accessed.
text
The text to display for the option. Properties and references of the object the menu was called on can be accessed.
script
The script to run when the option is pressed.
Item-Based Menu
The syntax for an item-based menu is as follows:
[MENU
defname
]
title
ON=
baseid
text
script
ON=
baseid
@
hue
,
text
script
Name
Description
defname
The menu's defname.
title
The title of the menu. Properties and references of the object the menu was called on can be accessed.
baseid
The item
BASEID
to display for the button.
hue
If the @
hue
syntax is used, the item will be displayed in the specified colour.
text
The text to display for the option. Properties of the ITEMDEF that
baseid
refers to can be accessed.
script
The script to run when the button is pressed.
Triggers
When the client selects an option from the menu, the "ON=
...
" section will be executed, in a similar fashion to how a trigger would fire.
If the client cancels the menu (by right-clicking it, or for text-based menus by pressing "Cancel"), an @Cancel trigger will be fired.
In both cases, the following references and arguments are available:
Name
Description
I
The
character
or
item
that the MENU function was called from.
SRC
The client operating the menu.
Examples
//
// Displays a menu asking if the player wants more gold, and creates it
// if they select Yes.
//
[MENU m_goldmenu]
You currently have <SRC.BANKBALANCE>gp in your account. Would you like some more gold?

ON=0 Yes
    SERV.NEWITEM i_gold, 5000
    SRC.BOUNCE <NEW.UID>
    RETURN
    
ON=0 No
    SRC.SYSMESSAGE Ok then!
    RETURN
//
// Displays a menu asking the player which item they would like.
//
[MENU m_itemmenu]
Which item would you like?

ON=i_sword_viking <NAME>
    SERV.NEWITEM i_sword_viking
    SRC.BOUNCE <NEW.UID>
    RETURN
    
ON=i_gold 5000 <NAME>
    SERV.NEWITEM i_gold, 5000
    SRC.BOUNCE <NEW.UID>
    RETURN
    
ON=i_backpack @020, a red backpack
    SERV.NEWITEM i_backpack
    NEW.COLOR = 020
    SRC.BOUNCE <NEW.UID>
    RETURN
    
ON=0 Nothing
    SRC.SYSMESSAGE You get nothing!
    RETURN
//
// Demonstrates the @Cancel trigger
//
[MENU m_cancelmenu]
Don't cancel this menu!

ON=0 Ok!
    SRC.SYSMESSAGE Thank you!
    RETURN
    
ON=@Cancel
    SRC.SYSMESSAGE I said don't cancel this menu!
    MENU m_cancelmenu
    RETURN

--- PAGE BREAK ---

Help
Available languages
Missing languages
A region resource block defines a resource that can be found in a region.
Contents
1
Properties
2
Triggers
3
Examples
Properties
The following properties are available when defining a region resource:
Name
Read/Write
Description
AMOUNT
RW
Gets or sets the initial amount of the resource available when it spawns. Accepts multiple values to build a weighted range of difficulty values.
DEFNAME
W
Gets or sets the resource defname.
REAP
RW
Gets or sets the
BASEID
of the resource item.
REAPAMOUNT
RW
Gets or sets the amount of the resource that can be gathered in one use of a skill. Accepts multiple values to adjust based on skill level.
REGEN
RW
Gets or sets the length of time it takes for the resource to decay, in seconds.
SKILL
RW
Gets or sets the difficulty of gathering the resource. Accepts multiple values to build a weighted range of difficulty values.
Triggers
Here is a list of all region resource triggers. Click on the trigger name for more detailed information such as arguments and examples.
Name
Description
@ResourceFound
Fires when the resource is spawned.
@ResourceGather
Fires when you are going to gather a resource.
@ResourceTest
Fires when the resource is being considered for spawning.
Examples
//
// Fish resource from default script pack.
//
[REGIONRESOURCE mr_fish1]
SKILL=1.0,100.0    // requires between 1% and 100% skill to gather
AMOUNT=9,30        // between 9 and 30 fish available
REAP=i_fish_big_1  // the resource item
REGEN=60*60*10     // decays after 10 hours

--- PAGE BREAK ---

A REGIONTYPE definition contains a set of trigger scripts which can be attached to
regions
. A region type can also define which resources can be found inside the region. There are different properties that can be used to attach an region type block to a region or set of regions:
Region definitions
via their
EVENTS
or
RESOURCES
property.
Region objects
via their
EVENTS
or
RESOURCES
property.
All
regions
via the
EVENTSREGION
setting in Sphere.ini (triggers only).
Contents
1
Syntax
2
Properties
3
Examples
Syntax
The syntax for defining an region type for triggers is:
[REGIONTYPE
defname
]
ON=
trigger_name
script
ON=
trigger_name
script
Any number of triggers can be handled by one
REGIONTYPE
definition, however it is not possible to handle the same trigger twice without using multiple definitions.
The trigger name can be the name of any
region trigger
. The return value from the script can affect Sphere's hardcoded behaviour in different ways. See the documentation for the trigger to discover what parameters are passed in to each trigger and what the return values do.
A region type can also define which resources can be gathered from a region. This syntax for this is:
[REGIONTYPE
defname
item_type
]
RESOURCES=
weight
resource
RESOURCES=
weight
resource
RESOURCES=
weight
resource
The
item_type
parameter should be the item or terrain
TYPE
that the resources can be gathered from.
Properties
The following properties are available when defining a region type:
Name
Read/Write
Description
CALCMEMBERINDEX
R
Selects a resource from the region type at random, and returns its zero-based index.
CALCMEMBERINDEX
character_uid
R
Selects a resource from the region type at random based on the resource available to the specified character, and returns its zero-based index.
DEFNAME
W
Sets the region type's defname.
RESOURCES
weight
resource_defname
W
Adds a region resource to the region type. Accepts a comma-separated list of resources.
RESOURCES
R
Gets a list of resources attached to the region type.
RESOURCES
.COUNT
R
Gets the number of different resources attached to the region type.
RESOURCES
.n
.KEY
R
Gets the defname of the
nth
resource attached to the region type.
(1-based)
RESOURCES
.n
.VAL
R
Gets the weight of the
nth
resource attached to the region type.
(1-based)
WEIGHT
W
Sets the weight of the last resource added to the region type.
Examples
//
// Default region type from default script pack.
//
[REGIONTYPE r_default]
ON=@Enter
    SRC.MUSIC = midi_britain1,midi_ForestA,midi_JungleA,midi_MountainA,midi_Plains,midi_Victory
    
ON=@CliPeriodic
    SRC.MUSIC = midi_britain1,midi_ForestA,midi_JungleA,midi_MountainA,midi_Plains,midi_Victory
//
// Default rock resources from default script pack.
//
[REGIONTYPE r_default_rock t_rock]
// Random rocks
RESOURCES=420.0 mr_iron
RESOURCES=8.5 mr_copper
RESOURCES=8.0 mr_bronze
RESOURCES=7.5 mr_stagmite
RESOURCES=7.0 mr_arcanium
RESOURCES=6.5 mr_gold
RESOURCES=6.0 mr_shadow
RESOURCES=5.5 mr_phoenix
RESOURCES=5.0 mr_argonite
RESOURCES=4.5 mr_bronzealloy
RESOURCES=4.0 mr_myriad
RESOURCES=3.5 mr_chromecopper
RESOURCES=3.0 mr_nixalite
RESOURCES=2.5 mr_crimson
RESOURCES=2.0 mr_agapite
RESOURCES=1.9 mr_daedric
RESOURCES=1.8 mr_omniate
RESOURCES=1.7 mr_alumina
RESOURCES=1.6 mr_rose
RESOURCES=1.5 mr_silver
RESOURCES=1.4 mr_elven
RESOURCES=1.3 mr_bloodrock
RESOURCES=1.2 mr_solarite
RESOURCES=1.1 mr_cyruss
RESOURCES=1.0 mr_verite
RESOURCES=1.0 mr_stone
RESOURCES=1.0 mr_lunar
RESOURCES=1.0 mr_ice
RESOURCES=0.9 mr_demonic
RESOURCES=0.8 mr_mystic
RESOURCES=0.7 mr_aqualis
RESOURCES=0.6 mr_Valorite
RESOURCES=0.5 mr_kryptonite
RESOURCES=0.4 mr_lavan
RESOURCES=0.3 mr_ancientsteel
RESOURCES=0.2 mr_sandrock
RESOURCES=0.1 mr_mytheril
RESOURCES=0.1 mr_vulcan
RESOURCES=0.1 mr_titanium
RESOURCES=0.1 mr_dragon
RESOURCES=0.1 mr_bloodsteel
RESOURCES=0.1 mr_sacratus
RESOURCES=0.1 mr_blackrock
RESOURCES=0.1 mr_lothlorien
RESOURCES=0.1 mr_diamond

--- PAGE BREAK ---

Help
Available languages
Missing languages
Areas in the world, such as dungeons and cities are defined by regions. Regions are constructed from one or more "rectangles" on the map.
The basic syntax for definining a region is as follows:
[AREADEF
defname
]
RECT=
left, top, right, bottom, map
RECT=
left, top, right, bottom, map
RECT=
left, top, right, bottom, map
Contents
1
Properties
2
Examples
Properties
Within the region definition the following properties are also available to customise the behaviour of the area.
Name
Read/Write
Description
ANNOUNCE
RW
Gets or sets whether or not there will be an announcement when someone enters or exits the region.
ARENA
RW
Gets or sets whether or not the region is considered to be an arena.
BUILDABLE
RW
Gets or sets whether or not players can place buildings and ships in the region.
EVENTS
regiontype_defname
W
Adds a region event to the region.
FLAGS
RW
Gets or sets the region's attributes.
GATE
RW
Gets or sets whether or not casting the gate travel spell is allowed in the region.
GROUP
RW
Gets or sets a group name for the region.
GUARDED
RW
Gets or sets whether or not guards can be called within the region.
MAGIC
RW
Gets or sets whether or not there is an anti-magic field in the region.
MARK
RW
Gets or sets whether or not casting the mark spell is allowed in the region.
NAME
RW
Gets or sets the name of the region.
NOBUILD
RW
Gets or sets whether or not players can place buildings in the region.
NODECAY
RW
Gets or sets whether or not items will decay in the region.
NOPVP
RW
Gets or sets whether or not PvP combat is allowed in the region.
P
RW
Gets or sets the location of the region (used when using the
GO
command).
RECALL
RW
Gets or sets whether or not casting the recall spell is allowed in the region.
RECALLIN
RW
Gets or sets whether or not it is possible to use the recall spell to enter the region.
RECALLOUT
RW
Gets or sets whether players can recall out of the region.
RECT
left, top, right, bottom, map
W
Adds a rectangle to the region definition.
RESOURCES
regiontype_defname
W
Adds a region event to the region.
SAFE
RW
Gets or sets whether or not the region is a safe zone.
TAG
.name
RW
Gets or sets the value of a TAG.
UNDERGROUND
RW
Gets or sets whether or not the region is considered to be underground.
Examples
//
// The world region from the default script pack.
//
[AREADEF a_world]
EVENTS=r_default,r_default_rock,r_default_water,r_default_tree,r_default_grass
NAME=Felucca
GROUP=ALLMAP
P=1323,1624,55,0
RECT=0,0,7168,4096,0
//
// Lord British's Castle from the default script pack.
//
[AREADEF a_lord_britishs_castle_1]
EVENTS=r_default,r_default_rock,r_default_water,r_default_tree,r_default_grass
NAME=Lord British's Castle
GROUP=Britain
FLAGS=0648e
P=1392,1625,30,0
RECT=1294,1679,1411,1697,0
RECT=1295,1559,1313,1577,0
RECT=1392,1559,1410,1577,0
RECT=1302,1577,1410,1680,0
RECT=1313,1563,1392,1577,0
EVENTS=r_brit_castle
TAG.GUARDOWNER=Lord British's Personal

--- PAGE BREAK ---

Within
regions
you can also define rooms, which are basically 'sub-regions' that exist inside the area which may represent buildings within a town or a boss room within a dungeon. Rooms are almost identical to region.
Sphere 56b
ROOMDEF  cannot possess events, triggers or tags.
Since Sphere56c (20 July 2013)
ROOMDEF can have events, triggers and tags.
The syntax for defining a room is as follows:
[ROOMDEF
defname
]
RECT=
left, top, right, bottom, map
RECT=
left, top, right, bottom, map
RECT=
left, top, right, bottom, map
Contents
1
Properties
2
Triggers
3
Examples
Properties
Within the room definition the following properties are also available to customise the behaviour of the area.
Name
Read/Write
Description
ANNOUNCE
RW
Gets or sets whether or not there will be an announcement when someone enters or exits the room.
ARENA
RW
Gets or sets whether or not the room is considered to be an arena.
BUILDABLE
RW
Gets or sets whether or not players can place buildings and ships in the room.
EVENTS
regiontype_defname
W
Adds a region event to the region.
FLAGS
RW
Gets or sets the room's attributes.
GATE
RW
Gets or sets whether or not casting the gate travel spell is allowed in the room.
GROUP
RW
Gets or sets a group name for the room.
GUARDED
RW
Gets or sets whether or not guards can be called within the room.
MAGIC
RW
Gets or sets whether or not there is an anti-magic field in the room.
MARK
RW
Gets or sets whether or not casting the mark spell is allowed in the room.
NAME
RW
Gets or sets the name of the room.
NOBUILD
RW
Gets or sets whether or not players can place buildings in the room.
NODECAY
RW
Gets or sets whether or not items will decay in the room.
NOPVP
RW
Gets or sets whether or not PvP combat is allowed in the room.
P
RW
Gets or sets the location of the room (used when using the
GO
command).
RECALL
RW
Gets or sets whether or not casting the recall spell is allowed in the room.
RECALLIN
RW
Gets or sets whether or not it is possible to use the recall spell to enter the room.
RECALLOUT
RW
Gets or sets whether players can recall out of the room.
SAFE
RW
Gets or sets whether or not the room is a safe zone.
TAG
.name
RW
Gets or sets the value of a TAG.
UNDERGROUND
RW
Gets or sets whether or not the room is considered to be underground.
Triggers
Within the room definition the following properties are also available to customise the behaviour of the area.
Trigger
Description
@Enter
Fires when a room is entered (56c)
@Exit
Fires when a room is exited (56c)
@Step
Fires when a step is taken inside a room (56c)
Examples
//
// A House in Minoc, from the default script pack.
//
[ROOMDEF a_house_1]
NAME=House
GROUP=Minoc
FLAGS=04000
P=2484,472,0,0
RECT=2479,463,2489,481,0
RECT=2489,471,2497,481,0
//
// A Secret Cave, from the default script pack.
//
[ROOMDEF a_secret_cave_1]
NAME=Secret Cave
GROUP=Hidden Valley
P=1653,2967,0,0
RECT=1648,2957,1658,2977,0

--- PAGE BREAK ---

A skill class restricts the maximum skill and stat values that a character can have. Skill classes also act an EVENTS block, and can contain character triggers that will fire for all characters with the skill class.
Contents
1
Properties
2
Examples
Properties
The following properties are available when defining a skill class:
Name
Read/Write
Description
DEX
RW
Gets or sets the maximum dexterity value allowed for characters with the class.
INT
RW
Gets or sets the maximum intelligence value allowed for characters with the class.
NAME
RW
Gets or sets the name of the class.
skill_key
RW
Gets or sets the maximum amount of
skill_key
is allowed for characters with the class.
SKILLSUM
RW
Gets or sets the maximum skill total allowed for characters with the class.
STATSUM
RW
Gets or sets the maximum stat total allowed for characters with the class. (dexterity, intelligence and strength)
STR
RW
Gets or sets the maximum strength value allowed for characters with the class.
Examples
//
// 'Undeclared' skill class from the default script pack. (default for all new characters)
//
[SKILLCLASS 0]
DEFNAME=Class_undeclared
NAME=undeclared
STATSUM=300       // maximum total of 300 in str+dex+int
SKILLSUM=10000.0  // maximum total of 10000% in all skills
STR=100
INT=100
DEX=100
Alchemy=100.0
Anatomy=100.0
AnimalLore=100.0
ItemId=100.0
ArmsLore=100.0
Parrying=100.0
Begging=100.0
Blacksmithing=100.0
Bowcraft=100.0
Peacemaking=100.0
Camping=100.0
Carpentry=100.0
Cartography=100.0
Cooking=100.0
DetectingHidden=100.0
Enticement=100.0
EvaluatingIntel=100.0
Healing=100.0
Fishing=100.0
Forensics=100.0
Herding=100.0
Hiding=100.0
Provocation=100.0
Inscription=100.0
LockPicking=100.0
Magery=100.0
MagicResistance=100.0
Tactics=100.0
Snooping=100.0
Musicianship=100.0
Poisoning=100.0
Archery=100.0
SpiritSpeak=100.0
Stealing=100.0
Tailoring=100.0
Taming=100.0
TasteId=100.0
Tinkering=100.0
Tracking=100.0
Veterinary=100.0
Swordsmanship=100.0
Macefighting=100.0
Fencing=100.0
Wrestling=100.0
Lumberjacking=100.0
Mining=100.0
Meditation=100.0
Stealth=100.0
RemoveTrap=100.0
Necromancy=100.0
Focus=100.0
Chivalry=100.0
Bushido=100.0
Ninjitsu=100.0
Spellweaving=100.0

--- PAGE BREAK ---

Skill menus are a more advanced form of
MENU
where options can be hidden from the client based on criteria.
Contents
1
Syntax
2
Functions
3
Triggers
4
Examples
Syntax
The syntax for a skill menu is identical to a menu except for the definition starting with [SKILLMENU rather than [MENU. As with menus there are both text-based and item-based styles possible. Only the syntax for the item-based style of skill menu is shown below:
[SKILLMENU
defname
]
title
ON=
baseid
text
script
ON=
baseid
@
hue
,
text
script
Name
Description
defname
The menu's defname.
title
The title of the menu. Properties and references of the object the menu was called on can be accessed.
baseid
The item
BASEID
to display for the button.
hue
If the @
hue
syntax is used, the item will be displayed in the specified colour.
text
The text to display for the option. Properties of the ITEMDEF that
baseid
refers to can be accessed.
script
The script to run when the button is pressed.
Functions
Whilst the syntax for a skill menu is identical to a menu, the difference is that before displaying an option to the client Sphere will search the
script
lines for the following functions (more than one can be present). These functions affect the visibility of the menu option.
Name
Description
MAKEITEM
item_baseid
Checks if the client meets the criteria for crafting the item (
SKILLREQ
and
RESOURCES
properties on the item's
ITEMDEF
).
SKILLMENU
skillmenu_id
Searches the skillmenu to see what options are available to the client. If there are no visible items in the submenu then the option will be hidden from the client.
TEST
resource_or_skill_list
Checks if the client possesses all of the listed resources/skills. If they do not then the menu option will not be available to them.
TESTIF
condition
Checks the condition. If it evaluates to false then the menu option will not be available to the client.
Triggers
When the client selects an option from the skill menu, the "ON=
...
" section will be executed, in a similar fashion to how a trigger would fire.
If the client cancels the menu (by right-clicking it, or for text-based menus by pressing "Cancel"), an @Cancel trigger will be fired.
In both cases, the following references and arguments are available:
Name
Description
I
The
character
or
item
that the MENU function was called from.
SRC
The client operating the menu.
Examples
//
// sm_cloth_misc skill menu from the default script pack.
//
[SKILLMENU sm_cloth_misc]
Misc.

ON=i_SASH <NAME> (<RESMAKE>)
    MAKEITEM=i_SASH
    
ON=i_apron_half <NAME> (<RESMAKE>)
    MAKEITEM=i_apron_half
    
ON=i_apron_full <NAME> (<RESMAKE>)
    MAKEITEM=i_apron_full
//
// Similar to the MENU example, except adds conditions to the options.
//
[SKILLMENU sm_itemmenu]
Which item would you like?

ON=i_sword_viking <NAME>
    TESTIF (<SRC.STR> > 100)             // client must have more than 100 strength to see this option
    SERV.NEWITEM i_sword_viking
    SRC.BOUNCE <NEW.UID>
    RETURN
    
ON=i_gold 5000 <NAME>
    TESTIF (<SRC.BANKBALANCE> < 5000)    // client must have less than 5000gp in their bank to see this option
    SERV.NEWITEM i_gold, 5000
    SRC.BOUNCE <NEW.UID>
    RETURN
    
ON=i_backpack @020, a red backpack
    TEST 1 i_backpack, 10.0 TAILORING    // client must have 1 backpack and 10% tailoring to see this option
    SERV.NEWITEM i_backpack
    NEW.COLOR = 020
    SRC.BOUNCE <NEW.UID>
    RETURN
    
ON=0 Nothing
    SRC.SYSMESSAGE You get nothing!	     // no special function here, this option will always be visible
    RETURN

--- PAGE BREAK ---

Help
Available languages
Missing languages
A skill block defines the basic properties and behaviours of a skill.
Contents
1
Properties
2
Triggers
3
Examples
Properties
The following properties are available when defining a skill:
Name
Read/Write
Description
ADV_RATE
RW
Gets or sets the skill's advance rate. Accepts multiple values to adjust based on skill level.
BONUS_DEX
RW
Gets or sets a multiplier for how much dexterity affects a character's non-real skill amount, and affects stat gain.
BONUS_INT
RW
Gets or sets a multiplier for how much intelligence affects a character's non-real skill amount, and affects stat gain.
BONUS_STATS
RW
Gets or sets a modifier for gaining stats when using the skill.
BONUS_STR
RW
Gets or sets a multiplier for how much strength affects a character's non-real skill amount, and affects stat gain.
DELAY
RW
Gets or sets how long it takes to attempt to complete the skill, in tenths of a second. Accepts multiple values to adjust based on skill level.
EFFECT
RW
Gets or sets a value which effects skills in different ways. (Crafting = Resource Loss % on Fail, Healing = Amount Healed). Accepts multiple values to adjust based on skill level.
FLAGS
RW
Gets or sets skill attributes.  The available flags are defined in the sphere_defs.scp file:
SKF_SCRIPTED
0001
fully scripted, no hardcoded behaviour
SKF_FIGHT
0002
considered a fight skill, maintains fight active
SKF_MAGIC
0004
considered a magic skill
SKF_CRAFT
0008
considered a crafting skill, compatible with MAKEITEM function
SKF_IMMOBILE
0010
skilluser can not move while skilluse
SKF_SELECTABLE
0020
from skill list. ATTENTION: This does
not
place the button next to the skill in the client's skill list! For this you have to edit skills.mul or script the trigger.
SKF_NOMINDIST
0040
you can mine, fish, chop, hack on the same point you are standing on
SKF_NOANIM
0080
don't show hard-coded animation for this skill
SKF_NOSFX
0100
don't play hard-coded sound for this skill
SKF_RANGED
0200
considered a ranged skill (combine with SKF_FIGHT)
GAINRADIUS
RW
Gets or sets a difficulty "radius" that prevents characters from gaining skill when performing "easy" actions.  Skillgain will only be calculated if the current skill is less than the actual difficulty + GAINRADIUS.  If skillgain is aborted due to GAINRADIUS not met, a message will only be displayed if TAG.NOSKILLMSG=1 on character.
GROUP
RW
Get or sets the skill's group flags.
KEY
RW
Gets or sets the skill's defname.
NAME
RW
Gets or sets the name of the skill.
STAT_DEX
RW
Gets or sets the maximum dexterity a character can gain up to when using this skill.
STAT_INT
RW
Gets or sets the maximum intelligence a character can gain up to when using this skill.
STAT_STR
RW
Gets or sets the maximum strength a character can gain up to when using this skill.
PROMPT_MSG
RW
Gets or sets the message shown when the character selects the skill, and also forces characters to select a target when non-empty.
TITLE
RW
Gets or sets the professional title for the skill.
VALUES
RW
Gets or sets a modifier for the value of items that are created using the skill. Accepts multiple values to adjust based on skill level.
Triggers
The following table lists all of the triggers that can be placed under a skill definition. All of the triggers here have an equivalent @Skill trigger on the
character
object.
Name
Description
@Abort
Fires when a character aborts an attempt at using the skill.
@Fail
Fires when a character fails an attempt at using the skill.
@Gain
Fires when a character is given the chance to gain in the skill.
@PreStart
Fires when a character starts to use the skill, before any hardcoded behaviour takes place.
@Select
Fires when a character selects the skill from their skill menu.
@Start
Fires when a character starts to use the skill.
@Success
Fires when a character succeeds an attempt at using the skill.
@UseQuick
Fires when a character quickly uses the skill, without changing their
ACTION
.
@Wait
This is called whenever Sphere wants to check if a character must wait before starting a skill. Normally this will be when a skill is selected from the skill menu (before
@Select
), but also when snooping a container or using a musical instrument.
Examples
//
// Alchemy skill from the default script pack.
//
[SKILL 0]
DEFNAME=SKILL_ALCHEMY
KEY=Alchemy
TITLE=Alchemist
DELAY=3.0,1.0
ADV_RATE=10.0,200.0,800.0
VALUES=1,20,100

BONUS_STATS=10
BONUS_STR=0
BONUS_DEX=20
BONUS_INT=80

STAT_STR=5
STAT_INT=75
STAT_DEX=40

ON=@Fail
    SRC.SYSMESSAGE You toss the failed mixture from the mortar, unable to create a potion from it.
    
ON=@Abort
    SRC.SYSMESSAGE You fail to complete the potion.

--- PAGE BREAK ---

Instead of setting the MORE1 property of a spawn to a single
character
defname, a spawn group can be used instead so that a random character is spawned. A spawn group contains a set of character defnames, with optional weights to affect their chances of spawning.
Contents
1
Syntax
2
Properties
3
Examples
Syntax
The syntax for defining a spawn group is:
[SPAWN
defname
]
ID=
character_defname_1
weight
ID=
character_defname_2
weight
ID=
character_defname_3
weight
etc..
The weight parameter can be used to make a defname more likely to be selected than the other defnames in the group. With a weight of 10 for example, a defname would be 10 times more likely to be selected.
Properties
The following properties are available when defining a spawn group:
Name
Read/Write
Description
CALCMEMBERINDEX
R
Selects a defname from the spawn group at random, and returns its zero-based index.
DEFNAME
W
Sets the spawn group's defname.
ID
defname
weight
W
Adds a defname to the spawn group with the specified weight.
RESOURCES
R
Gets a list of defnames contained in the spawn group.
RESOURCES
.COUNT
R
Gets the number of defnames in the spawn group.
RESOURCES
.n
.KEY
R
Gets the
nth
defname in the spawn group.
(1-based)
RESOURCES
.n
.VAL
R
Gets the weight of the
nth
defname in the spawn group.
(1-based)
Examples
//
// Undead spawn from default script pack.
//
[SPAWN 08001]
DEFNAME=SPAWN_Undead_Weak
ID=c_spectre,2
ID=c_skeleton_w_axe
ID=c_skeleton_w_sword
ID=c_skeleton,5
ID=c_zombie,10
//
// Lists the characters of a spawn in the console, and picks one at random.
// Usage: DescribeSpawn <spawn_defname>
//
[FUNCTION describespawn]
// validate args
IF !(<SERV.SPAWN.<ARGS>>)
    SERV.LOG Spawn '<ARGS>' does not exist.
    RETURN
ELSEIF !(<SERV.SPAWN.<ARGS>.RESOURCES.COUNT>)
    SERV.LOG Spawn '<ARGS>' has no contents.
    RETURN
ENDIF

// list characters
SERV.LOG Spawn '<SERV.SPAWN.<ARGS>.DEFNAME>', <SERV.SPAWN.<ARGS>.RESOURCES.COUNT> characters)
FOR 1 <SERV.SPAWN.<ARGS>.RESOURCES.COUNT>
    SERV.LOG Character <dLOCAL._FOR>: <dSERV.SPAWN.<ARGS>.RESOURCES.<LOCAL._FOR>.VAL>x <SERV.SPAWN.<ARGS>.RESOURCES.<LOCAL._FOR>.KEY>
ENDFOR

// pick character (obeying weights)
LOCAL.INDEX = <EVAL <SERV.SPAWN.<ARGS>.CALCMEMBERINDEX> + 1>
SERV.LOG Picked '<SERV.SPAWN.<ARGS>.RESOURCES.<LOCAL.INDEX>.KEY>'.
RETURN

--- PAGE BREAK ---

Help
Available languages
Missing languages
A spell block defines the basic properties and behaviours of a spell.
Contents
1
Properties
2
Triggers
3
Examples
Properties
The following properties are available when defining a spell:
Name
Read/Write
Description
CAST_TIME
RW
Gets or sets the length of time it takes to cast the spell, in tenths of a second. Accepts multiple values to adjust based on skill level.
DEFNAME
RW
Gets or sets the spell's defname.
DURATION
RW
Gets or sets the duration of the spell's affect in tenths of a second, if applicable. Accepts multiple values to adjust based on skill level.
EFFECT
RW
Gets or sets the strength of the spell. Accepts multiple values to adjust based on skill level.
EFFECT_ID
RW
Gets or sets the ID of the spell's visual effect.
FLAGS
RW
Gets or sets the spell's attribute flags.
GROUP
RW
Gets or sets the spell's group flags.
INTERRUPT
RW
Gets or sets the chance of a character being interrupted when hit in combat while casting the spell. Accepts multiple values to adjust based on skill level.
MANAUSE
Rw
Gets or sets the number of mana points needed to cast the spell.
NAME
RW
Gets or sets the name of the spell.
PROMPT_MSG
RW
Gets or sets the message shown when a character casts the spell, and also forces characters to select a target when non-empty.
RESOURCES
RW
Gets or sets the resources that are needed to cast the spell.
RESOURCES
.n.KEY
R
Gets the
BASEID
of the nth resource needed to cast the spell. (zero-based)
RESOURCES
.n.VAL
R
Gets the amount of the nth resource needed to cast the spell. (zero-based)
RUNE_ITEM
RW
Gets or sets the
BASEID
of the item that should be equipped when a spell has a duration.
RUNES
RW
Gets or sets the spell's words of power.
SCROLL_ITEM
RW
Gets or sets the
BASEID
of the scroll that casts the spell.
SKILLREQ
RW
Gets or sets a list of skills that are needed to cast the spell.
SOUND
RW
Gets or sets the ID of the sound that will be played when the spell is cast.
Triggers
The following table lists all of the triggers that can be placed under a spell definition. All of the triggers here have an equivalent @Spell trigger on the
character
object.
Name
Description
Sphere X only?
@Effect
Fires when a character or item is hit by the spell.
@EffectAdd
Fires when a spell memory item is being added.
@EffectRemove
Fires when a spell memory item is removed.
X
@EffectTick
Fires when a character is under effect of a periodic spell (like Poison spell).
X
@Fail
Fires when a character fails to cast the spell.
@Select
Fires when a character selects to cast the spell, or when Sphere checks if a character is capable of casting it.
@Start
Fires when a character starts to cast the spell.
@Success
Fires when a character successfully casts the spell.
@TargetCancel
Fires when a character cancels target selection for a spell they are casting.
Examples
//
// Clumsy spell from the default script pack.
//
[SPELL 1]
DEFNAME=s_clumsy
NAME=Clumsy
SOUND=snd_SPELL_CLUMSY
RUNES=UJ
CAST_TIME=1.0
RESOURCES=i_reag_blood_moss,i_reag_nightshade
RUNE_ITEM=i_rune_CLUMSY
SCROLL_ITEM=i_scroll_CLUMSY
FLAGS=SPELLFLAG_TARG_CHAR | SPELLFLAG_DIR_ANIM | SPELLFLAG_HARM | SPELLFLAG_FX_TARG | SPELLFLAG_RESIST
EFFECT_ID=i_fx_curse
EFFECT=3,15
DURATION=2*60.0,3*60.0
MANAUSE=4
SKILLREQ=MAGERY 10.0
INTERRUPT=100.0,100.0

--- PAGE BREAK ---

Help
Available languages
Missing languages
Type definitions are the equivalent of
EVENTS
that can be attached to
items
. There are different properties that can be used to attach a type block to an item or set of items:
item definitions
via their
TYPE
and/or
TEVENTS
property.
items
via their
TYPE
and/or
EVENTS
property.
In addition to handling triggers, type definitions can also be used to define different types of terrain. This can be used to affect the return value of the
TYPE
property on
map points
, or for some hardcoded types such as t_rock it can be used to define which terrain IDs Sphere should consider to be rock when the mining skill is used.
Contents
1
Built-in Types
2
Scripted TYPEDEFs
3
Syntax
4
Examples
Built-in Types
The built-in types are all listed in the sphere_defs.scp file.  The table below only lists some of the built-in types and it is VERY weak on actual details...so use with care.
DEFNAME
Number
Description
t_normal
0
No built-in behavior.
t_container and t_container_locked
1 and 2
These types are used for containers.  They leverage the following properties:
MORE1 = "ID" from the key that can unlock this item (If the MORE1 of the key matches the MORE1 of the container then they are linked)
MORE2 = The lock complexity (how hard it is to pick the lock)
MOREX = The trap type (not used yet?)
TDATA2 = The gumpID of the container (this is not an ITEMDEF)
TDATA3/4: Defines rectangle, where you can place items (so they won't end up out of gump)
TDATA3 = top left corner. Hexadecimal number, each position takes 4 bytes, XY (example: X = 10 (0a) and Y = 20 (014) will look like TDATA3=000a0014
TDATA4 = bottom right corner.
LINK = UID of a secondary key?
t_door or t_door_locked
3 or 4
This type is used for both unlocked and locked doors.  They leverage the following properties:
MORE1 = UID of this door's key (if it has one)
TDATA1 = ID for the sound it makes when double clicked
t_key
5
This type is used for keys.  It leverages the following properties:
MORE1 = "ID" of the item(s) this key can unlock (if the MORE1 of the key matches the MORE1 of the container/door then they are linked)
LINK = If this is set to the UID of a "multi" object (like a house) the key can open all doors/containers in that multi?
Note:
Keys, containers, and doors are interesting. If both a key and a door/container contain the same arbitrary MORE1 value, the key can be used to lock or unlock the door/container.  That action changes the TYPE of the door/container to indicate whether it is locked or not. It also seems like LINK on the key can be set to the UID of a multi so that it can be used to open all doors/containers inside that multi.
t_light_lit
6
This type is used for light sources that can be turned onIT_S or off.  It leverages the following properties:
MOREY = Number of charges before the item is consumed
MOREZ = Type of light pattern it will cast
t_light_out
7
This type is used for light sources that can be turned on or off.  It leverages the following properties:
MOREY = Number of charges before the item is consumed
MOREZ = Type of light pattern it will cast
t_food
8
This type is used for edible food.  It leverages the following properties:
MORE2 = The ID of the creature that this came from
MOREM = Is the amount (0 to 127) of "food units" that will be gained when the item is used (eaten)
MOREZ = Is the poison level of the food
Note:
The following properties may also exist depending on your server version:
MOREX = The ID of a spell effect that will be gained when eaten
MOREY = The strength of the spell effect
t_food_raw
9
This type is used for
raw
food.  It leverages the following properties:
MORE1 = ID of the item it makes when cooked (the default is i_unused and if defined, it will override TDATA1)
MORE2 = The ID of the creature that this came from
MOREM = Is the amount (0 to 127) of "food units" that will be gained when the item is used (eaten)
MOREZ = Is the poison level of the food
TDATA1 = The item ID this cooks into
Note:
The following properties may also exist depending on your server version:
MOREX = The ID of a spell effect that will be gained when eaten
MOREY = The strength of the spell effect
TDATA2 = The creature ID type that the food came from
TDATA3 = The amount of skill required to cook it (did this ever work?)
t_armor
10
This type is used for armor.  It leverages the following properties:
MORE1L = Max hitpoints
MORE1H = Current hitpoints
MOREX = Spell effect when worn (for example, setting MOREX=1 causes a permanent Clumsy effect)
MOREY = There are two possible effects of setting MOREY:
If MOREX is set, then MOREY is the power/effect of that spell
If the ATTR includes attr_magic, then there is an AR bonus (how is this calculated?)
Note:
Old versions of sphere stored remaining charges in MORE2, this is no longer true.
t_weapon_mace_smith
11
This type is used for macefighting weapons that can also be used by blacksmiths to forge items.  It leverages the following properties:
MORE1L = Max hitpoints
MORE1H = Current hitpoints
MOREY = Attack bonus (percentage), but only if ATTR & attr_magic
The following overrides can be set on a per item basis:
TAG.OVERRIDE.DAMAGETYPE = can be used on a per item basis to override the types of damage this weapon does
TAG.OVERRIDE.SOUND_HIT = can be used on a per item basis to override the sound this weapon makes when it hits
TAG.OVERRIDE.SOUND_MISS = can be used on a per item basis to override the sound this weapon makes when it misses
t_weapon_mace_sharp
12
This type is used for macefighting weapons that have sharp cutting edges.  It leverages the following properties:
MORE1L = Max hitpoints
MORE1H = Current hitpoints
MOREY = Attack bonus (percentage), but only if ATTR & attr_magic
The following overrides can be set on a per item basis:
TAG.OVERRIDE.DAMAGETYPE = can be used on a per item basis to override the types of damage this weapon does
TAG.OVERRIDE.SOUND_HIT = can be used on a per item basis to override the sound this weapon makes when it hits
TAG.OVERRIDE.SOUND_MISS = can be used on a per item basis to override the sound this weapon makes when it misses
t_weapon_sword
13
This type is used for swordsmanship weapons.  It leverages the following properties:
MORE1L = Max hitpoints
MORE1H = Current hitpoints
MOREY = Attack bonus (percentage), but only if ATTR & attr_magic
The following overrides can be set on a per item basis:
TAG.OVERRIDE.DAMAGETYPE = can be used on a per item basis to override the types of damage this weapon does
TAG.OVERRIDE.SOUND_HIT = can be used on a per item basis to override the sound this weapon makes when it hits
TAG.OVERRIDE.SOUND_MISS = can be used on a per item basis to override the sound this weapon makes when it misses
t_weapon_fence
14
This type is used for fencing weapons.  It leverages the following properties:
MORE1L = Max hitpoints
MORE1H = Current hitpoints
MOREY = Attack bonus (percentage), but only if ATTR & attr_magic
The following overrides can be set on a per item basis:
TAG.OVERRIDE.DAMAGETYPE = can be used on a per item basis to override the types of damage this weapon does
TAG.OVERRIDE.SOUND_HIT = can be used on a per item basis to override the sound this weapon makes when it hits
TAG.OVERRIDE.SOUND_MISS = can be used on a per item basis to override the sound this weapon makes when it misses
t_weapon_bow
15
This type is used for archery weapons (bow or crossbow).  It leverages the following properties:
MORE1L = Max hitpoints
MORE1H = Current hitpoints
MOREY = Attack bonus (percentage), but only if ATTR & attr_magic
TDATA1 = The sound effect the weapon makes when it shoots
TDATA2 = The required strength to wield the weapon
TDATA3 = ID of arrow item that will be fired (and must therefore be on the player's person)
TDATA4 = ID of the arrow animation (for bows it is usually i_arrow_x, for crossbows, i_xbow_x)
The following overrides can be set on a per item basis:
TAG.OVERRIDE.DAMAGETYPE = to override the types of damage this weapon does
TAG.OVERRIDE.SOUND_HIT = to override the sound this weapon makes when it hits
TAG.OVERRIDE.SOUND_MISS = to override the sound this weapon makes when it misses
AMMOANIMRENDER = to override the rendermode of the ANIM this item uses (yes, no TAGs)
AMMOTYPE = to override the type of ammo (TDATA3) this item uses (yes, no TAGs)
AMMOANIM = to override the ammo animation (TDATA4) this item uses (yes, no TAGs)
AMMOANIMHUE = to override the color of the ammo animation this item uses (yes, no TAGs)
t_wand
16
This type is used for magic wands.  It leverages the following properties:
MORE1L = the current amount of hitpoints the item has
MORE1H = the maximum hitpoints for the item
MORE2 = the number of remaining charges (if magical)
MOREX = the spell type (if magical)
MOREY = the spell strength (0-1000)
MOREZ = the poison skill applied (0-100)
TDATA2 = Required Strength to equip the wand
TDATA3 = ID of the light pattern
TDATA4 = A flag to indicate what happens when the light burns out (0=nothing, 1=delete the object).
t_telepad
17
This type is used for teleport pads.  It leverages the following properties:
MOREP = Coordinates of the point to which you will teleport when you step on the item
MORE1 = If set to 1, the teleport pad will only work for players (and their pets)
MORE2 = If set to 1, the teleport animation and sound will not be shown to anyone witnessing the teleport
t_switch
18
This type is used for switches.  The way these things work is, when used, they trigger @DCLICK on the LINK object.  It leverages the following properties:
LINK = UID of item to trigger
MORE1 = The item ID of the next state of the switch
MOREX = A flag to indicate if this is activated by stepping on it
t_book
19
This type is used for books of static or dynamic text.  It leverages the following properties:
MORE1L = This can be set to an ID of a book (some default book text is included in the sphere_books.scp file)
MORE1H = Some flags that determine book behavior:
0c00: Scripted book
0800: Editable book
08000: ? time stamp ?
AUTHOR = The ID of the character that wrote the book
BODY.# = The text for each page of the book (starting with page 0)
Note:
we need more information on those flags...
t_rune
20
This type is used for recall runes.  It leverages the following properties:
MORE1 = The number of uses left before it wears out
MOREP = The coordinates of the marked location
t_booze
21
This type is used for alcohol (it causes a drunk effect when double clicked.)  It leverages the following properties:
TDATA1 = A flag that indicates whether the container is empty or not.
t_potion
22
This type is used for potions.  It leverages the following properties:
MORE1 = The potion spell effect that will result when the potion is double clicked
MORE2 = The strength of the potion (This has a different effect defending on the spell, usually between 0 and 1000)
MOREX = The countdown to explosion (for purple potions)
TDATA1 = A flag that indicates whether the container is empty or not
t_fire
23
This type is used for fires (and ovens?).  These items can be used to cook food, and they can burn you if stepped on.  It leverages the following properties:
TIMER = time until it decays?
MORE1 (or MORE2?) = Amount of damage it will cause when stepped on or dclicked
MOREZ =  Type of light pattern it will cast
t_clock
24
This type is used to tell time (game time, not real time) when double clicked.  The result comes out something like "half past eleven o'clock at night".  From what I can tell there are no MORE or TDATA modifiers that affect the result.
t_trap and t_trap_active
25 and 26
These types are used for traps that are triggered when walked on.  They leverage the following properties:
MORE1 = ID of the animation
MORE2 = The damage the trap will cause
MOREX = The length of time the animation will run
MOREY = The length of time the activated trap will idle until reset
MOREZ = A flag that indicates if the trap must idle before changing from active to inactive.
t_musical
27
This type is used for musical instruments.  It leverages the following properties:
TDATA1 = The sound ID to be played if successful
TDATA2 = The sound ID to be played if not successful
t_spell
28
This type is used for magic spell effects.  It leverages the following properties:
MORE1L = The polymorph effect on STR
MORE1H = The polymorph effect on DEX
MORE2 = The number of charges left
MOREX = The spell effect that will result when the item is stepped on
MOREY = The strength of the spell (This has a different effect defending on the spell, usually between 0 and 1000)
MOREZ = Type of light pattern it will cast
t_gem
29
This type is used for gems, and from what I can tell there is no built-in behavior for it.
t_water
30
This type is used for water, which means it can be fished in or used to clean used bandages.
MORE1 = The regiontype ID that determines what sorts of resources (fish etc) that it can produce.
t_clothing
31
This type is used for all cloth based equip-able items.  It is essentially identical to t_armor and t_armor_leather.    It leverages the following properties:
MORE1L = Max hitpoints
MORE1H = Current hitpoints
MOREX = Spell effect when worn (for example, setting MOREX=1 causes a permanent Clumsy effect)
MOREY = There are two possible effects of setting MOREY:
If MOREX is set, then MOREY is the power/effect of that spell
If the ATTR includes attr_magic, then there is an AR bonus (how is this calculated?)
Note:
Old versions of sphere stored remaining charges in MORE2, this is no longer true.
t_scroll
32
This type is used for scrolls.  It leverages the following properties:
MOREX = ID of the spell to cast when double-clicked
MOREY = Power of the spell (equivalent to the EFFECT setting of the spell itself?)
t_carpentry
33
This type is used by carpenters to craft items, and from what I can tell there is no built-in behavior for it.
t_spawn_char
34
This type is used to spawn NPCs.  Once it spawns its first creature, it will turn red and change its appearance to the ICON of the creature (or appear as a wisp if the spawn is set to use a template.)  It leverages the following properties:
AMOUNT = The maximum amount of NPCs the spawner should create
MORE1/SPAWNID* = The creature ID or spawn template ID for what you want to spawn
MORE2/COUNT* = The current number of creatures spawned from this point
MOREX/TIMELO* = The minimum time between spawns (in minutes)
MOREY/TIMEHI* = The maximum time between spawns (in minutes)
MOREZ/MAXDIST* = The maximum distance away from the spawn to create the spawned NPC (this is also the maximum wander distance for the NPC)
AT*(R/W) = Access the object in the N position and reads/writes/executes the given text, eg: at.0.remove, <at.0.str>...
ADDOBJ*(W) = Adds to the spawn an object with the given uid (must be a valid uid)
DELOBJ*(W) = Deletes from the spawn an object with the given uid (must be a valid uid)
START*(W) = Forces the spawn to start spawning
STOP*(W) = Stops the spawn and removes everything it created
RESET*(W) = Froces an STOP and then START it again
*X branch only
Note:
The spawn is considered active if the TIMER has a positive value, and when the timer reaches zero, it is automatically restarted using a random number between MOREX and MOREY.
t_game_piece
35
This type is used for game board pieces (checkers, chess, etc).  They cannot be removed from the game, and they have no tile image outside of the game board gump.  It leverages the following properties:
TDATA1 = The starting x position for this piece
TDATA2 = The starting y position for this piece
t_portculis
36
This type is used for portcullis doors that raise and lower when double clicked.  It leverages the following properties:
MORE1 = The z height at the lowest setting
MORE2 = The z height at the highest setting
t_figurine
37
This type is used for shrunk NPCs (essentially magic figurines), that turn into a "pet" creature when double clicked.  It leverages the following properties:
MORE1 = The creature ID that will spawn when the item is double clicked.
MORE2 = The UID of the off-line creature (in "stable master" inventory)
TDATA2 = The required strength to mount the creature (presumably only if it is possible to mount it)
TDATA3 = The base creature ID.
t_shrine
38
This type is used for shrines.  They will resurrect a ghost when double-clicked by a ghost.
t_moongate
39
This type is used for moongates.  When stepped on they teleport the player to another location.  It leverages the following properties:
MOREP = The coordinates that the moongate leads to
MORE1 = If set to 1, the smoke and sound is supressed
MORE2 = If set to 1, NPCs (and pets?) cannot use it
t_chair
40
This type is used for any sort of a chair item and it's only purpose is to trigger a sitting animation.
t_forge
41
This type is used by blacksmiths to smelt ore....
t_ore
42
This type is harvested by miners, and converted by blacksmiths (using a forge) into something else.  It leverages the following properties:
TDATA1 = ID of item created when the ore is smelted (usually ingots)
t_log
43
This type is a raw material resource usually harvested from trees.
t_tree
44
This type is chopped by lumberjacks to get logs.  It leverages the following properties:
MORE1 = The regiontype ID that determines what sorts of resources (fish etc) that it can produce.
FRUIT = ID of item gathered if double-clicked (usually logs)
t_rock
45
This type can be mined for ore.
MORE1 = The regiontype ID that determines what sorts of resources (fish etc) that it can produce.
t_carpentry_chop
46
A carpentry tool that can be used to craft carpentry objects as well as used to "chop" trees (like a saw?)
t_multi
47
Multi part object like house or ship.
MORE1 is the UID of the player that created/owns the multi
t_reagent
48
Alchemy when clicked ?
t_ship
49
This is a ship multi.
MORE1 is the UID of the player that created/owns the multi
MORE2 contains the speed, anchor flag, direction of movement, and facing direction in each byte respectively
t_ship_plank
50
Ship plank for players to get on a boat.
TDATA1 = is the itemID of the next open/closed state.
MORE1 = the lock code. normally this is the same as the uid (magic lock=non UID)
MORE2= 0-1000 = How hard to pick or magic unlock. (conflict with door ?)
MOREX = type to become (IT_SHIP_SIDE or IT_SHIP_SIDE_LOCKED)
t_ship_side
51
Should extend to make a plank TDATA1 is the itemID of the next open/closed state.
MORE1 = the lock code. normally this is the same as the uid (magic lock=non UID)
MORE2= 0-1000 = How hard to pick or magic unlock. (conflict with door ?)
t_ship_side_locked
52
TDATA1 is the itemID of the next open/closed state.
MORE1 = the lock code. normally this is the same as the uid (magic lock=non UID)
MORE2= 0-1000 = How hard to pick or magic unlock. (conflict with door ?)
t_ship_tiller
53
Tiller man on the ship.
MORE1 = the lock code. Normally this is the UID, except if uidLink is set.
LINK = If this is set to the UID of a "multi" object (like a house) the key can open all doors/containers in that multi?
Note:
Keys, containers, and doors are interesting. If both a key and a door/container contain the same arbitrary MORE1 value, the key can be used to lock or unlock the door/container.  That action changes the TYPE of the door/container to indicate whether it is locked or not. It also seems like LINK on the key can be set to the UID of a multi so that it can be used to open all doors/containers inside that multi.
t_eq_trade_window
54
Container for the trade window.
t_fish
55
Fish can be cut up. Yields 4 * <Amount> when a bladed object is used on it.
t_sign_gump
56
This type is used for simple signs (and things like grave stones).  It leverages the following properties:
TDATA2 = The gumpID
TDATA3 = The minimum gump size
TDATA4 = The maximum gump size
MORE1 = the lock code. Normally this is the UID, except if uidLink is set.
LINK = If this is set to the UID of a "multi" object (like a house) the key can open all doors/containers in that multi?
Note:
Keys, containers, and doors are interesting. If both a key and a door/container contain the same arbitrary MORE1 value, the key can be used to lock or unlock the door/container.  That action changes the TYPE of the door/container to indicate whether it is locked or not. It also seems like LINK on the key can be set to the UID of a multi so that it can be used to open all doors/containers inside that multi.
t_stone_guild
57
This type is used for guild stones.  It leverages the following properties:
MORE1 = The alignment of the guild (chaos, neutral, order)
MORE2 = The amount of gold in the guild account
t_anim_active            58   // = active anium that will recycle when done.
t_sand                   59   // = sand on the beach
t_cloth                  60   // = bolt or folded cloth
t_hair                   61   //
t_beard                  62   // = just for grouping purposes.
t_ingot
63
This type is used for ingots (when a blacksmith smelts ore, it turns into ingots.  It leverages the following properties:
TDATA1 = The skill required to smelt this
TDATA2 = The skill required to get the maximum yield when smelting
t_coin
64
This types is used for coins, gold or otherwise.
t_crops
65
This type is used to grow plants that likely bear fruit.  Double clicking a t_crop item will harvest the fruit if it is ripe.  It leverages the following properties:
MORE1 = Time in seconds before this item will grow to the next stage (this overrides the default server defined number)
TDATA1 = Is the ID of the first stage of the crop (the sprout), it is the ID that the crop will be reset to regrow from (0=nothing, which means this plant will not regrow once harvested)
TDATA2 = Is the ID of the next stage of the crop (or zero if this is the final mature crop which will bear the fruit)
TDATA3 = Is the ID of the fruit that this plant will grow and should only be set on the
ripe
plant (0 means the plant is not mature)
Note
This type has unusual TIMER behavior in that regardless of the ATTR flags, the timer will restart when it reaches zero.
t_drink
66
This type is used for non-alcoholic drinks.  It leverages the following properties:
TATA1 = A flag that indicates whether the container is empty or not.
Note:
There is an INI flag OF_DrinkIsFood (0x10000) that, if set, will increase FOOD level when the drink is consumed (like T_FOOD does)
t_anvil                  67   // = for repair.
t_port_locked            68   // = this portcullis must be triggered.
t_spawn_item
69
This type is used to spawn items.  Once it spawns its first item, it will turn red and change its appearance to the i_worldgem_lg ID item. It leverages the following properties:
AMOUNT = The maximum amount of items the spawner should create
MORE1/SPAWNID* = The item ID or spawn template ID for what you want to spawn
MORE2/PILE* = The current number of items spawned from this point
MOREX/TIMELO* = The minimum time between spawns (in minutes)
MOREY/TIMEHI* = The maximum time between spawns (in minutes)
MOREZ/MAXDIST* = The maximum distance away from the spawn to create the spawned item (this is also the maximum wander distance for the NPC)
AT*(R/W) = Access the object in the N position and reads/writes/executes the given text, eg: at.0.remove, <at.0.str>...
ADDOBJ*(W) = Adds to the spawn an object with the given uid (must be a valid uid)
DELOBJ*(W) = Deletes from the spawn an object with the given uid (must be a valid uid)
START*(W) = Forces the spawn to start spawning
STOP*(W) = Stops the spawn and removes everything it created
RESET*(W) = Froces an STOP and then START it again
*X branch only
Note:
The spawn is considered active if the TIMER has a positive value, and when the timer reaches zero, it is automatically restarted using a random number between MOREX and MOREY.
t_telescope              70   // = big telescope pic.
t_bed
71
This type is used to indicate the item is a bed.  I am not sure how it is used exactly, but it leverages the following properties:
TDATA1 = The direction it occupies
t_gold
72
This type is used to indicate the object is a gold coin and can be used to purchase stuff.
t_map
73
This type is used for cartography maps.  It has the following properties:
MORE1L = The top coordinate.
MORE1H = The left coordinate.
MORE2L = The bottom coordinate.
MORE2H = The right coordinate.
MOREZ = A flag that indicates whether the map has pins or not.
MOREX and MOREY = The coordinates of the pin (I think).
TDATA1 = The map gump width.
TDATA2 = The map gump height.
t_eq_memory_obj
74
This type is used for character memories, and it really depends on the type of memory to know what each property really means, but here is a relatively good guide:
MORE1L = The action type this is a memory for
MORE1H = The skill involved
MORE2 = The start time of the memory
MOREP = The map coordinates at which the memory occurred.
t_weapon_mace_staff      75   // = staff type of mace. or just other type of mace.
t_eq_horse
76
This type is used for equipped horse object.  Essentially it represents a riding horse to the client.  It leverages the following properties:
MORE1 = The creature ID
MORE2 = The UID of the offline creature (in "stable master" inventory)
TDATA2 = The required strength to mount it
TDATA3 = The base creature ID
t_comm_crystal
77
This type is used for communication crystals.
t_game_board
78
This type is used as a container for game pieces (t_game_piece).  It leverages the following properties:
MORE1 = The type of pieces to use (0=chess, 1=checkers, 2=none... presumably this is hard-coded)
TDATA2 = The gumpID of the container (this is not an ITEMDEF)
TDATA3 = The minimum gump size
TDATA4 = The maximum gump size
t_trash_can
79
This type is used as a trash can container, and it deletes any object placed into it.  It leverages the following properties:
TDATA2 = The gumpID of the container (this is not an ITEMDEF)
TDATA3 = The minimum gump size
TDATA4 = The maximum gump size
t_cannon_muzzle
80
This type is used for the business end of the cannon. It leverages the following properties:
MORE2 = A mask of what is currently loaded in it. (0 = none, 1=powder, 2=shot)
t_cannon
81
This type is used for the cannon control.
t_cannon_ball
82
This is ammo for a t_cannon.
t_armor_leather          83   // = non metallic armor (t_clothing)
t_seed
84
This type is used for seeds.  A seed can be created by using a dagger on a fruit (assuming the fruit is setup to have a seed.)  A seed can be planted by double clicking it and targeting the ground (specifically t_dirt items).  It leverages the following properties:
TDATA1 = The ID of a t_crop item that will grow the fruit that this seed comes from. 0 is Nothing.
TDATA2 = The art asset to use as the seed art asset. A copper coin is default.
t_junk                   85   // = never used
t_crystal_ball           86   // = Has no internal use.
t_swamp                  87   // = swamp (smelly)
t_message
88
This type is used for bulletin board messages.  It leverages the following properties:
TDATA2 = The gumpID
TDATA3 = The minimum gump size
TDATA4 = The maximum gump size
t_reagent_raw
89
Freshly grown reagents...not processed yet. A seed can be created by using a dagger on a raw reagent (assuming the raw reagent is setup to have a seed.)  A seed can be planted by double clicking it and targeting the ground (specifically t_dirt items).  It leverages the following properties:
TDATA1 = The ID of a t_crop item that will grow the fruit that this seed comes from. 0 is Nothing.
TDATA2 = The art asset to use as the seed art asset. A copper coin is default.
t_eq_client_linger
90
Change player to npc for a while.
t_snow
91
Snow
t_it_stone
92
This type is an "item stone" that is used to generate items when the object is double clicked.  It has the following properties:
MORE1 = The item or template ID to generate
MORE2 = The price (or Plotflags to set?)
MOREX = The regen time (0 = instant)
MOREY = The total amount to deliver (0 = infinite, 0xFFFF = none left)
t_unused_93
93
This has no use.
t_explosion
94
This type is used for explosion animations.  It leverages the following properties:
MOREX = The damage that the explosion will cause
MOREY = The type of damage (fire, magic, etc)
MOREZ = The distance range for the damage
t_eq_npc_script
95
This type is used to script NPC actions (in the form of a book).  The sphere_defs.scp file says "get rid of this in favor of waiting on m_events" but it may still exist... if so, it leverages the following properties:
MORE1 = The same as for other books
MORE2L = The current script page
MORE2H = The current offset
MOREZ = The priority for this script (as a percent, this is the chance they want to "do" this task)
t_web
96
Walk on this and transform into some other object.  MORE1 is the amount of hits the web can take.
t_grass
97
Can be eaten by grazing animals
MORE1 = The regiontype ID that determines what sorts of resources (fish etc) that it can produce.
t_arock
98
A rock or boulder. can be thrown by giants.
t_tracker
99
Points to a linked object.
t_sound
100
This type is used to play sounds.  It uses the following properties:
MORE1 = The sound ID
MORE2 = A flag to indicate repetition
t_stone_town
101
This type is used for town stones.  It leverages the following properties:
MORE1 = The alignment of the town (chaos, neutral, order)
MORE2 = The amount of gold in the town bank account
t_weapon_mace_crook     102   //
t_weapon_mace_pick      103   //
t_leather               104   // = leather or skins of some sort.(not wearable)
t_ship_other            105   // = some other part of a ship.
t_bboard
106
This type is a bulleting board container that holds t_message items.  It leverages the following properties:
TDATA2 = The gumpID of the container
TDATA3 = The minimum gump size
TDATA4 = The maximum gump size
t_spellbook
107
This type is used for the Magery spellbook.  It leverages the following properties:
MORE1 = A bit mask of available spells in circles 0-4, so to add all those spells: set MORE1=0ffffffff
MORE2 = A bit mask of available spells in circles 5-8, so to add all those spells: set MORE2=0ffffffff
Note:
In older sphere versions, MOREX, MOREY, and MOREZ could be set to add additional spells (necro, etc), but recently these concepts may have been removed... same with these TDATA settings:
TDATA2 = Required Strength to equip the book
TDATA3 = Type of light pattern it will cast
TDATA4 = A flag to indicate what happens when the light burns out (0=nothing, 1=delete the object)
t_corpse
108
This type is a container used for all dead corpses.  It leverages the following properties:
MORE1 = The time of death
TIMESTAMP seems to hold the time of death.
MORE1 = Corpse is already carved? (0=not carved, 1=carved)
MORE2 = The UID of the individual character that landed the killing blow
MOREX & MOREY = Combined, these make up a single DWORD which specifies what type of creature this was
MOREZ = The direction it is facing
TDATA2 = The gumpID of the container
TDATA3 = The minimum gump size
TDATA4 = The maximum gump size
There are two special TAGs for corpses:
TAG.BLOOD = This is the number of times you can carve the corpse and cause blood to come out (default 5)
TAG.MAXBLOOD = Not certain about this one, but it is likely related... perhaps it is set on the CHARDEF?
t_track_item            109   // - track a id or type of item.
t_track_char            110   // = track a char or range of char id's
t_weapon_arrow          111   //
t_weapon_bolt           112   //
t_eq_vendor_box         113   // = an equipped vendor box
t_eq_bank_box
114
This type is a container that is used for the character bank.  It leverages the following properties:
MORE1 = The amount of gold in the account (is this still true?)
MORE2 = The amount to restock to (for NPCs vendors who can buy stuff from players?)
MOREP = The location in the world (x, y, and z) where the bank box was opened
TDATA2 = The gumpID for the bank box container
TDATA3 = The minimum gump size
TDATA4 = the maximum gump size
t_deed
115
This type is used to create something else when double clicked.  It is perhaps the best solution for a player to place a
multi
part item like a house.  When double clicked, it will prompt for a target location.  It leverages the following properties:
MORE1 = The ID of the item that will be created at the target location
MORE2 = The previous key ID (ideally this is set when a house or ship are re-deeded so that all the existing keys will still work)
t_loom
116
This type of device is used by weavers who turn wool or thread into bolts of cloth.  It leverages the following properties:
MORE1 = The ID of the currently loaded resource (wool or cotton/flax) that is being woven
MORE2 = The amount of resources currently in the loom
t_bee_hive
117
This type is used for beehives.  It leverages the following properties:
MORE1 = The amount of honey which has accumulated in the hive
t_archery_butte
118
This type is used for practice archery targets.  When double clicked, the target will first check if you have an archery weapon equipped and if so, it will return some ammo.  It leverages the following properties:
MORE1 = The ID for the type of ammo currently stuck in the target
MORE2 = The amount of items stuck in the target
t_eq_murder_count       119   // = my murder count flag.  MORE1 contains the amount of time before it expires. 
t_eq_stuck              120   // we are stuck in a web
t_trap_inactive         121   //  = a safe trap.
//t_unused_122          122
t_bandage               123   //  = can be used for healing.
t_campfire              124   //  = this is a fire but a small one.
t_map_blank             125
t_spy_glass             126
t_sextant               127
t_scroll_blank          128
t_fruit
129
This type is used for fruit.  When double clicked, fruit will be eaten.  Fruit can be grown from crops (t_crop).  It leverages the following properties:
TDATA1 = The ID of a t_crop item that this fruit comes from (If not set, this fruit may not have a seed, use zero to be certain)
MOREM = Is the amount (0 to 127) of "food units" that will be gained when the item is used (eaten)
MOREZ = Is the poison level of the fruit
t_water_wash            130   // water that will not contain fish. (for washing or drinking)  TDATA1 is a flag that indicates whether the container is empty or not 
t_weapon_axe            131   // not the same as a sword. but uses swordsmanship skill
t_weapon_xbow
132
This type is used for crossbow weapons.  It is essentially identical to t_weapon_bow.
t_spellicon             133
t_door_open             134
t_meat_raw              135   // just a meaty part of a corpse. (uncooked meat)
t_garbage               136
t_keyring
137
This type is a container used to store keys.  It leverages the following properties:
TDATA2 = The gumpID
TDATA3 = The minimum gump size
TDATA4 = The maximum gump size
t_table
138
doesn't really do anything.
t_floor
139
t_roof
140
t_feather
141
a birds feather
t_wool
142
wool cut from a sheep.
t_fur
143
t_blood
144
blood of some creature
t_foliage
145
This type is very similar to t_crops, the difference being the foliage does not disappear when the fruit is harvested.  It leverages the following properties:
MORE1 = Time in seconds before this item will grow to the next stage (this overrides the default server defined number)
TDATA1 = Is the ID of the first stage of the crop (the sprout)
TDATA2 = Is the ID of the next stage of the crop (or zero if this is the final mature crop which will bear the fruit)
TDATA3 = Is the ID of the fruit that this plant will grow and should only be set on the
ripe
plant
Note
This type has unusual TIMER behavior in that regardless of the ATTR flags, the timer will restart when it reaches zero.
t_grain                 146
t_scissors              147
t_thread                148
t_yarn                  149
t_spinwheel             150
t_bandage_blood         151   //  = can't be used for healing.
t_fish_pole             152
t_shaft                 153   // bolt or arrow.
t_lockpick              154
t_kindling              155
t_train_dummy           156
t_train_pickpocket      157
t_bedroll               158
t_bellows               159
t_hide
160
Made into leather.
TDATA1 = Hold ID or DEFNAME of custom cut leather (or any item).
t_cloth_bolt
161
A bolt of cloth.
t_board
162
Logs are plained into decent lumber
t_pitcher
163
A pitcher holding a liquid of some kind.
TDATA1 is a flag that indicates whether the container is empty or not.
t_pitcher_empty
164
An empty pitcher that can or did hold a liquid.
TDATA1 is a flag that indicates whether the container is empty or not.
t_dye_vat
165
For dyeing items with.
t_dye
166
Dyes to set colors on a t_dye_vat
t_potion_empty
167
Empty bottle.
t_mortar
168
Alchemists mortar and pestle.
t_hair_dye
169
Hair dye.
t_sewing_kit
170
Tailoring sewing kit.
t_tinker_tools
171
Tinker's tools.
t_wall
172
Wall of a structure.
t_window
173
Window for a structure.  MOREZ is the light pattern
t_cotton
174
Cotton from the plant
t_bone
175
A bone from a corpse.
t_eq_script
176
This type can have tags and can be equipped.  Possibly used for memory objects that leverage @Equip and @UnEquip triggers.
t_ship_hold
177
A ships hold.
TDATA2 is the gumpID
TDATA3 is the minimum gump size
TDATA4 is the maximum gump size
MORE1 = the lock code. normally this is the same as the uid (magic lock=non UID)
MORE2= 0-1000 = How hard to pick or magic unlock. (conflict with door ?)
t_ship_hold_lock
178
A locked ship's hold.
MORE1 = the lock code. normally this is the same as the uid (magic lock=non UID)
MORE2= 0-1000 = How hard to pick or magic unlock. (conflict with door ?)
t_lava
179
t_shield
180
This type is used to indicate the object is an equipable shield.  It has the following properties:
MORE1L = The current amount of hitpoints the item has
MORE1H = The maximum hitpoints for the item
MORE2 = The number of remaining charges (if magical)
MOREX = The spell type (if magical)
MOREY = The spell strength (0-1000)
t_jewelry
181
This type is used for equpable jewelry.  It leverages the following properties:
MORE1L = The current amount of hitpoints the item has
MORE1H = The maximum hitpoints for the item
MORE2 = The number of remaining charges (if magical)
MOREX = The spell type (if magical)
MOREY = The spell strength (0-1000)
TDATA2 = Required Strength to equip the item
TDATA3 = Light pattern
TDATA4 = A flag to indicate what happens when the light burns out (0=nothing, 1=delete the object)
t_dirt
182
This type is used to represent a patch of dirt where something can be planted.
t_script
183
This type can have tags, but can NOT be equipped.
t_spellbook_necro
184
AOS Necromancy spellbook (should have MOREZ=100 by default)
t_spellbook_pala
185
AOS Paladin spellbook (should have MOREZ=200 by default)
t_spellbook_extra
186
some spellbook for script purposes (MOREZ=basic offset)
t_spellbook_bushido
187
SE Bushido spellbook (should have MOREZ=400 by default)
t_spellbook_ninjitsu
188
SE Ninjitsu spellbook (should have MOREZ=500 by default)
t_spellbook_arcanist
189
ML Spellweaver spellbook (should have MOREZ=600 by default)
t_multi_custom
190
Customisable multi
t_spellbook_mystic
191
SA Mysticism spellbook (should have MOREZ=677 by default)
t_hoverover
192
Hover-over item (CAN_C_HOVER can hover over blocking items)
t_spellbook_bard
193
SA Bard spellbook (should have MOREZ=700 by default)
Scripted TYPEDEFs
DEFNAME
File
Description
t_advance_gate
??.scp
MORE = ID of character to change into
Syntax
The syntax for defining a type is:
[TYPEDEF
defname
]
TERRAIN=
id
TERRAIN=
start_id
,
end_id
ON=
trigger_name
script
ON=
trigger_name
script
Any number of triggers can be handled by one
TYPEDEF
definition, however it is not possible to handle the same trigger twice without using multiple definitions.
The trigger name can be the name of any
item trigger
. The return value from the script can affect Sphere's hardcoded behaviour in different ways. See the documentation for the trigger to discover what parameters are passed in to each trigger and what the return values do.
Note:
If the
defname
matches any of Sphere's hardcoded types (see 'typedefs' block in sphere_defs.scp), then the
TYPEDEF
can be used to override the behaviours of items of that type.
Examples
//
// Water definition from default script pack.
//
[TYPEDEF t_water]
TERRAIN = 0a8	0ab
TERRAIN = 0136	0137
//
// Makes an item speak when double clicked.
//
[TYPEDEF t_exampletype]
ON=@DClick
    SAY I have been double clicked!
    RETURN 2

--- PAGE BREAK ---

Objects are 'things' that exist inside Sphere and can be controlled during runtime. Modifying the property of an object will only affect a single instance (for example, setting the colour of one pile of gold to blue will not result in all gold turning blue).
Some objects may need definitions, for example an
item
has its basic properties defined by an
ITEMDEF
block and a
region
is defined by an
AREADEF
block.
View the pages in this category to learn more about the objects that exist in Sphere, and what functions, properties and references can be used to manipulate them.
Pages in category "Objects"
The following 18 pages are in this category, out of 18 total.
A
Accounts
ATTACKER
C
Characters
D
Database
De:Database
F
Files
G
GM Pages
I
Items
M
Map Points
N
NOTORIETY
P
Parties
R
REGIONRESOURCE
Regions
Rooms
S
Sectors
Server
Special Items
T
Tr:ATTACKER

--- PAGE BREAK ---

Help
Available languages
Missing languages
Player characters are attached to accounts. The account object can be referenced by using
ACCOUNT.KEY
from the character object or
ACCOUNT.name_or_index.KEY
from the server object. The following tables detail the various properties of accounts in SphereServer:
Contents
1
References
2
Properties and Functions
References
References return pointers to other objects (e.g. the CHAR.n reference allows you to access the characters that are attached to the account). These can either be accessed by using
<REFNAME>
to return the
UID
(1 for object types that don't have UIDs) of the object or 0 if it doesn't exist, or by using
<REFNAME.KEY>
where KEY is a valid property/function/reference for the
REFNAME
object. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
CHAR
.n
R
Gets the nth
character
attached to the account. (zero-based)
Properties and Functions
Here is a list of all account properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
ACCOUNT
R
Gets the name of the account.
BLOCK
RW
Gets or sets whether or the not the account is blocked.
CHARS
R
Gets how many characters are attached to the account.
CHATNAME
RW
Gets the name the account uses in chat.
FIRSTCONNECTDATE
RW
Gets the date and time on which the account first connected.
FIRSTIP
RW
Gets the IP address that the account first connected with.
GUEST
RW
Gets whether or not the account is a guest account.
JAIL
RW
Gets whether or not the account is jailed.
LANG
RW
Gets or sets the account's language.
LASTCHARUID
RW
Gets the
UID
of the last character used on the account.
LASTCONNECTDATE
RW
Gets the date and time on which the account most recently connected.
LASTIP
RW
Gets the IP address that the account most recently connected with.
MAXCHARS
RW
Gets or sets the maximum number of characters that the player can create on the account.
NAME
R
Gets the name of the account.
NEWPASSWORD
RW
Gets or sets a new password that will be set on the account.
PASSWORD
RW
Gets or sets the current password for the account.
PLEVEL
RW
Gets or sets the account's privelege level.
PRIV
RW
Gets or sets account flags.
RESDISP
RW
Gets or sets the account's expansion level.
TAG
.name
RW
Gets or sets the value of a TAG.
TAGCOUNT
R
Gets the number of TAGs on the account.
TOTALCONNECTTIME
RW
Gets the total number of minutes that the account has been connected for.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Using the
DB
object reference, scripts can interact with an external MySQL database. The following table details the various properties of the database object in SphereServer:
Note:
Before the DB object can be used, MySQL must be enabled along with the database host details, in Sphere.ini.
Contents
1
Properties and Functions
Properties and Functions
Here is a list of all database properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples. If an attempt is made to access a property that does not exist on the item, the property from the
ITEMDEF
will be accessed instead.
Name
Read/Write
Description
AEXECUTE
function, command
R
Executes an SQL command in a background thread, calling
function
when complete. Returns 1 if the command is successfully queued.
AQUERY
function, command
R
Executes an SQL command in a background thread, calling
function
when complete. Returns 1 if the command is successfully queued.
CLOSE
W
Closes the connection to the database.
CONNECT
W
Opens a connection to the database, using the settings from Sphere.ini.
CONNECTED
R
Returns 1 if the database is connected.
ESCAPEDATA
text
R
Returns
text
as an escaped SQL string.
EXECUTE
command
W
Exectutes an SQL command that doesn't return any result.
QUERY
command
W
Executes an SQL command that returns results.
ROW
.NUMCOLS
R
Returns the number of columns returned in the last query.
ROW
.NUMROWS
R
Returns the number of rows returned in the last query.
ROW
.n.col_index
R
Returns the value of the column at index
col_index
in the nth row. (zero-based)
ROW
.n.col_name
R
Returns the value of the column named
col_name
in the nth row. (zero-based)

--- PAGE BREAK ---

Using the
FILE
object reference, scripts can interact with text files. The following table details the various properties of the file object in SphereServer:
Note:
Before the FILE object can be used, the OF_FileCommands flag must be set in Sphere.ini's OptionFlags setting.
Contents
1
Properties and Functions
Properties and Functions
Here is a list of all file properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
CLOSE
W
Closes the currently open file.
DELETEFILE
file_name
W
Deletes
file_name
.
FILEEXIST
file_name
R
Returns 1 if
file_name
exists.
FILELINES
file_name
R
Returns the total number of lines in
file_name
.
FILEPATH
R
Returns the name of the currently open file.
FLUSH
W
Forces all buffered output to be written to the file,
INUSE
R
Returns 1 if a file is currently open.
ISEOF
R
Returns 1 if there are no more lines left to read from the file.
LENGTH
R
Returns the total length of the currently open file, in bytes.
MODE
.APPEND
RW
Gets or sets whether or not the file will be appended to when opened. Cannot be set after the file has been opened.
MODE
.CREATE
RW
Gets or sets whether or not the file will be created when opened. Cannot be set after the file has been opened.
MODE
.READLFLAG
RW
Gets or sets whether or not the file will be opened for reading from. Cannot be set after the file has been opened.
MODE
.WRITEFLAG
RW
Gets or sets whether or not the file will be opened for writing to. Cannot be set after the file has been opened.
MODE
.SETDEFAULT
W
Sets the mode to the default setting. Cannot be set after the file has been opened.
OPEN
file_name
R
Opens a file, and returns 1 if the attempt was successful, using the set
MODE
flags.
POSITION
R
Gets the current position in the currently open file, in bytes.
READBYTE
R
Reads the next byte from the currently open file.
READCHAR
R
Reads the next character from the currently open file.
READLINE
n
R
Reads the nth line from the currently open file (1-based). 0 Reads the last line.
SEEK
position
R
Changes the current position in the currently open file to
position
. Accepts "BEGIN" for the start of the file and "END" for the end of the file. Returns the new position in the file.
WRITE
text
W
Writes
text
to the currently open file.
WRITECHR
ascii_value
W
Writes a single character to the currently open file.
WRITELINE
text
W
Writes
text
to the currently open file, with newline character(s) on the end.

--- PAGE BREAK ---

Help
Available languages
Missing languages
When a client submits a GM page, these pages can be accessed through scripts using the
GMPAGE.n
reference from the
server
object. The following table details the various properties of GM pages in SphereServer:
Contents
1
Properties and Functions
Properties and Functions
Here is a list of all GM page properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
ACCOUNT
R
Gets the name of the account that sent the page.
HANDLED
R
Gets the
UID
of the character currently handling the page.
P
RW
Gets or sets the location that the page was sent from.
REASON
RW
Gets or sets the reason for the page.
STATUS
R
Gets the status of the page sender (OFFLINE, LOGIN or character name).
TIME
RW
Gets the time since the page was originally sent in seconds.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Certain types of items have extended functionality, and therefore have additional properties, functions or references to the ones already listed on the
Items
page. The following sections describe what these are.
Contents
1
Multis
1.1
Properties and Functions
2
Customizable Multis
2.1
References
2.2
Properties and Functions
3
Ships
3.1
References
3.2
Properties and Functions
4
Maps
4.1
Properties and Functions
5
Messages / Books
5.1
Properties and Functions
6
Communication Crystals
6.1
Properties and Functions
7
Guild/Town Stones
7.1
References
7.2
Properties and Functions
8
Guild/Town Members
8.1
Properties and Functions
8.1.1
Character Members
8.1.2
Item Members
9
Containers
9.1
References
9.2
Properties and Functions
10
Vendable Items
10.1
Properties and Functions
Multis
Multis have a TYPE t_multi, t_multi_custom or t_ship. These are multi-piece items that are usually stored in the client's multi.mul file, but are only considered to be one item to both the server and client (so when you approach a castle, there is a significant reduction in lag since the server doesn't have to tell the client to display thousands of wall pieces).
Properties and Functions
Here is a list of all multi properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
COMPS
R
Gets the number of components defined in the
ITEMDEF
.
COMP
.n.key
R
Gets the KEY (ID,DX,DY,DZ,D) of the nth component defined in the
ITEMDEF
.
MULTICREATE
owner_uid
W
When a multi is created via SERV.
NEWITEM
, this function must be used to initialise the multi-region.
Customizable Multis
Customizable multis are represented by the TYPE of t_multi_custom. These are designed to be used with the AOS House Designer tool that is present since the 4.0.0 series of UO clients.
References
References return pointers to other objects (e.g. the REGION reference allows you to access the REGION that an object is in). These can either be accessed by using
<REFNAME>
to return the
UID
(1 for object types that don't have UIDs) of the object or 0 if it doesn't exist, or by using
<REFNAME.KEY>
where KEY is a valid property/function/reference for the
REFNAME
object. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
DESIGNER
R
Gets the
character
currently modifying the house design.
Properties and Functions
Here is a list of all custom multi properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
ADDITEM
item_id, dx, dy, dz
W
Adds an item to the house design.
ADDMULTI
multi_id, dx, dy, dz
W
Adds a multi to the house design.
CLEAR
W
Removes all items from the house design.
COMMIT
W
Commits all changes that have been made to the house design, updating the state of the building.
COMPS
R
Gets the number of components in the house design.
CUSTOMIZE
character_uid
W
Enters the building into edit mode for the specified character (or SRC).
DESIGN
.n.KEY
R
Gets a property (ID,DX,DY,DZ,D,FIXTURE) from the nth component in the house design.
EDITAREA
R
Gets the designable area rectangle of the multi (left,top,right,bottom)
ENDCUSTOMIZE
W
Exits the current designer from edit mode.
FIXTURES
R
Gets the number of fixtures in the house design.
REMOVEITEM
item_id, dx, dy, dz
W
Removes an item from the house design.
RESET
W
Resets the house design back to the house foundation.
RESYNC
character_uid
W
Resends the current building state to the specified character (or SRC).
REVERT
W
Undoes all of the changes made to the house design since the last commit.
REVISION
R
Gets the revision number of the house design.
Ships
Ships have the TYPE t_ship, and are another extended version of multis that are designed to be used to sail around the world.
References
References return pointers to other objects (e.g. the REGION reference allows you to access the REGION that an object is in). These can either be accessed by using
<REFNAME>
to return the
UID
(1 for object types that don't have UIDs) of the object or 0 if it doesn't exist, or by using
<REFNAME.KEY>
where KEY is a valid property/function/reference for the
REFNAME
object. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
HATCH
R
Gets the ship's
hatch
.
TILLER
R
Gets the ship's
tiller
.
PLANK
.n
R
Gets the nth ship
plank
. (zero-based)
Properties and Functions
Here is a list of all ship properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
PLANKS
R
Gets the number of planks on the ship.
SHIPANCHORDROP
W
Drops the ship's anchor, preventing it from moving.
SHIPANCHORRAISE
W
Raises the ship's anchor, allowing it to move.
SHIPBACK
W
Begins moving the ship backwards.
SHIPBACKLEFT
W
Begins moving the ship backwards and to its left.
SHIPBACKRIGHT
W
Begins moving the ship backwards and to its right.
SHIPDOWN
W
Begins moving the ship downards, if ATTR_MAGIC is set.
SHIPDRIFTLEFT
W
Begins moving the ship to its left.
SHIPDRIFTRIGHT
W
Begins moving the ship to its right.
SHIPFACE
direction
W
Sets the direction of the ship.
SHIPFORE
W
Begins moving the ship forwards.
SHIPFORELEFT
W
Begins moving the ship forwards and to its left.
SHIPFORERIGHT
W
Begins moving the ship forwards and to its right.
SHIPGATE
location
W
Moves the entire ship and its contents to a specified location.
SHIPLAND
W
Moves the ship to ground level, if ATTR_MAGIC is set.
SHIPMOVE
direction
W
Begins moving the ship in the specified direction.
SHIPSPEED
.TILES
R
Gets the number of tiles that ths ship moves in one step.
SHIPSPEED
.PERIOD
R
Gets the length of time between each step, in tenths of a second.
SHIPSTOP
W
Stops the ship.
SHIPTURN
W
Turns the ship to face the opposite direction.
SHIPTURNLEFT
W
Rotates the ship to its left.
SHIPTURNRIGHT
W
Rotates the ship to its right.
SHIPUP
W
Begins moving the ship upwards, if ATTR_MAGIC is set.
Maps
The TYPEs t_map and t_map_blank are used to represent maps. These display a map to the player when used, that can be marked with a series of pins (markers) to plot a route.
Properties and Functions
Here is a list of all map properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
PIN
.n
PIN
x, y
RW
Gets the position of the
nth
pin (zero-based), or adds a pin to the map at the specified location.
MORE1H
,
MORE1L
RW
Gets the top left coordinates (x,y) of the area displayed on t_map.
MORE2H
,
MORE2L
RW
Gets the bottom right coordinates (x,y) of the area displayed on t_map.
Messages / Books
Messages (t_message) and books (t_book) possess a range of properties and functions that are used to store their title, author and body text.
Properties and Functions
Here is a list of all message properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
AUTHOR
RW
Gets or sets the author of the message.
BODY
.n
RW
Gets the nth line of text from the message, or appends a new line of text to the message.
ERASE
page_num
W
Removes all lines of text from the message, or if a page number (one-based) if supplied erases just a single line.
PAGE
.n
W
Sets the text of the nth single line of the message. (zero-based)
PAGES
R
Gets the number of lines of text in the message.
TITLE
RW
Gets or sets the title of message.
Communication Crystals
Communication crystals have the TYPE of t_comm_crystal.
Properties and Functions
Here is a list of all communication crystal properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
SPEECH
-/+speech_defname
RW
Gets a list of attached SPEECH blocks, or adds to or removes from the attached speech..
Guild/Town Stones
Guild and Town stones are defined by the types t_stone_guild and t_stone_town. Whilst a lot of functionality has been moved into the script pack, there are still some special properties, functions and references that can be used.
References
References return pointers to other objects (e.g. the REGION reference allows you to access the REGION that an object is in). These can either be accessed by using
<REFNAME>
to return the
UID
(1 for object types that don't have UIDs) of the object or 0 if it doesn't exist, or by using
<REFNAME.KEY>
where KEY is a valid property/function/reference for the
REFNAME
object. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
GUILD
.n
R
Gets the nth linked
guild or town
. (zero-based)
GUILDFROMUID
stone_uid
R
Gets the linked
guild or town
with a specified UID.
MEMBER
.n
R
Gets the nth member of the
guild or town
. (zero-based)
MEMBERFROMUID
.
character_uid
R
Gets the
member
of the guild with a specified UID.
Properties and Functions
Here is a list of all guild/town stone properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
ABBREV
RW
Gets or sets the guild/town abbreviation.
ABBREVIATIONTOGGLE
R
Returns one of the
STONECONFIG_VARIOUSNAME_*
defnames depending on whether SRC has their abbreviation showing or not.
ALIGN
RW
Gets or sets the alignment of the guild/town.
ALIGNTYPE
R
Returns the name of the guild or town's alignment.
ALLGUILDS
flags, command
W
Performs the given comamnd on all linked guilds or towns based on flags. (0 = All, 1 = War Declared by 'Us' only, 2 = War Declared by 'Them' only, 3 = War Declayed by both)
ALLMEMBERS
priv, command
W
Performs the given command on all guild or town members with the specified privelege level. (-1 = All)
APPLYTOJOIN
character_uid
W
Adds a character as a candidate to the guild or town.
CHANGEALIGN
alignment
W
Changes the guild or town alignment.
DECLAREPEACE
stone_uid
W
Declares peace towards another guild or town.
DECLAREWAR
stone_uid
W
Declares war towards another guild or town.
ELECTMASTER
W
Selects a new guild or town master based on which member has the most votes.
GUILD
.COUNT
R
Gets the number linked guilds or towns.
INVITEWAR
stone_uid, who_declared
W
Invites another guild or town to go to war (
who_declared
, 0 = They declared, 1 = We declared)
JOINASMEMBER
character_uid
W
Adds a character as a full member of the guild or town.
LOYALTO
R
Returns the name of the guild or town member that SRC has declared fealty to.
MASTER
R
Returns the name of the guild or town master.
MASTERGENDERTITLE
R
Returns the gender of the guild or town mastser.
MASTERTITLE
R
Returns the title of the guild or town master.
MASTERUID
RW
Gets the UID of the guild/town master, or sets it to the UID of a new master.
MEMBER
.COUNT
priv
R
Gets the number of members in the guild/town with at least the given privileges (or all if not supplied).
RESIGN
character_uid
W
Removes a character from the guild or town.
TOGGLEABBREVIATION
character_uid
W
Toggles the display of guild/town abbreviation for a member or SRC.
WEBPAGE
RW
Gets or sets the guild or town's webpage.
CHARTER
.n
EW
Gets or sets the nth line of the guild/town charter. (zero-based)
Guild/Town Members
When accessing a member of a guild or town via the
MEMBER
.x,r
MEMBERFROMUID
.uid,
GUILD
.x, or
GUILDFROMUID
.uid references, you access a special "Guild/Town Member" object which has specific properties, references and functions available. If you attempt to access something that doesn't exist in any of the following tables then the command is 'redirected' to the actual character or item the member object is linked to (so something like
<MEMBER.x.STR>
would work because the STR property exists on the
character
).
Properties and Functions
Here is a list of all guild/town member properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Character Members
Name
Read/Write
Description
ACCOUNTGOLD
RW
Gets or sets the amount of gold the member has in their guild/town account.
ISCANDIDATE
R
Returns 1 if the member is a candidate of the guild/town.
ISMASTER
R
Returns 1 if the member is a guild/town master.
LOYALTO
RW
Gets or sets the UID of who the member has declared fealty towards.
PRIV
RW
Gets or sets the member's privilege level within the guild/town.
PRIVNAME
R
Returns the name of the member's privilege level within the guild/town.
TITLE
RW
Gets or sets the member's title within the guild/town.
SHOWABBREV
RW
Gets or sets whether or not the member's abbreviation is shown.
Item Members
Name
Read/Write
Description
ISENEMY
R
Returns 1 if the other guild/town is considered an enemy.
THEYALLIANCE
RW
Gets or sets whether or not the other guild/town has declared an alliance with the guild/town.
THEYWAR
RW
Gets or sets whether or not the other guild/town has declared war.
WEALLIANCE
RW
Gets or sets whether or not the guild/town has declared an alliance with the other guild/town.
WEWAR
RW
Gets or sets whether or not the guild/town has declared war with the other guild/town.
Containers
Container items (backpacks, bankboxes, bags, etc) can be used to hold other items. These items have the
TYPE
of t_container.
References
References return pointers to other objects (e.g. the REGION reference allows you to access the REGION that an object is in). These can either be accessed by using
<REFNAME>
to return the
UID
(1 for object types that don't have UIDs) of the object or 0 if it doesn't exist, or by using
<REFNAME.KEY>
where KEY is a valid property/function/reference for the
REFNAME
object. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
FINDCONT
.n
R
Gets the nth
item
from inside the container. (zero-based)
FINDID
.item_id
R
Gets the first
item
found inside the container with the matching
BASEID
.
FINDTYPE
.type
R
Gets the first
item
found inside the container with the matching
TYPE
.
Properties and Functions
Here is a list of all custom multi properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
COUNT
R
Returns the number of items inside the container.
DELETE
nth
W
Deletes the nth item from inside the container. (1-based)
EMPTY
W
Deletes all items inside the container.
FCOUNT
R
Returns the total number of items inside the container, including subcontainers.
FIXWEIGHT
W
Recalculates the total weight of the container and its contained items.
OPEN
W
Opens the container, for SRC to view its contents.
RESCOUNT
item_defname
R
Returns the total amount of a specific item inside the container, including subcontainers.
RESTEST
item_list
R
Returns 1 if all of the items in the list can be found inside the container, including subcontainers.
Vendable Items
When an item has value, either explicitly in the ITEMDEF's
VALUE
property or implicity in the ITEMDEF's
RESOURCES
property, it is considered a "Vendable Item" that can be sold on vendors.
Properties and Functions
Here is a list of all vendable item properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
PRICE
RW
Gets or sets the price of the item. (affect only the sell/buy price on player vendor. NPC use the value)
QUALITY
RW
Gets or sets the quality of the item.

--- PAGE BREAK ---

Help
Available languages
Missing languages
A map point is a specific location on a world map, defined by X, Y, Z and M coordinates. Map point references, such as
P
from the
character
/
item
object and
MAP(x,y,map)
from the
server
object can be used to access additional information about a map point such as what static items exist at the location. The following tables detail the various properties of map points in SphereServer:
Contents
1
References
2
Properties and Functions
References
References return pointers to other objects (e.g. the REGION reference allows you to access the region that contains the map point). These can either be accessed by using
<REFNAME>
to return the
UID
(1 for object types that don't have UIDs) of the object or 0 if it doesn't exist, or by using
<REFNAME.KEY>
where KEY is a valid property/function/reference for the
REFNAME
object. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
REGION
R
Gets the
region
that contains the map point.
ROOM
R
Gets the
room
that contains the map point.
SECTOR
R
Gets the
sector
that contains the map point.
Properties and Functions
Here is a list of all map point properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
COMPONENTS
R
Gets the number of components of the
MULTI
at the location.
COMPONENTS
.n.ID
R
Gets the ID of the nth component at the location. (zero-based)
COMPONENTS
.n.MULTI
R
Gets the UID of the MULTI item.
COMPONENTS
.n.Z
R
Gets the Z level of the nth component at the location. (zero-based)
COMPONENTS
.n.KEY
R
Gets the
KEY
property from the
ITEMDEF
of the nth component at the location. (zero-based)
ISNEARTYPE
type, distance, check_multis
R
Returns 1 if an item exists within
distance
tiles of the location whose
TYPE
matches a specified type.
M
MAP
R
Gets the location's map number.
STATICS
R
Gets the number of static items at the location.
STATICS
.n.ID
R
Gets the ID of the nth item at the location. (zero-based)
STATICS
.n.COLOR
R
Gets the hue of the nth item at the location. (zero-based)
STATICS
.n.Z
R
Gets the Z level of the nth item at the location. (zero-based)
STATICS
.n.KEY
R
Gets the
KEY
property from the
ITEMDEF
of the nth item at the location. (zero-based)
TERRAIN
R
Gets the terrain's ID at the location.
TERRAIN
.Z
R
Gets the terrain's Z level at the location.
TYPE
R
Gets the terrain's TYPE at the location.
X
R
Gets the X coordinate of the location.
Y
R
Gets the Y coordinate of the location.
Z
R
Gets the Z coordinate of the location.

--- PAGE BREAK ---

Clients are able to form parties with each other by using the
/add
command. When in a party, the party object can be referenced by using
PARTY.KEY
from the
client
object. The following tables detail the various properties of parties in SphereServer:
Contents
1
References
2
Properties and Functions
References
References return pointers to other objects (e.g. the CHAR.n reference allows you to access the characters that are attached to the account). These can either be accessed by using
<REFNAME>
to return the
UID
(1 for object types that don't have UIDs) of the object or 0 if it doesn't exist, or by using
<REFNAME.KEY>
where KEY is a valid property/function/reference for the
REFNAME
object. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
MASTER
R
Gets the party master, the
character
who originally formed the party.
MEMBER
.n
R
Gets the nth
party member
. (zero-based)
Properties and Functions
Here is a list of all party properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
ADDMEMBER
character_uid
W
Adds a character to the party.
ADDMEMBERFORCED
character_uid
W
Adds a character to the party. If the character is already in a party then they will be forced out of it. The character will be added even if the party has reached the maximum size of 10.
CLEARTAGS
W
Removes all TAGs from the party.
DISBAND
W
Disbands the party.
ISSAMEPARTYOF
character_uid
R
Returns 1 if a specified character is a member of this party.
MEMBERS
R
Gets the total number of characters in the party.
REMOVEMEMBER
character_uid
W
Removes a character from the party.
REMOVEMEMBER
@
n
W
Removes the nth character from the party. (zero-based)
SPEECHFILTER
RW
Gets or sets a function that will be called every time a party member speaks to the party.
SYSMESSAGE
character_uid, message
W
Sends a message to a party member (0 = Entire party).
SYSMESSAGE
@
n, message
W
Sends a message to the nth party member.
TAG
RW
Gets or sets the value of a TAG.
TAGAT
.index
R
Gets a TAG at the given zero-based index.
TAGAT
.index
.KEY
R
Gets the name of the TAG at the given zero-based index.
TAGAT
.index
.VAL
R
Gets the value of the TAG at the given zero-based index.
TAGCOUNT
R
Gets the number of TAGs stored on the party.
TAGLIST
W
Displays a list of all TAGs to SRC.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Areas in the world, such as dungeons and cities are defined by regions. Accessing regions in scripts can be accomplished using the REGION reference from a
character
,
item
or
map point
object, or the AREA.region_id reference from the
server
object. The following tables detail the various properties of the region object in SphereServer:
Contents
1
References
2
Properties and Functions
3
Triggers
References
References return pointers to other objects (e.g. the CHAR.n reference allows you to access the characters that are attached to the account). These can either be accessed by using
<REFNAME>
to return the
UID
(1 for object types that don't have UIDs) of the object or 0 if it doesn't exist, or by using
<REFNAME.KEY>
where KEY is a valid property/function/reference for the
REFNAME
object. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
REGION
R
For regions linked to a multi, gets the region that contains the multi region. Only valid for reading values.
Properties and Functions
Here is a list of all region properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples. Properties from the
region definition
can also be accessed from the region object. If an attempt is made to execute (not read) a command that does not exist on the region or its definition, then the command will be called on all sectors that touch the region area.
Name
Read/Write
Description
ALLCLIENTS
command
W
Executes
command
on all clients inside the region boundaries.
CLEARTAGS
prefix
W
Removes all TAGs from the region that start with the given prefix.
CLIENTS
R
Gets the total number of clients that are inside the sectors that touch the region.
COLDCHANCE
W
Set the ColdChance to all sectors in this Region.
DEFNAME
R
Gets the region's defname.
EVENTS
+/-regiontype_defname
RW
Gets a list of attached region events, or adds or removes a region event to or from the region.
GUARDED
RW
Set the region to be Guarded or not.
ISEVENT
.regiontype_defname
R
Returns 1 if the region has a specified region event attached.
MAGIC
RW
Enables or Disables Region_Antimagic_All flag.
MAP
R
Gets the map that the region exists on.
MARK
RW
Same as RecallIn.
NOBUILD
RW
Enables or disables Building in this area (only affects futures houses).
NOPVP
RW
Enables or disables PvP in this region.
P
RW
Gets or Sets the P coordinates for this area.
RECALLIN
RW
Enables or disables Mark & RecallIn flags.
RECT
R
Gets the number of rectangles that this region is made from.
RECT
.n
R
Gets the nth rectangle that this region is made from.
RAINCHANCE
W
Sets the RainChance for all sectors inside this region.
RESOURCES
+/-regiontype_defname
RW
Gets a list of attached region events, or adds or removes a region event to or from the region.
SAFE
RW
Get or Set Safe flag for this region.
TAGAT
.index
R
Gets a TAG at the given zero-based index.
TAGAT
.index
.KEY
R
Gets the name of the TAG at the given zero-based index.
TAGAT
.index
.VAL
R
Gets the value of the TAG at the given zero-based index.
TAGCOUNT
R
Gets the number of TAGs stored on the region.
TAGLIST
W
Outputs a list of the region's TAGs.
TYPE
R
If the region is linked to a multi, returns the multi's
BASEID
property.
UID
R
Gets the region's unique ID in the world.
UNDERGROUND
RW
Gets or sets Underground flag for this region.
Triggers
Here is a list of all region triggers. Click on the trigger name for more detailed information such as arguments and examples.
Name
Description
@CliPeriodic
Fires multiple times approximately every 30 seconds, for each client in the region.
@Enter
Fires when a character enters the region.
@Exit
Fires when a character exits the region.
@RegPeriodic
Fires once approximately every 30 seconds, as long as there is at least one client in the region.
@ResourceFound
Fires after a resource has been selected and the resource bit has been created.
@ResourceGather
Fires before finishing the gathering skill.
@ResourceTest
Fires once for every resource listed in a REGIONTYPE, to check if the player (SRC) can get it. It is called only if the player meets the SKILLMAKE requirements for the item set in REAP.
@Step
Fires whenever a character takes a step within the region.

--- PAGE BREAK ---

Within
regions
you can also define rooms, which are basically 'sub-regions' that exist inside the area which may represent buildings within a town or a boss room within a dungeon. Accessing rooms in scripts can be accomplished using the ROOM reference from a
character
,
item
or
map point
object, or the ROOM.room_id reference from the
server
object. The following table details the various properties of the room object in SphereServer:
Contents
1
Properties and Functions
2
Triggers
Properties and Functions
Here is a list of all room properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples. The properties from the
room definition
can also be accessed from the room object. If an attempt is made to execute (not read) a command that does not exist on the room, then the command will be called on all sectors that touch the room area.
Name
Read/Write
Description
ALLCLIENTS
command
W
Executes
command
on all clients inside the room boundaries.
CLEARTAGS
prefix
W
Removes all TAGs from the room that start with the given prefix.
CLIENTS
R
Gets the total number of clients that are inside the sectors that touch the room.
EVENTS
+/-regiontype_defname
RW
Gets a list of attached room events, or adds or removes a room event to or from the room.
ISEVENT
.regiontype_defname
R
Returns 1 if the room has a specified room event attached.
MAP
R
Gets the map that the room exists on.
RECT
R
Gets the number of rectangles that this room is made from.
RECT
.n
R
Gets the nth rectangle that this room is made from.
TAGAT
.index
R
Gets a TAG at the given zero-based index.
TAGAT
.index
.KEY
R
Gets the name of the TAG at the given zero-based index.
TAGAT
.index
.VAL
R
Gets the value of the TAG at the given zero-based index.
TAGCOUNT
R
Gets the number of TAGs stored on the room.
TAGLIST
W
Outputs a list of the room's TAGs.
UID
R
Gets the room's unique ID in the world.
Triggers
Here is a list of all room triggers. Click on the trigger name for more detailed information such as arguments and examples.
Name
Description
@Enter
Fires when a character enters the room.
@Exit
Fires when a character exits the room.
@Step
Fires whenever a character takes a step within the room.

--- PAGE BREAK ---

The world is split into fixed-size sectors (by default, 64x64 tiles). Environmental settings (light, weather, etc) are stored on a per-sector basis. Accessing sectors in scripts can be accomplished using the SECTOR reference from a
character
,
item
or
map point
object. The following table details the various properties of the sector object in SphereServer:
Contents
1
Properties and Functions
Properties and Functions
Here is a list of all sector properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
ALLCHARS
command
R
Executes
command
on all characters inside the sector.
ALLCHARSIDLE
command
R
Executes
command
on all disconnected characters inside the sector.
ALLCLIENTS
command
R
Executes
command
on all clients inside the sector.
ALLITEMS
command
R
Executes
command
on all items inside the sector.
CANSLEEP
R
Returns 1 if the sector have all condition to sleep. (X ONLY)
CLIENTS
R
Gets the number of clients in the sector.
COLDCHANCE
RW
Gets or sets the chance of snow for the sector.
COMPLEXITY
R
Gets the number of characters in the sector.
COMPLEXITY
.HIGH
R
Returns 1 if the sector has a high complexity. (less than 5 characters)
COMPLEXITY
.MEDIUM
R
Returns 1 if the sector has a medium complexity. (less than 10 characters)
COMPLEXITY
.LOW
R
Returns 1 if the sector has a low complexity. (10+ characters)
DRY
W
Sets the weather to dry.
ISDARK
R
Returns 1 if the light level in the sector is considered to be dark.
ISNIGHTTIME
R
Returns 1 if the local time of day is between 9pm and 7am.
ISSLEEPING
R
Returns 1 if the sector is sleeping. (X ONLY)
ITEMCOUNT
R
Returns the number of items in the sector.
LIGHT
RW
Gets or sets the light level for the sector.
LOCALTIME
R
Gets the local time of day, as a descriptive string.
LOCALTOD
R
Gets the local time of day, in minutes.
NUMBER
R
Gets the index number of the sector.
RAIN
W
Sets the weather to raining.
RAINCHANCE
RW
Gets or sets the chance of rain for the sector.
RESPAWN
ALL
W
Resurrects dead NPC characters (not corpses). If
ALL
is provided then all sectors will be affected.
RESTOCK
ALL
W
Restocks all NPCs in the sector. If
ALL
is provided then all sectors will be affected.
SEASON
RW
Gets or sets the current season in the sector.
SNOW
W
Sets the weather to snowing.
WEATHER
RW
Gets or sets the current weather in the sector.

--- PAGE BREAK ---

Help
Available languages
Missing languages
The server object is a global object that can be accessed from any script, by using the SERV reference. The following tables detail the various properties of the server in SphereServer:
Contents
1
References
2
Properties and Functions
References
References return pointers to other objects (e.g. the CHAR.n reference allows you to access the characters that are attached to the account). These can either be accessed by using
<REFNAME>
to return the
UID
(1 for object types that don't have UIDs) of the object or 0 if it doesn't exist, or by using
<REFNAME.KEY>
where KEY is a valid property/function/reference for the
REFNAME
object. Click on the name for more detailed information such as usage and examples.
Name
Read/Write
Description
ACCOUNT
.n
R
Gets the nth
account
on the server. (zero-based)
ACCOUNT
.name
R
Gets the
account
with the specified name.
AREA
.defname
R
Gets the
region
with the specified defname.
CHARDEF
.defname
R
Gets the
character definition
for
defname
.
DEF
.defname
R
Gets the value for
defname
. Def0.defname can also be used similar to tag0 and ctag0.
CLIENT
.n
R
Gets the nth
client
on the server. (zero-based)
Note:
The nth client may not be an ingame player character, check <CLIENT.n> first as it returns 1 for ingame clients and 0 for non-player clients.
GMPAGE
.n
R
Gets the nth
GM page
on the server. (zero-based)
GUILDSTONES
.n
R
Gets the nth
guild stone
on the server. (zero-based)
ITEMDEF
.defname
R
Gets the
item definition
for
defname
.
LASTNEWCHAR
R
Gets the last
character
created on the server.
LASTNEWITEM
R
Gets the last
item
created on the server.
MAP
(x, y, map)
MAP
(x, y, z, map)
R
Gets the
map point
for a specified location.
REGIONRESOURCE
.defname
R
Gets the
region resource definition
for
defname
.
REGIONTYPE
.defname
R
Gets the
region type definition
for
defname
.
ROOM
.defname
R
Gets the
room
with the specified defname.
SKILL
.defname
R
Gets the
skill definition
for
defname
.
SKILLCLASS
.defname
R
Gets the
skillclass
for
defname
.
SPAWN
.defname
R
Gets the
spawn group
for
defname
.
SPELL
.defname
R
Gets the
spell definition
for
defname
.
SPELL
.n
R
Gets the nth
spell definition
, ordered by skill requirements (1-based, ascending).
(X only)
TILEDATA
.TERRAIN(
id
).
attribute
R
Gets the tiledata
attribute
of
id
terrain.
attribute
can be one of: FLAGS,UNK,INDEX,NAME.
(X only)
TILEDATA
.ITEM(
id
).
attribute
R
Gets the tiledata
attribute
of
id
item.
attribute
can be one of: FLAGS,WEIGHT,LAYER,UNK11,ANIM,HUE,LIGHT,HEIGHT,NAME.
TOWNSTONES
.n
R
Gets the nth
town stone
on the server. (zero-based)
Properties and Functions
Here is a list of all item properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples. Settings from Sphere.ini can also be accessed from the server object, but they are not listed in this table.
Name
Read/Write
Description
ACCOUNT
ADD
name password
W
Creates an account with the specified name and password.
ACCOUNT
ADDMD5
name hash
W
Creates an account with the specified name and MD5 password hash.
ACCOUNT
BLOCKED
days command
W
Executes
command
on all accounts that have been unused for
days
days and are currently blocked.
ACCOUNT
JAILED
days command
W
Executes
command
on all accounts that have been unused for
days
days and are currently jailed.
ACCOUNT
UNUSED
days command
W
Executes
command
on all accounts that have been unused for
days
days.
ACCOUNT
UPDATE
W
Saves the accounts to file.
ACCOUNT
name command
W
Executes
command
on the account with the specified name.
ACCOUNTS
RW
Gets or sets the number of accounts on the server.
ALLCLIENTS
command
W
Executes
command
on all online player characters.
B
message
W
Broadcasts
message
to all clients on the server.
BLOCKIP
address, time
W
Blocks an IP address for
time
, in tenths of a second (-1 = permanent).
CHARS
RW
Gets or sets the number of characters on the server.
CLEARLISTS
mask
W
Removes all LISTs whose name contains
mask
.
CLEARVARS
prefix
W
Removes all VARs that start with the given prefix.
CLIENTS
R
Gets the total number of connected clients.
CONSOLE
command
W
Executes
command
as if it had been typed directly into the server console.
EXPORT
file, flags, distance
W
Exports all objects within
distance
tiles of SRC to a file. (Flags: 1 = Items, 2 = Characters, 3 = Both)
GARBAGE
W
Forces an immediate garbage collection (checks for invalid objects and fixes them if possible, or else removes them).
GMPAGES
R
Returns the total number of GM pages.
GUILDS
R
Returns the total number of guild
and
town stones.
GUILDSTONES
.COUNT
R
Returns the total number of guild stones on the server.
HEARALL
RW
Gets or sets whether player speech is logged to server console and log file.
IMPORT
file, flags, distance
W
Imports previously exported items that were within
distance
tiles. (Flags: 1 = Items, 2 = Characters, 3 = Both)
INFORMATION
W
Displays server information to SRC.
ITEMS
RW
Gets or sets the number of items on the server.
LOAD
file
W
Loads a script file.
LOG
message
W
Logs
message
to server console and logs.
LOOKUPSKILL
skill_name
R
Looks up a skill name or key, and returns its skill number.
MAP
.map_num.
ALLSECTORS
command
W
Executes
command
on all sectors of a map.
MAP
.map_num.
SECTOR.
sector_num command
RW
Executes
command
on sector
sector_num
of a map.
MAPLIST
.map_num
R
Returns 1 if
map_num
is a valid map number.
MAPLIST
.map_num
.BOUND.X
R
Returns the maximum X coordinate for a map.
MAPLIST
.map_num
.BOUND.Y
R
Returns the maximum Y coordinate for a map.
MAPLIST
.map_num
.CENTER.X
R
Returns the central X coordinate of a map.
MAPLIST
.map_num
.CENTER.Y
R
Returns the central Y coordinate of a map.
MAPLIST
.map_num
.SECTOR.COLS
R
Returns the number of sector columns on a map.
MAPLIST
.map_num
.SECTOR.QTY
R
Returns the number of sectors on a map.
MAPLIST
.map_num
.SECTOR.ROWs
R
Returns the number of sector rows on a map.
MAPLIST
.map_num
.SECTOR.SIZE
R
Returns the size of the sectors on a map.
MEM
R
Returns the total amount of memory being used, in kilobytes.
PRINTLISTS
LOG
W
Displays a list of all LISTs to SRC, or the server console.
REGEN
0
RW
Gets or sets the length of time it takes for characters to regenerate 1 health point, in seconds.
REGEN
1
RW
Gets or sets the length of time it takes for characters to regenerate 1 mana point, in seconds.
REGEN
2
RW
Gets or sets the length of time it takes for characters to regenerate 1 stamina point, in seconds.
REGEN
3
RW
Gets or sets the length of time it takes for characters to lose 1 food point, in seconds.
RESPAWN
W
Respawns all dead NPCs (not corpses) in the world.
RESTOCK
W
Restocks all NPCs in the world.
RESTORE
file, account_name, character_name
W
Restores a player character from a backup save.
RESYNC
W
Checks all script files for any changes made since they were last loaded.
RTICKS
R
Returns the real-world time, as a timestamp.
RTICKS
.FORMAT
timestamp, format
R
Returns the real-world timestamp as a formatted datetime string.
RTICKS
.FROMTIME
year, month, day, hour, minutes, seconds
R
Returns the specified real-world time, as a timestamp.
RTIME
R
Returns the real-world time, as a formatted string.
RTIME
.FORMAT
format
R
Returns the real-world time, as a formatted string.
More information :
Serv.rtime.format
SAVE
force_immediate
W
Begins a world save. If background saving is enabled,
force_immediate
can be used to force a foreground save.
SAVECOUNT
R
Returns the number of world saves that have taken place.
SAVESTATICS
W
Performs a statics save.
SHRINKMEM
W
Temporarily reduces memory usage.
SHUTDOWN
time
W
Schedules a server shutdown in
time
minutes.
SYSCMD
cmd
W
Executes
cmd
and waits for it to finish executing. Returns <0 if an error occurred. Requires OF_FileCommands.
SYSSPAWN
cmd
W
Executes
cmd
and does not wait for the program to finish executing. Returns <0 if an error occurred. Requires OF_FileCommands.
TICKPERIOD
R
Returns how much server ticks are in a real-world second.
TIME
R
Returns the total server uptime, in tenths of a second.
TIMEHIRES
R
X branch only. Returns the internal timer in milliseconds.
TIMEUP
R
Returns the server uptime, as second.
TOWNSTONES
.COUNT
R
Returns the total number of town stones on the server.
UNBLOCKIP
address
W
Unblocks a previously blocked IP address.
VARLIST
LOG
W
Displays a list of all VARs to SRC, or the server console.
VERSION
R
Returns the SphereServer version.

--- PAGE BREAK ---

Scripts are used to control what actions take place when certain things happen. For example a script can be used to control what happens when a player double clicks a certain object. Through the use of scripts, Sphere can be customised in a very particular way that should meet the needs of virtually any server.
The
Definitions
category describes how scripts can be used to define the basic properties of objects, and the
Objects
category describes each of the different types of object and how they can be manipulated by scripts.
The pages in this category describe more general information about scripts, such as global properties and functions that are available from any script in Sphere, as well as the arguments that are available when creating scripting functions and triggers.
Subcategories
This category has the following 3 subcategories, out of 3 total.
F
Functions
S
Statements
V
Variables
Pages in category "Scripts"
The following 4 pages are in this category, out of 4 total.
D
De:Intrinsic Functions
I
Intrinsic Functions
L
LIST
P
Portuguese:Intrinsic Functions

--- PAGE BREAK ---

References
The following references are available within function and trigger scripts. If an attempt is made to access a reference that is not listed here then the object the function/trigger is called on will be accessed instead.
Name
Read/Write
Description
ARGO
RW
Gets or sets a reference to a
character
or
item
.
REF
x
RW
Gets or sets a reference to a
character
or
item
.
Properties and Functions
The following properties and functions are available within function and trigger scripts. If an attempt is made to access a property or function that is not listed here then the object the function/trigger is called on will be accessed instead.
Name
Read/Write
Description
ARGN1
RW
Gets the first parameter passed into the function, as a numeric value.
ARGN2
RW
Gets the second parameter passed into the function, as a numeric value.
ARGN3
RW
Gets the third parameter passed into the function, as a numeric value.
ARGS
RW
Gets the entire argument string passed into the function.
ARGV
R
Returns the number of parameters passed into the function.
ARGV
[
n
]
R
Returns the nth parameter passed into the function. (zero-based)
FLOAT
.name
RW
Gets or sets the value of a local floating point variable.
LOCAL
.name
RW
Gets or sets the value of a local variable.
RETURN
value
W
Exits the function, passing
value
back to whatever called it (if the function was used as
<FUNCTION>
.
value
can be either a string or numeric value.
TRY
command
W
Executes
command
.
TRYSRV
command
W
Executes
command
, with the
SERV
object as SRC.
This category currently contains no pages or media.

--- PAGE BREAK ---

References
The following table lists all object references that are available from any script.
Name
Read/Write
Description
DB
R
Gets the server's
database
object.
FILE
R
Gets the server's
file
object.
I
R
Gets the current object.
LIST
R
Gets the server's list object.
NEW
RW
Gets or sets the last
character
or
item
created on the server.
OBJ
RW
Gets or sets a reference to a
character
or
item
SRC
R
Gets the source
character
of an event.
UID
.
object_uid
R
Gets a reference to the
character
or
item
with the specified
UID
.
Properties and Functions
The following table lists all properties and functions that are available from any script.
Name
Read/Write
Description
ASC
text
R
Converts
text
into a series of ASCII values.
ASCPAD
size,text
R
Converts
text
into a series of ASCII values, padded with 0s untill
size
is reached.
Will also truncate the
text
if longer then
size
BETWEEN
min, max, numerator, denominator
R
Returns the value that's
numerator/denominator
between
min
and
max
BETWEEN2
min, max, numerator, denominator
R
Returns the value that's
numerator/denominator
between
max
and
min
CHR
ascii_code
R
Returns the character represented by the given ASCII code.
CLEARVARS
prefix
W
Removes all server VARs whose name start with
prefix
.
CLRBIT
value, bit
R
Returns the value of
value
with
bit
not set.
D
property_or_function
R
Forces a property or function to return a decimal value.
DEFMSG
.name
W
Sets the value of a DEFMESSAGE. (see sphere_msgs.scp)
EXPLODE
separators
,
text
R
Splits
text
by the given separator characters.
EVAL
expression
R
Evaluates an expression and returns the result as an integer.
FEVAL
expression
R
Evaluates an expression and returns the result as an integer, supports floating point values.
FHVAL
expression
R
Evaluates an expression and returns the result as a hexadecimal value, supports floating point values.
FLOATVAL
expression
R
Evaluates an expression and returns the result as a floating point value.
FVAL
expression
R
Evaluates an expression and formats the result with a single decimal point. ("1000" becomes "100.0")
ref
.
GETREFTYPE
R
Returns a code representing what type of object
ref
is.
HVAL
expression
R
Evaluates an expression and returns the result as a hexadecimal value.
ISBIT
value, bit
R
Returns non-zero if
bit
is set in
value
.
ISEMPTY
value
R
Returns 1 if
value
is empty/blank text.
ISNUM
value
R
Returns 1 if
value
is a numeric value.
LISTCOL
R
Returns the alternating colour in webpage tables.
MD5HASH
text
R
Returns an MD5 hash for
text
.
MULDIV
num, mul, div
R
Returns (
num
*
mul
) /
div
.
NEWDUPE
object_uid
W
Clones the character or item with the specified
UID
.
NEWITEM
item_defname, amount, container, equip
W
Creates a new item.
NEWNPC
character_defname
W
Creates a new character.
QVAL
expression
?
value_true
:
value_false
R
Evaluates an expression and returns
value_true
if the result is true, otherwise returns
value_false
.
There is another variant of QVAL in the
Intrinsic Functions
category.
R
x
R
Returns a random number between 0 and
x - 1
.
R
x, y
R
Returns a random number between
x
and
y
.
SETBIT
value, bit
R
Returns the value of
value
with
bit
set.
SHOW
property_or_function
W
Displays the returned value from a property or function to SRC.
STRARG
text
R
Returns the first word from
text
.
STREAT
text
R
Removes the first word from
text
and returns the remaining text.
STRPOS
position character text
R
Returns the position of a
character
within the
text
, starting from
position
.
STRREGEXNEW
pattern, text
R
Returns 1 if
text
matches a regular expression
pattern
.
STRREVERSE
text
R
Returns
text
, after reversing its characters.
STRSUB
position, count, text
R
Extracts
count
characters from
text
, starting from
position
.
STRTOLOWER
text
R
Returns
text
in lowercase.
STRTOUPPER
text
R
Returns
text
in uppercase.
STRTRIM
text
R
Removes whitespace (i.e. spaces, tabs) from the start and end of
text
.
SYSCMD
command, arg1, arg2...
R
Executes a system command on the server and waits for it to complete.
Note:
Requires OF_FileCommands to be enabled in Sphere.ini
SYSSPAWN
command, arg1, arg2...
R
Executes a system command on the server and does not wait for it to complete.
Note:
Requires OF_FileCommands to be enabled in Sphere.ini
UVAL
expression
R
Evaluates an expression and returns the result as an unsigned integer.
VAR
.name
RW
Gets or sets the value of a VAR.
This category currently contains no pages or media.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Intrinsic functions are special functions that can only be used within evaluation functions, such as
EVAL
,
FEVAL
,
FHVAL
,
FVAL
,
HVAL
, and
UVAL
. Some of the builtin functions and properties will automatically evaluate their parameters, for example the
IF
,
WHILE
statements will automatically evaluate their conditions.
Unlike the syntax for normal functions (<FUNCTION args>), the syntax for returning a value from an instrinsic function is:
FUNCTION(
args
)
The following table details all of the intrinsic functions in SphereServer:
Name
Description
ABS
(
value
)
Returns the absolute
value
of a number.
COS
(
value
)
Returns the cosine of
value
.
ID
(
defname
)
Returns the numeric value of
defname
.
ISOBSCENE
(
text
)
Returns 1 if
text
is considered to contain obscene language.
ISNUMBER
(
value
)
Returns 1 if
value
is a number.
LOGARITHM
(
value
)
Returns the base-10 logarithm of
value
.
LOGARITHM
(
value
,
base
)
Returns the base-
base
logarithm of
value
. (Accepts "e" and "pi" as bases, as well as numeric values)
NAPIERPOW
(
value
)
Returns e (2.7182818) to the power of
value
.
QVAL
(
a, b, less_than, equal_to, greater_than
)
Returns
less_than
if
a
is less than
b
,
equal_to
is
a
is equal to
b
, or
greater_than
if
a
is greater than
b
.
RAND
(
value
)
Returns a random value between 0
value-1
.
RAND
(
min, max
)
Returns a random value between
min
and
max
.
RANDBELL
(
value, variance
)
Calculates a value based on a bell-shaped curve.
SIN
(
value
)
Returns the sine of
value
.
STRCMP
(
string1, string2
)
Compares
string1
to
string2
and returns the result. Case-sensitive. (<= 1 =
string1
less than
string2
, 0 =
string1
equal to
string2
, >= 1 =
string1
greater than
string2
)
STRCMPI
(
string1, string2
)
Compares
string1
to
string2
and returns the result. Case-insenstive. (<= 1 =
string1
less than
string2
, 0 =
string1
equal to
string2
, >= 1 =
string1
greater than
string2
)
STRINDEXOF
(
text, search, n
)
Returns the index of the
search
string within
text
, starting from the
n
th character. (zero-based)
STRLEN
(
text
)
Returns the length of
text
.
STRMATCH
(
pattern, text
)
Returns 1 if
text
matches the specified wildcard
pattern
.
STRREGEX
(
pattern, text
)
Returns 1 if
text
matches the specified regular expression
pattern
.
SQRT
(
value
)
Returns the square root of
value
.
TAN
(
value
)
Returns the tangent of
value
.

--- PAGE BREAK ---

Statement
End Statement
Description
BEGIN
END
Groups a set of lines together, for use with
DORAND
and
DOSWITCH
statements.
DORAND
line_count
ENDDO
Executes a random line of code within the block.
DOSWITCH
line_number
ENDDO
Executes the specified line of code within the block.
FOR
start end
ENDFOR
Loops through the block of code
FORCHARLAYER
layer_id
ENDFOR
Loops through all items that a character has equipped on a specified layer.
FORCHARMEMORYTYPE
memory_flags
ENDFOR
Loops through all memory items on a character that have one of the specified flags.
FORCHARS
distance
ENDFOR
Loops through all characters within
distance
tiles.
FORCLIENTS
distance
ENDFOR
Loops through all connected clients within
distance
tiles.
FORCONT
container_uid, max_subcontainers
ENDFOR
Loops through all items inside a container.
FORCONTID
item_id, max_subcontainers''
ENDFOR
Loops through all items inside a container with a specified
BASEID
FORCONTTYPE
type, max_subcontainers
ENDFOR
Loops through all items inside a container with a specified
TYPE
FORINSTANCES
defname
ENDFOR
Loops through all instances of characters or items with the specified
BASEID
FORITEMS
distance
ENDFOR
Loops through all items within
distance
tiles.
FOROBJS
distance
ENDFOR
Loops through all items and players within
distance
tiles.
FORPLAYERS
distance
ENDFOR
Loops through all players (online and offline) within
distance
tiles.
IF
condition
ELIF
condition
ELSEIF
condition
ENDIF
Executes the block of code if
condition
is true.
WHILE
condition
ENDWHILE
Loops through the block of code whilst
condition
is true.
<local._for>
Current Step of the Loop for the FOR statements.  Note, not all of the FOR statements use this concept... for example, in a FORITEMS statement, the <local._for> counter will always be zero no matter how many objects the statement loops over.
<local._while>
Current Step of the Loop for the WHILE statement.
This category currently contains no pages or media.

--- PAGE BREAK ---

Subcategories
This category has the following 8 subcategories, out of 8 total.
C
Characters
Combat
I
Items
N
NPCS
P
Players
R
Regions
S
Skills
Spells
Pages in category "Triggers"
The following 200 pages are in this category, out of 201 total.
(previous page) (
next page
)
@
@Abort
@AfterClick
@Attack
@Buy
@CallGuards
@CharAttack
@CharClick
@CharClientTooltip
@CharDClick
@CharTradeAccepted
@Click
@ClientTooltip
@CliPeriodic
@CombatAdd
@CombatDelete
@CombatEnd
@CombatStart
@ContextMenuRequest
@ContextMenuSelect
@Create
@Criminal
@Damage
@DClick
@Death
@DeathCorpse
@Destroy
@Dismount
@DropOn Char
@DropOn Ground
@DropOn Item
@DropOn Self
@DropOn Trade
@Dye
@Eat
@Effect
@EffectAdd
@EffectRemove
@EffectTick
@Enter
@EnvironChange
@Equip
@EquipTest
@Exit
@ExpChange
@ExpLevelChange
@Fail
@Fail (Spell Trigger)
@FameChange
@Gain
@GetHit
@Hit
@HitMiss
@HitParry
@HitTry
@HouseDesignCommit
@HouseDesignExit
@ItemAfterClick
@ItemBuy
@ItemClick
@ItemClientTooltip
@ItemContextMenuRequest
@ItemContextMenuSelect
@ItemCreate
@ItemDamage
@ItemDClick
@ItemDropOn Char
@ItemDropOn Ground
@ItemDropOn Item
@ItemDropOn Self
@ItemEquip
@ItemEquipTest
@ItemPickUp Ground
@ItemPickUp Pack
@ItemPickUp Self
@ItemPickUp Stack
@ItemSell
@ItemSmelt
@ItemSpellEffect
@ItemStep
@ItemTargOn Cancel
@ItemTargOn Char
@ItemTargOn Ground
@ItemTargOn Item
@ItemToolTip
@ItemUnEquip
@Jailed
@KarmaChange
@Kill
@Login
@Logout
@Mount
@MurderDecay
@MurderMark
@NotoSend
@NPCAcceptItem
@NpcActCast
@NPCActFight
@NPCActFollow
@NPCAction
@NPCActWander
@NPCHearGreeting
@NPCHearUnknown
@NPCLookAtChar
@NPCLookAtItem
@NPCLostTeleport
@NPCRefuseItem
@NPCRestock
@NPCSeeNewPlayer
@NPCSeeWantItem
@NPCSpecialAction
@PartyDisband
@PartyInvite
@PartyLeave
@PartyRemove
@PayGold
@PersonalSpace
@PetDesert
@PickUp Ground
@PickUp Pack
@PickUp Self
@PickUp Stack
@PreStart
@Profile
@ReceiveItem
@Redeed
@RegenStat
@RegionEnter
@RegionLeave
@RegionResourceFound
@RegPeriodic
@Rename
@ResourceFound
@ResourceGather
@ResourceTest
@Resurrect
@SeeCrime
@SeeHidden
@SeeSnoop
@Select
@Select (Spell Trigger)
@Sell
@SkillAbort
@SkillChange
@SkillFail
@SkillGain
@SkillMakeItem
@SkillMenu
@SkillPreStart
@SkillSelect
@SkillStart
@SkillSuccess
@SkillUseQuick
@SkillWait
@Smelt
@SpellBook
@SpellCast
@SpellEffect
@SpellEffectAdd
@SpellEffectRemove
@SpellEffectTick
@SpellFail
@SpellSelect
@SpellSuccess
@SpellTargetCancel
@Start
@Start (Spell Trigger)
@StatChange
@Step
@StepStealth
@Success
@Success (Spell Trigger)
@TargOn Cancel
@TargOn Char
@TargOn Ground
@TargOn Item
@Timer
@ToggleFlying
@ToolTip
@TradeAccepted
@TradeClose
@TradeCreate
@UnEquip
@UseQuick
@UserBugReport
@UserChatButton
@UserExtCmd
@UserExWalkLimit
@UserGuildButton
@UserKRToolbar
@UserMailBag
@UserQuestArrowClick
@UserQuestButton
@UserSkills
@UserSpecialMove
@UserStats
@UserVirtue
@UserVirtueInvoke
@UserWarmode
@Wait
T
Tr:@EquipTest
(previous page) (
next page
)

--- PAGE BREAK ---

GM Commands
ADD # - GM & COUNSELOR Adds an item to the world.
If the itemnumber (#) is left out, a gump menu will be displayed with different menu options of what can be created. The current gump this command produces is limited. Item numbers are listed in the items.scp file. In X branch, the command accepts a second parameter to set the amount of the item about to be created.
.ADMIN - GM & COUNSELOR This will display a menu that allows you to do a variety of things without having to enter the commands by hand. Most of the commands listed below are included in this menu.
.ADDNPC # - GM Adds an NPC to the world. NOTE: This method of adding NPCs will result in an NPC which is not associated with a spawn point. The added NPC will respawn after death at the point of creation. The only way to remove an NPC created by this method is to .REMOVE it while it's alive.
.ALLMOVE - GM This makes it possible for the you to move items not normally movable, i.e. items whose properties have been set to make them non moveable.
.ALLCLIENTS - GM This command brings all clients to your location in the game. This is a dangerous command on large shards as it may crash clients in heavily populated servers when used.
Syntax: .SERV.ALLCLIENTS GO x
VERIFY: where x is the x,y,z location?
.ANIM # - GM & COUNSELOR Performs the selected (#) animation. Refer to Inside UO to see Animation Numbers.
.BANK
or
.BANK # - GM If no # is supplied, it opens the bankbox of the selected character. (A target cursor appears after the command is entered.)
For the # command, use 1A,1B or 1C for vendor storage areas. 1A is the main vendor stock. Items put in here are periodically restocked. Use the SETZ command to set the restock count. 1B is the area vendors store things they have bought from players. 1C is the list of items that vendors will buy from players but not actually stock.
.BANKSELF - GM This will open your personal bank box.
.BLOCKIP #.#.#.# - ADMIN Block an IP. Only blocks full IP's, not ranges See also: UNBLOCKIP
.CAST # - GM Attempts to cast spell #.
.CLOCK - ADMIN Displays timing/clock information. Usable for debugging.
.COLDCHANCE # - GM Set the % chance of snow in a 64x64 map tile area. Settings are saved in the worldfile.
.RAINCHANCE # - GM Set the % chance of rain a 64x64 map tile area. Settings are saved in the worldfile.
.CONTROL - GM Gain possession of the PC/NPC selected. WARNING: .CONTROL is very useful for on the fly quests, but be warned! Your original body will assume the characteristics (NPC BRAIN) of the new body you intend to inhabit. Your original body may wander off. To prevent this use the .set flags 4 command on your original body to keep it paralyzed while you inhabit the new body. If your old body was a ghost, the ghost is deleted. All newbie items are carried with you as you move. Create a newbie backpack inside your main pack and all items in the pack will be carried with you.
.CLIENTIS3D - ADMIN Returns 1 if client is 3D.
.CLIENTISENHANCED - ADMIN Returns 1 if client is enhanced.
.CLIENTISKR - ADMIN Returns 1 if client is Kingdom Reborn.
.CLIENTS - GM Lists all the clients currently connected to the server.
.xCRIMINAL - GM Sets a character as criminal, more useful when used in a script trigger.
Leave the x off if you wish yourself to be the target.
.DEBUG - GM Toggles debug mode of the invoking client. All objects look like visible worldgems. All creatures look like white humans and do not animate. all objects will appear at the same Z level as the viewer. This is a good way to remove a house or a ship, enter .DEBUG mode and .REMOVE the structure or ship object gem.
.DETAIL - GM & COUNSELOR Toggles detail level on system messages. Defaults to ON, and it gives you information when people log on and off the server.
.xDISCONNECT - GM Will disconnect a client character without blocking the account. Great for characters that are stuck in-game after a crash. Leaving off the x will disconnect your client.
.DRY - GM Turn off rain and snow in this quadrant of the world.
.DUPE - GM Duplicates the selected object.
.xEDIT - GM Allows you to edit the contents of any container, including NPC and Player Characters
.EXPORT- filename.scp <boolean> # ADMIN Exports the whole or a part of the world to a file.
Syntax: .EXPORT filename.scp exportchar pacesfromyou
Comment: exportchar is 1 or 0 ; pacesfromyou is # of paces.
Example: .EXPORT tailorshop.scp 1 10
.EXTRACT - filename ADMIN Extracts multi items out of the MULTI.MUL file.
Syntax: .EXTRACT multi.txt
Comment: This will create the multi.txt file, after which you need to edit the file and change the header
Sample Header: XXX template id change the XXX to 1 and import with /MULTI 1
.FIX - GM & COUNSELOR Attempt to set the Z coordinates after a teleport.
.FIXWEIGHT - GM Recalculates the weight of the selected character. For use when weight gets outside of normal range due to scripting errors or resync problems.
.xFLIP - GM & COUNSELOR Attempt to flip the item to it's directionally different equivalent. (ex. right and left handed stacks of hides or change the facing direction of a creature.), as allowed by the game art. This will rotate characters or corpses as well as change the shape of light sources. Not all settings for the flips are correct. If you find an error, please report it in our bug forum including the base ID of the flipped item.
.xFOLLOWED - GM Allows a GM to follow any targeted char. Toggle war mode to cancel
.x FORGIVE - GM & COUNSELOR Release someone who has been jailed using the /jail command. Leave off the X if you wish to target yourself
.GM - GM Toggle GM mode for testing as player. Also handy for wandering around incognito.
.GMPAGE - GM Enter a page request into the page que.
.GO X Y Z - GM & COUNSELOR Teleports to the selected X, Y, Z coordinates.
.GOCHAR # - GM & COUNSELOR Teleport to the selected (#) character. Good mostly for random player checking. If there are 5 characters in the game, valid values for # are 0, 1, 2, 3 or 4.
.GOCLI # - GM & COUNSELOR Teleport to the selected (#) client on the server. If there are 5 clients connected to the server, valid values for # are 0, 1, 2, 3 or 4.
.GOPLACE <string> - GM Teleport to the location, as named in SPHEREmap.scp. Town names are used as default. Example: .GOPLACE Yew
.GOSOCK # - GM & COUNSELOR Teleport to the client connected to the selected (#) socket. If there are 5 sockets in use, valid values for # are 0, 1, 2, 3 or 4. The socketcodes are obtained on the console or from the .CLIENTS list.
.GOUID # - GM & COUNSELOR Teleports to the selected (#) UID (gameobject). Every object in the game has a UID number as listed in the world file. Going to a key code (MORE) will allow you to locate to house, ship or container the key belongs to.
.HEARALL - GM Gives you the ability to hear all that is said in the world.
.HUNGRY - GM & COUNSELOR Reports your current hunger level.
.IMPORT #CHAR #RANGE ADMIN - Imports an area from another server's save file or from an UOX WSC-file.
Syntax: /IMPORT FILENAME .(WSC or SCP) #CHAR #RANGE
Some fields are lost during conversion of UOX files, type=x is sometimes not translated correctly. Remeber that the files to be imported must end with *.WSC or *.SCP.
CHAR - 1 = include characters in conversion, 0 = exclude characters.
RANGE - This is a distance limit from the current location to import.
.INFO - GM & COUNSELOR Brings up an in game dialog for viewing and modifying object attributes. A councilor may view, but not modify.
.INFORMATION - GM Displays information about the server.
.INVIS - GM This toggles the invisibility flag of the invoking client. When the invisibility flag is set, you will not show up on .CLIENTS or on tracking. You will however show up on the console Client list. You will produce no words of power when you cast a spell. You can talk normally.
.INVULNERABLE - GM This toggles the invulnerability flag of the invoking client. This command makes the invoker invulnerable. NPC's wont attack an invulnerable client (they aren't that stupid you know). When used on a regular player, the player cannot do harm or be harmed.
.xJAIL #
or
.xJAIL - GM & COUNSELOR Moves the selected player to a jail cell. Leave the x off if you wish yourself to be the target. Valid cell numbers are 1-10, if the number is left out, the selected player will be moved to jailcell number 10.
.xKICK - GM Kicks the selected player off the server.
.KILL - GM Kills the selected PC/NPC.
.LAST - GM & COUNSELOR When the client is in target mode (cursor), this command targets the invoking players last selected target. When a client creates an object or a npc, the npc/object is automatically set to last target. VERIFY: THIS FEATURE MAY HAVE BEEN REMOVED IN RECENT VERSIONS.
.LIGHT # - GM Sets light level for a 64x64 map tile area. It is saved in the world file.
The lightlevels (#) range from 1 (brightest) to 19 (darkest). In T2A light levels range from 1 - 30.
.LINK - GM Links two objects together. This command is most commonly used to link two doors in the same doorframe together so that with a single click they both open. This command may also be used to link a key to a door.
.LISTEN - GM See HEARALL.
.MOVE X,Y - GM Move your (or a target's) x or y position.
Example: .MOVE 0,10 will move your character 10 paces along the y axis (south)
.MOVE - 10,0 will move your character 10 paces along the x axis (east)
Use negative numbers for moving north and west.
.MULTI # - ADMIN Places a multi object into the world. The .MULTI command is used with the multi.txt file which lists large items made up of multiple images like the telescope or shrines.
.MUSIC # - GM & COUNSELOR Plays the music code supplied.
.NUDGEDOWN - GM Shift the Z level of an item down by one.
.NUDGEUP - GM Shift the Z level of an item up by one.
.NUKE - GM Deletes the items in a selected area. This is the opposite of the TILE command. When you invoke this command you will be prompted for two points (via targeting cursor) that should reflect the rectangle/square you want deleted. WARNING: If you are standing on the roof of a tower and delete a range of objects, all objects in all Z levels of the building will be deleted within the selected range.
.NUKECHAR - ADMIN Deletes the character(s) in a selected area. When you invoke this comment you will be prompted for two points (via targetingcursor) that should reflect the rectangle/square you want the NPC's deleted from. WARNING: If you are standing on the roof of a tower and delete a range of objects, all objects in all Z levels of the building will be deleted within the selected range.
.PAGE <letter> - GM & COUNSELOR Displays the GM page queue. The page command have several flags, below are listed the most common.
.PAGE D - Disposes the current page.
.PAGE L - Lists the page queue.
.PAGE O - Go to the Origin point of the page.
.PAGE P - Go to the current location of the calling Player.
.PAGE Q - Send page back to Queue.
.PAGE CURRENT or
.PAGE ? - Displays information about the Current selected page.
.PAGE K - .Kick the player who made the page. Only works if they are online.
.PAGE BAN - Ban the player who made the page and lock their account.
.PAGE JAIL - Send the calling player to jail. Only works if they are online.
.PAGE OFF - Turns of intrusive page notify messages.
.PAGE ON - Turns on intrusive page notify messages.
.PASSWORD - GM & COUNSELOR Changes your account password. This command clears your current password, you will then need to log out and log in using your new choice of password.
.PRIVSHOW - GM Turn on or off the privilege label showing on the paperdoll. For example GM Joe becomes simply Joe. The privs remain intact but players cannot see the GM tag.
.PRIVSET #
or
.SETPRIV # - ADMIN Sets a characters privilege level.
LEVEL 0 PLEVEL_Guest Restricted Guest Account, ie. can't PK
LEVEL1 PLEVEL_Player Player or NPC
LEVEL2 PLEVEL_Counsel Can travel (teleport)
LEVEL3 PLEVEL_Seer Can add items and NPC's but cannot directly affect players <<-- broken
LEVEL 4 PLEVEL_GM GM Command Clearance
LEVEL 5 PLEVEL_Dev Developement Clearence, not bothered by GM
LEVEL 6 PLEVEL_Admin Can Switch into and out of GM mode
.POLY #### - GM Polymorph into the selected NPC, by ID hex number
.PROPS- GM See INFO.
.RAIN - GM Make it rain in the immediate 64 x 64 map tile area of the world.
.RAINCHANCE # - GM Set the % chance of rain in a 64x64 map tile area. Settings are saved in the world file.
.REGION # <binary> - GM Change the default map settings for the area you are currently in. Options are defined on the SPHEREmap.scp file.
.REMOVE - GM Permanently remove the item or character from the game. This cannot be used on players. It will also remove all the contents of a container or corpse so be careful.
.REPAIR - GM Attempt to repair the selected item
.RESEND - GM & COUNSELOR Reload all objects and chars on screen for the client. Used to fix some sorts of display problems.
. RESPAWN - GM Respawns all dead monsters in the world, ahead of their regular schedule on the spawn bit timer.
.RESTOCK - GM Restocks the monster spawns and the vendors in the current quadrant of the world.
.RESTOCK ALL - GM Restocks the monster spawns and the vendors in the whole world.
.RESYNC - GM See RESEND.
.SAVE
or
.SAVE # - GM Force an immediate world save.
.SAVE - If background save is enabled, .SAVE 1 forces a fast foreground save .
.SELF - GM & COUNSELOR When the client is in target mode (cursor), this command targets the invoking player.
VERIFY: THIS FEATURE MAY HAVE BEEN REMOVED IN RECENT VERSIONS.
.SEND # - ADMIN Sends a string of bytes to the client. DANGEROUS! The # represents the string of bytes you want to send to the client.
.SET #PROP #VAL - GM Modify any property of an item or character. There are many many properties. This is probably the most useful in game command in the server. See the Properties explanation in the Customizing your SPHERE area of the SPHERE Support menu.
Syntax: /SET #PROP #VAL
PROP = The property to be changed.
VAL = The new value.
.SETZ - GM Sets the Z coordinate of the selected object. This is also used for setting the restock count for items in vendor vaults. See the BANK command for this.
.SHOW - GM Command to show specific properties that may or may not be listed in the .info dialogue.
.SFX # - GM Plays the selected sound code.
.SHRINK - GM Turns the selected creature into a TYPE_FIGURINE object. This does not work on players.
For further help on what this command actually does, summon a horse and use SHRINK on it, then play around with the figurine. If you want to turn it back into a real horse again, doubleclick the figurine.
.SERV.SHUTDOWN # - GM & COUNSELOR Shuts down the server in # minutes.
VERIFY .SHUTDOWN # or .SERV.SHUTDOWN #
.SNOW - GM Make it snow is in this quadrant of the world.
.SPLIT - GM Allows you to separate from your body to become a ghost. It leaves your current body behind as an NPC.
.STATIC - GM Sets the targeted item as unmovable. Also may be used instead of /ADD to add items preset to static.
.SUICIDE - GM & COUNSELOR Mostly used in triggers but may be used in game.
.SYNC - GM & COUNSELOR See .RESEND.
.SYSMESSAGE <text> - GM Sends a system message.
Example:
.SYSMESSAGE - This SPHERE is shutting down in 10 minutes.
.TELE - GM & COUNSELOR Teleport to selected location.
.TILE - GM Lay a blanket of tiles (objects) on the selected area and at the selected Z-coordinate.
Syntax: /TILE #Z #
The #Z is the height (Z-coordinate) at which height you want your area fill to appear. The item number (#) is what item from the SPHEREITEM.SCP file you want the area filled with. When you invoke this comment you will be prompted for two points (via targeting cursor) that should reflect the rectangle/square you want filled.
.TWEAK - GM See .INFO.
.TYPEDEF - GM This will allow access to the base class information like SELLVALUE and BUYVALUE. This information will not be saved as it exists only in the SPHEREITEM.SCP file but it will allow you to play with this a bit.
.UNBLOCKIP ADMIN - Unblock the IP that was previously blocked See also: BLOCKIP
VERIFY USAGE: .UNBLOCKIP #.#.#.#
.UNDERWEAR - GM & COUNSELOR For removing the default underwear from PC and NPC chars.
.VERSION - GM Displays current server version.
.WEBLINK - GM Launches your system's browser and loads the SPHERE page.
.WHERE - GM & COUNSELOR This command tells you your current X Y and Z coordinates in the world.
.XGO - GM Teleports a PC/NPC or an object to the selected coordinates.
Syntax: .GO #X #Y #Z

--- PAGE BREAK ---

Help
Available languages
Missing languages
Have you ever wondered why your handmade set of platemail where each part has an AR value of "40" only gives you an overall armor rating of "36"? Well, here is the answer.
Sphere follows OSI's armor rating system. That means, that each armor part will show you an AR value what it will give you if you wear a complete set of armor where each part has this AR value. Depending on what body parts a selected armor part is covering it adds a procentual share to the overall armor.
Furthermore, armor pieces theoretically can be stacked. So a platemail chest covers chest and back, and a cloak covers the chest. But that does not mean that your back now is double protected: Like on OSI, Sphere only uses the covering part with the highest AR property. Therefore, if you wear a chain tunic under your plate, id adds to weight, but not to your character's AR.
Body parts and Percents
15 percent from    ARMOR_HEAD
7 percent from    ARMOR_NECK
5 percent from    ARMOR_BACK
25 percent from    ARMOR_CHEST
14 percent from    ARMOR_ARMS
7 percent from    ARMOR_HANDS
22 percent from    ARMOR_LEGS
5 percent from    ARMOR_FEET
What layer covers what?
LAYER_HELM                                                         gives ARMOR_HEAD
LAYER_COLLAR                                                       gives ARMOR_NECK
LAYER_SHIRT, LAYER_CHEST, LAYER_TUNIC, LAYER_CAPE, LAYER_ROBE      gives ARMOR_BACK
LAYER_SHIRT, LAYER_CHEST, LAYER_TUNIC, LAYER_ROBE                  gives ARMOR_CHEST
LAYER_ARMS, LAYER_CAPE, LAYER_ROBE                                 gives ARMOR_ARMS
LAYER_GLOVES                                                       gives ARMOR_HANDS
LAYER_PANTS, LAYER_SKIRT, LAYER_HALF_APRON, LAYER_ROBE, LAYER_LEGS gives ARMOR_LEGS
LAYER_SHOES, LAYER_LEGS                                            gives ARMOR_FEET
Or, if you're preferring it the other way around:
A helmet, hat ect. will only cover the head, thus adding 10 percent to the total AR.
A gorget, but also a necklace will cover the neck, adding 5 percent to total AR.
A shirt (LAYER_SHIRT) can cover the back and the chest, adding up to 40 percent of total AR.
Items on LAYER_CHEST and LAYER_TUNIC behave like LAYER_SHIRT.
A cape may cover the back and the arms, adding up to 20 percent to total AR.
A robe may cover back, chest, arms and legs, adding up to 70 percent to total AR.
Armwear (LAYER_ARMS) only covers the arms, thus adding 10 percent to total AR.
Gloves and gauntlets are covering the hands, adding 10 percent.
LAYER_PANTS, LAYER_SKIRT, LAYER_HALF_APRON are covering the legs (20 percent of total AR).
LAYER_LEGS (like plate legs) and LAYER_SHOES are covering the feet (5 percent of total AR)
Do not forget that multiple coverings will _not_ stack; only the item with the highest AR property will be taken into account!
If you prefer it all in a combined table:
Hit Zones
head
throat
chest
back
arms
hands
legs
feet
layer
10%
5%
30%
10%
10%
10%
20%
5%
total
helm
X
-
-
-
-
-
-
-
10%
collar
-
X
-
-
-
-
-
-
5%
shirt
-
-
X
X
-
-
-
-
40%
chest
-
-
X
X
-
-
-
-
40%
tunic
-
-
X
X
-
-
-
-
40%
cape
-
-
-
X
X
-
-
-
20%
robe
-
-
X
X
X
-
X
-
70%
arms
-
-
-
-
X
-
-
-
10%
gloves
-
-
-
-
-
X
-
-
10%
pants
-
-
-
-
-
-
X
-
20%
skirt
-
-
-
-
-
-
X
-
20%
half apron
-
-
-
-
-
-
X
-
20%
legs
-
-
-
-
-
-
X
X
25%
shoes
-
-
-
-
-
-
-
X
5%

--- PAGE BREAK ---

Help
Available languages
Missing languages
2D/3D Client Updates
Client Patch 5.0.8.1
On Monday, February 12, 2007 at 1:00PM PST (January 31 9:00PM GMT), we will deploy Client Patch 5.0.8.1
Added live event content
Winter is ending, and the spring rains have begun!  The snow has melted and should no longer display on the ground, trees, or radar.
Areas which have had falling snow will have falling rain instead
Client Patch 5.0.8.2
On Tuesday, February 13, 2007 at 5:00PM PST (February 14 1:00AM GMT), we will deploy Client Patch 5.0.8.2
Fixed display issue with Rose in the 3d client
Client Patch 5.0.8.3
On Tuesday, March 20, 2007 at 5:00PM PDT (March 21 1:00AM GMT), we will deploy Client Patch 5.0.8.3
Added Event Content
Client Patch 5.0.8.4
On Tuesday, March 20, 2007 at 11:00PM PDT (March 21 7:00AM GMT), we will deploy Client Patch 5.0.8.4
Fixed issue with Heartwood not displaying
Client Patch 5.0.9.0
On Friday, March 23, 2007 at 12:00PM PDT (March 23 8:00PM GMT), we will deploy Client Patch 5.0.9.0. This is a MANDATORY patch.
Fixed a cliloc error with stockings
Fixed a cliloc error displayed when trying to log in with a blocked account
Additional technical changes
Client Patch 6.0.1.1
02 May 2007 20:09:38 EST
We have deployed client patch 6.0.1.1 - this client patch will require a server publish for all the fixes to be visible.
Fixed many world art issues
Fixed entrance blocking issue with the Shadowlord base
Potential fix for Win98 and ME users' "out of memory" issue
Client Patch 6.0.1.2
08 May 2007 15:35:36 EST
At 12:00PM PDT (7PM GMT) on Tuesday, May 8, we will be deploying client patch 6.0.1.2.
Updated clilocs (NOTE!  Some ninjitsu spells will appear to have changed requirements- the actual changes will not occur until the server is updated.)
Many map and world art fixes
Further Windows 98 optimizations
Client Patch 6.0.1.3
17 May 2007 20:14:10 EST
At 4:30PM PDT (11:30PM GMT) on Thursday May 17th we will be deploying client patch 6.0.1.3:
Updated clilocs
Many map and world art fixes
2D Client Patch 6.0.1.5
22 Jun 2007 19:45:05 EST
The following 2D Client patch (6.0.1.5) will be deployed at 4:00PM PDT (11:00PM GMT) on Friday, June 22:
Added live event content
Fixed bug with certain gates in custom houses that became impassable
2D Client Patch 6.0.1.6
27 Jun 2007 18:14:40 EST
Beginning between 6:00PM and 8:00PM PDT on June 27 (June 28 1:00AM-3:00AM GMT) the 2D client will be patched to version 6.0.1.6, which include the following changes:
Updated clilocs
Added live event content
2D Client Patch 6.0.1.8
23 Jul 2007 15:36:36 EST
At 11:30AM PDT (6:30PM GMT) on Monday, July 23, 2D client patch vers 6.0.1.8 will be deployed. This patch contains the following changes:
Version number change
2D Client vers. 6.0.1.9
26 Jul 2007 18:22:28 EST
At 2:00PM PDT (9:00PM GMT) on Thursday, July 26, 2D client version number 6.0.1.9 was deployed:
Polished Destard, Deceit, Paroxymus
2D Client vers. 6.0.1.10
06 Aug 2007 18:45:49 EST
At 2:30PM PDT (9:30PM GMT) on Monday, August 6, the 2D client will be updated to version 6.0.1.10. Notes after the jump:
Map file changes for compatibility
2D Client vers. 6.0.2.0
28 Aug 2007 18:45:55 EST
At 2:30PM PDT (9:30PM GMT) on Tuesday, August 28, the 2D client will be updated to version 6.0.2.0 Notes after the jump:
Clilocs have been updated
Unused tiles in some caves have been fixed
2D Client vers. 6.0.3.0
20 Sep 2007 17:32:12 EST
At 1pm PDT (8PM GMT) on Thursday, Sept. 20, the 2D client will be updated to version 6.0.3.0. Notes after the jump:
Added art for new items
updated clilocs
2D Client vers. 6.0.3.1
25 Sep 2007 14:32:39 EST
At 10:30AM PDT, the 2D client will be updated to version 6.0.3.1, which contains the following:
Fixed unused tiles in front of dungeons
2D Client vers. 6.0.4.0
18 Oct 2007 16:16:36 EST
At 1:00PM PDT (8:00PM GMT) on Thursday, October 18, the 2D client will be updated to version 6.0.4.0 Notes after the jump:
Updated Magincia tiles to be vulnerable to the rage of Daemons
2D Client vers. 6.0.5.0
20 Nov 2007 18:13:42 EST
At 3:15PM PST (11:15PM GMT) on Tuesday, November 20, the 2D client will be updated to version 6.0.5.0 Notes after the jump:
Updated clilocs
Added decoration in many areas, including the Doom Gauntlet and Serpent's Hold
2D Client vers. 6.0.6.0
07 Feb 2008 17:30:51 EST
At 5:30PM EST (10:30PM GMT) the 2D client will be updated to version 6.0.6.0. Notes after the jump:
Added live event content
Added worldbuilding updates to New Haven moongate
Updated clilocs
2D Client vers. 6.0.6.1
19 Feb 2008 13:26:35 EST
At 1:30PM EST (6:30PM GMT) the 2D client will be updated to version 6.0.6.1. Notes after the jump:
Fixed an issue that could cause rubberbanding and/or movement lag
2D Client vers. 6.0.6.2
20 Mar 2008 15:19:21 EST
At 4:30PM EDT the 2D client will be updated to version 6.0.6.2. Notes after the jump:
Fixed several areas where players might get stuck
Fixed a client crash
Removed the "2d/3d" client picker
KR Client Updates
KR Client Patch 2.47.1.5
18 Oct 2007 16:48:53 EST
Fixed an issue with flying creatures' movement animations
Players can now target items on ther hotbars, provided the item is in their backpack or equipped.
Using recall in your hot bar will not bring up a cursor if you have something targeted
Fixed a crash when mousing over UI
Client will timeout and disconnect properly when inactive for 10-15 minutes
Now item properties will have each word's first letter capitalized for easier reading
Fixed a bug with the theme music when logging in and out multiple times
Fixed a crash when exiting the game while customizing a house.
Items that are too heavy to pick up should no longer highlight or put up a properties box when moused over.
Can't start to move unmovable things anymore (things too far away or too heavy)
Item properties windows will now hue the strength requirement line red if you don't meet the strength requirement, just like they do in 2d.
Fixed a bug with input being sent incorrectly when the KR window loses focus
Players can now sort the shard list by the percent full that each shard is. More populated shards will be at the top. Test center and other language shards appear lower on the list due to other sorting effects that are happening. Also adds highlighting to selectable text on the shard list, in addition to reformatting the layout slightly.
Foliage should fade more intelligently as players walk under trees
Cursor hand should be silver in Felucca, gold in Trammel
Mouse now always points to "west" direction when it is over a window. This "west" direction is in-game "west" direction, not the screen's west direction.
Resource targeting macros are not depleting the veins.
Fixed a bug where the Help buttons in japanese mode pointed to US CS pages
Items should no longer get shuffled around when you cross server lines
Players will now no longer have the two party related context menu items in their context menu until they have accepted the invite to join a party.
The word "CONTINUE" was being cut off on a button on the release pet confirmation gump. The button label has now been changed to use the word "OKAY" instead.
It is now a lot easier to drop things on the ground.
Buttons on user waypoint gumps now stay inside their gump when language is set to Japanese.
Male's Jester tunic uses the correct art, and the in-game colors should be closer to paper doll's.
Fixed issue with system slowness related to the chat window
KR Client Patch 2.47.1.10
06 Nov 2007 16:52:36 EST
Fixed a bug with moving and looting heavy items from containers and backpacks.
KR Client Patch 2.48.0.3
20 Nov 2007 18:13:22 EST
New Features:
Legacy Art Mode - enable this in Options: User Settings: Graphics, then restart the client to enable
Fully Moddable UI
Substantial number of client optimizations - should run much smoother now
Improved the guild ui
Added legacy container art - enable this in Options: User Settings: Graphics (no restart needed for this one)
Fixed a number of windows that weren't updating properly, ncluding party window, pet window, draggable health bars, and more
The item properties "blessed" "blessed for playername" and "insured for playername" are now colored blue for increased visibility
"Macros" and "Actions" are two separate items on the main menu
Improved the layout of the veteran rewards window
Improved the animal lore window
Polished spellbook window
Polished char creation window
Improved npc vendor window
Empty slots on the paperdoll now have a tooltip telling you what goes in it
Removed the "add by ID" option in the friends list (since there's no way to find an ID, it was not usable)
Improved the art and functionality of the party window
Added a line to specify what the target is in the tooltip for a hotbar slot
Chat Improvements:
The default chat config now only has one tab with all chat in it.
Added a "reset chat to default" option in settings
Added /r or /reply command to automatically reply to the last person to send you a /tell
/tell now requires a comma after the player name (it will also handle multi-word names)
Shift-left clicking on a line of chat will copy it to the clipboard
Party, guild, alliance and faction messages will not show as overhead text
The chat context menus now has a color selection option for text color, overhead chat color, and chat window background color
Map Improvements:
Added a settings:interface item to reset map icons to default
Added 40 new icons for waypoints
Waypoint icons on the map will show sextant coordinates when you mouse over them
UI Improvements and Fixes:
You can now target a player or creature by clicking the name over their head
Added a user settings option to use the mouse wheel for targeting - can choose target friendly or target enemy
Added stat hotbar icons - you can drag off icons from the stats window to your hotbar, where it will display the number of your stat.  (mouseover the icon for the name of the stat)
Health, mana, and stamina stat icons will change when their value is under 10 - the weight icon will glow when you approach your weight limit
Added dual monitor support - the kr window can now be stretched across two monitors
Static objects (trees, etc) will now display their name when you click on them
If you have your bandages in your hotbar, a timer will count down when you use them, telling you how long it will be until the bandage is applied
Fixed a few bugs with tree foliage not fading correctly
When you drag a stack of items, the number of items will automatically be selected
Skill icons in your hotbar will now show your skill points in their tooltip
Made toggle UI, screenshot, toggle circle of transparency, reload ui all configurable keybindings
Turn off hotbar page flipping if legacy chat is enabled (use shift 0-9 to change hotbars in legacy mode)
Players can now target items on ther hotbars, provided the item is in their backpack or equiped.
Added a default targeting for spells, different spells now have a different default target instead of defaulting always to current target.
Many macros can now be interrupted by the ESC key
General Fixes and Improvements:
Added decoration in many areas, including the doom gauntlet and serpent's hold
Shortened the hiryu's tail
Made giant beetle's beak shorter
Made ostards' tails shorter
Tweaked and added a number of creature graphics and animations
The skills available in Character Creation now match 2d
Items behind other items should be easier to select in freeform view
Tweaked appearance of trees to make them blend with the background less
KR Client Patch 2.48.0.7
21 Nov 2007 17:02:49 EST
Fixed problem with client loading in fullscreen mode
Fixed issue with no sounds playing
Fixed issue with legacy container art not displaying for Armoires
Fixed spelling of "Holiday Stocking" legacy container
KR Client Patch 2.50.0.3
07 Feb 2008 18:12:35 EST
KR: Removed clouds from the daytime display
Various localization updates for text
Default tab name is now Chat instead of System
Fixed hueing in the Paperdoll
Treasure maps fixed
KR: Shopkeeper window revamped. Now supports click and holding on + or -
Many broken animations fixed
KR Client Patch 2.51.0.3
20 Mar 2008 15:20:28 EST
Fixed a number of stuck areas
Fixed various incorrect tiles

--- PAGE BREAK ---

0r, st00pid th1ngs n00bs d0?!?!?!/1/1/1
By Taran
Contents
1
CHARDEF blocks must use a number
2
Bodies and colors revert upon death
3
IF does not require an ENDIF
4
SRC is required in functions
CHARDEF blocks must use a number
This is simply not true, and certainly not recommended. I highly recommend that scripters use a DEFNAME instead of a new number. For example, instead of this:
[CHARDEF 04000]
DEFNAME=c_scary_man
ID=c_man
...
You can just as easily do this:
[CHARDEF c_scary_man]
ID=c_man    // 0190 would work here just as easily, since c_man = 0190
...
So, you see, you can simply including a DEFNAME in the definition for the creature. SPHERE will assign it some sort of internal number. You don't want to worry about that sort of thing. If you REALLY want to see what the number is, you can always use the following function:
[FUNCTION examine_id]
// Usage: examine_id <id_to_examine>
// Example: examine_id c_man
SYSMESSAGE <EVAL <ARGS>>
But then again, why would you want to? The entire idea behind the DEFNAME feature is that there is no need for you to memorize those scary numbers. Remember
Chapter 1
?  :)
Bodies and colors revert upon death
This is an easy one. Simply set OBODY and OSKIN along with BODY and COLOR. The player will assume his OBODY/OSKIN upon resurrection.
IF does not require an ENDIF
All IF blocks require an ENDIF. At best, they won't work correctly. At worst, they won't work at all. Let's look at an example:
[FUNCTION superdude]
IF ( <STR> < 100 )
    STR = <EVAL <STR> + 2000>
    IF ( <DEX> < 100 )
        DEX = <EVAL <DEX> + 2000>
        IF ( <INT> < 100 )
            INT = <EVAL <INT> + 2000>
As you can see, this is a rather silly function which does nothing except set a player's strength, dexterity, and intelligence up by 2000 points. The idea is that a stat is only modified if that stat is below 100. Can anyone spot the error? Let's see how SPHERE reads this script. This is why it's good to indent your scripts anyway:
[FUNCTION superdude]
IF ( <STR> < 100 )
    STR = <EVAL <STR> + 2000>
    IF ( <DEX> < 100 )
        DEX = <EVAL <DEX> + 2000>
        IF ( <INT> < 100 )
            INT = <EVAL <INT> + 2000>
        ENDIF
    ENDIF
ENDIF
This is definitely NOT the result we wanted. As you can see, we could fix this by simply adding ENDIF statements to the original function.
[FUNCTION superdude]
IF ( <STR> < 100 )
    STR = <EVAL <STR> + 2000>
ENDIF
IF ( <DEX> < 100 )
    DEX = <EVAL <DEX> + 2000>
ENDIF
IF ( <INT> < 100 )
    INT = <EVAL <INT> + 2000>
ENDIF
SRC is required in functions
Absolutely NOT! In fact, it's probably a bad idea to use the SRC reference in a function unless you're absolutely sure that you want to reference the SRC all of the time. Example time! We'll make a function that damages the SRC:
[FUNCTION fire_damage]
// The purpose of this function is to cause damage
// along with a spectacular flamestrike effect
SRC.EFFECT 3,i_fx_fire_column,1,16,0
SRC.DAMAGE <EVAL {20 25}>
So what's wrong with this? If we use it by saying SRC.FIRE_DAMAGE, there is absolutely nothing wrong with it! However, what if we want to use this function on someone other than the SRC? Let's say we make a cursed shield that damages its bearer after a certain timer. Our @Timer event might look something like this:
ON=@Timer
    CONT.FIRE_DAMAGE // Call the function on the CONT
    RETURN 1 // Don't let the item decay
What happens now? Well, when we execute the FIRE_DAMAGE function on an object, that object (CONT in this case) becomes the default object inside of the function. That is, it's the item we refer to without any sort of object reference. (Like <STR> or <RESTEST 10 i_gold>, instead of <SRC.STR> or <CONT.RESTEST 10 i_gold>.) However, inside of the function, we're doing all of the damage and pretty effects to the SRC object. We're in an @Timer event. Can anyone tell me the cardinal rule of @Timer events? That's right. There is no SRC object. And what if we were in another event which has a SRC, but that SRC object was not the player we wanted to affect? As you can see, it's much better to remove SRC from functions unless it's absolutely necessary. Here's our new and improved function:
[FUNCTION fire_damage]
// The purpose of this function is to cause damage
// along with a spectacular flamestrike effect
EFFECT 3,i_fx_fire_column,1,16,0
DAMAGE <EVAL {20 25}>
We've removed all references to SRC from the function. Therefore, we can call this using ANY object reference we want, including the example above with CONT. There is one more thing to consider when doing anything of this nature. One of the functions we call inside of our fire_damage function depends on a SRC in its default state. Yes, it's the DAMAGE function. See the
Reference Compendium
for information about how you might solve that problem.
I've been mentioning cases when SRC may be required in a function. I can only think of one where it's absolutely necessary, and one where it might be useful. Can you figure out what they are? Well, too late if you didn't:
When you call an in-game function, SRC is always the person who called the function and the default object is the object you executed it on. For example, if you type .FIRE_DAMAGE, you will be executing the function on yourself, so you will be both the SRC and the default object. However, if you type .xFIRE_DAMAGE and target someone, you will be the SRC and that person will be the default object.
When you are absolutely certain that you want to reference the SRC in a function. I don't know when this might be, but you might find it necessary.

--- PAGE BREAK ---

An object property is a more advanced way of setting or retrieving a tag from an object. This advanced method uses a single function to replace the step of setting the tag's value and the step of getting the tag's value. Object properties also allow other events to occur each time the tag is set or retrieved without the need for repetitive code.
Example
Whenever a player kills a creature, they gain a certain amount of gold. Gold is stored as a tag. Whenever a player's gold tag is set, we also need to update a global gold variable.
[FUNCTION gold]
IF !(<ISEMPTY <ARGS>>)
    // The function was passed arguments; therefore,
    // the player's gold is increased by the passed amount.
    // The global gold count is also increased at the same
    // time, eliminating the need for repetitive code.
    TAG0.GOLD += <ARGS>
    VAR0.TOTAL_GOLD += <ARGS>
ELSE
    // There were no arguments which means that the amount
    // of gold is being referenced.
    RETURN <dTAG0.GOLD>
ENDIF
Demonstration of what the code does:
VAR.TOTAL_GOLD = 5000
// var.total_gold is now: 5,000
SRC.GOLD += 5000
// tag.gold is now: 5,000
// var.total_gold is now: 10,000
LOCAL.X = <SRC.GOLD>
// local.x is now: 5,000
SRC.GOLD -= 2000
// tag.gold is now: 3,000
// var.total_gold is now: 8,000

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Exit Codes
2
Garbage Collection
Exit Codes
When Sphere closes, an 'exit code' will normally be shown in the console to describe why it is being shut down. In general, an exit code less than 0 is considered to be an error code, and values above 0 are normal shutdown codes. In most cases, a more descriptive error will be shown in the console and/or log file to help better diagnose the reason behind error codes.
The following table lists all of the current codes and their meanings.
Code
Description
-10
Unexpected error occurred
-9
Failed to bind server port
-8
Failed to load world save(s)
-3
Failed to load server settings (script, ini, mul files)
or
did not write AGREE=1 in the sphere.ini
-1
Shutdown via commandline (/?, /T and /Q switches)
1
X in console
or
SIGHUP signal, terminal closed (Linux Only)
2
SHUTDOWN command
4
Service shutdown
(Windows Only)
5
Console window closed
(Windows Only)
6
SIGABRT signal, process aborted
(Linux Only)
Garbage Collection
The purpose of garbage collection is to validate all of the server objects and free up unused UIDs. Garbage collection is initiated:
After the world save is loaded at startup.
Before a world save begins, if the
FORCEGARBAGECOLLECT
setting is enabled in Sphere.ini.
After the
IMPORT
or
RESTORE
functions have been used on the
server
object.
When the 'G' command is entered via the Sphere console
When the
GARBAGE
function is used on the
server
object.
When garbage collection encounters a problem with an object it may attempt to automatically correct the error, otherwise the object will be removed. When an object is removed by garbage collection there will normally be an error shown in the console describing the item that was removed along with the reason. The following table lists all of the garbage collection codes along with their description:
Code
Message
Description
1102
Disconnected charr not acting as such
A character has been marked disconnected from the world, but it is not listed in the sector's disconnected character's list.
*
1103
Ridden NPC not acting as such
An NPC has the
statf_ridden
flag set, but does not have its
ACTION
property set to 111.
1104
Ridden NPC without a mount item
An NPC has the
statf_ridden
flag set, but its
ACTARG1
property isn't set to the
UID
of an item whose
TYPE
property is set to
t_figurine
or
t_eq_horse
.
1105
Ridden NPC with a mislinked mount item
An NPC has the
statf_ridden
flag set, but its
ACTARG1
property isn't set to the
UID
of an item whose
MORE2
property matches the NPC's
UID
.
1106
Disconnected NPC neither dead nor ridden
An NPC has been disconnected from the world, but does not have either one of the
statf_ridden
or
statf_dead
flags set.
1107
In game char that is neither a player nor an NPC
A character is not a player or an NPC.
*
1108
Char not on a valid position
A character's
position
is outside of the map boundaries.
1203
Ridden NPC not acting as such
Same as 1103.
1204
Ridden NPC without a mount item
Same as 1104.
1205
In game char that is neither a player nor an NPC
Same as 1107.
2102
Item without ITEMDEF
An item does not have an
ITEMDEF
section.
*
2103
Item ITEMDEF with ID = 0
An item's
ITEMDEF
has an
ID
of zero.
*
2104
Disconnected item
An item has been marked as disconnected from the world.
*
2105
Item not on a valid position
An item is not in a container and its
position
is outside of the map boundaries.
2106
Item flagged as being in a container but it isn't
An item is flagged as not being top level, but it does not have a container.
2202
Item flagged as equipped but it isn't
An item is flagged as being equipped, but its parent is not a character.
2205
Mislinked item
An item's
LINK
property matches its
UID
, or has been set to a
UID
that doesn't exist.
2206
Gm Robe / Deathshroud not on a char
A GM robe or death shroud (
ID
of 0204E or 0204F) is not equipped to a character.
2207
Deathshroud not on a dead char
A death shroud (
ID
of 0204F) is equipped to a character without the
statf_dead
flag set.
2208
Gm Robe on a char without privilege
A GM robe (
ID
of 0204E) is equipped to a character whose
PLEVEL
is less than 2.
2220
Trade window memory not equipped in the correct layer
A
t_eq_trade window
item type is not equipped, has its
LAYER
property set to something other than
layer_none
, or is equipped to an NPC.
2221
Client linger memory not equipped in the correct layer
A
t_eq_client_linger
item type is not equipped, has its
LAYER
property set to something other than
layer_flag_clientlinger
, or is equipped to an NPC.
2222
Memory not equipped / not in the memory layer / without color
A memory item (
ID
of 02007) is not equipped, or a non-memory item has had its
TYPE
set to
t_eq_memory_obj
after creation.
2226
Mount memory not equipped in the correct layer
A
t_eq_horse
item type is not equipped, or has its
LAYER
property set to something other than
layer_horse
.
2227
Hair/Beard item not equipped / not in a corpse / not in a vendor box
A
t_hair
or
t_beard
item type that isn't equipped, is either not in a container or its container has an
ID
other than 02006 or 02AF8.
2228
Hair/Beard item not equipped / not in a corpse / not in a vendor box
A
t_hair
or
t_beard
item is equipped, but has its
LAYER
property set to something other than
layer_hair
or
layer_beard
.
2229
Game piece not in a game board
A
t_game_piece
item has been found outside of a container.
2230
Item equipped in the trade window layer but it isn't a trade window
An equipped item has been found with its
LAYER
property set to
layer_none
, but its
type
is not
t_eq_trade_window
.
2231
Item equipped in the memory layer but it isn't a memory
An equipped item has been found with its
LAYER
property set to
layer_special
, but its
type
is not
t_eq_memory_obj
or
t_eq_script
.
2233
Item equipped in the mount memory layer but it isn't a mount memory
An equipped item has been found with its
LAYER
property set to
layer_horse
, but its
type
is not
t_eq_horse
.
2234
Item equipped in the client linger layer but it isn't a client linger memory
An equipped item has been found with its
LAYER
property set to
layer_flag_clientlinger
, but its
type
is not
t_eq_client_linger
.
2235
Item equipped in the murder memory layer but it isn't a murder memory
An equipped item has been found with its
LAYER
property set to
layer_flag_murders
, but the character is an NPC or the player has its
KILLS
property set to 0.
2236
Item flagged as decay but without timer set
A top-level item has the
attr_decay
flag set, but its
TIMER
property has not been set.
3101
Object is totaly lost, no parent exists
An object has no parent.
*
3102
Object was deleted or UID is incorrect
An object does not have a valid
UID
.
*
3201
Object not correctly loaded by server (UID conflict)
More than one object has the same
UID
value.
*
4222
Memory not equipped / not in the memory layer / without color
A memory item is not flagged as equipped, has its
LAYER
property set to something other than
layer_special
, or has its
COLOR
property set to 0.
4223
Memory not on a char
A memory item is flagged as equipped, but it's
parent
is not a character.
4224
Stone/Guild memory mislinked
A memory item's
COLOR
property has one of the
memory_guild
or
memory_town
flags set, but the
LINK
property is not set to the
UID
of a guild or town stone.
4225
Stone/Guild memory linked to the wrong stone
A memory item's
COLOR
property has one of the
memory_guild
or
memory_town
flags set, but the character the memory is equipped to is not a member of the guild or town.
7101
Object's UID does not match up with server's UID table.
An object does not have the expected
UID
value.
*
7102
Object does not exist.
An object does not exist.
*
FFFF
Bad memory allocation
An exception was thrown whilst checking the object's validity.
*
Note
:
Garbage collection codes marked with * generally indicate a serious error within an object's internal state and should not normally be seen. If you are experiencing and are able to reliably reproduce any such errors then please report the details to the
bug tracker
.

--- PAGE BREAK ---

Currently Sphere .56b has a built in experience system, and of course it's designed in a way so that you can intercept it at any stage to implement your own code.
About how to activate and configure the experience and level system you'll find further information
here
and
here.
But at least you should know what amount of experience the system will give to your characters on what occasions.
Currently you can only get EXP by slaying NPC or PC, or by crafting valuable items:
Experience in Combat
You will get NO experience by killing a summoned creatures.
You will get NO experience if your pet did the kill.
You will get NO experience if you kill a guildmate.
You will get between 1 and 20 percent of your enemy's EXP as experience; if you're a newbie fighting a very experienced enemy with success, you'll gain much more EXP than he would gain if he slays you.
If there are more but one persons involved in the fight, everyone gets a share.
Even monsters gain EXP while killing enemies. So finally killing a daemon who already killed dozens of players will give you more EXP than killing a "newbie daemon".
If you've activated Sphere's level system the level difference between you and your victim will also influence the amount of EXP you'll gain.
If activated in sphere.ini you may loose 10 percent of your total experience if you die.
If not set explicitely set by script, monsters' EXP are calculated from the NPC's STR, INT and DEX, its best fighting skill, the remaining fighting skill, peacemaking, provocation, magery, taming, its base defense and attack damage values. Just to give a relation: An orc will have approx. 650 EXP, a daemon will have approx. 7 times the EXP of an orc.
Experience in Crafting
You will only get EXP by crafting items that have a value.
You will gain approximately 1 percent of the value of an item as EXP.
Levelling
If activated in Sphere.ini (
LevelSystem=1
) all characters will gain levels related to the amount of EXP they get.
Set "NExtLevelAt" to the amount of EXP that is needed to raise a character from level 0 to level 1.
If "LevelMode=0", characters will gain a new level each time they receive LevelNextAt EXP.
If "LevelMode=1", characters will need an increasing number of EXP points to gain at each level.
Levelling only means that the LEVEL property rises. It also means that the EXP _given_ by a slain character will grow with its LEVEL, and that the EXP the killer receives will go down with
his
LEVEL.
The following table shows the different in EXP requirements for the two different levelling modes:
LEVEL
(LevelNextAt=1000)
EXP Needed
(LevelMode=0)
EXP Needed
(LevelMode=1)
1
1000
1000
2
2000
3000
3
3000
6000
4
4000
10000
5
5000
15000

--- PAGE BREAK ---

Help
Available languages
Missing languages
The following diagram shows when combat triggers are triggered. See the
Triggers
page for more information on each trigger.
@HitTry
(attacker)
/           \
@Hit
(attacker)
@HitMiss
(attacker)
|
@Damage
(weapon)
|
@HitParry
(victim)
|
@GetHit
(victim)
|
@Damage
(armor)
Thanks to Moe for posting this.
NOTE: HITCHECK was added too. page need to be create

--- PAGE BREAK ---

Occam's Razor
By Taran
Occam's Razor is a philosophical precept first stated by the controversial but brilliant philosopher and monk William of Occam (or Ockham) during the 14th century. It is widely used in scientific investigation and philosophical debate. It has also taken a number of forms over the years.
The most commonly used form is, "All things being equal, the simplest explanation is to be preferred." It does not mean that the simplest explanation is correct, merely preferred. More experimentation and proof is necessary to demonstrate the correctness of the more complex explanation, but it does happen. In physics, Newton's theory of motion (F=ma) is far simpler than Einstein's more complex, but more correct, theory of relativity.
However, this is not the way in which the original statement was written by William. In Latin, he wrote, "Pluralitas non est ponenda sine neccesitate." This is translated literally as "Plurality should not be posited without necessity," or sometimes as "Entities should not be multiplied unnecessarily." It is this last translation we shall be examining as it applies to scripting and to programming in general.
In the case of SPHERE, the entities are the aspects of your script. They include the variables, methods, and tricks you use to accomplish your goal. Occam's Razor suggests that you should not use any more of these entities than you absolutely need to use. Unfortunately, many beginning scripters who haven't realized how much you can really do with the UO scripting language will try to multiply these entities without any need to do so.
I was talking to a scripter last night on ICQ, when he asked me about a script which looked something like the following:
[ITEMDEF i_first_item]
ID=i_something

ON=@DClick
    // If we've already used the item, don't
    // let them use it again until their
    // timer expires.
    IF (<SRC.TAG0.USEDONCE> == 1)
        SRC.SYSMESSAGE You already used this item once.
        RETURN 1
    ELSE
        SRC.SYSMESSAGE You equip the time
        SERV.NEWITEM i_timer_item
        NEW.EQUIP
        SRC.TAG.USEDONCE = 1
        RETURN 1
    ENDIF
    RETURN 1
    
[ITEMDEF i_timer_item]
ID=i_memory
TYPE=t_eq_script

ON=@Create
    TIMER = some_number
    
ON=@Timer
    CONT.SYSMESSAGE Your timer has expired!
    // Do some stuff here
    CONT.TAG.USEDONCE = 0
    REMOVE
    RETURN 1
The violation of Occam's Razor in this script is not immediately obvious. However, upon closer examination it seems that we have a TAG that is not really necessary. This tag stores a value to determine whether the timer item still exists on the player. When the timer item decays, it sets the TAG back to zero, so that the player can use the i_first_item again.
Think about this. If the item is on the player, can't we merely check that the item still exists? Wouldn't using FINDID to determine whether the player has the item be simpler than using a TAG along with that item? In this case, it would also reduce the likelihood that this script conflicts with other scripts, which might also use a TAG.USEDONCE. (Naming your tags creatively in each system is usually important toward avoiding conflicts.)
A few other violations of Occam's Razor appear in this script. First, there are too many RETURN statements. In this case, it doesn't matter, but in other scripts you might have unforeseen effects. Since both parts of the IF statement return 1, we could simply move it to the end of the script, where it will execute regardless of how the IF evaluates. However, my preferred method is to take care of all exceptional cases at the start, so that the rest of the script will execute cleanly without as many conditionals. In this case, the exceptional status is when the player has his timer item and cannot get another. We will have two RETURN statements instead of one, but this is not a violation of Occam's Razor because speed is also a necessity in a script, and the faster we get out of any script, the better our server will run.
An improved version of this script might look as follows:
[ITEMDEF i_first_item]
ID=i_something

ON=@DClick
    // Handle all exception cases.
    // Check the UID of the item to see if it exists. If not, this
    // will return 0 and so the IF statement will evaluate as false.
    IF (<SRC.FINDID.i_timer_item.UID>)
        SRC.SYSMESSAGE You already used this item once.
        RETURN 1
    ENDIF
    
    // Execute the "true" case, which is what we'd like to do
    // if nothing went wrong.
    SRC.SYSMESSAGE You equip the timer
    SERV.NEWITEM i_timer_item
    NEW.EQUIP
    RETURN 1
    
[ITEMDEF i_timer_item]
ID=i_memory
TYPE=t_eq_script

ON=@Create
    TIMER = some_number
    
ON=@Timer
    CONT.SYSMESSAGE Your timer has expired!
    // Do some stuff here
    REMOVE
    RETURN 1
So you see, by applying Occam's Razor to our script, we have shortened it and removed an unnecessary TAG.
This principle is even more important when applied to the content of user-defined functions, those fun bits of code inside of [FUNCTION] blocks. I have seen so many functions which contain unnecessary code. In this case, such code generally restricts the re-usability of a function, so that you can use it in one or maybe two places, but then are required to alter it or write a new function for a third extremely similar case. Even some of the built-in functions contain unnecessary code which definitely hinders the scripting ability.
Last night, I was experimenting with the built-in BUY and SELL functions of NPCs. I discovered that both functions have a built-in distance check, where an NPC will not respond to you if he is a particular distance away. This distance check is completely unrelated to any sort of buying and selling. If you want to check distance, do it in a script, such as:
ON=*buy*
    IF (<DISTANCE> < 15)
        BUY
    ENDIF
This way, not only can you modify the distance if you wish, but you can also buy from incredibly large distances. It would be slightly (but not much) better if all functions had such a restriction, but other NPC-related functions are not affected by distance. So, we have a restriction that not only is entirely unrelated to the problem, but also hinders our ability to script particular things, such as an NPC who can respond to this type of request over long distances. Certainly, we can script a function which brings the NPC to our position, executes the BUY or SELL function, and puts him back where he was, but that is unnecessarily complication. If we want a distance check in some cases, the complication should appear in THOSE cases, not the cases where we simply want to BUY or SELL something.
I have seen many functions which impose unnecessary restrictions upon their execution. For instance, let's look at this incredibly simple script whose entire purpose is to give the player two named swords when he double-clicks another item.
[ITEMDEF i_named_sword_dispenser]
ID=1828 // A runic tile
TYPE=t_script

ON=@DClick
    GIVE_NAMED_SWORD doom
    GIVE_NAMED_SWORD fire
    RETURN 1
    
[FUNCTION give_named_sword]
SERV.NEWITEM i_sword_viking
// Set the name to the original name, plus "of something," where something is
// whatever we passed as an argument to the function (in our case, "doom" or
// "fire"). We'll end up with "viking sword of doom" or "viking sword of fire".
NEW.NAME <NEW.NAME> of <ARGS>
// Put it in their backpack
SRC.BOUNCE <NEW.UID>
Can you see the problem with this script? It certainly will work and the player will end up with a sword of doom and a sword of fire in their backpack when they double-click the dispenser. We've used a function to save ourselves some typing and allow us to easily change the names of the dispensed swords. However, our function is needlessly complex. That is, it violates our Occam's Razor principle of using the simplest method possible to perform an action. Which part of our function is unnecessary?
Well, for one, the SRC is unnecessary. We would be better to remove the SRC from all statements in the function, because it is not necessary. If we call the function as SRC.GIVE_NAMED_SWORD, the SRC will be the default object in the function. The SRC will still receive the necessary items, but now our function is no longer complicated by that restriction. What restriction, you may be asking? Well, take a look at the following script. Imagine that the above function is included.
[ITEMDEF i_target_sword_dispenser]
ID=1828 // A runic tile
TYPE=t_script

ON=@DClick
    TARGET Who to provide with weapons?
    RETURN 1
    
ON=@Targon_Char
    // Give our target viking swords of fire and ice.
    SRC.TARG.GIVE_NAMED_SWORD fire
    SRC.TARG.GIVE_NAMED_SWORD ice
    RETURN 1
Make one of these items, double-click it, and target someone else (not yourself). If no one else is on your server, target an NPC, and then inspect his backpack. Instead of ending up in the targeted character's backpack, the swords have mysteriously arrived in your own backpack. This is the result of our over-complication of the script. We have restricted it so that it will ONLY work for the SRC. No matter who invokes the function (SRC.TARG or anything else), it will always act upon the SRC. This could be disasterous in @Timer, where there is no useful SRC.
So, we can remove SRC from the function, combine our three scripts, and have the following:
[ITEMDEF i_named_sword_dispenser]
ID=1828 // A runic tile
TYPE=t_script

ON=@DClick
    GIVE_NAMED_SWORD doom
    GIVE_NAMED_SWORD fire
    RETURN 1
    
[ITEMDEF i_target_sword_dispenser]
ID=1828 // A runic tile
TYPE=t_script

ON=@DClick
    TARGET Who to provide with weapons?
    RETURN 1
    
ON=@TargOn_Char
    // Give our target viking swords of fire and ice.
    SRC.TARG.GIVE_NAMED_SWORD fire
    SRC.TARG.GIVE_NAMED_SWORD ice
    RETURN 1
    
[FUNCTION give_named_sword]
SERV.NEWITEM i_sword_viking
NEW.NAME <NEW.NAME> of <ARGS>
NEW.CONT <FINDLAYER.layer_backpack.UID>
Notice that I'm setting the CONT of the new item instead of using the BOUNCE function. This is because BOUNCE will always place the items in the backpack of the SRC, which is not what we want. Instead, I set CONT (the container reference) to the UID of the default object's backpack. I retrieve that UID using the FINDLAYER reference with layer_backpack as an argument.
Now, we have a simpler function which can be used in many places instead of a needlessly complicated function which can be used in one place.
Essentially, a function should perform exactly one task, and not perform other tasks which may or may not be related to that task. Distance/line-of-sight checking is a common unrelated feature people place into their functions. However, like with the built-in BUY and SELL, chances are, you'll need different functionality one day, and it's better to insert distance checks where you need them, instead of using workarounds where you don't.
The following are things which people like to include in their functions, which should NOT be included in their functions:
Extra RETURN statements
SRC references or SRC-specific commands (such as BOUNCE and DIALOG)
Extra conditionals (too many IFs) and unnecessary TAGs
Events (syntax error)
Messages/Sysmessages which are not appropriate in all situations
Mixing of SRC and non-SRC functions (I see this all the time)
Using INVUL or INVIS to change the player's invisibility state
Using enormously complex storage methods for fear that TAGs will cause lag
Use of complex IF statements instead of using TRY or TRYP
Use of EVAL where unnecessary
Simple is almost always better. Do not do things which are unnecessary to achieve your goal.
And remember the following stages of scripting:
Make it work - That is, make it do something similar to what you want it to do
Make it work RIGHT - Debug all of the little mistakes
Make it work FAST - Not always necessary. I could post an article on
optimization
some other time.

--- PAGE BREAK ---

Making Sphere Faster
Optimization in Sphere
By Taran
This will be an article about time. Incredibly small amounts of time, on the order of thousandths of a second.
I have noticed over the years that people complain often that a Sphere server cannot handle a significant number of players without suffering severe lag. Most people speculate that this is because something is inherently wrong with Sphere. After all, they've played on other shards which didn't have lag. Never mind that those other shards also use Sphere. No administrator cares about other shards.
So, an oft-asked question in the Sphere community is, "How can I make my shard run faster?"
By faster, most people mean to reduce lag. Most people assume that the lag in SPHERE is the result of a slow connection. People will play on a server run on a T1 before they will play on a Cable server. This is because people are under the misconception that UO game play requires a fast connection. Granted, a faster connection will accelerate your running speed slightly. However, to get to the root of this problem, we need to use a profiler. Profiling is generally an option on a compiler, which builds the program so that it will measure how long its various aspects will take. It is an important skill in real programming, because the slow parts a program are almost never in the location the programmer would first assume.
In UO, everything takes place in the form of packets. Packets are clumps of data which I describe in detail in the SENDPACKET tutorial. The size and amount of packets you receive in a second determines how much lag you experience. The packet which describes an object (item on the ground) to your client is between 15 and 21 bytes. You read that correctly. This means that even sending the description of 100 items to your character will only require 1500 or 2100 bytes. This is not a significant amount and can be transferred nearly instantly over a decent cable or DSL connection. Once your client knows about the items, it will store them in a cache, so that it doesn't need to receive them again. Sphere sends your client information about the items in an area equal to the size visible on the small radar. This is how you can see multis on your radar before you can see them on your screen.
Lag occurs when your client is not receiving data fast enough to update its display. Since it doesn't know what's happening, it will sit there and wait until it does receive enough data. This can be the result of insufficient bandwidth on the server end, or it could be the result of insufficient bandwidth on the client end. If there are 100 items at Britain bank, and 50 players arrive there, your server will try to send 2100 bytes to 50 players, for a total of 105000 bytes. If your server can handle sending this amount of data out in a second (105 KB/s), none of those players will experience lag.
Now, it goes without saying that under no circumstances should you have 100 items and 50 players at Britain bank. That's just asking for lag. 105 KB/s is the equivalent of a full second's bandwidth on a very fast DSL or cable connection (~850 kbit) or a slow LAN connection. Those bytes are only a small portion of the data sent out your line every second, depending on what the players are doing. So, we have determined already that a major cause of server lag is decoration. You should not excessively decorate highly-traveled locations. Instead of placing 100 dynamic items, you should either make a multi which coincides with the bank, or you should patch them into a statics file which you then distribute to your players.
Connection issues, however, are not the primary cause of lag. Excessive decoration is certainly a cause, but it is not the only cause. After all, your server is required to do other things aside from send data to players. For instance, it must keep track of all NPCs and all items at every instant. Wandering NPCs must be moved in a way that they don't collide with trees and landmasses. Fighting NPCs must fight in a way that is sensible based on their current situation. Items with @Timer scripts may execute their scripts on a regular basis. And any other scripts on players and items must execute before any data can be sent in reply.
Unfortunately, SPHERE does not utilize a very good threading model. A threading model allows a program to essentially do more than one thing at any given time. A thread, which is generally helpfully defined as "a thread of execution," is basically an individual program within a program. Threads are independent but can communicate with one another. As they are part of the same larger process, they can also alter data that other threads can use. If you have multiple processors, your computer is capable of running each thread on a different processor, which allows them to actually run at the same time, instead of taking turns as they'd do on a single processor.
The major advantage to threads involves input and output. Programs spend a lot of time waiting for the computer to respond. For instance, if they try to read data from the disk, they must wait until that data is actually transferred into memory and presented to the program successfully. No execution can continue until the data is received. Windows provides a method of automatically reading data in a separate thread, called overlapped I/O. This method allows you to ask for data, and then do other things while you wait for it. When it arrives, you are notified in one of many ways, and you can then do whatever you needed to do with the data. Since data can be retrieved at the same time that your processor is doing other tasks, your program runs faster.
Sphere does use a few threads. You may notice that exiting the program causes the console to print "closing background threads." While your server runs, it is also keeping track of the modification dates of every script file. It does this in a separate low-priority thread, so that it doesn't get in the way of other main tasks. Sphere also uses a separate thread to perform a background save. When you force a foreground save, it transfers that save process from the background thread to the main thread. While it's saving, then, clients will not receive data because the main thread, which sends the data, is doing something else.
This brings us to a very important point in our discussion. Sphere uses a single main thread to perform all of its tasks. This means that while one task is taking place, no other tasks occur (except that file-checking and background saving, like I said). Sphere runs in a loop model, much like the
WHILE
loops that you can have in scripts. Here is a rather simplistic description of the innards of SPHERE:
While the server is running, Sphere does the following things, over and over:
Execute a "tick" on each item and each character.  This decrements TIMERD on all objects.
o If TIMERD = 0 on any item, run its timer-based action, which could be a default action, like decaying or walking or fighting, or an @Timer trigger, or both.  Deal damage and call other triggers as appropriate.
Read data from all sockets.
Determine what actions are required on any objects as a result of that data (initiate attacks, perform default actions, run scripts, etc).
Both of the previous steps involve output to clients, so send it.
(In about the time it takes you to blink your eyes twice, Sphere should have executed all of these things up to ten times.)
As you can see, Sphere only really cares about player input for a reasonably short period of time. Much of the server's execution time involves scripts and other actions. It turns out that internal actions are incredibly fast, which is why the Sphere team opted to hard-code them. This leaves us with scripts as a major cause of lag. Does that surprise you? It won't in a minute.
To execute a script, Sphere must first read through each line. So, the first task is to find the beginning of the necessary script. If this is a function, that's simple. It's the beginning of the function. If it's an item or an [EVENTS] block, it isn't so simple, because the script could exist in one of many different places.
Next, after it identifies the location of the script in the file, Sphere will read that file one line at a time and interpret the script. Interpreting the script involves a lot of binary searches (a reasonably fast algorithm for searching sorted lists) and parsing expressions. Parsing expressions also takes time, especially when variables and defnames are involved. When you say i_gold, for instance, Sphere needs to look that name up in a table and find out that i_gold is actually equivalent to the item 0EED. Each command is executed individually and Sphere updates its state based on the result. If the execution of the script takes it elsewhere, by calling a function, for instance, Sphere must go find the beginning of that script. If you create new items or characters, Sphere must first figure out exactly what the object is and how it will appear in-game, and then execute the @Create trigger on that objects, which takes additional processing. If you create a list like { 5 6 10 15 18 }, Sphere must execute an algorithm that randomly selects a member of this list for you. Of course, this list is interpreted on the fly, and can also contain other lists, such as { {7 9} {10 17} }. Numerical expressions, which are not stored in the file as numbers, but rather as sequences of characters, must be transformed into numbers and then carried out.
And Sphere does all of this remarkably quickly. However, there are a number of things you can do to help it. Since it is the interpretation process that takes such a long time, the sooner that process ends, the faster your server will run. The process of making a script (or any other program) run faster is called optimization. Unfortunately, optimizing a script often makes it nearly unreadable. So, you should always make your script work correctly before you try to optimize it. If you cannot make your script work correctly and quickly at the same time, sacrifice speed for quality.
There are many things you can do which might cause your scripts to execute more quickly. I shall detail a few of them.
1.
Check exit cases first, and return as soon as possible. This is an important feature of any function in which a particular state may cause the function to stop executing properly. A good scripter who paid attention in my
Occam's Razor
tutorial might write the following:
[FUNCTION do_something]
IF (<SRC.STR> < 70)
    // do something here
    // do something here
    // do something here
    // do something here
    // do something here
    // do something here
    // do something here
ENDIF
RETURN 1
When Sphere begins to execute this script, it will check to see if SRC.STR is less than 70. If so, it will execute the body of the IF block. Otherwise, it will search down through each line, reading every line in as it goes, until it finds an ELSEIF, ELIF, ELSE, or ENDIF. This takes time, as I mentioned, to read through the lines. It does not take the same amount of time as actually executing the code within the IF block, but it will still take time. In our example script, we return from the script after the ENDIF, and nothing else. In this case, it isn't really worthwhile to scan down through all of those lines. A faster script might look like the following:
[FUNCTION do_something]
IF (<SRC.STR> >= 70)
    RETURN 1
ENDIF
// do something here
// do something here
// do something here
// do something here
// do something here
// do something here
// do something here
RETURN 1
This prevents the script from reading unnecessary code. When it determines that the strength of the SRC is not appropriate for this function's actions, it will immediately return from the function. Thus, no time is wasted looking for an ENDIF. If you have a long script with many IF/ELSEIF sections, you might consider placing a RETURN 1 within each of those sections.
You would not want to follow this rule if you want to actually do things after your IF statement. For instance, if our original script looked like this:
[FUNCTION do_something]
IF (<SRC.STR> < 70)
    // do something here
    // do something here
    // do something here
    // do something here
    // do something here
    // do something here
    // do something here
ENDIF
SYSMESSAGE This is the end!
RETURN 1
You might want the player to receive that message regardless of his strength. In that case, it would probably be best to leave the function in its original state, instead of unnecessarily duplicating code. Duplicating code leads to messes when you try to modify that code and forget that you'd duplicated it. Another alternative would be to use a second function.
[FUNCTION do_something]
IF (<SRC.STR> >= 70)
    DO_IT
    RETURN 1
ENDIF
// do something here
// do something here
// do something here
// do something here
// do something here
// do something here
// do something here
DO_IT
RETURN 1

[FUNCTION do_it]
SYSMESSAGE This is the end!
2.
Avoid using ALLCLIENTS statements if at all possible. If they are vital for your script, use them, but use them sparingly. If you use ALLCLIENTS, you are inflicting not only one player but all of the players currently online to the lag associated with a slow script. If your script is not inherently slow, you probably have nothing to worry about, but every little bit counts. A script which uses ALLCLIENTS to transport players into a game or to send text messages in the form of a chat system probably has very little to worry about as these scripts, if written correctly, are not inherently slow.
3.
Avoid excessive recursion. While a recursive function may seem the easiest way to perform a task, you are using both time and memory when you call that function. Calling a function is not nearly as expensive as the commands you might execute within the function, but like I said in the previous point, every little bit counts. If you look at some of Swindler's scripts, you will find that they are prohibitively long, but that they run extremely fast. His "contents" script, which executes a function on every object in a container, is spread out and fast. A simple way to run this script might be the following:
[FUNCTION contents]
// The argument is the action to execute on the contents of the
// container. For instance to make every item in the container say
// "hello," we would use the following command on the container:
//
// CONTENTS SAY Hello

// The last item is actually index RESCOUNT - 1, because
// the first item is index 0. The second item is index 1, etc.
// Therefore, the last item's index is one less than the number
// of items left in the container.
VAR.HOWMANY = <EVAL <RESCOUNT> - 1>
CONTENTS_AUX <ARGS>


[FUNCTION contents_aux]
// Our recursive function. Notice that I'm checking the
// exit condition first, like I said.
IF (<VAR0.HOWMANY> < 0)
    RETURN 1
ENDIF
// This line might resolve to something like the following:
// FINDCONT.50.SAY Hello
TRY FINDCONT.<VAR.HOWMANY>.<ARGS>
VAR.HOWMANY -= 1
// Don't forget to pass the argument to the next iteration! :)
CONTENTS_AUX <ARGS>
Believe it or not, there is a faster way to execute this script. Swindler and I realized, while scripting for Ithyca, that calling a function is slightly slower than not calling that function. Remember, for each function call, Sphere must go find that function in a file, which requires time.
4.
Turn on SECTORSLEEP in sphere.ini. Sector Sleep is a function added somewhere around TUS 0.45, which causes, well, sectors to sleep. In sphere.ini, you can specify an integer value for SECTORSLEEP. We'll call that value X for now. Every X minutes, Sphere checks to see if any players are in a particular sector. I believe this takes place in one of the background threads, but I'm not certain. If no players occupy a sector, Sphere will suspend all handling of timers in that sector. When a timer reaches 0, it will simply stop there, without executing @Timer scripts or doing any default timer actions. As soon as a player enters the sector, it will awaken and everything in that sector will come to life again.
Since NPC movement and fighting is based on timers, this will effectively suspend all NPC movement until a player re-enters the region. Unfortunately, since it also suppresses timers on items, Sector Sleep has a number of unfortunate side effects. For instance, spawn points depend explicitly on a timer. Therefore, if you have just spawned your world or have just reset the spawns in your world, nothing will spawn unless a player is actually within the same sector as the spawn point. This could be an advantage, I suppose, but I would recommend that you remove SECTORSLEEP (set it to 0) while you are spawning your world and for a short time after you reset all spawn points.
If you have a scripted item using @Timer in a sleeping sector, that item will not function correctly anymore. Unfortunately, this can affect a number of systems. When I ran my automated capture the flag script on Ithyca, my players experienced this difficulty first-hand. The sector containing the game control stone would go to sleep, thus suspending @Timer handling on that stone. Thus, when the game ended, their game memories would detect the end of the game and remove their clothing, but the stone would not appropriately return them to the ready room. All of the players would be stuck, naked, in the CTF arena until someone happened to pass through the ready room and awaken the sector.
Thus, while SECTORSLEEP can cause some scripts to behave strangely, it reduces lag enough that it makes timer workarounds worthwhile.
5.
Avoid excessive use of TAG and VAR values. These values are stored in a special type of sorted list called a linked list. A linked list allows you to add and remove things from the middle quickly, which makes it ideal for this sort of application. Linked lists do not allow you to find a particular item in the list very quickly. You must search through each element from the beginning, counting as you go, until you find the item with the index you require. Sphere uses sorted linked lists, which allows them to very quickly find the index of the element they need. Despite this speed, they must still search through each individual item until they find the one they need.
Of course, the lag you will experience from TAGs and VARs is minimal, and probably not worth worrying about. Giving each player 350 tags might lag your server a bit, but if you do that, your scripting dilemma is larger than your lag dilemma.
By the way, this is why I said you should always delete a TAG or a VAR when you are finished using it.
(And don't worry about how linked lists work. If you are a programmer and are curious, you can find plenty of information about them by searching Google.)
6.
Do not spawn cities excessively, especially Britain. Since sectors only go to sleep when there are no players, you can safely assume that the 7 or 8 sectors in Britain will never sleep. This means that any animals or NPCs you place in the biggest city in the game will continue to wander about aimlessly, using your precious server time.
7.
Avoid excessive multiplication and division in a script. This will cause minor delays, probably unnoticable next to other types of delays. Multiplication and, especially, division are much slower than addition. Unfortunately, there are few workarounds for this lag issue. I can't think of any reason you would need excessive multiplication and division, except perhaps to calculate a square root, so these operators do not pose a threat to your server.
8.
If a function returns a value, calculate that value in the RETURN statement, instead of using temporary variables to hold the value. One long string is faster than a number of short strings put together later. The perfect example of such a mistake is our SPLIT4BYTES function from the SENDPACKET tutorial. I wrote this function so that it looked something like this:
[FUNCTION split4bytes]
LOCAL.PART1 = <HVAL <ARGV[0]> & 0FF>
LOCAL.PART2 = <HVAL (<ARGV[0]> / 0100) & 0FF>
LOCAL.PART3 = <HVAL (<ARGV[0]> / 010000) & 0FF>
LOCAL.PART4 = <HVAL (<ARGV[0]> / 01000000) & 0FF>
RETURN "<LOCAL.PART4> <LOCAL.PART3> <LOCAL.PART2> <LOCAL.PART1>"
This function will run fast. However, it will not run as fast as possible. To accomplish that, we must put all of those calculations into the return statement, and avoid the creation of unnecessary temporary variables:
[FUNCTION split4bytes]
RETURN "<HVAL (<ARGV[0]> / 01000000) & 0FF> <HVAL (<ARGV[0]> / 010000) & 0FF> <HVAL (<ARGV[0]> / 0100) & 0FF> <HVAL <ARGV[0]> & 0FF>"
Acratia wrote an even faster version of this function, which you will find on the Functions & Events board, and probably on Script Sharing. His function uses binary shifts, a topic I will probably write another tutorial about someday.
9.
Avoid calling EVAL or HVAL unless necessary. That's just simply another unnecessary function call SPHERE could use doing something else. You only need to use EVAL if you are dealing with:
Strings
TAGs
VARs
Displaying numbers that normally display in hexadecimal format
10.
Avoid creating excessive new objects. Creating 100 items in a recursive script requires 2.8 seconds. Creating 100 NPCs takes slightly longer than that. Clearly, then, creating new objects is a slow process. This is mostly because Sphere must first create the new object, then fill its properties according to its TYPEDEF, then read and execute its @Create event.
11.
Set the CONT of an item instead of using EQUIP or BOUNCE. Unless, of course, you want the @Equip event to execute. EQUIP and BOUNCE perform extra processing which is usually unnecessary or already completed in your script. BOUNCE also displays that unsightly "You put the something in your backpack" message to whoever is putting the item in his or her backpack.
[FUNCTION equip_a_sword]
// To demonstrate equipping an item
SERV.NEWITEM i_sword_viking
NEW.CONT <UID>

[FUNCTION bounce_a_sword]
// To demonstrate bouncing an item
SERV.NEWITEM i_sword_viking
NEW.CONT <FINDLAYER.layer_backpack.UID>
See? Easy and fast. Of course, Sphere will still perform some extra processing, to verify that the item can actually go where you're telling it to go, but otherwise, it's generally faster to do it this way.
Remember, if you want Sphere to do extra equip processing ("You can't equip that"), you will need to call EQUIP explicitly. You must also call EQUIP if you are expecting the @Equip event on the item to execute (or the @ItemEquip event on the player).
Overall, optimization saves Sphere time on the order of a few tens or hundreds of milliseconds. But, if you have 50 players executing a thousand optimized functions and scripts, you will save time that Sphere can spend doing other things, such as sending data to your clients, thus reducing lag. Remember, for every internal function Sphere can avoid by not executing something in a script, it has extra time to do other internal things.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Override Common Data
2
Item-based Override TAGs
3
Character-based Override TAGs
4
Region-based Override TAGs
5
Removed Override TAGs
Override Common Data
Ever wondered why you can't change for example 'TDATA' values on a per-item basis? Or some default values from Sphere.ini?
The reason is simple: The majority of items, characters and situation will not need individual values there and are working fine with the default ones (either hardcoded or set in the INI or the *DEF sections), so it simply would be a waste of memory to store them again on each game object. Therefore for example a single crossbow in the world reads what items it needs as ammunition not from it's "WORLDITEM" data object, but from it's ITEMDEF (the TDATA property).
Alas, as time goes by for some stuff it showed reasonable to allow overriding the default values for a single item, character or even region. Nevertheless it still would be a waste of resources to give all crossbows an "ammunition" property what on almost all of them will read: "default". So the Sphere developers decided to store the respective individual changes in TAGs: If the TAG exists it will be used, if not, the default is used.
Common to most overrides is the syntax of the TAG's name:
TAG.OVERRIDE.*
- where "
*
" denotes the name of the respective tag. But there are also some others what were named before this naming scheme was established.
Item-based Override TAGs
TAG.ALWAYSSEND
When optional flag OF_OsiMultiSight is on, all items inside a multi are not sent until entering the multi. If you want an item to be always sent, set TAG.ALWYASSEND to 1. This tag also can also go under the ITEMDEF section of an item.
TAG.NOSAVE
If set to 1 the object will NOT be saved.
TAG.OVERRIDE.DAMAGETYPE
Sets the damage type for a weapon (ARGN2 in @GetHit trigger).
TAG.OVERRIDE.DROPSOUND
Overrides the sound that will be played when the item is dropped somewhere.
TAG.OVERRIDE_LIGHTID
Overrides TDATA3 for lights (T_LIGHT_LIT, T_LIGHT_OUT). Take notice that there is an underscore in this TAG's name.
TAG.OVERRIDE.MAXITEMS
Overrides the maximum number of items that can be placed into a container (default: 255)
TAG.OVERRIDE.MAXWEIGHT
Overrides the maximum total weight that can be placed into a container.
TAG.OVERRIDE.PRACTICEMAX.SKILL_$skillid
Overrides SKILLPRACTICEMAX setting from Sphere.ini for a particular skill. $skillid is the numeric ID of the skill.
TAG.OVERRIDE.SKILL
Overrides the SKILL property of the ITEMDEF for a weapon.
TAG.OVERRIDE.SPEED
Overrides the SPEED for a weapon.
TAG.OVERRIDE.SOUND_HIT
Overrides the hit sound for a weapon. Take notice that there is an underscore in this TAG's name. (Removed in newer versions and is just AMMOSOUNDHIT=<Val> without the use of Tag.Override.<String>=<Val>)
TAG.OVERRIDE.SOUND_MISS
Overrides the miss sound for a weapon. Take notice that there is an underscore in this TAG's name. (Removed in newer versions and is just AMMOSOUNDMISS=<Val> without the use of Tag.Override.<String>=<Val>)
Character-based Override TAGs
TAG.DEATHFLAGS
Changes some death related behaviour. The list of supported flags are in sphere_defs.scp.
TAG.MAXPLAYERPETS
Overrides the maximum number of pets that a player can stable. Default is 10.
TAG.NAME.ALT
Sets an alternative name, useful for incognito effects.
TAG.NAME.HUE
Changes the colour of the name displayed above a character.
TAG.NAME.PREFIX
Sets some text to display before the character's name.
TAG.NAME.SUFFIX
Sets some text to display after the character's name.
TAG.NOSKILLMSG
When set to 1, character will receive the "gainradius_not_met" defmessage (sphere_msgs.scp) when skillgain is aborted due to the GAINRADIUS on a skill.
TAG.OVERRIDE.MOVERATE
Overrides the MOVERATE property of the CHARDEF.
TAG.OVERRIDE.MOVEDELAY
Overrides completely the moverate checks and setting the next movement to the given timer, eg 'tag.override.moverate=250' makes the npc move each 250 milliseconds when walking. WARNING:* Setting this tag completelly overrides default moverate checks, TAG.OVERRIDE.MOVERATE gets ignored too.
TAG.OVERRIDE.RUNNINGPENALTY
Overrides RUNNINGPENALTY from Sphere.ini
TAG.OVERRIDE.SKILLCAP_$skillid
Overrides skill settings from the character's SKILLCLASS. $skillid is the numeric ID of the skill.
TAG.OVERRIDE.SKILLSUM
Overrides SKILLSUM setting from the character's SKILLCLASS.
TAG.OVERRIDE.SPIDERWEB
When set to 1, NPC will be able to drop spider webs (for a giant spider, if this set to 1 then it will stop it from dropping webs)
TAG.OVERRIDE.STAMINALOSSATWEIGHT
Overrides STAMINALOSSATWEIGHT from Sphere.ini
TAG.OVERRIDE.STATCAP_$statid
Overrides STR/DEX/INT settings from the character's SKILLCLASS. (0=STR, 1=INT, 2=DEX)
TAG.OVERRIDE.STATSUM
Overrides STATSUM setting from the character's SKILLCLASS.
TAG.OVERRIDE.TRAINSKILLMAX
Overrides NPCTRAINMAX setting from Sphere.ini
TAG.OVERRIDE.TRAINSKILLMAXPERCENT
Overrides NPCTRAINPERCENT setting from Sphere.ini
TAG.PARTY_AUTODECLINEINVITE
When set to 1, character will automatically decline party invitations.
TAG.PARTY_CANLOOTME
When set to 1, party members will be allow to loot this character without it being counted as a criminal action (linked to the option in the party menu).
TAG.VENDORMARKUP
This value is added to the markup percentage that vendors apply to their buy and sell prices. Since the default markup is 15%, this means that a vendor will sell something worth 100gp at 115gp and buy it back for 85gp. If you set this tag to -15 the markup will be cancelled out to 0%, or you can raise/lower it if you want your vendor to sell things at a higher/lower price.
Region-based Override TAGs
TAG.ANNOUNCEMENT
Sets a message to be announced to all who enters the region if REGION_FLAG_ANNOUNCE is set.
TAG.GUARDOWNER
Specifies the owner of the region's guards (ex: "The City")
TAG.OVERRIDE.GUARDS
Specifies the character that will be summoned when guards are called in the region, overriding the
guards {c_h_guard 1 c_h_guard_f 1}
defname in sphere_defs.scp
TAG.RED
Sets the region as a safe place for evil. Murders are considered normal here.
If region is guarded, guards will be red and protect evil players.
TAG.VENDORMARKUP
This value is added to the markup percentage that vendors apply to their buy and sell prices. Since the default markup is 15%, this means that a vendor will sell something worth 100gp at 115gp and buy it back for 85gp. If you set this tag to -15 the markup will be cancelled out to 0%, or you can raise/lower it if you want your vendor to sell things at a higher/lower price. If the vendor has this tag set directly on them then this region TAG will not be used.
Removed Override TAGs
OLD TAG
NEW Variable
Description
TAG.BREATH.DAM
Breath.Dam
Overrides Damage done from fire breathing.
TAG.RANGE
Range
Range is now writable for both characters and items.
TAG.OVERRIDE.SHIPSPEED.PERIOD
ShipSpeed.Period
Overrides SHIPSPEED.PERIOD for a ship (the length of time it takes for the ship to move one step, in tenths of a second).
TAG.OVERRIDE.SHIPSPEED.TILES
ShipSpeed.Tiles
Overrides the amount of tiles moved in each tick.
TAG.OVERRIDE.DOORSOUND_CLOSE
DOORCLOSESOUND
Overrides the sound that will be played for a door when it is being closed.
TAG.OVERRIDE.DOORSOUND_OPEN
DOOROPENSOUND
Overrides the sound that will be played for a door when it is being opened.
TAG.OVERRIDE.PORTCULISSOUND
PORTCULISSOUND
Overrides the sound that will be played for a portcullis when it is used.

--- PAGE BREAK ---

Following is a list of all changes made to Sphere since version 55a. These changes can also be found by opening and reading the REVISIONS-55-SERIES.txt and REVISIONS-56-SERIES.txt files that are provided with the Sphere download.
You can also retrieve the very latest revisions file for the 56 series from the
Automated SVN Builds
page. This file also shows the changes that have been made for the next prerelease.
Contents
1
REVISIONS-55-SERIES
2
REVISIONS-56-SERIES
3
0.56a
4
0.56b
5
0.56c
6
0.56d, Current Nightly
REVISIONS-55-SERIES
---- 0.55a --------------------------------------------------------------------
---- * date unknown

new crypt for clients up to 2.0.7
2.0.7 client has strange problem with text containing - or _ in UNICODE speech modes (this can crash the client in some cases)
  UNICODESpeech=off will fix for english.
3d beta client support.
new key ACCOUNT.CHARS
new key ACCOUNT.CHAR.x.NAME
use verb serv.server.0.name
bandages only for gm's
Steal Looting corpses
line numbers for errors where not accurate - ftell() is not accurate in text mode !!! does not work with fseek to get you back to the same place !!!
CHECK cant feed pets ? not GM's
Ghosts can't equip scriptable timers ? timers don't expire.
block type [REGION] changed to [REGIONTRIG]
added key RESOURCES= to [AREA]
added new block type [REGIONRESOURCES] in sphereregion.scp
changed [MAPRESDEF] to [REGIONRESOURCE]
ANIM with backwards and TimeDelay = invis in all other clients (client bug really)
x You put the logss in your pack
x. Also you can smelt Chaos and Order shields to get gold and blackrock ingots in mass amounts with no or little work.
x. Also with the guild stones, you can recruit the guildmaster making him a candidate and 
  take over the guild stone and kick everyone out. Warring guilds tend to make mules and do this sort of thing.
18. Many guild bugs. Players can be "half-way" in a guild now. 
  The result is other waring guilds are now orange to you and 
  you are blue to them. They can be half way in the guild two 
  ways. 
  18.1. Have the guildmaster never accept you fully in. 
  18.2. after the guildmaster accepts you in, don't click the stone. You can actually end up half way in a guild with your guild tag on. 
19. Another guild bug is people will make a charater with 10 str 
  and then join it to a guild thats either Chaos or Order. 
  Then go attack greens, the player will auto attack back and 
  easily kill the player with 10 str. Thusly giving them a kill
  they get guard killed and a near by guildmate loots the corpse of the person that got attacked by the guy with 10 str. No criminal tags are incured on either the looter or the attacker due to the fact that the target was green.

---- 0.55b --------------------------------------------------------------------
---- * date unknown

XBank and XCOLOR problems.
test inscription 
DUPE limited to MaxItemComplexity
X (seems ok, script issue ?) word Bank dont work
immunity to ones own spells.
X (seems ok to me) defname of types don't work
x no loss of ar-value on unequipping armor or another item, but unequipping works correct with xedit 
X (seems ok, script issue ?) scribing scrolls no longer check to see if magery is high enough to scribe a scroll
x The same with weapons like bow, you can shoot with the unequipt bow after unequip...
X ( seems ok) .shutdown 1 says it will, but never shutsdown :)
X returnvalue for functions . see i_test_rand_ret
slight damage to mining tools as used.
@SkillTry to @SkillStart

---- 0.55c --------------------------------------------------------------------
---- 15/03/2001

sphere list sorting. non letters and repeating letters
SPEECHCOLOR for NPC's
X Equip / unequip items that mod skills.
X (Seem ok ) overly heavy iron ingots ?
X Check - listening equipped items.
prevent NUKE command target in pack.
x test poisoned horse dies while ridden.
x change mapresources causes critical error on resync
i_runebook
CanSee and CanSeeLOS triggers for items
change unreasonable timer max length to 90 days. was 2 hours !
ADD items directly into pack by targetting other item in pack.

---- 0.55d --------------------------------------------------------------------
---- * date unknown

X  tag.morep_1=<morep> works
X Check i_rune_book
remove MENU_ADMIN, replace with gump and FUNCTION
test output for scripts and logs should use the \r\n text mode. NotePad will work again.
SKILLDEF effects
  "DELAY_HI",
  "DELAY_LO",
  "EFFECT_HI",
  "EFFECT_LO",
missing SKILLMAKE=BLACKSMTIHING x.x for item 01b73 (i_shield_buckler) in sphereitemb5.scp
SPELL_Reactive_Armor = effect_Lo and Effect_Hi = random max percent reflected damage.
Crypt for 3.0.0

---- 0.55e --------------------------------------------------------------------
---- 21/03/2001

X Taste Id doesnt work at all it doesnt give a message period.  
burn vs. smelt. flame effect ?
X -npc speech color not working properly 
SEEMS OK = no kindling from trees -dagger on tree doesn't yield kindling "this is not a tree"   
SEEMS OK = Problem with resources on Multiple planes, not getting any? Problem in map file maybe?
X Polymorph not working  
SEEMS OK TO ME - When creating a t_script item, buying off a vendor, not to have the t_script attributes, 
  the TAGS do not appear to working through the ON=@CREATE .
X Need the @LOGIN @LOGOUT trigger
x Backgammon board has chess pieces  
X All drinkable potions create a gold coin in pack instead of empty bottle (probably script TDATA value).  
? CLIENT UPDATE BUG? - when u set an amount as a gm it doesnt set the whole stack-it leaves the original 1 and then gives u the diff in a different pile  
-NEED to do UPDATE now - couldnt .set flags statf_nightsight 
  -Setting colors of cchar objects is very strange, I would color my zorn, but no refeash commands would show me the color, when I mounted it, it turned the right color. 
- CANT CURSE self - curse, weaken, clumsy, feeblemind all consume regs but have no spell effect (no reduction of stats)  
new command SAYUA Color, Mode, Font, Lang, Text
- dices can roll a "0,0", "0,x", "x,0"
SKILLBEST or SKILLBEST.1 to get the best ranked skills
X unicode speech must add lost of "......" , or it will not be displayed.  "......." amount = unicode words amount - 2  
TEXT problem with new client versions 2.0.7 ?
Yawn anim ?
Fix items that should decay but lose timers.
Eval Int message
TRUE - Drink one potion, then drink a different one - second one drank overwrites the first potion's effect. (IE, poison yourself, drink agility - now agile, but no longer poisoned at all)(all potions, same thing)  
TRUE - Var.x=rand(nnn) doesn't save output of Random function (so a number since 0 to nnn-1) but it save the function.
  Should use Var.x = <eval rand(nnn)>  rand() only works bare if it's an 'if' or other known math function.
i_shield_wood shield made of only wood.

---- 0.55f --------------------------------------------------------------------
---- * date unknown

ARCHERYMINDIST=2
Repairs now require some of the components of the item.
Double fame when order pet to attack.
GM equipping item to NPC.
Stealing can fail
Stealing can get you caught.
-archer npcs AI three steps to fire 
X Shovel is destroyed really fast if you mine 

---- 0.55g --------------------------------------------------------------------
---- 29/03/2001

BUG - missing reags = success. ? 
LASTUSED for player chars. seconds
CHECK -Seems ok = released animals still follow their owner
CHECK -Seems OK- Spawns seems to be hovering around their spawn point and not moving
Meditation:  
[SKILL] all 0 to 100 percent.
DELAY=2.0,3.0 // per stroke.
EFFECT=0.0,100.0
ADV_RATE=10.0,200.0,800.0 = reveresd from old.
VALUES=
Bandage washing not working (it seems so anyway might have to wash them somewhere else)
NPC re-lighting torches a million times ?
Ingot smelting yield for one ore is 1.
x) If in war mode, summon a animal, you end up fighting yourself
Healing - you get two messages about applying bandages when you heal yourself/anyonelse  unequip on heal  healrates totally screwed up 100 heal 100 anat = crazy healing  
SECTOR.RAIN SECTOR.DRY weather transition problem.
MORE1l, MORE1h, MORE2l, MORE2h
remove "Rune to:" header
CAN'T FIND THIS- they don't count fists or daggers as a criminal offence, 
  thus getting the npc's to attack them and making the npc grey and free to kill.
CALL FOR GUARDS WORKS FOR ME - Just hit the blue npc or player one time in war mode. The aggressor WILL NOT
 be flagged criminal until the victim die. Or the aggressor can go in peace
 mode and let the blue attack. The blue will become grey to him and finally
 the aggressor will kill the blue and loot him without any problems. I tested
 it, it works. Some players seem to use this for kill any blues in town.
NOT ON SELF = curse, weaken, clumsy, feeblemind all consume regs but have no spell effect (no reduction of stats)

---- 0.55h --------------------------------------------------------------------
---- 04/04/2001

CHECK - OK - refresh potion
keys to houses going blank
3) Hatches on boats wont open?
4) No Keys for tents boxes (Fixed this problem by adding a sign to the multi)
TAGLIST for multi, script, account, cchar
x loot while hidden
player use bandages on self,-> get 2 messages
Stealing off corspses still works, should never be able to steal off a corpse
murderer and criminal titles capitalized.
the bug appears if the archery butte is linked to an item. if the item it is linked to is dclicked, the archery butte reacts as if itself had been dclicked.  (Same with pickpocket dips and training dummies and alot of other things).
With GM or PC, if you try to fill a keg with potion you get the you cannot use this yet message. I have a mortar and pestle. Tested at GM alchemy skill for both GM and PC.
In UO3D, if you log into an account that has no characters, you get a message
  that says "You already have 5 characters".  -- Fixed AD 3/31/2001.
Increased maximum item name length to 256.
The teleports in the map script, like entering dungeons should not allow NPC's to travel through them unless they are pets. This will keep monsters from harder levels roaming to easier levels.
CHECK - .sayua x,x,x,x,test -- Works, but was returning false, so it would say "Not a valid command or format"
It seem the off duty vendor brain act though it's just a vendor that has ran out of goods..
Party System reveals your account name (not password) to any person you ask to join.
CHECK - OK - 55g deletes all shrinked npcs on startup?
CHECK - OK - kills down by 1 each login ?
Can't attack things u can't see.
fix silly torch dupe AGAIN !

---- 0.55i --------------------------------------------------------------------
---- * date unknown

.ACCOUNT name ADD password changed to .ACCOUNT ADD name password
working tool tips
x A way to check if skill requirments when casting like IF (<SRC.CANMAKE>==i_arrow) something like that
x Poison needs to release a paralyzed person
x Item i_fire is being picked up by players when being created suring smelting
set color will not update imediately
5) Resources in Other Mapplanes like (1) and so on (MAP.SCP Attached)
6) Undefined Symbol error on region tags in housing.... Look at lines 4270 & 4263 in sphereitem_housing.scp

---- 0.55j --------------------------------------------------------------------
---- * date unknown

.55j
uid.x.name is broken
i_multi_house_wheat_cottage
UNICODE to UTF8 convert for LINUX
syntax error with " if ((<morey><0) || (<morey>>1000))"
port +1000 for the accounts ?

REGIONRESOURCE replace AMOUNT_LO,AMOUNt_HI with AMOUNT=lo,hi
REGIONRESOURCE replace SKILL_LO,SKILL_HI with SKILL=lo,hi
REGIONRESOURCE add REAPAMOUNT = range of amount to find in 1 try.

---- 0.55 R1 ------------------------------------------------------------------
---- 14/11/2003

11-11-2003, Zorm
Fixed dye anything, now has to be a dye tub
Added checking to strings to prevent exploits
Candle dupe has been fixed
Layer_horse can no longer be picked up by players
Messages in message boards can no longer be picked up by players
Stats max on create character raised from 66 to 80, allows new prof.txt
Now checking colors for pants and shirt when creating a character
Added more checking to a players name when creating characters
Teleport effects should no longer harm players
Pets now clear all old owners when getting a new one
Fixed showing of hp to other players
Administrator account is no longer auto admin
If you attempt a command and can't use it it comes out as normal speech
death menu option is no longer sent
guild mates no longer give you a kill count/karma/fame when you kill them
speech support improved. If you send unicode text it is handled throughout as unicode
non unicode text is sent back out as unicode text

12-11-2003, Kell
- Added @CallGuards as a propper trigger, "return 1" cancels guards being called
- Changed @Logout so that "return 1" disallows instalogout.
- Added support for the following TAGs on characters:
  TAG.NAME.ALT (alternate name, good for incognito effects)
  TAG.NAME.PREFIX (alternate prefix, if not set, defaults to Notoriety prefix - lady/lord)
  TAG.NAME.SUFFIX (suffix for the name)
  Note that a space isn't added for prefix or suffix on purpose, to allow text to be
  glued to the name. You can add a space by using quotes, as in: TAG.NAME.SUFFIX="text "
- Using open door macro now triggers double click event.
- @DClick is now triggered on NPCs BEFORE attempting to mount, paperdoll or open
backpack ("return 1" cancels)
- If REAPAMOUNT isn't present, AMOUNT/3 will be used (it won't just default to 1).

13-11-2003, Kell
- Player characters with conjured flag get unmounted and the flag removed on death. Useful
to leave no corpse behind ( under ON=@Death : flags = <flags> | statf_conjured ). This would
be better as a server setting.
- Fixed spider webs remaining for days, and spider silk too (increased item count too much)

14-11-2003, Zorm
- Fixed client 1.26.x, it may now log on a 55i server
- Updated addbark, addbarkunicode, addbarkspeechtable to follow OSI better

---- 0.55 R2 ------------------------------------------------------------------
---- 27/11/2003

14-11-2003, Kell
- Fixed parsing of <<args>> or any other nested <var> btw. Also fixed parsing of numerical commands
  (skills) so that <7> actually works for accessing skill #7 (this didn't make it to .55R1).
- Fixed dumb log file being created out of place. Will still happen when Sphere is run as
  an NT service though.

15-11-2003, Zorm
- Added LOS check for taming
- Changed m_defense from BYTE to WORD, thus fixing the bug with AR > 255
- CanSeeLOS fixed, now checks if target object z is greater then myz + 14 if so blocks
- Kill count decay should be fixed
- Can no longer steal from trade windows or game boards
- ATTR_OWNED items may no longer be magic locked
- Added @DeathCorpse, argn1 = corpse?
- Trade window items are now dumped to back before corpse is made
- Now checks accounts when first sent
- Added @start in skilldefs
- Provoking players disabled

16-11-2003, Kell
- Identified problem regarding vanishing horses. Apparently, they stop acting as ridden, so instead
  of deleting them I will just try and restart their behaviour again. If this fails, they still
  shouldn't be deleted, and a new message should be printed out. To test, try creating a horse, mount
  and then worldsave.
- Made sure that ABORTED skills don't hand out experience for failure. Only those that actually fail do.
  ( this fixes lumberjacking / mining exploits ).
- Added support for TAG.NAME.HUE (name colour)
- Added @SkillSelect to character events, and @Select  to SKILLDEFs ("return 1" aborts).
- Added support for FORCHARS/FORITEMS/FOROBJS the correct way: SRC is retained and the default object
  within the FOR block is the object being looped through.
- Added @SkillSuccess to character events, and @Success to SKILLDEFs ("return 1" aborts).
- Changed @SkillStart so that "return 1" actually aborts the skill (same for @Start in SKILLDEFs).
- Changed @Login so that "return 1" disallows logging in.
- Added @UserSkills ("return 1" cancels the skill window being displayed).
- Added @UserStats  ( user requested stats update, return value is ignored )
- DBG: Added @SkillMakeItem to character events, triggered after the item has been created:
  "return 1" deletes the item
  "return 0" bounces the item as usual, but with no extra messages (potion, quality message)
  "return"   bounces the item as usual.

17-11-2003, Kell
- Hopefully fixed the bug with resyncing SPELL sections.
- Added triggers to SPELL sections, so you can now independently code spells:
  @Select ( "return 1" cancels, "return 0" skip checks, "return" default behaviour)
  @Start  ( "return 1" cancels )
  @Fail   ( "return 1" cancels the fizzle effect).
  @Success
- Changed SERV.LOG to allow writing of messages to the log. New syntax is:
  serv.log @enable   -- enables logging
  serv.log @disable  -- disable logging
  serv.log @toggle   -- toggles logging
  serv.log text      -- log text to console and file

18-11-2003, Zorm
- Fixed commands going to npcs, as well as more problems with unicode speech
  support - BROKEN
- CGTypedArray, SetCount, DestroyElements, crashes on shutdown. Needs more
  work to fix
- Fame gain fixed

18-11-2003, Kell
- Moved tags to CObjBase so all types of objects can have tags. Removed special
  handling of TAGs from characters, script items and multi items.
- Fixed problem when resycing SKILL sections (spheretables.scp) would mess up
  Skill_ defnames ( and the ACTION field on characters ). One no longer needs
  to use workarounds like my FIXACTION function. Memory corruption problems
  when resyncing SPELL tables should also be fixed.

18-11-2003, DarkStorm
- Started fixing some issues preventing sphere to compile on linux (CSocket.h)
- Managed to make it compile on Linux, comitted all the changes neccesary and
  made sure it still compiles on windows.
- Implemented some code changes to remove the ncurses dependency on linux and
  activated the console again. 
- Implemented Colors on the Linux Console

19-11-2003, DarkStorm
- Added MD5 Password support via MD5PASSWORDS=1 in sphere.ini. If you activate
  this, accounts will be saved with the password encoded (existing non-encoded
  password will be converted). WARNING: disabling it afterwards won't restore
  the passwords to plain text, and thus you won't be able to login with those
  accounts. Once enabled, and the accounts file saved this setting should not be
  changed (unless you set the passwords by hand).
- Removed the ScriptEngine Folder from the VC++6 project and wrapped an #if
  defined() around the three functions that used it. It seems unused in the
  productive gameserver, so i think we can remove the additional 400kb of
  possibly error prone code.
- Removed the ScriptEngine Folder from the VC++ 7 project too
- Changed the VC++ 6 projects to use the shared CRT. (It's shipped with windows
  since 95)
- Rewrote the new[], new, delete and delete[] operators and removed the memory
  footprinting. 
- Tuned the optimizations for VS.NET 2003 Release mode a bit.
- Removed the StatusReports from ntservice.cpp before it loads the ini for now
  Reporting as a service if you aren't a service isn't supposed to be happening,
  there needs to be a better fix than mine (maybe a -service argument?)
- added a check to CAccount to filter out accounts named "eof"
- fixed the help provided by .serv.accounts

19-11-2003, Kell
- Added a .DBG command, to put test code in. At the moment it'll be used to try
  and crash the server in various ways, to see how it behaves on Linux.

20-11-2003, Kell
- Added INTERRUPT=X,Y to SPELL sections in spheretable_x.scp. This controls
  the chance to fizzle a spell when hit in combat, at different Magery levels.
  Default is 100.0, 100.0 (always fizzle). With a setting of "100.0 50.0" a GM
  mage would only fizzle half the times.
- NPCs equipping stuff that is too heavy for them on @NPCRestock won't
  spit hundreds of errors to the console.
- Added LOSTNPCTELEPORT=X to sphere.ini. If X is greater than 0, NPCs that have
  a HOME point set will now teleport home if the distance to their HOME is above
  X. This fixes it when they go through portals, then get lost in the map.
- Fixed problem with mounted NPCs dying and leaving a lingering object which
  could leak later.
- FINALLY made it crash resistant under Linux - it is now trapping most
  signals AND launching exceptions correcly. Tested with a single thread
  (FREEZERESTARTTIME=0 in sphere.ini) and no background saving. More tests
  to come.
- Changed the loading procedure so sphere.ini is loaded prior to any message
  being printed to the log file. This allows the LOG= line to be parsed and
  log files to be created in the appropriate folder, so to make sure, LOG=
  line should be among the first in sphere.ini
- Changed the Linux makefile to include the necessary exception flags.
- "return 1" from a skill's @Start or @Success trigger doesn't trigger @Fail. If you
  do want @Fail triggered, set ACTION=-1. This is compatible with .55i scripts, because
  seeing as "return 1" didn't work there, scripts which did mean for @Fail to be triggered
  should already be using ACTION=-1

21-11-2003, Kell
- Linux version now works with secondary threads (FREEZERESTARTTIME not 0),
  and is able to restart the main loop if it freezes.
- Added a toggle to sphere.ini, "EXPERIMENTAL", to allow setting flags
  which enable several experimental features. You will see these referenced
  in the changelog as EF 0x????.
- EF 0x0001 enables a packet fix for Linux servers, for XCMD_Spy. Enable this
  if your clients get a login error.
- EF 0x0002 enables new UNICODE fixes.
- EF 0x0004 enables zorm CanSeeLOS fix. This is required, seeing as that fix
  won't allow you to cast uphill - a minor problem, but worth having a flag to
  toggle that behaviour.
- EF 0x0008 disables interruption of fight skills if the ACT changes. This
  fixes scripts that re-implement combat, and cases where combat with multiple
  enemies would break swings.
- EF 0x0010 enables the INTERRUPT field in SPELL sections. INTERRUPT=100.0 100.0
  SHOULD yield the standard always fail behaviour, as should not having an 
  INTERRUPT line at all. But seeing as this wasn't fully tested, you MUST enable
  this flag to make any use of the interrupt values.
- Suggested value for EXPERIMENTAL field in sphere.ini is:
  EXPERIMENTAL=013

22-11-2003, Kell
- LOSTNPCTELEPORT now checks for homedist, and won't teleport if the NPCs are still
  within home-distance. This allows you to have low values.
- Further stability fixes for Linux version, it should now work fine with background
  world saves.

22-11-2003, Zorm
- Added login crypt keys for clients up to 3.0.3, must add support for packets up to
  0xCC or atleast lengths.
- I think I fixed unicode speech now

22-11-2003, Kell
- Attempted to fix the bug where setting ACT in a @Hit trigger stops
  the swing, by restoring it after the trigger.
- Added SKIPDIFFICULTY (0 by default, or 1) to SKILL sections. Setting it to 1
  skips the hardcoded difficulty check and allows one to do their own skill difficulty
  checks in @Success, and "return 1" in there for a failure.
- Fixed @Select triggers which return 1 leaving the character waiting for an action.

23-11-2003, Zorm
- Experimental Precasting support, enable with experimental flag EF_Precast (flag 020),
  this is not well tested - it's a work in progress. Included here just for the sake of
  getting feedback.

24-11-2003, Kell
- SERV.SPELL(x).yyy, where x is the number of the spell and yyy is a key from the
  SPELLs section, such as MANAUSE or RESOURCES. You can also use RESCAST for a
  descriptive name of resources (much like RESMAKE works for items).
- SERV.SKILL(x).yyy, where x is the skill number and yyy is a key from the SKILLs
  section, such as KEY or TITLE.
- Experimented with breaking SKILL and SPELL sections to seperate files, loading them
  off-order and reloading, no problems found. Notice however that files containing
  SPELL sections must load after the base items (like spheretable_x does).

25-11-2003, Kell
- Changed it so NPCs with SPIRITSPEAK equal or above 100.0 are able to see dead players,
  like healers can. That allows one to use ON = @NPCSeeNewPlayer and an human brain to
  implement NPCs that interact with the dead, without having to put up with healer's
  default behaviour.
- Added flag NORESROBE to sphere.ini. If set to 1, players will not be given a robe
  when resurrected.

26-11-2003, Kell
- Changed SERV.SPELL and SERV.SKILL so that they accept either number or defname
  (SKILL also accepts plain names, like <SERV.SKILL(Magery).TITLE>)
- SERV.ITEMDEF(x).yyy to access data from ITEMDEF sections (similar to the above)
- SERV.CHARDEF(x).yyy to access data from CHARDEF sections (similar to the above)

27-11-2003, Kell
- On the brink of release, fixed a serious problem inherited from .55j where unknown
  keywords being evaluated would *silently* come out untouched. As an example,
  '<SERV.NONEXISTANT>' would silently come out as '<SERV.NONEXISTANT>' instead of ''
  as in .55i. If used with tags, it could end up getting weird values and make it hard
  to catch the error, as no error was being shown. It now returns '' for stuff it can't
  evaluate, BUT also prints an error in the console. I believe this is the best possible
  behaviour.
- Linux version is now declared stable. A minor problem still exists, in that pressing
  CTRL-C in the console is not a good way to terminate the server, and will very likely
  get it into a loop. This is a minor problem though, still trying to solve it. Test
  servers report uptimes of 2-3 days with 10-20 players online (that's all the testing
  I could do).
- Added CANMAKESKILL to test ONLY for the ability to make an item skillwise (it ONLY
  tests the SKILLMAKE line), not resources.
- Added "fval", which works exactly like "eval", but formats the output in x.x format.
- There seems to be an issue with skills that use @Success to cancel a skill, in that
  sometimes the skill won't be registered as finished, and using the skill again will
  show the "you must wait" message. Players can just double-tap TAB to overcome this,
  or you can use ACTION=-1 to force skill termination. Need some feedback on this, as
  this behaviour might actually be due to bad scripts, so feel free to post comments.
- Many issues with the default 

---- 0.55 R2a -----------------------------------------------------------------
---- 02/12/2003

30-11-2003, Zorm
- Fixed text going all uppercase sometimes and gm body commands.

01-12-2003, Kell
- Added @EquipTest and @ItemEquipTest (return 1 cancels equiping).
- Changed @SkillItemMake so that "return 1" only deletes the item if it's container hasn't
  been set.
- Fixed bug with skills apparently not finishing (also fixes cartography).
- Fixed summoning bug (Linux only). This has to do with doing propper memory initialization
  prior to using points.
- Removed all specific handling for SERV.xxx(y).zzz and made it generic. You can now use
  either syntax: SERV.xxx(y).zzz or SERV.xxx.y.zzz.
- Changed default release options for speed optimization.

02-12-2003, Kell
- Fixed REAPAMOUNT / AMOUNT. It can now take multi-point values in a format similar to
  ADVANCE for skills.
- Added SPEECHSELF= to sphere.ini, to allow setting the name of the speech trigger that
  should be called to intercept player speech. Suggested: SPEECHSELF=spk_player
  "return 1" in said trigger stops the player from actually talking.
- Removed hard coded "home home home" - one can just use the default spk_player speech if
  that feature is desired (but mostly it's not)
- Added SPEECHPET= to sphere.ini, to allow setting the name of the speech trigger that
  is called when a pet listens to its master. "return 1" in said trigger stops the pet
  from listenning.

---- 0.55 R3 rc1 --------------------------------------------------------------
---- 08/01/2004

09-12-2003
- Added TAGs to CHARDEF/ITEMDEF sections. If a TAG does exists at an instance it overrides
  the def value.

10-12-2003, Kell
- Added OptionFlags to sphere.ini, to set multiple options. These will be named OF_
- Added OF_Magic_IgnoreAR = 0001, so that AR doesn't count to stop damage spells.
- Added ACTDIFF to characters to obtain the current action difficulty.
  Suggestion: One can use ACTDIFF to modify difficulty within skill Start triggers.
- Added a 6th parameter to the EFFECT command, the hue for the effect.
- Added @Effect trigger to spells, triggered after @SpellEffect
- <TAG0.xxx> can now be used to assume "0" as the default value for a tag.
- TAG0.xxx = yyy can now be used, if yyy is 0, then no tag will be recorded (same as setting
  to a zero length string)
  Using TAG0, you can thus have tags that are only recorded if they are not 0. This is great
  for tags that are usually 0 and are often used (e.g. tags that must exist on all characters).
- Added VAR0 (same functionality as TAG0, but for VAR).

11-12-2003, Kell
- Added OF_Magic_CanHarmSelf = 0002, so that spells with SPELLFLAG_HARM will still affect the
  caster (useful for SPELLEFFECT in scripts)
- Changed rand(x) to allow a 2nd parameter rand(x,y) and return a random number between x and y,
  if y is present.

12-12-2003, Kell
- You can now use @color,font in SYSMESSAGE and MESSAGE. font ranges from 0 to 9, and I quote:
      FONT_BOLD,  // 0 - Bold Text = Large plain filled block letters.
      FONT_SHAD,  // 1 - Text with shadow = small gray
      FONT_BOLD_SHAD, // 2 - Bold+Shadow = Large Gray block letters.
      FONT_NORMAL,  // 3 - Normal (default) = Filled block letters.
      FONT_GOTH,  // 4 - Gothic = Very large blue letters.
      FONT_ITAL,  // 5 - Italic Script
      FONT_SM_DARK, // 6 - Small Dark Letters = small Blue
      FONT_COLOR, // 7 - Colorful Font (Buggy?) = small Gray (hazy)
      FONT_RUNE,  // 8 - Rune font (Only use capital letters with this!)
      FONT_SM_LITE, // 9 - Small Light Letters = small roman gray font.
- Changed SKILLMAKE to allow getting an individual resource in the list. SKILLMAKE.1 gets the first,
  SKILLMAKE.1.VAL gets the value and SKILLMAKE.1.KEY gets the associated resource key.

13-12-2003, Kell
- Added "RELEASE" to character verbs, does the same as "release" when spoke to a pet.
- Added @NPCFollow trigger, called when an NPC is following someone.

14-12-2003, Kell
- Changed ATTACK to accept as parameter the UID of the character to attack.
- Changed TRY to make no plevel or touch/distance checks. Use TRYP if you want those checks
  (TRYP 0 only checks for touch/distance, not plevel).
- Added an useful keyword to scripts, that allows one to use "OBJ" as pointer to an item. It's
  similar to ACT but it can be used anywhere. 
  Example:
     OBJ  = <UID>
     SAY You are <OBJ.NAME>, with uid <OBJ.UID>.
- Changed MEMORY to allow an UID as parameter, so you can now find the memory related to a specific
  UID. If no argument is used, it uses SRC's UID as usual. Also changed it to be read/write.
  Example:
     MEMORY <SRC.UID> 0200  // set memory 
     SAY Memory flag regarding <UID> is <MEMORY.<SRC.UID>>.

15-12-2003, Kell
- Changed @UserSkills so that <argn1> is the number of the skill being updated, or -1 for the skill
  list. This allows one to stop sending of skill updates to the client.
- NPCs will not say "Yes Master" if SPEECHPET is set in sphere.ini (you can script it in the speech
  triggers if you want them to). If SPEECHPET isn't set, they still won't say anything unless they
  can see their master (which is great for GMs). Players will no longer respond "Sorry".
- Resource gathering was changed so that the SKILLMAKE of the resource item is checked. Resources
  which fail the canmake check are ignored and aren't part of the randomization process. If for some
  reason one wants to go back to the old style, just comment SKILLMAKE on the ore itemdefs.
- Added OF_Skill_DiffFirst = 0008. With this flag turned on, difficulty for a skill is calculated BEFORE
  calling @Start/@SkillStart. This has the advantage of allowing the difficulty for a skill to be changed
  via ACTDIFF within that trigger. Notice that for a skill to fail, ACTDIFF must be set above the current
  (modified) skill. Setting ACTDIFF to a negative value means that the skill will abort, that is, @Fail
  will not be called and no skill gain will be attempted. To always fail set ACTDIFF to a value above the
  possible skill (say, 1001).
  This has the sideffect of calling @SpellCast before @Start/@SkillStart. On the other hand, it is the
  ultimate tool for implementing your own skill difficulties.
  Here's an example of making the difficulty for arms lore AT LEAST the same value as for making the item
  (using the primary skill). Characters with skill above ACTDIFF will always succeed.
  ON = @Start
   if ( <SRC.ACTDIFF> < <SRC.ACT.SKILLMAKE.1.VAL> )
      SRC.ACTDIFF = <SRC.ACT.SKILLMAKE.1.VAL>
   endif

16-12-2003, Kell
- You can now use NEWITEM, NEWNPC and NEWDUPE in item scripts, the items will be created into "NEW". Using
  these commands on a character will create the items in both NEW and ACT. If you want to use these
  on a character without changing ACT, use SERV.NEWITEM, etc.
  Example:
    NEWITEM i_gold
    NEW.AMOUNT 100
    NEW.P = <TOPOBJ.P>
  You can also use NEW as a temporary handler, much like you can use OBJ (and to an extenct, ACT).

17-12-2003, Kell
- Functions can now receive "args" when being evaluated, as in <SRC.myfunction Say hello>
- Added RANGE=min,max or RANGE=max (min defaults to 0) for ITEMDEF and CHARDEF. Default weapon range
  is 1. Default character range is 1. Range is calculated as (character + weapon -1). 
  Example: Assuming all characters are RANGE=1 (which they are), putting RANGE=2 in an halberd
  means characters equipping it can hit 1 square further.

18-12-2003, Kell
- The main section for DIALOGs is now fully interpreted like other scripts, allowing you to add logic
  to your dialog, use IFs, etc. The only limitation at the moment is that gump commands are only 
  allowed right in the DIALOG section, and not within FUNCTIONs, but hei... it's better. :)
- Dialogs will no longer conflict with each other, this allows for permanent on-screen dialogs. INPDLG
  works too, seeing as there can be only one INPDLG window onscreen at all times.
- Added RESOURCES.n, RESOURCES.n.KEY and RESOURCES.n.VAL to items/characters.

19-12-2003, Kell
- To make writing dialogs easier, added a cursor and relative coordinates:
     dorigin 50 50  // sets the origin to x=50, y=50
  Using "*" near a coordinate makes it relative to the origin, and displaces the origin by some amount:
     dtext     *0    *10    0    the origin is now x=50 y=60, so is the last location
  Using "+" near a coordinate makes it relative to the last location w/o changing the origin.
     dtext     +10     -    0    adds 10 to X (y=150, o.y=100)
  As an example, imagine writing a list of text with 3 columns, each seperated via 200 x and 20 space
  between each row:
  dorigin 10 10
  // first row
  dtext     *0   -    5   1:
    dtext  +10   -    0   the text for row1, col1
  dtext   *200   -    5   2:    // x orig = 200
    dtext  +10   -    0   the text for row1, col2
  dtext   *200   -    5   3:    // x orig = 400
    dtext  +10   -    0   the text for row1, col2

  And now one only has to go down one row. and the text is quite similar. This isn't too easy to explain, it's
  there for whomever might find it useful. If you can't think of a use for it, just ignore it. ;)
- Fixed the bug with FORCHARS/ITEMS/OBJS and keywords starting with "FOR" (like FORensics).
- Changed textadd and gumptext to collapse equal strings of text to the same index. So if you use
    gumptext 10 20  This is an example.
    gumptext 10 40  This is an example.
    gumptext 10 60  This is an example.
  It will only generate ONE text id. This does away with the need to have a seperate TEXT section. Granted,
  such a section is still useful for keeping strings all in one place (in this case it'd be useful), but it
  is no longer mandatory, it becomes simply a matter of style/choice.

20-12-2003, Kell
- Equal PLEVEL should be able to see each other, so they are now.
- You can now open a dialog in a specific page, with DIALOG  d_dialog_name  pagenumber. This isn't actually
  possible with the UO client - what it does is recalculate the dialog page/button numbers so that the selected
  page is first. It's completly invisible though, and works perfectly.
- Added a new command - DTEXT - to gumps, which does the handling of text ids for you (d stands for dynamic):
     dtext x y color  Actual text comes here.
  Text added with gumptext is actually added to the [DIALOG ... TEXT] section. If you're only using a given
  text string once, then it's actually faster using this than using "text" and adding it to the TEXT section
  of the dialog. Simmilar commands, DCROPPEDTEXT and DTEXTENTRY are also in, also taking text instead of an
  index. DHTMLGUMP is also in, but notice that the syntax is like HTMLGUMP, except that you ommit the ID and add
  the text in the end.
  With these changes, you can completly ommit the [DIALOG ... TEXT] section of dialogs. Only those strings
  that are commonly used throughout the dialog should you put in the [DIALOG ... TEXT] section.
  Internally, both gumptext and textadd simply add stuff to the dialog as needed, and send normal "text"
  commands to the client, so they're safe to use. But they free you from having to keep track of a LONG
  list of numbers, and allow you to shape and modify your dialog w/o bothering with text ids.
- You can now use FUNCTIONs that issue gump commands. So you actually make your own gump commands!!! Death to
  copy & paste dialogs!

21-12-2003, Kell
- Fixed a bug in that setting stats & skills via scripts wouldn't correctly parse things. For instance, numerical
  expressions.
- Started work on MANUAL.TXT, to detail the current state of things like triggers and their arguments, seeing as
  reading this changelog is probably a difficult task for a lot of people.
- Changed args in functions to be writeable. This is useful in scripts, but for triggers, the server will read
  back the values and use the new ones wherever it makes sense. For the time being, these triggers were
  changed:
     @GetHit, ARGN1 is the damage being apllied, ARGN2 the damage type (as usual, but now writeable). 
     @Hit, ARGN1 is now the raw damage being applied, prior to armour (writeable). ARGO is the weapon (if any).
     @PersonalSpace, ARGN1 is the stamina required to move (writeable). "return 1" stops the movement, "return 0"
     allows the movement but shows none of the hard-coded messages. Plain "return" or no return, works as standard.
  @Hit, @HitTry and @HitMiss were also changed so that ARGO is the weapon being used (handy so you don't have to
  be looking at layers n stuff).
  I should add that ACTDIFF is also available, and it can be used to change the difficulty of a skill, even make
  a skill succedd that would otherwise fail (by setting it to 0). It can also be used in @HitTry now, and if
  set to any non-negative value, a missing hit will instead succeed.
- Added StrEat function, which removes a word up to the space, from a string (<streat("hello there friend")>
  or <streat hello there friend> return "there friend")
- Added <SERV.LOOKUPSKILL skill name> which returns the skill number for some text or -1 if not found.
- After some beta-testing, a few fixes to dialogs.
- LOCAL.xxx within functions for LOCAL . They're a bit more efficient on servers with lots of global
  vars due to faster lookups ). LOCAL variables always come up initially as "0".
- ARGN1, ARGN2 and ARGN3 are set for functions with numeric arguments. So whenever possible, use these instead
  of argv. Example: "myfunction  123 50 89" - these 3 values will be parsed into argn1, argn2 and argn3

22-12-2003, Kell
- Functions can now return strings using "return". Notice that this behaves like TAGs, in that if you do
     return 2+2
  then "2+2" is returned, and not "4". You'll have to explicitly call "eval" on what you want
  to return:
     return <eval (2+2)>
  Returning strings causes no extra lag, seeing as the old method of returning a value relied on the same
  string which is returned (EVALed). So it is actually faster (although hardly noticeable).
  This might pose a problem problem if you have "return rand" or similar, instead of "return <eval rand..."
  seeing as multiple uses of the return value re-evaluate it, generating a new random number - again,
  similar to TAGs.
  MAKE SURE YOU HAVE "EVAL" on your "return" lines, wherever you want the result of a calculation to be
  returned. The next version will probably not have an EF_ReturnString flag.

- Modified the profiling function to keep track of average consumption over time. The average time is
  calculated each second as 90% of the previous average time plus 10% the current time. This poses some
  resistence to spikes. 
- Added a new keyword to @Create / @NPCRestock and template scripts: FULLINTERP. Set FULLINTERP=1 to allow the
  use of functions, ifs, etc. Example:
  ON = @NPCRestock
     ITEM=i_cape
     FULLINTERP
        ITEM=i_robe
        MY_FUNCTION_CALL
  You can use FULLINTERP 0 to disable the feature, after you've enabled it, but it's usually pointless, seeing as
  this FULLINTERP affects only the remainder of the current script. Bear in mind that the usual restrictions apply,
  seeing as the created NPC is not ingame yet.

23-12-2003, Kell
- Added access to TERRAIN and STATICS either via P.key, MOREP.key or SERV.MAP(x,y).key, with key being one of:
    TERRAIN The terrain ID
    ISDIRT  Checks the terrain ID to see if it's dirt.
    ISGRASS guess
    ISROCK  dunno
    ISWATER guess again
    STATICS Number of statics in the position
    STATICS(n)  ID of static Nth static ( eg: <SERV.MAP(200,300).STATICS(0)>. Shows no error in the console
    if static isn't present, returning 0 - useful to test for a static w/o counting or looping.
    STATICS.n   same
    STATICS(n).key  Get a key from the appropriate ITEMDEF. eg: <SERV.MAP(200,300).STATICS(0).NAME>

- Added basic iterator construct, WHILE, with the following syntax:
     WHILE ( condition )
  // do stuff, current iteration number in <LOCAL._WHILE>
     END // or ENDWHILE

  also added FOR, terminated with either END or ENDFOR, with the following syntax:

     FOR 5  // loops from 0 to 5, current iteration number in LOCAL._FOR
  or FOR 3 5  // loops from 3 to 5, current iteration number in LOCAL._FOR
  or FOR K 5  // loops from 0 to 5, current iteration number in LOCAL.K
  or FOR K 3 5  // loops from 3 to 5, current iteration number in LOCAL.K
  // do stuff
     END  // or ENDFOR

  Changing these LOCAL variables has no effect on the loop.
- Wrote a small assembly function to access the high resolution timer. Works for both windows and Linux,
  now being used in profiling. Profiling works on Linux now. It also looks a lot better in the console
  thanks to the monospaced font.
- Changed the console font under Windows to Courier, which is monospaced, so things come out aligned in
  the console. Under Linux, the console is naturally monospaced.
- You can now add new SKILL sections, up to 70. SERV.MAXSKILL tells you how many skills are loaded. Notice
  that they won't be sent to the client though, the client doesn't support them (hint: @UserSkills). There
  is also a FLAGS key for SKILL section, with the following values:
     [DEFNAME skill_defs]
     SKF_SCRIPTED 01  // no hardcoded behaviour, only triggers are called.
     // feel free to add new tags you find useful, but only above 01000 please, to make room for future
     expansion
  This is heavily experimental, mess with it at your own risk.
- SKILLSELECT skill - force a button select event on the skill list

24-12-2003, Kell
- Fixed TYPEDEFS section in spherefs.scp loosing values when resynced.
- Added <CANMOVE dir>, takes a direction as argument (like WALK), returns the area ID we're moving to,
  or 0 if no move is possible.
- Added <MOVE dir>, takes a direction as argument (like WALK), returns the TILE flags for that position.
  Notice that flag 04 is walkable. Here's a list of flags, you can copy&paste it into spheredefs.scp. This
  keyword might change in the future.


[DEFNAME tile_flags]      // by Shadowlord
tilef_background  01    // No idea. None whatsoever. Maybe it's the blackness.
tilef_weapon    02    // I smack thee with this here ... club?
tilef_transparent 04    // Yeah. So we can see through it?
tilef_translucent 08    // Okay...
tilef_wall    010   // Hey look, we can't walk through it!
tilef_damaging    020   // Lava, perhaps? Fires, hmm!
tilef_impassable  040   // Mountains and stuff, I'll wager.
tilef_wet   080   // Water? Or mud? Or a slick road in a rainstorm? Probably the first.
tilef_unknown   0100    // Uh...
tilef_surface   0200    // Tables or something?
tilef_bridge    0400    // I wonder why they'd have a flag for that.
tilef_stackable   0800  
tilef_window    01000   // So we can see/shoot out?
tilef_noshoot   02000   // ? We can't shoot out or something? So, like a glass window maybe?
tilef_prefixA   04000   // A card
tilef_prefixAn    08000   // An apple
tilef_internal    010000    // hair, beards, etc
tilef_foliage   020000    // Probably bushes and tree leaves and stuff.
tilef_partialHue  040000    // semi-glowy?
tilef_unknown_1   080000    // Well, gee. I should see if it's used on anything...
tilef_map   0100000   // Sounds good to me.
tilef_container   0200000   // They flag these!?
tilef_wearable    0400000   // Omigod!
tilef_lightSource 0800000   // I'm getting tired of typing repetitive shiznit now.
tilef_animated    01000000  // Like fire again. And stuff. Those spinny propeller thingies!
tilef_noDiagonal  02000000  // !?!???!!?
tilef_unknown_2   04000000  // I really hope some of these unknowns are n/w/s/e facing flags.
tilef_armor   08000000  // Armor, okay, so does that count shields? Hmmm?
tilef_roof    010000000 // "Don't fall through me!" Or why isn't it just flagged surface or something?
tilef_door    020000000 // Okay...
tilef_stairBack   040000000 // Don't we have stairs that go forward or left too? This could cover both...
tilef_stairRight  080000000 // Well, whatever, you can climb them, so, hey... Good use for a 

NOTE :  EF flags change from version to version, so make SURE you're using only the EF
  flags you want, if any.

SUMMARY of flags for Sphere.ini:
OptionFlags=  // Flags for options that affect server behaviour but not compatibility
  0001    // OF_Magic_IgnoreAR
  0002    // OF_Magic_CanHarmSelf
  0004    // OF_Magic_StackStats      (Do NOT set this yet)
  0008    // OF_Skill_DiffFirst
  0010    // OF_Archery_CanMove
  0020    // OF_Magic_PreCast

Experimental= // Flags for options that affect server behaviour and which might affect compatibility
  0001    // EF_XCMD_Spy
  0002    // EF_UNICODE
  0004    // EF_CanSeeLOS
  0008    // EF_ReturnString
  Suggested value: EXPERIMENTAL=01

- It's Xmas! So I'm off to eat some turkey for the next 48 hours. :) Does this count as an entry in the
  changelog?

27-12-2003, Kell
- Added support for color & render mode in EFFECT. If no color or render effect are specified, old
  effect packet is still sent (which spares 8 bytes). Otherwise the new packet type is sent. Tested
  and works with clients from 2.0.3 (should work on all 2.0.* series).
- Consolidated support for 3.0.* clients, they should work fine, up to LBR (they already worked, just
  spitted some error messages).
- Added modulus (%) operator in numerical expressions (eg: 12 % 3 == 0).
- Added SENDPACKET command for clients. To make it easier to send WORD(2 bytes) and DWORD(4 bytes) values, 
  allowed for 'W' and 'D' prefix to values ('B' is also supported for byte but it's redundant). Here's an
  example, of setting light level:
     SRC.SENDPACKET   04e  D<SRC.UID>  20
  Both 04e and 20 could use the prefix B, but notice how <SRC.UID> uses the prefix D to specify it takes
  the space of a DWORD (4 bytes). So much for complex scripts to break multi-byte stuff in bytes :p
  Notice also that each of the parameters is evaluated and truncated, and only then used. For instance,
  if you put 0fffffffe (which obviously isn't a byte) in place of a BYTE, what you'll get is effectively
  0fe. If you put (2+2) it'll be evaluated to "4" before being used.

28-12-2003, Kell
- Added OSTR, ODEX, OINT.
- Added MODSTR, MODDEX, MODINT - spells affect these.
- STR, DEX and INT are always equal to O + MOD (for the relevant stat). If you have OSTR=50, MODSTR=0 and
  then do STR=60, you will get MODSTR=10 (and OSTR unchanged). 
  *** CHANGED *** read the entry for 19-01-2004
- Added MAXHITS/MAXMANA/MAXSTAM. If set to 0, it defaults to the base max stat (eg, MAXSTR defaults to STR).
  MAX always contains MOD for the appropriate stat. That is to say that if you have MAXHITS=100 and MODSTR=10
  then internally it'll be recorded as MAXHITS being 90, and if MODSTR changes, so does MAXHITS. This makes
  it coherent for stat spells, seeing as they not only change your stats but also max hits/stam/mana.
  To make hits depend on STR again, use
     MAXHITS =  // don't use a value
- You can now write TAGs on accounts. Both TAG and TAG0 are available.
- LOCAL._WHILE fixed, within WHILE loops.
- Changed dialog BUTTON sections to allow 
     ON = min max
  to grab any button with buttonID between min and max (including). Also, argn1 is the buttonID that
  actually got selected (even when specify just a buttonID and not a range, as usual). With the buttonID
  in argn1 you can write more generic functions with little fuss.

29-12-2003, Kell
- Fixed some skills not getting currectly terminated when another skill was used before they finished. An
  example of this is Spells not fizzling when a skill was used before spell ended.
- For skills, @Fail is now only triggered when failure occured due to normal circumstances (eg, failed
  difficulty). @Abort is called when failure occurs due to a situation that aborts the skill, such as
  using a new skill before finishing the previous one or an invalid circumstance.
  If @Fail is triggered, it means that the character will still get a skillcheck for failure (skill raise
  through failure), but if you do a "return 1" in there, it won't (check MANUAL.TXT).
- Started implementing propper behaviour for EF_CanSeeLOS. At the moment, it'll check the height of static
  items in the path to the target.
- The use of "SECTOR" to access keywords related to sector is now mandatory. So, to access "light" or
  "rainchance", SRC.RAINCHANCE used to work, you must do SRC.SECTOR.RAINCHANCE. This has several
  advantages - people usually already use SECTOR anyway, so this makes for faster faster execution of
  commands on characters, seeing as it has less things to try. It is also more coherent.

30-12-2003, Kell
- Fixed a small problem with KARMA/FAME that had the huge effect of blocking the client once it got different
  than 0.
- Added FEATURES= to sphere.ini, to define the features the server will enable on the clients upon connection:
   0001 - (T2A) enables chatbutton
   0002 - (LBR) enables LBR sound (plays MP3s instead of MIDI)
   0004 - (T2A) enables T2A update
   0008 - (LBR) enables LBR update (shows monsters)
  Standard .55i automatically enabled 0001 - but you could disable it.
- DIALOGCLOSE command. First argument is the dialog name, second argument is the button that should be
  triggered on the dialog - 0 if not specified. (eg: DIALOGCLOSE d_my_dialog).
  You can put this as one of the first commands in a DIALOG section, to ensure there is only one dialog of
  that type on the client.

02-01-2004, Kell
- Added connection control keywords to sphere.ini - a value of 0 disables
  any of these settings. These settings are not dumb proof. Make sure you
  know what you're doing if you set these:
  * ConnectingMax=x, where x is the maximum number of clients that can coexist
      in non-game state (http, login, etc). Older clients that are not ingame
      get disconnected when new ones come in. Default: 24
  * ConnectingMaxIP=x, as above, but per IP. Only a maximum of x simultaneous
      "not in game" connections will be allowed per IP. Notice that HTTP
      requests for instance, count as "not in game". Default: 8
  * ClientMaxIP=x, maximum number of connections per IP. This is intended to
      stop flooders, DO NOT SET THIS TOO LOW, or you risk looking stupid. There
      are MANY situations where connections can appear as comming from the same
      IP - a common one is people connecting from cybercaffes. Default: 0
- Fixed a serious bug where login errors (Bad Login) could leave a lingering
  socket. This happened because sockets were made invalid so that they'd get
  closed on the next read cycle, therefore losing all information about the
  socket. Clients are now flagged for disconnection, and socket handling is
  done when clients are freed.
  This means that there should always be a "disconnected" message to pair
  with a "connected" message.
- You will see two numbers after the IP in connected/disconnected messages.
  The first is the number of connections from that IP which are not in-game,
  whereas the second is the total number of connections from that IP.
- In savefiles, OSTR and MODSTR are now saved instead of STR. If "STR" is found,
  it'll be interpreted as OSTR. This works fine to convert old worldfiles, even
 if you have spells, because once they wear off they'll simply make your MODSTR
  negative. This works for all stats obviously (simply using STR as an example).
- Changed it so that the first time you set a stat on an NPC, if the Ostat is 0,
  it'll update Ostat not MODstat. In other words, and as an example, if you do
  STR=20 in @Create, you'll end up with OSTR=20 and MODSTR=0. If you then do
  STR=30 on the same NPC, you'll end up with OSTR=20 and MODSTR=10. 
  **** changed **** see the entry for 19-01-2003
- Fixed a small problem from R3.13 with stat affecting spells not setting MODstat
  correctly.

03-01-2004, Kell
- Added unary operators "*=", "+=", "-=", "/=", "%=", "|=", "&=" and "!=". Internally,
  what these actually do is change a line in the format:
    XXX += YYY
  to
    XXX = <eval (<XXX> + (YYY))>
  So you can do stuff like
    MANA  += 10/2     // same as MANA = <eval (<MANA> + (10/2))>
    ATTR  &= ~attr_magic    // same as ATTR = <eval (<ATTR> & (~attr_magic))>
- Added ".=" operator, to do string concatenation. Internally what it does is change a line
  in the format
    XXX .= YYY
  to
    XXX = <XXX>YYY
  This is intended to be used with things that can support strings (NAME, TITLE, VAR, LOCAL, etc)
- First attempt to implement propper LOS check counting with z. To have LOS, you must be
  able to walk in a straight line to the target (no news here) AND finish at a reasonable
  height, climbing your way to it. So, if you're on a slope you might have LOS, but if
  you're standing one floor below you won't. These extra texts have no measurable impact on
  performance Enable this behaviour with EF_CanSeeLos (04).
- Diagonal walking (eg, NW) is allowed only if the character can move ortogonally in both
  directions (NW -> N and W). This takes care of a few clientside exploits, as well as NPCs
  walking through corners. Enable this behaviour with EF_DiagonalWalkCheck (010)
- For the effect of stepping on them, all items were considered to have a height of 3. If you
  are standing higher than 3 above an item, you wouldn't trigger a step on it. Changed it so that
  if the item's height is above 3, that value is used, and not the hardcoded "3". This allows
  one to get @Step events on stuff like tables.
- If no SRC is defined at the time of a @SpellEffect trigger, then the character subject to the
  spell will be considered the SRC. This fixes SPELLEFFECT under @Timer triggers.
- Added @NPCLookAtChar and @NPCLookAtItem triggers (check the manual). Do not abuse of these
  triggers, as they will affect the CPU usage.

04-01-2004, Kell
- Added ISNEARTYPE, first argument is type, 2nd argument is max distance to search ( if not
  specified, 4 is the default ). Also added ISNEARTYPE.P, which returns "0" if false or the
  point coordinates if true.
- Changed DISTANCE to accept the UID of an object (item/char) to compare the distance, or a
  point. One can now write things like
     <DISTANCE <MOREP>>  <DISTANCE trinsic>  <DISTANCE <SRC.ACT.UID>>
  If no argument is supplied, then SRC.UID is used (as default). If the point/UID is invalid
  an error is printed to the console.
- Made TIMERD readable (its precision is 10x that of TIMER, same scale of SERV.TIME).
- Made USEITEM not check for visibility. The whole purpose of this keyword is to allow
  activating an item via scripts w/o testing for touch, so it doesn't make sense to test
  if the item can be seen. DCLICK performs the usual tests though. The "USE" keyword already
  allowed one to do "USE 0" not to test for touch, but it also tested for visibility, and it
  won't anymore if used like "USE 0".
- Spawns gems now instantly update the display as soon as you set MORE1.
- Double clicking an already negated (more2=0) character spawn sets its timer to 1 so it
  respawns next turn.
- Added MOVENEAR keyword for objects(items/chars). 1st argument is the UID of item to move
  near to, 2nd argument is the distance to the item. If 3rd argument is present and "0",
  then the item will not send an Update. Example:
     ON = @DClick
        MOVENEAR <SRC.UID> 5  // move to 5 steps away from SRC
  Notice that this movement respects walls & such (which is why it is useful).
- Set ARGN1=1 in @Login not to show MOTD scroll.

05-01-2004, Kell
- Fixed possible exploit with \n and textentry and inpdlg.
- AREA and ROOM sections in the following format
     [AREA name here]
  Should now be written as
     [AREADEF a_some_def] // ROOMDEF for rooms
     NAME=name here
  The advantage of this format is that you can resync it w/o having conflicting regions.
  Suggestions:  Keep your areas in different formats in seperate files. Either find a script
    to convert your old format to the new one or slowly convert by hand.
    Move [Teleporters] and [Moongates] to their own files (these can't be resynced).
  Note:   You do NOT have to use the new format. It is, however, strongly suggested, as
    it allows you to change an area without rebooting.
    Any future ability to save things on regions will only be available for regions
    in the new format (or regions that have a DEFNAME).
- Added CALL instruction to invoke a function, but sharing the LOCAL variables with the called
  function. Quite useful when you want to break a function in small pieces that are logically
  yet not functionally seperate. In other words, if you invoke a function with CALL, all your
  LOCAL will be available to the underlying function. Example
    [FUNCTION myfunction1]
       LOCAL.VAL1 = 12
       CALL myfunction2 1, 2    // LOCAL.VAL1 will be available to myfunction2
       // if myfunction2 changes LOCAL.VAL1 it will change here aswell.
  If you do not pass arguments to the called function, then args/argn/argv are also shared,
  and the process is faster than invoking the function w/o CALL. If you pass arguments to the
  function, then only LOCAL is shared, and the process is an infinitesimal amount slower. Not
  noticeable, no real impact, but conceptually slower. 
  This can also be used as <CALL Function ...>, faster without arguments, slower with.
- Recently realized that ALL DEFNAMEs are put into VAR. That means that all itemdefs, chardefs,
  etc have an entry in VAR (try <VAR.i_dagger> ). Now, this is potentially confusing and source
  for many problems:
     1) Whenever you're trying to access a VAR, you go through ALL the existing defnames.
     2) You can accidentally create a var that is also a defname... and oooooops!
  So to cope with this, changed it so that VAR/VAR0 only contains global variables that can be
  modified, whereas DEF/DEF0 contains item defnames and can only be read. The difference in speed
  is visible! EVERY time you were accessing a VAR you'd be searching through an array with a few
  thousand elements. Now each lookup searches only through the variables your scritps have created
  (which even on an extremely scripted shard shouldn't reach a hundred).
  This also makes it possible to identify WHICH variables are supposed to be saved.
  Although this is a huge change internally, it won't affect scripts except in the following
  situation:
     1) You defined a DEFNAME flag in scripts that you then changed during execution. This is
        highly uncommon, but if you decide you need this sort of behaviour just create the create
        the VAR once via scripts, it will be saved to spherevars.scp.
     2) You were accessing DEFNAMEs via VAR. No real reason to do it, seeing as DEFs / VARs can
        be accessed w/o the VAR. prefix.
  If not using DEF or VAR to access a variable, you'll get first the VAR if exists, and then the
  DEF. That means that old behaviour is kept.
- VARs are now saved to spheredata.scp. If that file isn't present at boottime the shard will print
  a warning, but it will continue, and it'll be created on the next save.
- GMPages will now be saved to spheredata.scp. Too many people are interested in parsing these to
  make special stuff (eg webpage interfaces or mirc scripts), so now they won't have to parse the
  whole world to read in this stuff.

06-01-2004, Kell
- Added "S" flag to SENDPACKET, allows one to send strings of characters directly. String is not
  within quotes it stops at the first space. Example
     SENDPACKET 00 S"This is the string to send" 0
     SENDPACKET 00 SUpToTheSpace 0
  If the string must be null terminated, simply put a 0 in there, as above. Otherwise, you'll probably
  need to specify length (strlen function) - depends on packet
- Added new walk limiting code, wildly based on the bit-bucket algorithm used in IP QoS DiffServ
  routers: there is a maximum speed at which you can walk (it's fixed, different walking or foot). If
  you walk faster than that speed, every tenth of second you walk faster than expected is a point you
  loose. Every 10th of second you take above the time expected is a point you win. The number of points
  you start with and the maximum is WALKBUFFER in sphere.ini, and I've tested it with values
  around 40 for good connections and 70 for laggy connections.
  If a player speedwalks, he'll soon drop below 0, and stop moving, then have to compensate with equally
  slow walking periods, like it happens when there's a burst of lag.
  WALKREGEN is the speed at which you regen walk points, in percentage.
  Default values: WALKBUFFER=50   WALKREGEN=25
  Hints:
  WALKBUFFER  lower for more strict control. However, setting it lower also increases the
        chance of limiting someone which is just experiencing lag. Raise this value
      if you lower WALKREGEN.
  WALKREGEN set lower for longer-lasting punishments. It makes sense to lower this value
      if you raise WALKBUFFER.
- Removed some EF_ flags that are no longer necessary seeing as they proved to be harmless. Make sure
  you consult MANUAL.TXT.
- Changed trigger @DropOn_Item and @ItemDropOn_Item to be activated for container items too.
  Activated when item with the trigger is dropped on another item (dropped on something else).
- Added @DropOn_Self and @ItemDropOn_Self, activated when an item is dropped on the item with the
  trigger (something was dropped on self).
- Implemented trigger @DropOn_Char and @ItemDropOn_Char.
- If these triggers fail, will only bounce the item if it's still being dragged. That allows the
  scripts in the triggers to define a new place for item.
- Made sure clients can only drop stuff into the bankbox if they are standing in the place where it
  was opened. This could now be checked within scripts aswell.
- Fixed an Injection exploit regarding accessing the bank away from the place it was opened in.
- Added @SkillGain and @Gain triggers. Check MANUAL.TXT for more info.

07-01-2004, Kell
- Automatically assign a DEFNAME to areas and rooms defined in the old format (AREA / ROOM). This
  defname is built upon the NAME, and is made unique by adding a number to it.
- In the console, you can type "d a" to output all the areas and rooms to a file "map_all.scp". I
  strongly suggest you replace your map with this file, as it'll allow you to finally get rid of the
  old format.
  NOTE: Teleporters and Moongates aren't saved in this file, so you should split those to a different
  file, to allow areas to be resynced.
- It is strongly suggested that you do the above, and get rid of the old format areas/rooms. Doing it
  has the following advantages:
  * Loading will be faster, because the server won't have to try and find a good defname for areas.
  * You can edit areas, and resync (even change their name) with no conflicts.
  * TAGs on areas are only saved for areas that have a valid DEFNAME, so if you do this, TAGs will be
    saved on all your areas.
- Added @Targon_Cancel for items.

---- 0.55 R3 rc2 --------------------------------------------------------------
---- 25/01/2004

08-01-2004, Kell
- Fixed VERBOSE=1 causing a catrazillion errors at boot.
- .CAST and .TELE won't show "bad command" sysmessage when they fail.
- If TRY/TRPY are called with an invalid command, they will send the error to the console and not to
  the player. This is coherent with how scripts should behave.
- Fixed NPCs not starting with max stats when MAXxxx is used.
- Fixed .admin showing only your own IP.

09-01-2004, Kell
- .serv.account unused xxx  delete
- .serv.account add test // missing password will no longer crash
- killing characters with positive karma (actually, it's about commiting a crime, not karma)
- .info not returning to dialog after changing a value (actually, INPDLG wasn't returning to dialog)
- flags on UIDs preserved (040000000 for items, 0d2000000 for skills, etc). GLOBALS renamed to WORLDVARS
  due to this (won't go into details here).
- SERV.LOG fixed.
- Fixed plevel 1 players seeing other plevel 1 hidden players
- Added USEHTTP=0/1 in sphere.ini, to disable/enable the built-in HTTP server.
- Added USEGODPORT=0/1 in sphere.ini, to disable the port opened at +1000. As far as I can tell, there is
  really no purpose for that port except taking in connections, much like the standard port you set. So it
  ships disabled by default.

10-01-2004, Kell
- Fixed a bug where redefining a base type (one in the TYPEDEFS list in spheretables.scp) could lead
  to a crash.
- Added a way to assign a TYPEDEF to a terrain type. This means you can define what terrain types are
  water, for instance. Example:
    [TYPEDEF t_water]
    TERRAIN = 00a8  00ab
    TERRAIN = 0136  0137
  This information is then used by ISNEARTYPE (and it has effect on all the hardcoded behaviour)
  when trying to assert if there's t_water around.
  Notice that ISWATER checks wether a terrain type is t_water, whereas <ISNEARTYPE t_water> would check
  for terrain, statics and dynamic items.
- Changed TYPE when called on an SERV.ITEMDEF.xxx.TYPE to return the typename, and not just a value. So
  when called on an water item it should return t_water, and not "30". This also has affect when using
  STATICS.x.TYPE.
- Fixed not being able to access properties of TARGP, as in <SRC.TARGP.X> or <SRC.TARGP.TERRAIN>.
- Added "TYPE" to the keywords available on a point. It uses the information above to return what item
  type is the terrain at that point. So you can do TARGP.TERRAIN.

11-01-2004, Kell
- Changed .info command to show the type associated with the terrain (t_normal if none).
- Wrote sphere_types.scp - it is a REQUIRED script, as it associates terrain IDs to item types. This
  replaces the old hard-coded behaviour (which by the way, was slower). By replacing it, I see no
  need to keep the old code, seeing as all you need is to have this script, which will be distributed
  from now on.
  Add sphere_types.scp in spheretables.scp right after sphere_defs.scp.
- Removed ISWATER, ISGRASS, ISROCK and ISDIRT commands from points (they were introduced in R3). Please
  use TYPE instead. For instance, use (<P.TYPE> == t_water) wherever you'd use <P.ISWATER>. Some might
  have grown attached to these commands, but unified and coherent scripts are certainly better than
  different methods for doing the same. Besides, this offers a lot more control (e.g.: <P.TYPE> == t_lava)
- Added ISNEARTYPE to the keywords accepted by points. So you can do <SRC.TARGP.ISNEARTYPE t_water> and
  that will effectively test terrain type, statics, and dynamic items. This is probably what most people
  will want to use, seeing as P.TYPE only test for terrain (and not statics or dynamic items).
- Added EF_New_Triggers (010). If set, allows the use of @NPCActFight, @NPCActFollow, @NPCLookAtChar
  and @NPCLookAtItem. This flag was added because even having these triggers *might* have some impact
  upon performance in very busy shards. 
- Removed a "Weird layer" message from whenever you equipped an item to layer_hidden. This is quite an
  useful layer for people wanting to expand their shards, so there's really no reason for this error.

12-01-2004, Kell
- Fixed "b" in console not working.
- Added DISTANCEYELL, DISTANCETALK, DISTANCEWHISPER to sphere.ini - a value of -1 turns it into a
  broadcast.

13-01-2004, Kell
- The @Create trigger for items works as any other item trigger - it can be fully scripted.
  After a LOT of work, you can now also check for SRC under item's @Create. There are situations where
  an item can be created without an SRC, but in most cases, there will be one. Eg:
  ON = @Create
     if ( <SRC.UID> )
        SRC.SYSMESSAGE You have created an item!
     endif
  Bear in mind that @Create is created before the item by the server, so it can still suffer transformations
  after it's been created. Particulary, you won't be able to REMOVE an item under a @Create trigger - it
  will have no effect.
- Added ISEMPTY and ISNUM. Eg: <ISEMPTY <VAR.TMP>> or <ISNUM <VAR.TMP>>. 
- Added STATICS.FINDID.xxx - it will take you to the ITEMDEF of the static item with the supplied ID
- Added @ResourceTest to REGIONRESOURCE sections, called once for each resource in the region that the
  character is able to find.
- Added @ResourceFound, triggered after a resource has been selected (@ResourceTest has been called for
  all resources available). ARGO is the resource bit to be placed at the location. "return 1" keeps the
  resource bit, but sets it to be empty.
- Added DEFMESSAGE section for scripts, allows setting of strings to be used by the server. More will be
  added - work in progress. You now REQUIRE a script with these strings.
- Fixed RESOURCES.xxx.val and .key.

19-01-2004, Kell
- Fixed a bug with getting stuck on stuff.
- STR, DEX and INT are always equal to O + MOD (for the relevant stat). If you have OSTR=50, MODSTR=10 and
  then do STR=70, you will get OSTR=60 and MODSTR unchanged.

21-01-2004, Kell
- Changed max height difference on CanSeeLOS from PLAYER_HEIGHT/2 to PLAYER_HEIGHT, so that you can access
  chests on top of a table.
- Removed the password being shown on console when a password error occurs.
- Made .x* and .set* commands respect PLEVEL. You also need plevel to use the "SET" command to use .x and .set
  commands.
- Slightly smarter NPCs against field spells - they will avoid them more often depending on INT.
- Fixed another spot where SRC was undefined in @Create (there might still be more of these).

23-01-2004, Kell
- Fixed buying multiple pets from animal trainers.
- Fixed a bug in FOR where counting down wouldn't work (eg: FOR 10 1 works now)

24-01-2004, Kell
- Fixed bug with NPCs going stale (their timer going -1) - particulary pets.
- Fixed @Effect in SPELL sections to work and have same arguments as @SpellEffect.
- Added SPELLFLAG_SCRIPTED (010000) so that one can more easily override the default behaviour of
  spells.

25-01-2004, Kell
- Fixed yet another exploit, with sending a hacked Author in books (tks Balkon)
- Added PROMPT_MSG to SPELL sections and disabled the hard-coded messages. You'll have to fill in the
  prompt messages for the spells.

---- 0.55 R3 rc3 --------------------------------------------------------------
---- 06/02/2004

25-01-2004, Kell
- Fixed a bug with @Gain trigger, that regardless of it even existing would reset the skill to the skill
  being tested. This turned out in Parrying skill interrupting combat, and other buggy skill behaviour.
- Added EF_Scripts_Parse_Verbs (040). If enabled, verbs (the 1st command in a script line) are parsed
  before execution, thus making "TRY" obsolete for that purpose. Example:
     LOCAL.MYSTAT = MODSTR
     // the following line is parsed to become: str = <<local.mystat>> + 5
     <LOCAL.MYSTAT> = <<LOCAL.MYSTAT>> + 5
     SYSMESSAGE Stat '<LOCAL.MYSTAT>' increased to <<LOCAL.MYSTAT>>.

26-01-2004, Kell
- Renamed SPELLFLAG_TARG_OBJ to SPELLFLAG_TARG_ITEM. This is really an internal change, but you should
  change spheredefs.scp to be:
  SPELLFLAG_TARG_ITEM 000002
  SPELLFLAG_TARG_CHAR 000004
  SPELLFLAG_TARG_OBJ  SPELLFLAG_TARG_CHAR | SPELLFLAG_TARG_ITEM
- Made sure a character can only be targeted by a spell with SPELLFLAG_TARG_CHAR, and that an item
  can only be targetted by a spell with SPELLFLAG_TARG_ITEM.
- Modified TARGET command to allow 3 possible suffixes (in this order): F, G and W. So you can do
  TARGETGW, TARGETFW, etc. 
  F - Call a function after target ( eg: TARGETF f_rename )
  W - Warn against criminal action
  G - Target ground
- Made sure flags in the CAN= field for ITEMDEFs work correctly. A few items are missing these flags,
  such as i_wall_stone_7 missing CAN_I_BLOCK (so NPCs walk through them).
- Added MULTICREATE command, so you can place multi items via scripts: first set their position then
  call MULTICREATE to build them permanently.

27-01-2004, Kell
- Added EF_New_Maps (020), which enables the mapchange packet (0bf, subcmd 08). If enabled, moving to
  mapplane 1 or 2 will send a packet for the client to see the appropriate map, and moving to other
  mapplanes will send the packet changing back to basic map. This allows one to see the new maps.
  However, there is NO support on the server for new maps. That means that you're walking on the new
  map only on the clientside, while on the server you're walking on the standard map.
- Server now recognizes bogus extended message 15 - won't send error message to client.
- Added recognition for clients up to 4.0.0c - will not endure AOS features though. Useful for people
  with plain AOS installation that wish to play on the server.
- Mind you that this isn't AOS support, it's merely supporting the client.

28-01-2004, Kell
- Fixed TARGP not being set when using a spell.
- Added SPELLFLAG_TARG_NOSELF (0800), which stops spells from being cast on the player itself.
- Fixed accessing LOCAL variables straight within DIALOG sections (also fixes FOR loops).
- "return 1" within a DIALOG section stops the dialog from actually being sent.

30-01-2004, Kell
- Changed SPELLEFFECT to take UID of SRC as 3rd argument, and UID of source item as 4th argument
  (optional). To maintain compatibility, a 3rd argument of '1' refers to the current SRC.
  Example: CONT.SPELLEFFECT s_fireball 1000 <CONT.UID>
  In this example, <cont.uid> will be the SRC of @Effect and @SpellEffect triggers. Say no to
  equip fudging :p
- Fixed KARMA going to odd ranges.
- Added EF_Intrinsic_Locals (080), so that after you do LOCAL.X = something, you can access it
  via just <X>. Be careful though, not to name local variables after some known keyword, or your
  results might how you want them. 
  Example:
      LOCAL.X = 10
      SYSMESSAGE X is <X>.

02-02-2004, Kell
- Fixed an exploit that would allow insta-resurrection anywhere (death menu packet).
- Fixed one last \n\r packet exploits.
- Made sure \n or \r are never saved to the world file, so even if some packet exploit got overlooked,
  it'll end up causing no harm and issue a warning in the console.. This is likely to be the end of
  99% of shard hacking.

03-02-2004, Kell
- Fixed FOR x being 0 based - FOR 5 will now loop from 1 to 5 and not from 0 to 5.
- Fixed "/" character in parsing of simple formulas (so you don't need to use eval when
  assigning formulas to TAGs/VARs or in RETURN).
- Fixed @Targon_ground in GM mode with weapons throwing critical exception (it was attempting
  to damage a static item, which obviously is not an item at all).
- Targon_ triggers now have argn1 as the id of the static item (if a static was targeted),
  and ARGO being the targeted item (reduntant yes, but coherent).
- (intermediary test release here to get some feedback)
- Polymorph spell fixed.

04-02-2004, Kell
- When loading a world with VERSION below "0.55 R3", convert spells that affect stats, by
  removing its effect from base stats (old method) then putting the effect into modstats
  (new method). This ensures compatibility with spells and cursed items.
  Notice that this only works for worlds saved on versions earlier than R3, seeing as worlds
  saved on the test versions of R3 made no conversion and thus had items with both formats
  which cannot be distinguished.
  If for some reason you want to bypass this conversion on an old world, change the version
  of the save files to "0.55 R3". If you want to force this conversion on a world saved with
  R3 test versions, change its version to "0.55".
- Fixed melee weapons with large RANGE hitting through walls.
- Added ARCHERYMAXDIST to sphere.ini (defaults to 12).
- RANGE works for ranged weapons (bows) too. If no minimum range is set, then ARCHERYMINDIST
  is used. If no maximum range is set, then ARCHERYMAXDIST is used.
  Notice that on ITEMDEFs, syntax for range is either RANGE=min,max or RANGE=max (assumes 0
  as min for melee weapons, or archerymindist for ranged weapons).
- Account delete should be working fine now.
- IPs now accept 255 as a wildcard. So if you add an ip under BLOCKIPs with:
  1.2.255.255 you will actually be blocking everyone IP under 1.2
- EOF Account really fixed now (thanks everyone who pointed all the flaws out).
  note for programmers: never ignore the return error value of a function :p
- Added <StrPos iPos, ch, string>, where iPos is the position to start at and ch can be
  either a single character, or the ascii code for a character.
  Example:  <strpos 0 32 Where is the first space> --> will return 5.
      <strpos 3 e  Where is the first 'e'> --> will return 4.
- Added <StrSub iPos, iCount, string>. Returns "iCount" numbers string, starting at iPos.
  Example:  <strsub 3 4 Oh look at this> --> will return "look".
- Both StrSub and StrPos can take a negative value as iPos. In such a case, the position 
  is counted from the end of the string. So if you do:
  StrSub -5 2 <abcdefg> --> returns "cd".
- Changed StrArg / StrEat to stop at either a space or a comma. These are quick functions
  when you just want to take one argument from a string, or just want the string after one
  argument. Imagine you have a function that takes 1 number and a string. Instead of using
  argv[], you could use strarg to get the number and streat to get the string.

05-02-2004, Kell
- Spells with SPELLFLAG_SCRIPTED can "return 0" in @Effect/@SpellEffect to bypass any
  hardcoded effect, w/o cancelling the spell.
- Duration for summon spells now takes in consideration the DURATION field in the SPELL section and
  the caster level (yeah, it didn't).
- @SpellEffect/@Effect is triggered on the NPC when it is first summoned (it's always considered to
  be the s_summon_creature spell, regardless of spell initially used to summon the NPC).

06-02-2004, Kell
- Spells with both SPELLFLAG_TARG_XYZ and SPELLFLAG_TARG_CHAR/ITEM can be used either on the ground
  or on a character / item.

---- 0.55 R3 final ------------------------------------------------------------
---- 31/05/2004
---- * unofficial release [unallowed]

07-02-2004, Kell
- Added FeaturesLogin= to sphere.ini, allows setting of the flags sent in the 0xA9 packet, on login.

08-02-2004, Kell
- Added EVENTS/TEVENTS to items. Order of triggering is as follows:
   1) If it's a character activating the trigger, check for triggers sensitive to items (@ItemDClick, etc).
   2) triggers in EVENTS on the item
   3) triggers in TEVENTS on the item
   4) triggers in TYPEDEF section for the corresponding TYPE of the item
   5) triggers in ITEMDEF section of the item
   6) default hardcoded behaviour (if any).
  a "return 1" in any case, stops further processing of triggers.

21-02-2004, Kell
- There is a feature/bug when checking to see wether a player has some specific items, any item of a similar
  type will do. It affects these items:
     0175d (cloth), 01067 (leather), 01078 (hides), 01bdd (log), 01bd7 (boards), 00f3f (arrow), 01bfb (bolt).
  e.g., when the server tries to find an arrow, any t_weapon_arrow will do, and so on.
  Added flag EF_Item_Strict_Comparison (0200) to disable this behaviour.
  
25-03-2004, Radiant
- Added some combat, server and command messages to sphere_msgs.scp.
- Added two file handleing commands:
   SERV.WRITEFILE <filename> <text>
   SERV.DELETEFILE <filename>
  Because these commands can be quite destructive, option flag OF_FileCommands (080) must be enabled 
  for these commands to work. Be careful, because any GM with access to SERV.* commands could use this!
  More will follow soon.
- Added @UserChatButton trigger (return 1 disables default (chat window) behaviour)
- Added @UserMailBag trigger (return 1 disables default (message) behaviour)
  NOTE: It seems this is also triggered on login, try using something like
    if (<uid> == <src.uid>)
      return 1
    endif
  to prevent this.

26-03-2004, Radiant
- Added <READFILE filename line> statement
  If line == 0 this will return the last line of the file, if line == -1 this will return the first line of
  the file. This needs OF_FileCommands (080) to be enabled because of obvious security reasons.
  This will return "" (nothing) on failure.
- Added <FILELINES filename> statement, returns the amount of lines in a file.
  If this is 0 it means the file doesnt exist or cannot be read. This too needs OF_FileCommands (080).
- Added some error and misc. messages to sphere_msgs.scp.
- Added SYSMESSAGEUA (syntax equal to SAYUA).
  *** NOTE *** People using Taran's colored sysmessage script will experience problems! Remove Taran's script
  and change your scripts to use the hardcoded function instead (which is much faster and efficient anyway).
- Fixed missing return char in TRY console errors and added the UID of the object causing the error.
- Added @Attack trigger (after someone doubleclicked a character to attack).
  SRC is the target. "return 1" will cancel the attack.
- Added @UserWarmode trigger, fired when a user hits the warmode button before sphere changes the warmode flag.
  ARGN is the current warmode state (1 = in warmode, 0 = peace). "return 1" cancels the warmode change.

27-03-2004, Radiant
- Got sphere to compile on FreeBSD, it's not very stable yet, working on that (problem with signal handlers).
- Added TRYSRC <uid> <verb>, executes <verb> with <uid> as the SRC. Death to equip fudging!
  Note that the default object is the object this is called on, so link.trysrc <cont.uid> will make <link> the
  default object and <cont> the <src>. Very useful in timers!

28-03-2004, Radiant
- Disabled SENDPACKET S"" and put in a little notice that you should use <ASC> instead.
- Casting recall/gate travel on an item now fires @SpellEffect on that item.

31-03-2004, Radiant
- Added OF_NoItemNaming (0100), prevents sphere from naming items "sword crafted by Player"
- Added EF_No_Pause_Packet (0400), this prevents sphere from sending a Disable Redraw (or pause) packet everytime
  a new item/character is sent to the client. This is a bandwidth saver and lag preventer.
  This saves about 45 bytes for each action, this doesn't seem much but you can notice the difference.

02-04-2004, Radiant
- Changed skillsum to DWORD, which fixes the problem with high skillsums not working.

04-04-2004, Radiant
- Gate travel spell now LINKs the gate to the person that opened it.

06-04-2004, Radiant
- Healing is now interrupted properly when hit, fixes exception problem.

08-04-2004, Radiant
- Fixed signal locking problem on Linux/FreeBSD, running sphere in multi-threading mode still has problems, I'll look
  at that tomorrow. Sphere now survives pretty much every error on Linux/FreeBSD (only tested on FreeBSD), as long as
  it's running in single thread mode.

09-04-2004, Radiant
- Threading problem seems to be a little more complicated, but at least sphere runs very stable for me without threading
  on FreeBSD. I've tried it on Slackware, which still had alot of problems. I'll leave that for Kell ;)

11-04-2004, Balkon
- Fixed bug when pick up few items from a pile on the ground it's timers become -1
- Added @Pickup_Self - fired on container when item picked up from it, ARGO points to item we picking up
  @ItemPickup_Self for chars, ACT - container , ARGO - item we picking up
  Removed Reveal() from corpse looting - one can do it using @Pickup_Self if needed
- @Dropon_Char, @ItemDropon_Char now called when drop an item directly on charater either (before secure trade window 
  shown and @NPCAccept/Refuseitem triggers), ARGO points to character we drop the item on, or character's backpack

11-04-2004, Balkon
- Can't provoce char against an item
- Return 1 in @Login fixed (character will not stay in the world, no "client version check" loop)
- Fixed CONT and TOPOBJ in @EquipTest, item not moved if can't be equipped when doubleclick on it

12-04-2004, Radiant
- Added LOCALLIGHT property on characters, if this is 0 the normal lightlevel (sector) will be used, if this is higher the
  LOCALLIGHT value will be sent as lightlevel instead. You will need to use UPDATE after you have changed this, because the
  light level is not automatically updated. This overrides nightsight.
  (note: if you want to give a character a LOCALLIGHT level of 0, just set the nightsight flag)

13-04-2004, Balkon
- OF_NoHouseMuteSpeech (0200) - if enabled players are able to hear each other inside and outside the house
- Started remaking a CanSeeLos and CanWalk, temporary added EF_CanSeeLos_New (0800) to enable both changes
  as for now it fixes shoot through walls an fall through the floor in house regions interception area bugs, 
  more changes here later...

14-04-2004, Radiant
- @DClick is now triggered before the item is attempted to be equipped

15-04-2004, Balkon
- EF_WalkCheck (01000) - new walk check code, should fix lot of house looting bugs (patched verdata, walk under stairs etc.)
  NOTE: in default script pack some stairs are in DUPELIST of items, which are not really a stairs, so they have
  wrong CAN flags (CAN_I_CLIMB is not set). Make sure you've fixed your scripts before enabling this EF or you'll 
  not be able to walk on some of dynamic stairs

16-04-2004, Balkon
- some optimization to EF_WalkCheck, fixing climb height after teleporting and Z changing
- fixed bug when summoned NPC's have loot
- fixed RESOURCES.1 returned string in RESMAKE format
- fixed shafts etc. dupe bug

17-04-2004, Radiant
- Started working on some basic AOS functionality, EF_AgeOfShadows (02000) will enable this.
  Currently only enables tooltips (which aren't even working for now). Don't forget to enable flag 020 in FeaturesLogin!
- Fixed a nasty exploit that would allow anyone to crash sphere and/or execute code on your machine without even logging in
  (thanks Furio for reporting this)
- Fixed AOS Tooltips, now only shows the name for items and characters. I'll add other things later.
- Added AOS/LBR fading damage counter thing (requires EF_AgeOfShadows). This only shows for you and the person that hit you,
  I believe thats how it works on OSI (or doesn't it?). Showing it for everyone would make it laggy in my opinion.

17-04-2004, Balkon
- torch/candle dupe bug seems to be fixed at last :)

18-04-2004, Balkon
- fixed ACCOUNT properties was not accessable for logged out chars
- added ISPLAYER function - just a little feature :)
- added ISONLINE function - for players returns 1 if client is online (connected) and 0 overwise, for NPCs returns 1 when 
  NPC is in the world or 0 if it is offline (shrinked, mounted pets)
- added NOTOGETFLAG function, returns notoriety flags for specified char, syntax: NOTOGETFLAG Viewer_Serial,Allow_Incognito
  returned values:
  NOTO_GOOD   1 // good(blue)
  NOTO_GUILD_SAME   2 // same guild
  NOTO_NEUTRAL  3 // Neutral
  NOTO_CRIMINAL 4 // criminal
  NOTO_GUILD_WAR  5 // Waring guilds
  NOTO_EVIL   6 // evil(red)
  if no args specified returns flags for SRC as a viewer, NOTOGETFLAG 0,1 will return flags for SRC as a viewer with 
  Allow_Incognito = true
  NOTE: for red guildmates it will return NOTO_EVIL, not NOTO_GUILD_SAME

18-04-2004, Radiant
- Some additions to AOS tooltips

19-04-2004, Kell
- A few changes to AOS tooltips for cross-platform compatibility (itoa).

19-04-2004, Radiant
- Fixed status updates not sending with EF_No_Pause_Packet flag set
- Made @userStats fire on every status update that is being sent, if ARGN3 == 1 then the user has just opened the status window
- More tooltips stuff, type specific
- Added AOS/LBR Popup Menu's, these can be activated by setting flag 08 in FeaturesLogin (currently only for characters).

19-04-2004, Balkon
- RANGE bug fixed
- updating last regen time for dead chars so that they will not get ticks every tenth of second any more

20-04-2004, Balkon
- some traffic optimization:
  short stats change packets now used instead of full status packet when changing only hits/mana/stamina or it's max. values
  HITSUPDATERATE in sphere.ini controls how often (in seconds) my changed hits will be sent to others who can see me,
  default value is 1, incraise to reduce the traffic usage, 0 value disables sending such updates (like it was on 55i)
- MAXHITS etc. fixed. .MAXHITS 100 will now set MAXHITS to 100, this will include MODSTR so that if you had MODSTR 10 before 
  setting MAXHITS than when you change MODSTR back to 0 MAXHITS will be 90.
- maxhits displayed for others changed from 25 to 50 for smoother hits line changing on the statusbar

21-04-2004, Radiant
- Added MESSAGEUA, syntax equal to SAYUA and SYSMESSAGEUA
- Fixed lack of argument checking in SAYUA that sometimes causes an exception
- Added support for the "Virtue button" (at the top of the paperdoll on newer clients), fires the @UserVirtue trigger.
- Added support for the new spellbook packets (old ones don't work with AOS), if EF_AgeOfShadows is not set the old packets will
  be used (this is for Magery, there is no Necromancy or Paladin stuff (yet)).

22-04-2004, Radiant
- Re-added the "The spell fizzles" message on spell failure

22-04-2004, Balkon
- setting values in quotas for TAGs, VARs and LOCALs now will create text tags, i.e. 
  TAG.TEST_1 2+2
  will create numrecal tag TEST_1 with value 04, but
  TAG.TEST_2 "2+2"
  will create text tag with text '2+2'.
  Text tags and vars are saved quoted also.
- fixed REGION.TAG0.SOMETHING caused 'Undefined symbol "" error' when tag SOMETHING is not set

23-04-2004, Radiant
- Found out that new spellbook packets are broken, still not fixed
- Added support for necro book spells, now reads the spelldefs for these (101 - 116), will add hardcoded behaviour later
- Added @UserExWalkLimit trigger, fired if a user exceeds the Walk limit (is either lagging alot or speedhacking)
  RETURN 1 allows the user to walk, no action or RETURN 0 disallows the user to walk
  (note: this is pretty expensive because it's fired each time a step is taken while the user's walkbuffer is at 0, so be careful)

24-04-2004, Radiant
- Removed message from WEBLINK command
- Fixed .admin showing japanese text/crashing client with long character names (names are truncated to 30 chars)
- SERV.NEWDUPE and DUPE now sets NEW (and ACT? coded but not tested) for items only, duping chars doesn't work like it should yet
- DCLICK/USE on characters now takes an argument (uid), makes the character DCLICK a certain item/char
- CALL function is no longer case-sensitive
- Added arguments to dialogs, in this form: "DIALOG d_dlg 0 blabla", both <args> and <argv[x]> can be used. <argn> is the page number
  (second argument)

25-04-2004, Radiant
- Added COMMANDLOG option in sphere.ini, only logs commands issued by this plevel and higher. (default = 0, log all)

29-04-2004, Balkon
- after some beta testing few fixes in equip and EF_WalkCheck
- added EVENTSPET to sphere.ini - events far all NPCs
- added EF_DiagonalLOSCheck (04000) - to see the object in diagonal direction we must be able to see the point at least 
  in one of ortogonal directions, this mean you can't see objects only through the "corner", this fixes teleport through
  fence NW corner and some other bugs but still allows, for example, closing doors which are in diagonal direction 
  to you when opened :) Setting this flag may incraise CPU usage.
- alternative name in TAG.NAME.ALT is now used everywhere if tag is set - in character status, corpse names, linked 
  memories etc. It overrides incognito name also. The real name is only accessable via NAME property.
  TAG.NAME.PREFIX now overrides fame prefixes (shown on click). TAG.NAME.PREFIX and TAG.NAME.SUFFIX are now can be combined
  with TAG.NAME.ALT

01-05-2004, Balkon
- fixed bug when closing dialog with targeting cursor up canceled targeting
- removed \r check from character profile packet - this allows to have a multiline profile and fixing wrong "Cheater" warnings
- fixed bug when players was able to buy any items from vendor even outside the stock (equipped on him. in his backpack etc.)
- vendor now will simply transfer items to character's backpack if they are stored in his "extras" box or if he is a player's 
  vendor (they was duped, you bought the copy and the old one deleted before). Shrinked pets will not be unshrinked when sold
  from player's vendor (or from extras box).

02-05-2004, Balkon
- EF_CanSeeLos_New is not longer used, all fixes affected by this EF are now included to the code by default.

03-05-2004, Socket (UNSP team)
- Started work on fullfeatured guild/town system. Added MEMBER property to guildstones. You shall use it this way:
  <guildstone>.member.X.<property> These properties are available for read/write: ACCOUNTGOLD, LOYALTO, PRIV,
  SHOWABBREV, GUILDTITLE. Functions available: IsCandidate (returns 1 if member is a recruit), IsMember (1 if member),
  IsMaster (returns 1 if guildmaster). Also, MEMBER.X. construction points directly to character, so you
  could use something like MEMBER.X.NAME in your scripts. MEMBER.COUNT returns total number of guildmembers.
- ACCOUNTGOLD guild member's property is now saving to worldsave too.
- Added new GOLDRESERVE property to guildstone.
- Added new <CONT>.COUNT function which returns a total amount of items in the container.
- Added new SERV.CLIENT.x reference. SERV.CLIENT.0. is a newest client and so on, for example <serv.client.0.name>
  will return the name of last logged in client. Reference is READ-ONLY for safety. In this case you could save
  client uid somewhere and work with his using UID.<uid>. reference.

07-05-2004, Socket
- <CONT>.COUNT now returns an amount of items only in selected container, without counting items in containers inside it.
- Added <CONT>.FCOUNT function, which returns a TOTAL amount of items inside container.

11-05-2004, Balkon
- some fixes, @EquipTest now fired before all internal checks, before item unstacked from the pile, before item in same layer
  unequipped (this mean if you have return 1 there char will not unequip previews item)

16-05-2004, Balkon
- fixed @Dropon_char called when dropping item to any container on the char. Now it called only when you really drop the item
  on the character - directly on his head or on his backpack if you don't own him. ARGO now always points to character.

19-05-2004, Balkon
- fixed @color,font in MESSAGE and SYSMESSAGE, now it accept hexadecimal values, added 3-rd argument there - unicode flag, 
  new format is SYSMESSAGE @color,font,unicode text, added @color,font,unicode to SAY and broadcast either. Of course SAYUA,
  MESSAGEUA and SYSMESSAGEUA still can be used for this, but @color,font,unicode is accepted in default messages definition
  (sphere_msgs.scp), so now we can have default messages in unicode :)
- added OF_SkipUndefMsgs (0400) - if flag is set sphere don't send error strings for undefined default messages, 
  dont print errors on resync - just ignores it, so now we can disable some default messages if needed.
- SPEED wepaons property now used in fight delay calcilation if set (and not 0), the formula is 
  DELAY = 15000 / ( ( DEX +100 ) * SPEED )

20-05-2004, Balkon
- some optimization in hit messages (get only messages which really will be sent to client)
- added SPEEDSCALEFACTOR to INI (defaul value is 15000), used in weapon delay calcultions, now formula looks like
  DELAY = SPEEDSCALEFACTOR / ( ( DEX + 100 ) * SPEED )
- ARGN1 in @HitTry now is the delay (in tenths of second) left before the hit, can be changed

21-05-2004. Balkon
- added FORCLIENTS and FORPLAYERS loops, difference is that FORPLAYERS will loop through disconnected players which are 
  still stay in the world (client linger) either.
- if no args specifiead for FORITEMS, FORCHARS, FOROBJS, FORCLIENTS, and FORPLAYERS loops value 18 is used by default 
  (maximum view distance)
- added FORCONTID and FORCONTTYPE loops, format is FORCONTID i_dagger max_sub_containers. If max_sub_containers is not 
  present it will search in all subcontainers. If max_sub_containers = 0 - it will search only in this container.
- added FORCHARLAYER layer - loop through all objects in specified layer
- added FORCHARMEMORYTYPE flags - loop through all memory objects with this flags

25-05-2004. Balkon
- fixed bug when after parsing quoted lines when setting VARs, TAGs and LOCALs didn't create text variables

27-05-2004, Socket
- Fixed guild MEMBER.X.KEY for read/write. Now it should be working well. Will return error if you try
  to access non-existant member (so it should be better to use MEMBER.COUNT to check bounds).

---- 0.55 R4.0.1 --------------------------------------------------------------
---- 07/06/2004
---- * unofficial release [unallowed]

30-05-2004, Kell
- Little fixes to allow compile under Linux (use strcmpi() for caseless string
  comparison, and add casts to (LPCTSTR) on CGStrings).
- Changed version number. I suggest using R4.x.y where xx is increased when
  something major is done and yy is for little changes. Set to R4.0.1.
  (ps: some people never quite understood what RC* means. After the 20th it
   stops being a release candidate, it's more like a candidate to a release
   candidate. So after the "powers that be" have adopted and turned that
   numbering scheme into a mockery, I suggest we change to something less
   confusing.

31-05-2004, Furio
- Added FORCONT loop, format is FORCONT uid_of_container max_sub_containers. It
  will loop on every item present in the container. If max_sub_containers is not
  present it will search in all subcontainers. If max_sub_containers = 0 - it
  will search only in this container. (Thx to Balkon for the base code for
  container loops)

07-06-2004, Furio
- Made a blank REVISIONS.TXT because it was getting pretty big.
- Added XOR (^) operator to expressions.

---- 0.55 R4.0.2 --------------------------------------------------------------
---- 22/07/2004
---- * unofficial release [unallowed]

12-06-2004, Furio
- Added two new INI value USECRYPT and USENOCRYPT. The first if 0 don't allow at
  encrypted client to login otherwise allow them to log (default is 1). The
  second if 0 don't allow at unencrypted client to login otherwise
  if 1 -> allow and suppose that the clientversion is >= 2.0.0
  if 2 -> n/a
  if 3 -> allow and suppose that the clientversion is >= 3.0.0
- Added the most requested security-by-obscurity feature DISGUISEVERSION in
  sphere.ini. If set change the version outputted to clients, ircserver,
  webserver, listserver, telnetserver to its value otherwise the default build 
  value is used. (Mind that the version in savefile and in console startup is 
  the default build version)
- Fixed (i hope) bug with Mozilla/Firefox browser with the status page
- Fixed a buffer overrun bug that could be exploited to crash or run arbitrary
  code, in the log system.

20-06-2004, kuch
- Added ClearTags function (removes all the tags from the char/item/account);
  Revital did most of the work, but I get the credit.

28-06-2004, Furio
- Fixed multiple gump exploits. In order to do this now memory 08000 is used as
  internal memory (is called MEMORY_GUMPRECORD).
- Fixed and refined things for disguise version feature.

02-07-04, kuch
- Added MODMAXWEIGHT: allows you to increase/decrease max carrying capacity of a
  char.
- Added MODAR: allows you to increase/decrease the overall AR of a char
  NOTE: there are no oStat equivalents (ie oModAr or oModMaxWeight) for the
  above.
- Also added the following to avoid possible confusion:
  * MAXWEIGHT - same as WEIGHTMAX
  * AR - same as AC
  * MODAC - same as MODAR
  * MODWEIGHTMAX - same as MODMAXWEIGHT
  
03-07-04, kuch
- Added 135 more strings (mostly from skills) to sphere_msg.scp
- Added new .ini option: WOOLGROWTHTIME: how long in minutes it takes for wool
  on sheared sheep to regrow.
- Added new .ini option: SKILLPRACTICEMAX: how high can you train a skill on
  dummy/archery_target.

04-07-04, kuch
- Added 93 more strings: NPC speech and skill msgs; there are now 329 string 
  messages in sphere_msgs.scp.
- Added TAGCOUNT function (works on regions/items/chars/accounts) - returns the
  number of tags on that obj
- Fixed CLEARTAGS (now also works on regions)

06-07-04, kuch
- Fixed some weird bug in jobmage.scp and jobnoble.scp 
- Added a lot more strings to sphere_msgs.scp; If you find any bugs with them,
  kuchervano@hotmail.com me immediately!

07-07-04, Furio
- Fixed DISTANCEWHISPER not working correctly.

07-07-04, kuch
- Added DEFFOOD value to sphere_defs.scp - this is a template of items you want
  to get by casting the create food spell; Yes it does not give you a great deal
  of control over what you get (ie skillbased for example), but its better than
  nothing
  
09-07-04, Furio
- Fixed bug with ^ operator.

16-07-04, Vjaka
- Fixed bug with armor/weapon when hits were above to hitsmax.
- Cosmetic fix to report Client out overflow error line once per dialog instead
  of tons of them.
- Added trigger function f_onchar_delete triggered before client is going to
  delete a character. SRC is char, return 1 denyes deletion.
- Added trigger function f_onaccount_login triggered after client entered the
  password, ARGS is account name, return 1 disconnects.
- Added spell flag SPELLFLAG_PLAYERONLY 020000 which denies spell being cast by
  npc ai (no more npcs casting shrink if not wished to).

17-07-04, Vjaka
- Added @NPCLostTeleport to trigger before NPC is going to be teleported back to
  its spawn (by LostNPCTeleport sphere.ini setting), ARGN1 is the distance from
  the spawn.
- Added INI switch PAYFROMPACKONLY (default: 0). If set to 1, then buying stuff
  from vendors will search pack only for the gold.
- Added @Hunger to trigger before char is going to loss a food level. ARGN1 is
  the food level that will be set, return 1 cancels.

19-07-04, Vjaka
- Removed IRC server from default build settings. It is buggy, has holes inside 
  and probably should not used by anyone.
- Reverted memory information profiling in Win32 version (stability testings).
- Fixed NoMessages and Quick login mode (ARNG1/2 in @Login) now skips sphere
  version information and Welcome back.. prompt.
- Fixed some exceptions for ticking events. Some division by zero removed, and
  the exceptions are made less critical (actualy the way they should be - quite
  local). It means that the server should be more stable now. Also they gives
  usualy more information on when the error occured.
- Added @StepStealth triggering on each step made by person in stealth. ARGN1
  (in and out) - whatever to reveal him or not.
- Added isnumber(something) - returns 1 if it is a number (only number of radix
  10 suits). Useful in argtxt validation.

19-07-04, Furio
- Fixed compatibility issues with Linux for isnumber(something).
- Added TAG.DIALOG_NAME to MEMORY_GUMPRECORD. The tag contains the name of the 
  dialog opened. Special case are the .admin gump (clientlist), the hair dye
  gump (hairdye), a guild hardcoded gump (guild) and if no name is found
  (undef). Hope that this will help in checking what gumps are opened on client
  screen.
- Added SDIALOG command. It works like DIALOG with the difference that it'll
  open a dialog only if it's not present on the client screen.
- Fixed a thing in DISGUISEVERSION. Now .[x]show version shows the disguised
  version.

20-07-04, Vjaka
- Fixed compatibility issues with Unix for exceptions
- Added MODAR (MODAC) working on items as well. Now it is for both items and
  chars.
- Fixed startup sequence - now tryes to bind a socket before loading the world
  saving time on running multiply instances.
- Fixed Windows version buffered output flushing. Also removed log file
  buffering.

21-07-04, Kell
- Fixed some compilation issues under Linux (just missing some (DWORD) casts).

22-07-04, Furio
- If PAYFROMPACKONLY (default: 0). is enabled, in the char status only gold from
  pack is displayed.
- Fixed minor things on default messages.

22-07-04, Vjaka
- Added server state functions f_onserver_save, f_onserver_save_ok and
  f_onserver_save_fail. Arguments are ARGN1 - force save? and ARGN2 - save stage
  (for background saves). For f_onserver_save the ARGN1 is writeable and return
  1 cancels the save.
  Please note, that if background saves are enabled, these functions will be run
  tons of times during the worldsave process (at least 6144 [sectors amount]
  times).
- Added f_onserver_start function triggered server start.
- Created knownbugs.txt file to be distributed with sphere revisions.

---- 0.55 R4.0.3 --------------------------------------------------------------
---- * not released
---- * unofficial release [unallowed]

23-07-04, Vjaka
- Added some more exceptions debugging. It is going deeper and deeper to engine.
- Added MAXITEMCOMPLEXITY (default: 25) - the amount of items in one tile so
  start showing "too many items here".
- Added MAXSECTORCOMPLEXITY (default: 1024) - the amount of items in one sector
  to start showing "x items too complex".

24-07-04, Vjaka
- Removed instant logout in guarded areas. use REGION_FLAG_INSTA_LOGOUT instead 
  if you wish instant logout.
- Added console commands history of 5 latest commands in Windows version. You 
  can scroll them using UP key.
- Added one minute delay after take of an item from trade window before 
  accepting the deal.

25-07-04, Vjaka
- Added smsg/smsgu shortcuts for sysmessage/sysmessageua (note, that msg already
  existed as a shortcut to message)
- Added SKILLCLASS properties - if written like SRC.SKILLCLASS.NAME, returns 
  <SERV.SKILLCLASS.<SRC.SKILLCLASS>.NAME>
- Started doing ARGVCOUNT and realised that <ARGV> is the amount of ARGV[x] 
  variables. Noting that as not found in revisions.
- If player speech longer 5 chars and has 75% capital letters inside, it will 
  come out in lower case. Works for english chars only. And as for unicode - if
  EF_UNICODE is set.
- Added GUILD properties: <SRC.GUILD> returns 0 or guildstone UID,
  <SRC.GUILD.NAME> returns guild name
- Removed all old PLOT bit stuff. Use EVENTS instead
- Changed CLEARTAGS - it takes optional argument, clearing tags only if matching
  the string (does not support wildcards)
- Added HITS and MAXHITS to items (same as MORE1L and MORE1H). Note: this is
  valid for armor and weapon object.
- Telnet has a username. So, Administrator or RemoteAdmin login left for local 
  logins (127.0.0.1) if LOCALIPADMIN enabled

25-07-04, Furio
- Hopefully tracked down and fixed the arrow bug, and similar problem derived 
  from NEW (big thx to Handred that finded the point where start looking at for
  the fix).

26-07-04, Vjaka
- Fixed broken TEVENTS read method on chars.
- Added QVAL(test1,test2,res1,res2,res3) in addition to current <QVAL?:>
  variant. It is useful if dealing with numbers without many IF-s. Sample 
  <eval qval(<VAR.X>,<VAR.Y>,<VAR.ONE>,<VAR.TWO>,<VAR.THREE>)> will return
  <VAR.ONE> if <VAR.X> < <VAR.Y>, <VAR.TWO> if they are equal, and <VAR.THREE>
  if the it is greater. If some of the arguments are omited like qval(1,2,,3) it
  will default to zero.
- Changed REGISTERSERVER to default an empty string. If you wish to register to
  list.sphereserver.net, specify REGISTERSERVER=1 or it's host.
- Added TELEPORTEFFECTSTAFF, TELEPORTEFFECTPLAYERS, the teleport effect for
  staff (use hex id of object or 0 here) (default: 03709 for staff, 0372a for
  players).

27-07-04, Furio
- Fixed an issue with MOVE/XMOVE command.

27-07-04, Vjaka
- Added command line switch -Gpath/to/saves/ to defrag sphere server UIDs. It
  is done because sphere UID management routines has flows which makes not to
  reuse empty uids, but generate new, higher. Howewer, space for lower unused
  objects is still reserved. It saved 400Mb me (from 600Mb on start to 180Mb)
  working for 2.5 hours, but caused all mounts to disappear, maybe some more
  flaws. So, use on your own risk. In future versions for 4.0.x Furio is going
  to improve the uid subsystem and this will not be needed anymore.

28-07-04, Vjaka
- Changed FILELINES to close the file and READFILE if line number is too big.
- Added DISMOUNT verb on char to dismount him, MOUNT to get UID of ridden one.
- Fixed an issue with SERV.CLIENT.x. causing exceptions.
- Removed 0.55R from version. It is a complicated notation. It's 4.0.x now.
- Fixed MODAR not updating armor class if changed on char or equipped item.

29-07-04, Vjaka
- Limited allshow to MAXCHARCOMPLEXITY*4.
- Fixed issue when telnet connection could not do resync load after pausing.
- Account now has TAG.LastLogged with his previous login date. It is shown upon
  login if quick/no-messages login not selected (by @Login trigger).
- Fixed msg_criminal to be shown only if person is not a criminal yet (lags).
- Added read-only COMP reference for multis. Returns amount of components when
  called with no params, and has attributes: ID,D,DX,DY,DZ (D mean delta).
- NPC wishes gold and vendable items (not limited to desires listing).
- Added ARGN2 to @NPCLookAtItem (writeable) - the percent level the the NPC
  wish this item. If set high, he can loot the item.
- Added GMPAGES and GMPAGE.* verb to access gm pages from scripts. You can
  give arguments like you do to .page command, and use 2 specials - DELETE to
  delete even not-taken one, and HANDLE [uid] to mark gmpage for character.
  Also GMPAGE.x.HANDLED field returns UID of person taken the gmpage.

30-07-2004, Kell
- Added ACCOUNT.NAME

30-07-04, Vjaka
- Speed optimisation working with strings & possible some stack overflow out.

31-07-04, Vjaka
- Fixed several spells (like mark) casting in not allowed region when running.
- Fixed KILLS removal using multi-uo client.
- Changed @Logoff to take 2 writeable arguments: ARGN1 - linger time and ARGN2
  instant logoff flag. Return 1 in logoff is now obsolete.

01-08-04, Vjaka
- Added triggers @MurderDecay (ARGN1 - murder count that will be set, ARGN2 -
  decay time to set for the next kill) and @MurderMark (ARGN1 - murder count
  that will be set, ARGN2 - set criminal flag?). The names are descriptive.
- NPC is now trying to move objects blocking his walkpath. He also investigate
  the possibility to loot this item in several cases. Triggers look@item not
  called since if there are tons of items in the spot, it will be very laggy.
- Added @Rename trigger (ARGS - new name, ARGO - target char) when renaming a
  pet. Return 1 cancels. Also triggered when creating character.
- Items with ATTR_STATIC are now saved to spherestatics.scp and NOT SAVED by
  standart world save. So, you need to call .serv.savestatics to save them.
- NPC is now trying to cast good spells as on self and his combat friends also.

02-08-04, Vjaka
- Calling guards are now more speed optimised.
- Defrag mode now supports spherestatics.scp and is much faster.
- Changed FACE and SALUTE to take an optional argument - target object.
- Characters on the way do not disallow GM to place a house anymore.
- Items gets stacked one on the other witheen some height if possible.

03-08-04, Vjaka
- Exceptions catching fixed, some stack information added.
- Added CLEARVARS being same as CLEARTAGS.
- Fixed CLEARTAGS to work normal without arguments.
- Now VENDORMARKUP is taken from region tags if not found on a vendor.

04-08-04, Vjaka
- Default messages working optimised for speed. Removed OF_SkipUndefMsgs.
- Removed OF_Skill_DiffFirst since the actdiff is calculated in any case.
- Started implementing EF_Pathfinding.

05-08-04, Vjaka
- Fixed SERV.ITEMDEF reference to object not being currently in the world.

06-08-04, Vjaka
- Added SERV.resync to resync scripts without the resync delay.
- Now adding a new account automaticaly fills (FIRST/LAST)CONNECTDATE.
- Added @SkillMenu to trigger BEFORE calling any hardcoded skillmenu. So, you
  can return 1 to cancel the action. ARGS - the name of the menu, is one of:
  sm_polymorph, sm_carpentry, sm_bowcraft, sm_tailor_leather, sm_tailor_cloth,
  sm_bolts, sm_carpentry, sm_cartography, sm_tinker, sm_summon, sm_blacksmith,
  sm_alchemy, sm_cartography, sm_inscription.

07-08-04, kuch
- Finished the conversions of default messages into the new format: this should
  greately improve the execution speed.  Also updated sphere_msg.scp to fit new
  format.  Read the comments inside the file to get more more infomation.

09-08-04, Vjaka
- Added DISGUISENAME to alter the name of the server.
- Added REPLYPEERCONNECTS (default 1) to allow masterserver and peer connects.
- Fixed duplicating hungry messages search.

10-08-04, Vjaka
- Fixed NPC moving some items not actualy blocking their way.

11-08-04, Vjaka
- Added console commands auto-completion on using TAB key. File sphere.dic is
  read for the list of definitions. Note: this file SHOULD BE sorted (at least
  witheen each separate first letter) to multi-matches to work correctly.

12-08-04, Vjaka
- Added @ItemCreate triggered when an item (ARGO) is created by a client.
- Added auto-completion to telnet connection. The difference from winconsole is
  that it fills the word up to end ONLY if there is exact 1 variant, or if
  other variants contains this one in self.

13-08-04, Vjaka
- Optimised sysmessages - now nothing is sent to client if the message is empty.
  This is useful to clear default messages. If wish to scroll line, use space.
- Fixed exploit to crash clients by renaming pet with some special color. Thanks
  TheLegbra reporting that.

15-08-04, Vjaka
- Added EF_Script_Profiler (08000) to add information on functions usage for
  weak places (functions or triggers) to be optimised.
- Added EF_Size_Optimise (010000) to save WORLDITEM/CHAR/SCRIPT as W*. This is
  not much for now, saving 7+ bytes per object. Loading supports any method.

03-09-04, Vjaka
- Added OverSkillMultiply (default 2). When player skills/stats goes this times
  more than skillclass allowed, drop them to skillclass level. Setting this to
  0 disables the action.
- Added ACCOUNTS BLOCKED/JAILED arguments. Works exactly like UNUSED, but just
  applyes to the blocked/jailed accounts only.
- Only chars in mapplane where the player is are ticked now (lag reduction).

04-09-04, Vjaka
- Added ## command to console to save both world and statics.
- Added X# command to instant shutdown the server with world/statics save.
- Changed "commands uid=... (name) to ''" to show amount if above of 1.
- Server startup crash fixed

08-09-04, Furio
- Fixed issues for the Linux build.
- Disabled information abou "Key" on OnTriggerRun exception for compatibility 
  problem on the *Nix build. (temporary solution)
- Added .pid file (sphere.pid) on *Nix build, for those who want to write bash
  script for checking sphere process easily.

08-09-04, Vjaka
- EF_Pathinding is working perfectly making NPC to select a best path. Howewer,
  for maximal speed it is yet checking only static objects blocking his path.
  More testings on the speed needed before making it to include dynamics checks.
- Fixed Counselors losing their invis status after worldsave.

10-09-04, Vjaka
- Memory information is now got from system routines instead of internal one. It
  will cause this info to appear in UNIX builds, howewer, it will be not be in
  WINDOWS systems where PSAPI.DLL is not available (fe: Windows 95/98/NT4.0).
  Also this makes ALLOCS useless, since there is no way to get it.
- Added CLIENTS property for sectors and regions to get active clients count.

11-09-04, Vjaka
- Added EF_Clients_Thread (020000) to split clients handling to to other thread.
  This will work only in windows build and is not recommendable to change on fly.
  This is VERY experimental yet, since sphere is very singlethreaded by design.

13-09-04, Furio
- Fixed memory information on Unix. Now it uses two different methods to get
  memory information depending on *Nix system where sphere is running.

13-09-04, Vjaka
- Fixed functions profiler to strip off arguments of a function.
- Fixed console commands like ##, x# showing unknown keyword error in console.
- Fixed murder count set always to 1 by @MurderMark.

14-09-04, Vjaka
- Fixed LOCALs in f_onserver_start/f_onchar_delete.

18-09-04, Vjaka
- Code cleanups, removed some useless (not enabled keywords), same keywords grouped
  to one variant for usage for faster work lookups:
  1. *WEIGHT[MAX]->*[MAX]WEIGHT, BRAIN->NPC, KNOWLEDGE->SPEECH, COMMENT->TAG.COMMENT
  CLI*VER*->CLIENTVERSION, DEF->ARMOR, LISTEN->HEARALL, *PRICE->PRICE, VER->VERSION
  WEBPAGEDST->WEPAGEFILE (LoadKeys)
  2. CLIENTS->ALLCLIENTS, PARDON->FORGIVE, INVISIBLE->INVIS, INVULNERABLE->INVUL,
  R->RUN, W->WALK, CLIENTS->ADMIN, MIDI/MUSIC->MIDILIST, [RE]SYNC->RESEND, ADDITEM->ADD
  FOLLOWED->FOLLOW, M->MOVE, PROPS/TWEAK->INFO, SPEAK[U[A]]->SAY[U[A]], SFX->SOUND
  SAFE->SECURE (VerbKeys)

20-09-04, Vjaka
- Fixed errors on load if setting VERSION for saves to start from litera.
- Fixed paths in resource testing commands.
- Added EF_Minimize_Triggers (040000) to call as little triggers as needed by a minimum.
- Removed some declared but unused triggers.

23-09-04, Vjaka
- Removed unused EF_Allow_Override (it was not working anyway).
- Added OF_Advanced_AI (including moving objects in the path, helping friends by magic,
  pathfinding)
- Renamed EF_Client_Thread to OF_Multithreaded (0400)
- sphere.pid file is now created in Windows builds as well.

25-09-04, Vjaka 
- Removed ADDNPC since it is already integrated with ADD command for both items and npc.
- Removed some more duplicates (some really strange) to speed up lookups.
- Added showing of option flags on start.

26-09-04, Vjaka
- Removed different mail operations not working and other code cleanups.
- Bugfix: Disabled moving gold coins to vendor stock (items shifting).
- Bugfix: Disabled moving static/immovable items from ground, spell effect.
- Bugfix: Disabled gaining spell effect by ghost other than ressurection.
- Bugfix: Mounted creature will leave no corpse on death if died while mounted.
- Bugfix: @DeathCorpse is called only if corpse is really created.

27-09-04, Vjaka
- Added ISSTUCK keyword to check if npc can move to N/W/E/S dirs.

29-09-04, Vjaka
- Optimized OF_Advanced_AI, makes NPC to remember the path, recalculating it
  not so often (depending on INT).

30-09-04, Furio
- Added OF_Advanced_LOS (0800) this disable EF_CanSeeLOS and EF_DiagonalLOSCheck
  and enable a new method to check the LOS (still testing and optimizing).
- Fixed some compatibility problems with Linux build.
- Now Linux build is compiled statically, so no more tons of version linked to
  different shared library for each distro.

30-09-04, Vjaka
- Fixed Windows build issue.
- Removed EF_CanSeeLOS, EF_DiagonalLOSCheck, moved that to default LOS checks.
- Bugfix: unable to resurrect on too low strength. Now gets 1 HP at least.
- Average profile information is now saved to worldsaves and loaded.
- Option and Experimental flags are now shown in text on .show command.

03-10-04, Furio
- Optimized some parts in OF_Advanced_LOS.
- Fixed Linux build issue.
- Added ISTEVENT for chars (npc/players) working like ISEVENT 

04-10-04, Vjaka
- Regions now does not conflict if are in different mapplanes (useful for new
  maps support). You can also specify RECT=left,top,right,bottom,map in the
  rect record, specifyed the exact map for this rect to work.
- Started redoing the code to support multiple maps. This will invalidate old
  mapplane feature which was 0..255. This is affected mainly by teleports and
  moongates since many of default ones had 255 mapplain specifyed. You should
  change it to 0, since this is only for map0.
- Added MAP property same as MAPPLANE (in future MAPPLANE will be removed)
REVISIONS-56-SERIES
0.56a
----0.56a --------------------------------------------------------------------
---- 08/12/2004

06-10-04, Vjaka
- Removed DISGUISE(NAME/VERSION), renamed the current version to 0.56a.

07-10-04, Vjaka
- Removed AGREE config line neccessaty since it is not longer R* series.
- Added startup expansion set support output depending on map*,statics*,staidx*
  files found and loaded (T2A, LBR, AOS, SE).
- Removed EF_New_Maps since it is integrated to source now, packet is sent when
  needed.
- Moving on other map now moves the same map on the server. But this currently
  does not use caching and re-read tile information from map files every time.
  Caching of same sectors but in different mapplanes will be in the future.
  You should both add regions for these maps, and place corresponding files in
  place where all other mul files resides.
- Changed values of EXPERIMENTAL flags to remove empty slots between items.

08-10-04, Vjaka
- Fixed memory leak caused by map cache removal.
- Fixed client screen update on map change.

08-10-04, Furio
- Added PROMPTCONSOLE, it makes the client prompt (like on page request) and send
  the response as an argument of a user definied function.
  (syntax PROMPTCONSOLE callback function, message to prompt)

10-10-04, Furio
- Added RESDISP properties to account. Accepted values are 0 (PreT2a client),
  1 (T2A), 2 (LBR), 3 (AoS), 4 (Samurai Empire). This is used to identify what type
  of client is logged in. As default is set at 0, but if the client is T2A is
  automatically set to 1 by Sphere. LBR, AoS and SE is not setted automatically and
  is leaved to you.
- Added to CHARDEF properties RESLEVEL, RESDISPDNID, RESDISPDNHUE. The first state
  from what UO version the anim comes. The second what anim id is showed to older
  client version. The third an hue showed to older client (if 0 or null the default
  anim hue is used.
- Modified scriptpack to reflect these changes for T2A monsters.

22-10-04, Vjaka
- Added <dVALUE> as a shortcut to <eval <VALUE>> to get a decimal value of a
  single expr like a variable. Note, this affects EF_Intrinsic_Locals a bit.
- Commands with .command and spaces before will be treated as without spaces,
  since extra space makes privileged chars to reveal self.
- Added TAG.PARTY_CANLOOTME for party. If 1, allows party to loot self.
- Added @Kill trigger (SRC-killer, ARGO-killed)
- Added sector function ALLCHARS,ALLITEMS similar to ALLCLIENTS. For regions
  you can use SECTORS.ALLCHARS, SECTORS.ALLITEMS.
- Changed GODPORT to accept port number as well. Old values ( <=0 = disables,
  1=ServPort+1000) are still working also.
- Added SYSCMD and SYSSPAWN commands to run external applications. Returns <0 if
  there was an error. The first one blocks while program is running while the
  second spawns and continues scripts execution. Due to obvious security fear
  in these commands, they are disabled if OF_FileCommands is not set. Up to 9
  command line arguments are passed to the external application.

23-10-04, Furio
- Fixed minor things in grayproto.
- Updated grayproto (list/sizes of Uo packet in Sphere).
- Finished and debugged the new crypt engine (for crypt clients). Currently up
  to latest current OSI client 4.0.5a is supported.

25-10-04, Vjaka
- Fixed exception in writefile when unable to open the file.
- Added account name output when packet dispatch generated an exception.

25-10-2004. Furio
- Still updated grayproto, with new packet infos.

26-10-04, Vjaka
- Fixed SMSG[u] resolve error.
- Fixed <dSOMEVAL> giving some hex results.
- Added update for items moved by NPCs when they blocks the path.

27-10-04, Vjaka
- Now Windows build tryes to use winsock 2.0 if available instead of 1.1.
- Added amount argument to NEWITEM (newitem i_gold,45). Defaults to 1.
- Removed one of occasions with creating an extra log not in logfile path.

27-10-04, Furio
- Fixed a bug in displaying big dialogs with newer clients (4.0.X).
- Fixed a bug where some clients were crashing when adding an item.

28-10-04, Vjaka
- Disabled string 'q'/'Q' to be said by privileged accounts. It is due the
  fact that default macro for repeat is Ctrl+Q, and one less Ctrl press will
  lead to GM to reveal self existance around, which really is not good.

31-10-04, Furio
- Some fixes related to account creation and bank/box hack.
- Removed EF_AgeOfShadows. It'll be re-added with new features and complete
  compatibility for older clients, when enabled.
- Fixed another exploit with Bullettin Boards. Thx to Balkon for reporting it.

01-11-04, Vjaka
- Added .pid file existance notification to warn for double sphere launches.

02-11-04, Vjaka
- Now light level for sectors is saved as LIGHT istead of LOCALLIGHT.
- One more cause for long default message string lookups removed.
- EQUIPHALO now takes an argument - time to work on a person.
- Fixed bug causing objects calculated to be in sector 0 always.
- Added @Destroy trigger for objects.

04-11-04, Vjaka
- Quickfix of OF_Magic_PreCast - now not precasting on NPCs.
- Consume now can take more than 65k at once.
- Added @CreatePlayer to trigger just after the char was created by a player.

05-11-04, Vjaka
- Now "Admin" is shown instead of "GM" if person is admin or owner in title.

06-11-04, Vjaka
- Added sector function ALLCHARSIDLE similar to ALLCHARS, but looping via
  disconnected/mounted/etc chars, not accessable by ALLCHARS.
- Added auto map fix to zero map if it is out of bounds. Please note, that
  this can cause some problems with MOREM usage as well.

25-11-04, Furio
- Fixed: encryption - client login.
- Fixed: dVALUE evaluating when VALUE is already int.
- Fixed: EQUIPHALO <timer> does not making the light disappearing.
- Updated supported clients to 4.0.6a.
- Removed "Cannot move here!" message.
- Added more information to "MOVE: empty region" error. (uid and point)

30-11-04, Furio
- Fixed: MOREM automatically converted to 0 because of new multi-map feature.
- Added MasterUid property to guildstones

02-12-04, Furio
- Fixed: Gm Page menu not sending gms on page select.
- Fixed: Lord is displayed without space.
- Fixed: TAGAT trying to access to non existing TAGs.
- Modified: Only items with 08000 as attr are moved to spherestatics.scp.
- Modified: Overskillmultiply is 0 by default now.
- Added: ISEVENT for regions.

08-12-04, Furio
- Fixed: EvaluatingIntel on 0 int NPCs.
- Fixed: EQUIPHALO light disappearing on Dispel.

08-12-04, Vjaka
- Fixed exploit submitting invalid amount in buy packet giving free resources
  (thanks Breaker and Fallout for reporting this).
- Fixed canmove to accept DIR values (0..8) in addition to a letter arguments.
  Same changes affects other places, like move command, etc.
- File locking method optimised. It should improve the multithreading a bit.
- Result of the old "ACCOUNT accname" command changed to be more informational.
- GMs should login with invul and without allshow flags set.
- If reference set to OBJ/NEW does not exist, zero will be storied instead. And
  opposite, if it is already deleted, OBJ/NEW value is cleared to zero.
- Fixed exception in f_onaccount_login.

08-12-2004, Various authors
- Fixed some scripts by Vjaka.
- Added new scripts and scripts fixes by Tattooed Corpse.
0.56b
---- 0.56b --------------------------------------------------------------------
---- * not released yet

09-12-04, Vjaka
- Added map caching supporting all maps. Due to this, sectors are no longer
  same in the same spot in different maps, allowing local settings for maps.
- Added ADDCIRCLE=x[,y] to add a circle to a character's spellbook. If y is on,
  includes all lower spell circles as well.
- File locking method optimised. It should improve the multithreading a bit.
- Changed [SECTOR x,y] in world saves to x,y,0,map to allow local settings for
  sectors in different maps. Old format will default to map 0.
- Since sectors are no longer shared witheen different maps, sectors on maps,
  unsupported by server (having no corresponding .mul files) do not get ticks.
- Fixed cause to duplicate saved items in static saves in several occasions.
- Added BADSPAWN command to jump to the first bad spawn found in the world. You
  should add this to some of the [PLEVEL records. It also saves the UID into
  ACT in case you unable to see it due to some obstacles.
- Removed useless PRIVHIDE (privshow 0/1 is enough for this).

10-12-04, Vjaka
- Fixed some defmessages misprint making unable to override them.
- Fixed @Kill to trigger even if the killer is not an agressor in the fight.
- Changed MAPPLANE->MAP, LOCALLIGHT->LIGHT (.56a supported both variants, but
  saved the second). Launch and save in .56a will autoconvert this in saves.
- Now any items with ATTR_STATIC are saved to spherestatics.scp, not only those
  who has this flag being the only set.
- Fixed carriage return in accounts unused message.

11-12-04, Furio
- Fixed: bugs with FORCONT* loops.
- Fixed: bug with coloured text in comm crystal.
- Added: SKILLGAIN function to call internal sphere skillgain function. Args are
  skill to gain and difficulty (0 to 100).
- Added: REPORTEDCLIVER property for clients. It'll contain the version that
  the client is. (this is easy fakeable by 3rd party programs, but still is
  useful)

13-12-04, Vjaka
- Fixed resolving functions executing on containers, if the name started from
  rescount,restest,fcount or count.
- Fixed isneartype not working if calling under points (like from TARGP).

17-12-04, Vjaka
- Account delete information now contains account name.
- Added NPC keyword GOTO x,y,z,map to execute sphere default movements there.
- Redone pathfinding to support separate thread execution, so it now utilizes
  extra thread if OF_Multithreaded is set.
- Advanced AI now includes food search on hunger to eat and gather meal around.
  It is executed in separate thread with pathfinding if configured so.

21-12-04, Vjaka
- Changed sector allocations, now allocates only those who are needed by the
  server depending on the *.mul files found. Thus, on bare t2a install no space
  for other maps will be allocated (saves several Mbytes).
- Random selection {x y} now supports format {x,y} also. Should help using it
  with DAM/AR fields of items.
- Added EXP field to characters. No internal support for it yet. But you can
  use it in scripts already.
- Empty accounts file is created on-fly if not found. Useful for unpack-n-run.
- Fixed bug with TOTALCONNECTTIME being increased by doubled value, and now is
  made more accurate.
- Optimized the UID allocation routine, trying to disallow creating holes in
  objects allocation. This should improve memory neccessaty increase for large
  or long-lasting servers. Howewer, this does not defrag the current save, only
  newly generated UIDs will be optimized - no existant UIDs will be altered.
  Garbage Collection should be enabled for this optimization to work.
- Expanded account information in ACCOUNT NAME command by logged char name.

03-01-05, Vjaka
- Added <Rarguments> as a shortcut to <eval rand(arguments)>. Can take either
  one, two or no arguments like <R>, <R15>, <R3,15>. If no arguments given,
  R1000 is assumed.
- You can now disable broadcast messages (like errors, connects, etc) from the
  server log to be sent to your account logged via telnet. You can toggle this
  behavior per account via PRIV field of the account (mask 0400). So, only
  responces to your commands and some very-basic messages (like world save)
  will be sent in this case.

08-01-05, Vjaka
- Added support for virtual maps. Now map numbers 0..255 are supported by the
  server.
- Map dimensions are now customizable in INI-file using by the following cmd:
  MAPx=max_x,max_y,sector_size,real_map_number.
  Here x - the map number for ingame useage (4rd coordinate of the coordinate).
  max_x - maximal X coordinate of the map (should be multiply of 8).
  max_y - maximal Y coordinate of the map (should be multiply of 8).
  sector_size - the sector size (you can play with this if you experience lags
    decreasing this value (should be multiply of 8 and both max_x and max_y).
  real_map_numer - number used by map files (like: 0 for map0, statics0).
  You can also change some attribute of the current map not redefining all
  values, skipping the ones you wish to be as default putting 0 instead (for
  real map number -1). For example, decreasing sector size for map 0 to 16
  from default value of 64 will look in INI file thus: "MAP0=0,0,16,-1".
  Please note, that no changes are applied when server is already started.
- Default map numbering has been changed (you can ovverride it easily by MAPx
  setting in sphere.ini). Now 0 = map0, 1 = map0, 2 = map2, 3 = map3, 4 = map4.

10-01-05, Furio
- Added: tooltip %d command for gumps (works in SE clients).
- Added: sphere_map*.scp/sphere_map_points*.scp for new maps and fixed the
  default one.
- Updated: gray proto with new packets.
- Updated: client support to 4.0.7 family.
- Updated: fix in default script pack.

13-01-05, Furio
- Modified SERV.MAP(x,y) to accept a 3rd parameter, the map. If omitted is
  defaulted to 0.
- Added SECTOR access to read-only properties from a point. Example:
  SERV.MAP(100,100,1).SECTOR.ITEMCOUNT will give you the itemcount of the
  sector that contains the point 100,100 on map 1.
- Added REGION access to read-only properties from a point. (works like
  SECTOR one)
- Fixed: gumppic to show hue when used. (Hue usable only for client >= 3)

15-01-05, Vjaka
- Changed the way the server saves allowing more information about the cause of
  some exception (which is now not fatal for the save).

17-01-05, Vjaka
- Added LEVEL field to char as the future part of the experience system.
- Added ExperienceSystem, ExperienceMode, LevelSystem, LevelMode, LevelNextAt
  fields to the .INI file as a future part of the experience system. Read the
  default sphere.ini for more description over these fields.
- PRIV flags are now auto-clearing bits corresponding to not used priv. This is
  a solution for a possible incompatibility when the previosely disabled bit
  will be reused with other functionality on same world saves.
- Fixed: LAYER_EXTRA is now used ONLY to place the items bought by the vendor.
- Items sold to vendors are auto-deleted exactly upon the sell operation. The
  only case they are saved, if they are sold to player vendors.
- Amount of items in sell packet is now limited to the container size.
- Fixed one more sell/buy exploit.

17-01-05, Furio
- Fixed: party system.
- Fixed: group disappeared from gumps.
- Added: scriptable components for the party. Still work in progress.
  With <REF>.PARTY refer to the current party of the char.
  	   <REF>.PARTY.MEMBER.x refer to any member of the party.
       <REF>.PARTY.MASTER refer to the master of the party.
  PARTY.MEMBERS give the count of members
  PARTY.MEMBER.x has also ISMASTER and ISLOOTABLE properties.
  PARTY.ADDMEMBER[FORCED] you can add a meber by script (forced  version works
       without the normal /accept behaviour)
  PARTY.DISBAND disband the current party
  PARTY.REMOVEMEMBER @<N> remove the Nth member
  PARTY.REMOVEMEMBER <UID> remove a member in the party with the UID given
       (if is the master the party is disbanded)
  PARTY.SYSMESSAGE @<N> TEXT send a party sysmessage to the Nth member
  PARTY.SYSMESSAGE <UID> TEXT send a party sysmessage to a member in the party
       with the UID given
  PARTY.SYSMESSAGE TEXT send a sysmessage to the party
  PARTY.MESSAGE @<M> TEXT send a message from the Mth member to the party
  PARTY.MESSAGE @<M>,<N> TEXT send a message from the Mth member to the Nth
       member
  PARTY.MESSAGE <UID1> TEXT send a message from the <UID1> to the party
  PARTY.MESSAGE <UID1>,<UID2> TEXT send a message from <UID1> member to <UID2>
- Added: TAG/TAG0 for party.

24-01-05, Vjaka
- Fixed bug with some keywords recognition caused by <Rxxx> operator.
- Chardef triggers do not apply to players now.
- Write deleted accounts out to log file

25-01-05, Vjaka
- Fixed vendor selling in case of one item being sold.
- Ensure double character removal from view in "remove 1" case (for allshow).

26-01-05, Vjaka
- Fixed registry settings overriding MULFILES setting in some cases in win32.
- Fixed the way spells are checked whatever they are in a spellbook. New type
  of spellbook (186) has been added for script purposes with internal support.
  Now the spellbooks (if not default one) can be configured to specify which
  number of the lowest spell it contains (stored in MOREZ).
- Fixed casting speel with two or more similar spell books when it does not
  exist in one of these books.
- Removed limitation to 1 byte (255) for MOREZ of spellbooks. Now it can hold
  2 bytes (65535). Please note, that setting MOREZ via MOREP is incorrect here.

28-01-05, Vjaka
- Fixed bug caused with layer_extra removal from buy menu in older clients.
- Added support for packets filterings. Please note, that you should understand
  what are you doing. You can install your handler of a packet X specifying
  PACKETx=functionname. This function will be called when the packet is going
  to be processed by the server. It has the following arguments set:
  ARGN1 = packet number (to allow using one function for different packets)
  ARGS = source client ip address
  LOCAL.0-LOCAL.9 - first 10 bytes of the packet for parsing contents
  If you do return 1 in this function, the packet will NOT be processed.
- Some exceptions debug messaging speed optimised.

29-01-05, Vjaka
- Added argument for RECRUIT on guildstone. If set 1, the member recruited will
  become a fully qualifyed member of a guild with abbriviation shown on.

30-01-05, Furio
- Fixed: compatibility problems on Linux.
- Freeze for 0.56b Test1.

03-02-05, Vjaka
- Argument switches of target[f][g][w] functions can be given in any order.
- Fixed removing events on other events execution that leaded skipping others.
- Memory usage is lowered (pre-storage optimized for more accurate values),
  approx 30-40% less memory will be used (depending on load structure).

04-02-05, Vjaka
- Logout now quits from chat removing problems with inactive zombies left.
- Characters with Statf_STONE cannot logout (actualy, have 1 hour logout timer).
- You can now access account properties using SERV.ACCOUNT.x. reference where x
  is the numerical index of the account (0..SERV.ACCOUNTS) [read-only]
- Fixed extra step made on sector borders.
- Fixed "return"/"return 2" in chardef triggers stopping others from launching.

04-02-05, Furio
- Added support for 4.0.8 clients.
- Fixed some arguments parsing in party functions

05-02-05, Vjaka
- Optimized time profiling on ticking objects.

07-02-05, Vjaka
- Problem with items left with switching virtual maps with one physical should
  be solved.
- Added simple mySQL support. New settings MySqlHost, MySqlUser, MySqlPassword,
  MySqlDatabase will be used to connect to the DB in case if MYSQL is set to 1.
  You will need extra .dll/.so to download for sphere installation. They will
  join the packages.

08-02-05, Vjaka
- Fixed several map support bugs with incorrect sector counting (should improve
  support of a high map numbers).

11-02-05, Vjaka
- Fixed bug causing incorrect function name lookup in several cases with some
  special chars like underline (_).
- Added debug flags 0200 and 0400 to debug experience and level changes from
  server console (if enabled).
- Experience system integrated. Few addons about defaults to config comments:
  a) experience bonus for crafting counted as a value/100.
  b) default experience set on create is str+dex/2+int.
  c) manual setting experience will alter level if configured so.
  d) dying decreases experience by 10%
  e) killing enemy will give experience depending on exp and level of target.

12-02-05, Vjaka
- Added 2 more EXP settings to config: ExperienceKoefPVP and ExperienceKoefPVM,
  controlling percents of gaining experience in PvP and PvM combat.
- Added triggers @ExpChange and @ExpLevelChange, where ARGN1 (writeable) is the
  change is going to happen. Returning 1 cancels the change.

12-02-05, Furio
- Fixed: another buffer overrun exploit in log system. Thx to Radiant for
  reporting it.
- Added: SUPPRESSCAPITALS (default 0) to enable/disable Vjaka system to avoid
  long text written only in capital letters.

14-02-05, Vjaka
- OF_Advanced_AI is now obsolete. Currently it is controlled by NPCAI setting
  in config file.
- Added MaxLoopTimes value to config (default 10000) to limit a number of
  iterations the while/for cycle could have to remove possible deadlocks making
  server to stop responding (better use this instead of main loop restart).
- Added MOVERATE to CHARDEFs. It is the percent modifier of the speed of the
  NPC - the higher it is, the slower will the NPC be. Default is 100.
- Now double clicking on the log window in windows build will bring up an
  editor with corresponded file (if any specifyed in the same line) opened.

15-02-05, Vjaka
- Fixed one more buy menu exploit (probably, the last one) ;).
- Fixed NEWITEM id,amount in case if non-exact value was given (like {x y}).
- Added cont argument to NEWITEM (now it looks NEWITEM id,amount,container).

16-02-05, Furio
- Fixed: compatibility things for Linux/BSD build.

27-02-05, Furio
- Added: STRREV for strings.
- Reverted to dynamic linked executable for the linux build. That permit some
  exception handling during signal raise.

01-03-05, Vjaka
- Fixed gaining fame and exp on summoned pets.
- Faster and more intelligent protection from fastloot like ,emptycontainer. The
  delays for picking now are 0.3 sec per item. Item with amount (popping dialog
  with input) adds extra 0.2 sec delay.

04-03-05, Vjaka
- Fixed an exploit with invalid book packet (thanks Fallout for reporting).
- Fixed @Destroy event not fired.
- Added the minimal delay before accepting sell/buy deal equal to 0.3 sec per
  each item. This limits the power of autobuy/autosell/inject sell all.
- Added client property CTAG similar to the TAG array. The difference is that
  the contents is not saved, and is destroyed upon logout - useful place to
  store your local variables on the client character.

06-03-05, Furio
- Some other fixes to improve Linux build stability.
- Now killing sphere with HUP make the server save and exit.
- Added support for 4.0.9 client encryption.
- Added more comprehensible messages to error output (bad login / garbage / save)

10-03-05, Vjaka
- Fixed placing items from invalid containers upon save loading to world nearby
  100,100 coords, these items should be deleted, so they are.
- Limited amount of items shown to client on screen to MaxItemComplexity*30 (by
  default 25*30 = 750).
- Removed goldreserve from guilds - use TAGs for this.
- Windows: added build date and time to the About box along with the version.

13-03-05, Furio
- Added SERV.GUILDSTONES.x to referer to the Xth guildstone in the server.
  Use SERV.GUILDSTONES.COUNT to get the total number.
- Added SERV.TOWNSTONES working like SERV.GUILDSTONES.
- Added MasterUid property also in write mode. Now you can change the guild
  master passing the uid as argument.
- Some minor fix to Linux build.

14-03-05, Vjaka
- Optimised object los check, should decrease waste of cpu on large shards.
- Fixed possible webpage exploit with malformed requests.
- Removed EMAIL property from accounts and all associated commands (EMAIL/
  ADDEMAIL,defmessages) - use account TAGs to work with it when needed.
- Removed server status responce from the standart ping/telnet connection.
- Fixed logging in localy when both RemoteAdmin and Administrator accounts were
  not found and LOCALIPADMIN was set.
- Fixed misprinted defmessage ncp_* to npc_* (2 matches), sphere_msgs.scp now
  comes commented by default - uncomment things only you need to change - most
  people will not need this file at all, so by this way we show that.

14-03-05, Furio
- Temp removed "Limited amount of items shown to client on screen".
- Moved FOLLOW from exe to scripts. Now MEMORY_FOLLOW(01000) is unused.
- Modified default info gump with a new one (thx to NHR).

17-03-05, Vjaka
- Removed EF_No_Pause_Packet, it is built in to code now.
- Drop item on vendor to trade quick, removed npc_vendor_sell (from 1.0).
- Setting SLEEPMASK=0 will give no time to sleeping sectors (from 1.0).
- Optimised few widely used checks like touch check.

29-03-05, Vjaka
- Removed debug message about not found pathfinding path.
- Fixed bug causing objects disappear on doubleclick.
- "Limited amount of items shown to client on screen" is back due this was not
  the cause of the previous bug ;).
- Removed verbose command. It was anyhow very limited in Release build.
- Added -c command line switch to WIN32 build. It allows changing registered
  class name for sphere, which helps working via windows messages with several
  sphere servers on the same machine.

05-04-05, Vjaka
- Made ARGN1 writeable in @Hunger.
- Fixed OptionFlags display instead of MagicIngoreAR.

11-04-05, Vjaka
- Packet filtering support heavily expanded. Now you have these variables:
  LOCAL.NUM (value) set to amount of data got from the packet
  LOCAL.STR (string) all data threated as a string (aware of zero chars)
  LOCAL.ACCOUNT (string) current active account if any is logged by the client
  LOCAL.CHAR (uid) current active char if any is logged in from the client
  and the all data is now given in LOCAL.x, not the only first 10 bytes.
- Returning 1 in PACKETx handler function no longer shows Bad Msg Eat string.
- Removing exception on invalid map point in some drop cases.
- Account named like account keywords (ADD/BLOCKED/etc) denied for creation.

12-04-05, Vjaka
- Walking via others with no penalty fixed (now it more like it was before in
  the times of 55i - more correct way). You can override this by changing ARGN1
  in @PersonalSpace trigger.
- Fixed message of guard owners always saying previous region guards owners.

14-04-05, Vjaka
- Fixed Sphere accepting a player character as a valid guard in some cases.
- Fixed guard walking to enemy even if they are cheaters (instantkill enabled).
- Added messaging flood control - equal sysmessages one after another will not
  be sent to the client (if they are absolutely identifical and no any other
  message was between them).
- Added STRIP [DIR/] console command. Reads all scripts and outputs them to new
  files with only [...], and base definitions lines. Good for giving script to
  your gms to be able to use axis with very basic information.

17-04-05, Vjaka
- Fixed bug with quick trade on player vendors.
- Fixed an exception caused by empty messages in some client events.

21-04-05, Furio
- Added 4.0.10 client keys.
- Fixed: bugs in getting vals from party.

21-04-05, Vjaka
- Fixed some cases (not all!) of scripts clearence by specifying incorrect
  directory in STRIP command. There are too many ways to specify direct or
  indirect path that will look different but will lead to the same file
  starting from symlinks, ending with messing with .. and dir seprarators (\/).
  Locking the file is not ok, since it will cause problems with other threads
  or applications working with file. So use this either with care, or with no
  argument ;)
- Added Axis tags support CATEGORY, SUBSECTION, DESCRIPTION to STRIP command. I
  do not use them, so did not add that when making the command :).

23-04-05, Furio
- Some fixes and optimization for Linux code.

03-05-05, Vjaka
- Fixed bug causing impossibility to dress off items in some cases.
- Removed background task and all corresponding to it operations, since they
  only looked as working, while doing almost nothing.

14-05-2005, Furio
- Fixed some bugs in client detection.
- Fixed a bug for too short account name login.
- Removed support for encrypted client from 1.25.31 to 1.26.4 (you can use them
  only in unencrypted way).
- Fixed problems with allshow.
- Fixed problems with rand(x,y).
- Disabled (temp.) Vjaka's messaging flood control.

24-05-05, Furio
- Fixed some bugs for Linux build.
- Added CanSee check in spellcast.

25-05-05, Vjaka
- Added OF_Flood_Protection as a control of toggling appearence of same
  messages and sysmessages one after another. Note, that this setting is always
  off for PLEVEL 2 or upper, so GMs will always get everything.
- Fixed copses giving unlimited blood amount. Now, the corpse gets TAG.BLOOD
  upon creation to TAG.MAXBLOOD of itemdef. You can also alter TAG.BLOOD upon
  creation on the coprse object. The default value is 5.
- Due to multiply requests, TAG.LastLogged is removed just after showing it to
  client. It is still there for the purpose to show real last connection date.
- Added INI setting of MOVERATE (default 100) to change the default moving
  speed of all NPCs at once. Remember, this is percent setting.
- Fixed bless and curse on items which lead to ultimate stats raise.

28-05-05, Furio
- Fixed: Corpse not appearing.
- Fixed: CTAG sysmessage on set.
- Fixed: FVAL bug.

18-06-05, Vjaka
- Fixed book saving only the first line on each page.
- Fixed exception on allshow.
- Fixed console errors when using looms and repair.

27-06-05, Vjaka
- Removed RESOURCES2 line since it never worked at all.
- Fixed variety of bugs with using some keywords like newitem from functions
  called directly from the server (like f_onserver_start). Special char is
  created for this purpose to be acting as a default object.
- Region now executes command for all sectors inside if the command is sector
  one (you can use REGION.all* instead of REGION.SECTORS.all*) for example.
  REGION.SECTORS command is depricated.
- Added StatsFlags setting to cap MAX(HITS/MANA/STAM) status.

01-07-05, Vjaka
- Added f_onserver_exit triggered on server quit. Quite useless since no saves
  are occured after then, but good for launching some prog using sysspawn.
- Townstones are now listed in status using TOWNLIST command, splitting town
  and guild stones to different links.
- Fixed calling guards on self.

03-07-05, Vjaka
- Fixed fightself bug. It was not fixed before. I did not notice that since do
  not use default summon creature spell. Thanks Handred for reporting.
- Trying to improve the rate and distance NPC sees characters around. Now it
  should happen faster, since higher distance is checked in areas with little
  complexity.
- Spawning NPC distance is now more random. Also now spawning checks the
  borders inside disallowing to spawn in unaccessable place. Thus, if you place
  spawn in house and the doors are closed, there is no possibility for NPC to
  spawn outside the house.
- The death now triggers inventory close to avoid appearing fake items inside
  that are no longer in the pack.

04-07-05, Vjaka
- Fixed impossibility to change type of the object to a non-default one.

08-07-05, Furio
- Fixed SERVIP problems (and similar).
- Fixed pet killing not giving criminal status to owner.
- Added: client 4.0.11 keys.
- Fixed: FVAL 0 now gives 0.0
- Touchups on Ef_Walkcheck routines

11-07-05, Vjaka
- Fixed ALLCHARS region/sector command.
- Fixed typedef bug on save.

17-07-05, Furio
- Added SERV.RTIME.FORMAT. It takes as args a string like strftime()
  (the list is here http://www.scit.wlv.ac.uk/cgi-bin/mansec?3C+strftime ).
  e.g SERV.RTIME.FORMAT %d returns the number of the day.
- Fixed: animal trainer problem with EF_Walkcheck.
- Fixed: magic lock/unlock bugs.
- Fixed: dagger on static crop.

19-07-05, Vjaka
- Multithreading now should be more stable.
- Few misc fixes in combat, like added los check.
- Fixed REGION.ALLCHARS command.

19-07-05, Furio
- Fixed: creating unnamed chars.
- Fixed: creating chars with no title.
- Fixed: creating chars with hacked stats.
- Fixed: writing on console.
- Fixed: problem with spawning with EF Walk flags.
- Fixed: touchups in script pack.
- Added: hardcoded support for AoS/Se/Ml skills.

21-07-05, Furio
- Fixed: Warmode refresh if getting attacked (thx to Torfo).
- Fixed: Training skill out of skillsum cap.
- Fixed: Viewing hidden clients with higher plevel with allshow.
- Fixed: skill name/key/title in sphere_skills.scp
- Fixed: template mispelled (orge instead of ogre).
- Modified: sphere_map*.scp and sphere_point*.scp are now in map/
	subdir.
- Modified: only map0 and map1 scp are loaded, to load the others
	uncomment the lines in spheretables.scp

22-07-05, Cloud_Br (Script pack)
- Fixed: buying wool from vendors.
- Fixed: Missing flags in sphere_defs.scp
- Added: sphere_item_aos_se.scp containing various AoS/Se item defs.
- Added: spherechar_se.scp containing various npc defs for Se.

23-07-05, Furio
- Fixed: rock throwed by ogres not decaying.
- Fixed: cansee e musical item for provocation.
- Fixed: npc speak on train.
- Fixed: animal lore on mounted pets.

24-07-05, Vjaka
- Fixed: default object operations on server. Will not show extra error msgs.

25-07-05, Furio
- Fixed: npc try to attack mounts causing exceptions.
- Fixed: mounts disappearing. (thx to Gygrazok and Darkraven)
- Fixed: args not used in trigger @PersonalSpace. (thx to Darkraven)
- Fixed: Map teleports teleporting npcs.
- Added: 4th argument to map teleports. If is set to 1 npcs can use the teleport.
	By default is 0. Eg: 1,1,1,0=100,100,100,0=my_teleport=1 is enabled,
	1,1,1,0=100,100,100,0=my_teleport=0 or 1,1,1,0=100,100,100,0=my_teleport is
	disabled.

27-07-05, Vjaka
- Fixed: Several exceptions with latest client.
- Fixed: Extra error msg for show command when server property was specifyed.
- Fixed: Some more timeslices freeing will decrease useless cpu usage in
  multithreaded mode.

30-07-05, Furio
- Fixed: exploit with hair dye gump (choosing random color).
- Fixed: x/set respecting plevel.
- Moved: hair dye gump from exe to scripts.

30-07-05, Cloud_Br (Script pack)
- Fixed: problems with spherechars_se.scp
- Added: defs to sphere_backward_compatibility.scp
- Fixed: some areas without guards (map0/map1).

30-07-05, Vjaka
- Added: MySQL support to scripts. You can execute any queries and statements,
  as well as get data from mysql link. A special script object similar to the
  FILE or OBJ added and is named DB.
  DB Properties:
    CONNECTED - the current state of database connection (1 or 0)
	ROW.NUMROWS - number of rows returned by last query
	ROW.NUMCOLS - number of columns returned by last query
	ROW.* - list of all columns returned by last query. Both column names and
	  numbers are saved in the list, so you can use indexes [0..] or column
	  names [id, name, etc] here.
  DB Methods:
    CLOSE - disconnects the SQL server
    CONNECT - connects to the database (using mysql settings in sphere.ini)
	EXECUTE - executes SQL query not filling any results anywhere
	QUERY - executes SQL query filling ROW.* properties information
  Example of a simple query:
	DB.query "SELECT id FROM users WHERE account='<SRC.ACCOUNT.NAME>'"
	SERV.log "Got ID = <DB.ROW.id>"
  Note: Server does not create connection upon start, so if you wish to make
    the connection with the server start, add DB.connect to the function
	f_onserver_start.
- Fixed: Map support higher than map 0. Now there should be no more problems
  with fix throwing to incorrect Z level (hopefully).

31-07-05, Radiant
- Added: Support for tooltips. Requires OF_Tooltips (02000) and the 020
  FeaturesLogin flag. Usable in scripts:
  	Every object has a OBJPROPS property, which works like tags. Syntax:
  	OBJPROPS.<name>=<locale id>,[args]
  	note that <name> can be anything, but the entries are sent in alphabetical
  	order. So, for example, a bag, the props would look like this:

  	OBJPROPS.a="1048032"				// a bag
  	OBJPROPS.b="1050044,32,450" // ~1_COUNT~ items, ~2_WEIGHT~ stones
- Fixed: exception occuring during load with unknown keys in sphere.ini

01-08-05, Radiant
- Added: CTAG0 similar to TAG0 version of CTAG.

03-08-05, Radiant
- Horses are now forced to dismount and will die if someone is riding them and
  they have statf_dead set or their hitpoints are 0 or below.  This should fix
  the "ghost" horses appearing sometimes (when horse is poisoned and ridden).

08-08-05, Furio
- Fixed: CTAG0 when setting a value.
- Updated: sphere_backward_compatibility.scp
- Added: FILE obj, enabled by Of_File_Commands. Look in manual.txt for help.

08-08-05, Vjaka
- Added: SQL support for multiply rows. You can use both ways ROW.<column#> and
  ROW.<row#>.<column#> for addressing a field you are interested in, but the
  first method allows operating on row #0 only.
  Sample full-n-ready script to show how to use this feature:
	DB.connect
	if ( <DB.connected> )
		db.query "SELECT * FROM mytable"
		for R 0 <eval <DB.ROW.NUMROWS>-1>
			SERV.log "--- ROW #<eval <LOCAL.R>> ---"
			for C 0 <eval <DB.ROW.NUMCOLS>-1>
				SERV.log ".. COLUMN #<LOCAL.C> : <DB.ROW.<eval <LOCAL.R>>.<eval <LOCAL.C>>>"
			end
		end
	endif
- Added: a possibility to specify MySQL port. Just add ':port' to the host
  record.
- Fixed: account references in several cases leading to errors.

11-08-05, Radiant
- Fixed 'undefined keyword' error on SKILLMENU with not enough resources on player

13-08-05, Exer (Script pack)
- Added: sphere_item_building_roofs_se.scp (SE roofing items)
- Added: sphere_item_building_walls_se.scp (SE wall items)
- Added: sphere_item_magic_necromancer_aos.scp (SE necromacer items)

13-08-05, Cloud_Br (Script pack)
- Updated: sphere_backward_compatibility.scp
- Updated: sphere_region.scp
- Added: sphere_chars_newer.scp (All monsters of AoS/SE)
- Removed: sphere_chars_aos_se.scp (Obsolete, sobstituted by chars_newer.scp)

15-08-05, Vjaka
- Added: AutoResDisp ini setting (default:0) to setup this resdisp by default
  to all accounts. Useful if all your clients are using at least some client.
  Recommended setting at least 1 (T2A).

15-08-05, Radiant
- Fixed: potential buffer overflow exploit in file write operations
  Also saves one string operation, it's gotten a little faster.
- Fixed: CTAG/CTAG0 got broken in last fix
- Fixed: Extremely long save times
- Moved: .admin from executable to scripts and completely rewritten it.
  Please copy sphere_admin.scp from the script pack. Same is going to happen
  to .tweak.

16-08-05, Rattlehead (Script pack)
- Added: sphere_item_building_floors_se.scp (SE floor items)
- Added: sphere_item_misc_se.scp (SE misc items)

18-08-05, Radiant
- Added: exception catching around more save sections, should give a better
  description if a save error occurs
- Added: sphere no longer cares if an npc is riding a valid horse, so you can
  just add a horse item
- Script sphere_admin.scp:
  - Staff can see their own IP
  - Invisible staff is now printed in red
  - Added summon cage
- Fixed: problem in saves and allskills, no check if skill is defined or not.
  Broke saves (naked players) on some servers with not all skills (AOS and SE) defined.
- Fixed: Disconnected NPCs (horses) being seen if rider is gone (probably! need feedback)

18-08-05, Gygrazok (Script pack)
- Modified: sphere_admin.scp:
  - Start position of dialogs set to 0,21
  - Default page of the tweaking menu set to "action"
  - + shown before account name for higher privs and - before guest accounts (like the old admin panel)
  - Removed PLevel informations in main page to get more space for char name
  - Closing tweak dialog brings back to main page
  - Added number of online clients in the main page title and changed "Administration Console"
    to "Admin Panel", which is shorter
  - Added "remove note" button
  - Fixed: extra page if you have 15 clients only

19-08-05, Furio
- Removed: OF_Tooltip
- Removed: Features/FeaturesLogin
- Removed: @CreatePlayer
- Added: Feature(T2A/LBR/AOS/SE/ML) to use feature expansion. Look in sphere.ini for usage.
- Added: f_onchar_create in sphere_serv_triggers.scp. With newer clients you'll get
	ARGN1 flags - ARGN2 profession chosen - ARGN3 elf
- Added: TRYSRV. It works like TRYSRC but putting automatically as src the server.
- Scripts: Added TRYSRV as plevel 7 command. I highly recommend everyone does this!

19-08-05, Radiant
- Scripts: Added TRYSRC as plevel 7 command. I highly recommend everyone does this!
- Fixed: d console command (area dump) was broken a while ago

21-08-05, Vjaka
- Fixed: 2 exploits due to bad player name parsing (thanks XD for reporting).

21-08-05, Radiant
- Made ROOM object accessable on everything. It is used like REGION, but for ROOMDEF.

22-08-05, Furio
- Fixed: Crash on sell for older clients.
- Fixed: Tooltip not working also if correct ini flags are set.
- Fixed: i_blood_2 created by sphere during hits not decaying.
- Added: TFLAGS accessable as SERV.ITEMDEF.defname.TFLAGS to get tiledata flags of the item.
- Added: p# dump all profiler data to profiler_dump.txt

23-08-05, Radiant
- Added: more exception catching to CSector::OnTick, should print more descriptive errors now
- Fixed: resource gathering bug (mining fishes when switching from pickaxe to fishing rod, etc)
  (resource gathering skill is now aborted if resource gathering tool is unequipped)

23-08-05, Vjaka
- Fixed: fatal exceptions referencing PARTY methods (PARTY.MEMBERS) from NPC.
- Fixed: account references for writing in scripts under low-privileged accounts.
  Both ways SRC.ACCOUNT.xxx and SERV.ACCOUNT.name.xxx are accessable this way.
- Fixed: invalid message when unlocking container told that I locked it.
- Fixed: NPC_AI_FOOD now obeys homedist and will not search out of the range.
- Fixed: NPC_AI_EXTRA caused npcs moving stonewalls and other spells :)
- Fixed: Pathfinding broken by some of the later changes.

23-08-05, Lynchy (Script pack)
- Added: NPCs from Mondain's Legacy (npcs/spherechar_mondains_legacy.scp)

24-08-05, Furio
- Added: Support for elf body (and ghost) in game.
- Added: Client keys for 5.0.0.
- Added: TAG.MAXPLAYERPETS to Stabler. It's the maximum limits of pets that a player
		 can stable. If not setted is 10.
- Added: @UserGuildButton for the new guild button on client.
- Added: @UserQuestButton for the new quest button on client.
- Fixed: Spellbook with newer clients (displaying/selecting spell).
- Fixed: Elf NPCs from Mondain's Legacy (npcs/spherechar_mondains_legacy.scp)
- Updated: grayproto to support ML quest button.
- Updated: spheretables.scp (changed plevel of some commands for better security)

24-08-05, Vjaka
- Added: CombatFlags ini setting. Currently it controls two aspects of the
  bounce back effect in combat.
- Fixed: Reference to SERV from some triggers including @Enter in regions.
- Fixed: House regions creation for maps bigger than 0.
- Fixed: Players unavailable to call guards on NPCs.
- Fixed: Trigger command that did not work on characters.

25-08-05, Radiant
- Removed: OBJPROPS
- Rewritten tooltips to use a trigger. There is @ClientTooltip on items and characters.
  (in the world, only non-static, movable items)
  You can use ADDCLILOC on the client in this trigger (SRC), syntax:
  ADDCLILOC <cliloc id>,[arguments]
  Arguments can also be NULL, to skip an argument.
  If this trigger returns 0 or nothing, some default properties will be added to the tooltip
  depending on the type.
  If it returns 1, no default properties will be added (but the tooltip still be sent).
- Added: @GetTooltip (ARGO = item being sent for) for players. This is like @itemEquip, etc.
  Fired before @ClientTooltip, if returns 1 @ClientTooltip is skipped.
  Try keeping these triggers light, because they will be fired alot.
- Added: f_onserver_save_finished, called after save is completely done
  (ARGS is time it took to save in seconds, 4 digit precision)
- Fixed: exploit to cast spells faster than normal (i.e. cast first clumsy then flamestrike)
  with precasting enabled.
- Added: COMMANDPREFIX ini setting. Default is .

25-08-05, Lynchy (Script pack)
- Added some Mondain's Legacy items (not complete yet)

26-08-05, Radiant
- Fixed: MASTERUID no longer changes loyalty, should fix the errors (was undesired behaviour too imo)
  Note that in order for this setting to work the person you set this to has to be a full member
  of the guild.
- Fixed: REMOVE not working in @EquipTest
- Added: Encryption keys for clients are now in SphereCrypt.ini. When new clients come out,
  the new keys can just be added here without the need to upgrade sphere.

26-08-05, Furio
- Fixed: Tooltip sent to wrong client version making them crash.
- Updated: sphere_defs.scp

26-08-05, Cloud_Br (Script pack)
- Updated: sphere_chars_newer.scp (Monsters of AoS/SE)

26-08-05, Gygrazok (Script pack)
- Added: sphere_item_deco_mini_houses.scp (House miniatures of AoS)

28-08-05, Furio
- Fixed: mem leak in CGTypedArray (and derived one).

28-08-05, Radiant
- Added: missing @itemClientTooltip trigger causing wrong triggers to be fired
- Removed: @GetTooltip. Please use @itemClientTooltip trigger now, argo = item
  tooltip being sent for (in both @ClientTooltip and @itemClientTooltip)
- Added: Notoriety title and guild abbreviation to default character tooltip
- Changed: Tooltips added in triggers now show below the name if return 0
- Fixed: Game Master title no longer shows on tooltip with privshow off
- Added: Elf bodies to sphere's internal list of humanoids
- Fixed: mem leak in sorted variable arrays (DEF/TAG/CTAG/VAR/LOCAL/etc)

30-08-05, Vjaka
- Added: GenericSounds ini settings to enable/disable all sounds.
- Removed: PlayerGhostSounds since it was not checked anywhere.

30-08-05, Cloud_Br (Script pack)
- Removed: spherechars_newer.scp
- Added: spherechar_lbr.scp (Lbr monsters)
- Added: spherechar_aos.scp (AoS monsters)
- Added: spherechar_se.scp (SE monsters)
- Updated: sphere_item_building_others.scp

02-09-05, Cloud_Br (Script pack)
- Updated: sphere_defs.scp (new sounds)
- Updated: spherechar_lbr.scp (Lbr monsters)
- Updated: spherechar_aos.scp (AoS monsters)
- Updated: spherechar_se.scp (SE monsters)
- Updated: sphere_item_building_others.scp
- Added: sphere_item_icons_new.scp (icons from new expansions)

03-09-2005, Furio
- Fixed: PARTY references (master/member)
- Fixed: hue/hair/beard for elf selectable on char creation
- Updated: sphere protocol (accepts tooltip refresh requests from new clients)
- Added: ISINPARTY to char (check if a player is in party)
- Added: UseDefaultSource (default: 0) if enabled SERV fallback to its default
  source when executing commands. You shold set this to 1 if you are operating
  with any new objects from functions called directly from the server, like
  f_onaccount_login, f_onserver_start and so on.

05-09-2005, Furio
- Updated: Sphere now support the internal client cache for tooltips. This will
  avoid wasting of bandwith and client crashes.

05-09-2005, Radiant
- Fixed: incorrect info on tooltips for some types

06-09-2005, Vjaka
- Fixed: some operations workability (SERV.new*) called from functions that are
  run directly by the server. This disables both the default script object and
  UseDefaultSource.
- Fixed: rescount-like operations when arguments was specifyed.
- Denied account auto-creation with first character numeric to avoid server
  confusion to treat this account as index or a valid name in some operations.
- Fixed: win32 server crash if server name was too long.

06-09-2005, Furio
- Added: SCREENSIZE to access the game window size if the client supports that.
  You can access that via SCREENSIZE.X and SCREENSIZE.Y.
- Added: RESENDTOOLTIP. Calling that on the object you need to resend tooltip.
  Since clients use a cache for tooltip, if you want to force the cache too use
  RESENDTOOLTIP 1.
- Fixed: REMOVEFROMVIEW/TARGET(FGW) not working.

08-09-2005, Vjaka
- Fixed: several errors with sql queries.
- Added: AutoPrivFlags to specify auto PRIV flags for new accounts.
- Added: ARGN1 to f_onaccount_login specifying account type. Most common values
  are 3(login), 4(go to game), 5(http), 6(telnet).
- Added: HitsHungerLoss to specify char hits percents lost on starving tick.
- Added: TAG.NOSAVE tag for objects. If set to 1 the object will NOT be saved
  when the world save will take place.
- Fixed: NEW* commands on characters not modifying character's ACT.

08-09-2005, Furio
- Fixed: SCREENSIZE.X/.Y not working.
- Added: CLIENTIS3D. Returns 1 if is a client is 3D.
- Removed: Client support for clients older than 1.26.00 (they're awfully old).
- ReDone: Unencrypted client support. UseNoCrypt now is a bool 1 means that
  unencrypted client are allowed to login. If ClientVersion in sphere.ini is
  setted to some value (e.g. 4.0.0) then only that client version will login
  (this is valid for encrypted and unencrypted clients). Note that sometimes
  unencrypted clients sometimes are dumb and sphere not recognize them properly
  (and thus disconnected), but after restarting the client it's all ok.
- Modified: REPORTEDCLIVER. It contains the version of the unencrypted client
  without any trailing letter. To get the complete version (e.g 4.0.11f) use
  REPORTEDCLIVER.1.
- Modified: Disabled support for client tooltip cache (it'll be re-enabled after
  a re-write).

08-09-2005, Cloud_Br (Script pack)
- Updated: sphere_map_points3.scp
- Updated: sphere_item_profession.scp
- Added: addons/worldfiles.zip. It contains a fully spawned world for Felluca,
  Ilshenar and Malas.

09-09-2005, Furio
- Moved: Hardcoded mount/mountid list from exe to scripts.
- Updated: sphere_defs.scp with the mount/mountid list. Read the comments to
  know how to edit it.
- Fixed: READLINE returning blank line.
- Fixed: Referring to party outputs a debug message.

09-09-2005, Vjaka
- Fixed: Popup menus not calling SELL, BUY speech triggers on NPCs.
- Added: LBR mounts IDs to the mount defnames.
- Fixed: mounting later npcs since they were treated being brain_human.

10-09-2005, Cloud_Br (Script pack)
- Fixed: some guarded areas on sphere_map2.scp that should be guarded.
- Fixed: names on sphere_map1.scp (Britain being Britain too, so when you
  typed .go britain you were going to MAP 1), now all trammel places have
  "Trammel <local name>".
- Fixed: some errors on addons/worldfiles.zip.
- Added: new mounts on sphere_chars_new_mounts.scp and their icons.
- Added: new mounts sounds to sphere_defs.scp
- Added: some HTML defs to sphere_defs.scp

10-09-2005, Rattlehead (Script pack)
- Added: new mounts defs to sphere_defs.scp
- Added: new mounts defs to spherechar_mondain_legacy.scp

12-09-2005, Furio
- Added: WOPCOLOR/WOPFONT to set color/font of Word of Powers.
- Added: TAG.OVERRIDE_SKILL applied to a weapon override the SKILL= field.
  Attention is a 1 based field so... 1 means Alchemy and so on.
- Modified: now PACKETxx in .ini accept values from 0 to 255.
- Modified: item, with attr not containing 010 or 08000, dropped by player
  on sea or black tile will insta-decay. RETURN 1 on DropOn_Ground
  avoid that thing.

14-09-2005, Vjaka
- Added: warning msg if chardef does not have any CAN flags specifyed.
- Added: error msg if RESOURCES line contains errors inside.
- Fixed: NPC item equipping not having mt_equip flag.
- Fixed: dialog command TILEPICHUE nor working.

18-09-2005, Cloud_Br (Script pack)
- Fixed: some errors on spherechar_lbr.scp

19-09-2005, Vjaka
- Fixed: wopfont not working.
- Optimized vendor templates storage. Now vendor does not keep all the items to
  be sold or bought from players all the time, but generate this list on the
  first query and invalidate after some time. It will save your server and save
  from tons of objects not actualy in the world.

19-09-2005, Furio
- Fixed: HITPOINTS not working.
- Modified: SYSPAWN/SYSCMD on *Nix build should work now.

20-09-2005, Vjaka
- Added: COMMANDTRIGGER setting. If set, each command the client is entering by
  .something will be given to the function first. If it returns 1, the default
  action is not taken. This allows overriding default commands.

21-09-2005, Cloud_Br (Script pack)
- Added: addons/Champion_Spawn.zip. A functional Champion Spawn system for Sphere.

21-09-2005, Furio
- Fixed: Spellbook content not correctly sent to newer clients.
- Fixed: SHRINK not working.
- Fixed: carving corpse not working.
- Fixed: using .commands with GM body.
- Modified: tooltip info on spellbooks.
- Modified: Damage on head for newer client now use newer packet.
- Modified: FeatureAOS in sphere.ini. Look in to know how it works.
- Added: support for All Names in 3d clients and newer 2d (ctrl+shift macro).

22-09-2005, Vjaka
- Fixed: Open paperdoll popup menu on self dismounting from horse.
- Modified: Resync executed in a fast mode will not broadcast notes to clients.
- Modified: Low hungry level does not damage in safe zones, and in underground
  for NPCs.
- Fixed: ARGO reference when no property was specifyed.
- Fixed: TOPOBJ reference.

22-09-2005, Furio
- Fixed: attack not working with some weapons.
- Fixed: damage packet sent to incorrect clients.
- Fixed: Advanced_LOS not blocking los in some cases.
- Fixed: Spell teleport not using ef_walkcheck routines when enabled.

23-09-2005, Cloud_Br (Script pack)
- Updated: addons/Champion_Spawn.zip (read inside readme for more infos).
- Updated: addons/worldfiles.zip (read inside readme for more infos).

25-09-2005, Furio
- Updated: Moved all OF flags related to magic/magery in "ad hoc" field
  called MAGICFLAGS. More info on it in Sphere.ini.
- Added: SEXTANTP. Retrieve the sextant point shown by a sextant in args
  and if no args are set it would return the sextantp for the reference.
- Added: support for showing skillcaps in newer clients.
- Added: support for new status gump in newer clients.

25-09-2005, Radiant
- Added @SkillUseQuick char trigger and @UseQuick skill trigger, these are
  called when sphere does a quick run of a skill (just difficulty test + skill
  gain), in which case it wouldn't call @SkillStart (for example use of tactics,
  parrying in combat, arms lore with blacksmithing repair, magic resistance, etc).
  ARGN1 = skill being used
  ARGN2 = difficulty requested
  ARGN3 = result of difficulty calculation (same as in @GetHit)
  returning 0 will force skill to fail, returning 1 will force skill to succeed
  (both skip gains)
- Fixed: GMs not being able to resurrect in anti-magic areas
- Added: Character flag 020000 (STATF_ArcherCanMove), same as OF_Archery_CanMove
  but for specific players. OF_Archery_CanMove overrides this flag for everyone.
- Updated: sphere_defs.scp and sphere_admin.scp for STATF_ArcherCanMove.
- Added: NPCAI flag NPC_AI_ALWAYSINT (0008), always be as smart as possible when
  pathfinding.
- Fixed: SERV.NAME not working
- Added: SKILLUSEQUICK on chars, syntax: <SKILLUSEQUICK (skill) (difficulty)>.
  Does a quick use of a skill based on (difficulty) and returns 1 if it succeeded.

26-09-2005, Vjaka
- Fixed: exception when adding empty sell/buy template on restock.
- Modified: CommandTrigger now has 2 arguments (in/out): ARGN1 is whatever the
  command is accepted (limited by PLEVEL section, etc), and ARGN2 is whatever
  the command should be said if not accepted. Also the prefix of the command is
  cut up as well.
- Fixed: SERV.MAP if normal point was given in arguments (with Z coord).
- Modified: the sphere window operation on tray dclick. Now it hides if shown
  and appears if hidden.

26-09-2005, Furio
- Modified: <STRREV string> to StrReverse(string)
- Added: StrTrim(string) trime whitespaces at start/end of the string.

26-09-2005, Gygrazok (Script pack)
- Added items/sphere_item_eight_age.scp. Item of 8th anniversary of UO.

27-09-2005, Furio
- Added: support in status gump for stat locking.
- Added: STATLOCK[x] working like SKILLLOCK[x] but for stats.

27-09-2005, Cloud_Br (Script pack)
- Updated: sphere_map0.scp and sphere_map3.scp
- Updated: sphere_map_points0.scp and sphere_map_points3.scp
- Updated: addons/Champion_Spawn.zip (read inside readme for more infos).
- Added: addons/Doom_Dungeon.zip. A functional Doom Dungeon system for Sphere
  (read inside readme for more infos).

28-09-2005, Vjaka
- Added: ARGN2 to UserSkills trigger. Will be 1 if triggeted from .info command
  that is useful if you use custom skill gump and not wish it opening when its not
  needed.
- Fixed: ModAr not affecting actual armor.
- Added: ARGN2 (show the message of gain/loss) and ARGO (person killed) to the
  @ExpChange trigger.

29-09-2005, Furio
- Updated: Moved LAYER_LIGHT from 9 to 15. Modified all hardcoded things.
- Updated: script pack (sphere_defs.scp, sphere_item_unsorted.scp).
- Fixed: sphere_admin.scp showing incognito name.
- Fixed: elf created always with blond hair.
- Added: RESDISPDNID/RESLEVEL/RESDISPDNHUE for items (it'll work for equippable ones only).

30-09-2005, Vjaka
- Fixed: dupe <amount> limited to the item complexity in containers.
- Fixed: commandtrigger not having proper default object.
- Added: TIMERCALL ini setting to specify amount of minutes for server to call
  user function f_onserver_timer.
- Added: BETWEEN min,max,currentvalue,maximalvalue to get the curve value in
  this combination.
- Modified: <Rx,y> now supports formulas inside, so -, or eval could be used.

01-10-2005, Cloud_Br (Script pack)
- Updated: addons/Doom_Dungeon.zip (read inside readme for more infos).
- Updated: addons/Champion_Spawn.zip (read inside readme for more infos).
- Updated: addons/worldfiles.zip (read inside readme for more infos).
- Added: addons/Slayer_Weapons.zip (read inside readme for more infos).

02-10-2005, Radiant
- Fixed #013: Webserver attempting to parse images and sending invalid
  Content-Type header to clients
- Updated #037: Changed @Kill trigger to be fired on ALL the characters that had
  to do with the killing and therefor would gain/lose karma/fame. return 1 stops default
  karma/fame changes.

02-10-2005, Handred (Script pack)
- Updated: sphere_types.scp

04-10-2005, Furio
- Fixed #040: An item crafted by a player (skillmenu - makeitem) is created
  without decay flag set.
- Updated: Client >= 5.0.0 now use the compressed dialog packet (bandwith saver).
- Updated: Default tooltip for a char (guild title/name).
- Updated: sphere_item_eight_age.scp with some RESDISP tests for two items.
- Added: TEXTENTRYLIMITED/DTEXTENTRYLIMITED (working in only in client >= 5.0.0),
  look into sphere_dialog.scp help section.

04-10-2005, Cloud_Br (Script pack)
- Updated: sphere_admin.scp

06-10-2005, Vjaka
- Added: MOUNT command for character to mount it (if possible) by SRC object.
- Fixed #020: Vendor buy menus showing empty list.
- Fixed #022: Fame prefix shown when in polymorph.
- Fixed #006: Item remove not working in DropOn_Ground.
- Fixed #017: Chars with MT_NONMOVER unable to spawn.
- Fixed #051: Extra message when drinking potions too fast, or eating errors.
- Fixed: ISBIT command. Now it is used like all rest functions <isbit value,bit>
  without complicated eval plus brackets constructions difficult to reproduce.
- Added: SETBIT value,bit and CLRBIT value,bit commands which returns mask with
  specifyed bit set or cleared.
- Added: @ operator (means power of value, fe: 2@3 = 8).
- Added: If SERV.log @text specifyed, this will be shown without script context.
- Added: ALLOWLIGHTOVERRIDE, if set to zero, sector local light will be skipped.

06-10-2005, Furio
- Fixed #009: Client lingering in newer clients.
- Fixed #061: Name not shown on paperdoll.

07-10-2005, Vjaka
- Fixed #057: <dSOMEVAL> gave incorrect values.

07-10-2005, Furio
- Fixed #065: Commands not working with gm body.
- Fixed #064: Commands saying with sysmesage.
- Fixed #055: sphere_backward_compatibility.scp. MUSIC command.
- Fixed #062: sphere_char.scp. CAN flag not specifyed for c_corpser.
- Added: StrIndexOf(string1,string2,[offset]). Search string2 in string1 and
  returns -1 (if not found) or a number >= 0 if found (index in string1).
  Offset is optional (where to start to search 0-based index).

11-10-2005, Vjaka
- Added: ZeroPoint to configure base of the sextant coordinates.
- Improved: exception debugging and support.
- Fixed: dclick on console not always opened the corresponding file.
- Added: ARGN2 in speech triggers corresponds to the player speech color if
  applicable.

11-10-2005, Radiant
- Fixed #070: Container can now be changed in @DropOn_Ground and @DropOn_Item

13-10-2005, Vjaka
- Fixed: ADDCLILOC leading to string corruption.
- Optimized: CALL operator to work faster if arguments are specifyed.
- Fixed #049: isevent/istevent working incorrectly.

18-10-2005, Radiant
- Reverted 0.56b back to 14-10-2005 07:10, 0.57.1 is now a different branch

19-10-2005, Radiant
- Tweaked #121: showing durability in tooltips as hits / maxhits instead of
  percentages for armor/clothing.
- Added #038: CTAGLIST and SERV.VARLIST. TAGLIST/CTAGLIST/SERV.VARLIST LOG writes
  results to the console.
- Fixed #098: Client not updating on .invis

19-10-2005, Cloud_Br (Script pack)
- Added the minor artifacts, see inside sphere_minor_artifacts.scp for tips.
- Added some missing fields to sphere.ini (PROFILE and EVENTSPET)
- Some updates and fixes on doom script and champions script.

19-10-2005, RanXerox (Script pack)
- Updated: sphere_item_aos_se.scp
- Updated: sphere_item_ml_weapons.scp
- Updated: sphere_item_treasure_maps.scp

19-10-2005, Vjaka
- Added a deadlock detection to some keywords parsing, that will eliminate some
  stack overflows.

22-10-2005, Furio
- Fixed #087: Guild related clilocs are bugged.
- Fixed #091: WOPFONT doesnt work.
- Fixed: bug in encryption routines that could lead to a sphere crash during startup

23-10-2005, Furio
- Fixed: Referring to SERV.MEM when memory = 0 causing exceptions.
- Fixed #131: Feature_AOS_Damage + Canharmself cause 2x damage display if damage
  is on self.
- Added #125: SERV.CLEARVARS. Clear all vars. Added in default script pack as
  plevel 6 command (spheretables.scp).
- Removed: SERV.DELETEFILE / SERV.WRITEFILE / READFILE / FILELINES since they're all
  integrated in the FILE obj.

26-10-2005, Cloud_Br (Script pack)
- Updated: sphere_item_building_walls_se.scp

26-10-2005, Furio
- Fixed #135: All stats being 26 when creating char.
- Fixed #149: Trigger @Rename is never called.
- Added: @UserSpecialMove with ARGN1 the special move selected from the fight book.

31-10-2005, Furio
- Fixed #159: Party don't display correct loot info.
- Fixed #171: All NPCs have ISSTUCK 1, even if they are on open, clear ground.
- Fixed #167: Can't see tooltips for locked down items.

04-11-2005, Vjaka
- Fixed #174: NEWDUPE from server object.
- Fixed #161: max* stats affected by mod* even if unsynced.
- Fixed #128: ClientTooltip trigger return 1 causing exceptions.

08-11-2005, Furio
- Fixed #188: <guildstone>.member.X.IsCandidate not working.

11-11-2005, Furio
- Fixed #186: <serv.map(<PLACE>).region.name> giving missing location.
- Added #199: Hiding hierachy (higher plevel will see lower hidden plevel gray).

15-11-2005, Vjaka
- Fixed #208: return 1 on @ReceiveItem not bounced item back if it was still in
  dragging layer.
- Fixed #151: trigger command not working for characters.

18-11-2005, Cloud_Br (Script pack)
- Fixed a bug when stealing artifacts that might cause crashes (add-on/Doom_Dungeon.zip).
- Added some missing weapons to sphere_item_ml_weapons.scp
- Added some missing npcs to spherechar_lbr.scp
- Added Succubus to Daemon Slayer list (add-on/Slayer_Weapons.zip).

22-11-2005, Vjaka
- Fixed #112: impossible to access the CHARDEF if the NPC is not in world.
- Fixed #225: CanSee and CanSeeLOS always required for SRC and not accepting
  arguments in several cases (actualy CanSee did not accept this at all).

22-11-2005, Torfo
- Fixed #221: Msg/Say parameters have no effect on hearall output.

24-11-2005, Cloud_Br (Script pack)
- Updated add-on/Champion_Spawn.zip:
  Changed c_forest_lord to c_etheral_warrior as it should be on Forest Lord Spawn Group.
  Changed ID field for Lord Oaks to c_etheral_warrior, to respect the defnames changes.
  Barracoon now has the hability to summon ratmans.
  Added Rotting Corpse to Unholy terror spawn.
  Added Rotting Corpse to Undead slayer weapon list.
  Corpses of the minions should now stay on the ground (with a timer of 15 seconds) to
    avoid lag.
  Optimized spawning of monsters, they won't appear on the same spot anymore and walk a
    way after some time, they will appear scatered around the spawn in a maximum distance
    of the range of that spawn (this should avoid lag when changing levels).

25-11-2005, Vjaka
- Fixed #233: Setting MAX* was substracting MOD*, so did not work correct way.

28-11-2005, Cloud_Br (Script pack)
- Updated add-on/Doom_Dungeon.zip.
- Updated add-on/Champion_Spawn.zip.

01-12-2005, Vjaka
- Fixed #222: Region triggers required return 0 to allow other same triggers to work.

01-12-2005, Cloud_Br (Script pack)
- Updated add-on/Champion_Spawn.zip:
  Fixed some wrong defnames on the monsters list.
  Fixed champion appearing as a man and dieing.
- Updated add-on/Slayer_Weapons.zip:
  Added Bovine Slayer to slayers list.
- Updated: Talismans to sphere_item_ml_misc.scp.

01-12-2005, Blizzard (Script pack)
- Updated: aquarium fishes to sphere_item_ml_misc.scp.

02-12-2005, Torfo
- Fixed #251: PacketX & unary operators

03-12-2005, Furio
- Fixed #246: Desappearing items on tiles built over water map tiles.
- Fixed #227: Tooltips for locked down items isn't being sent yet.
- Fixed: re-added basic support for speech.mul.

07-12-2005, Torfo
- Fixed #242: Cannot connect with newer clients

08-12-2005, Vjaka
- Fixed #247: Sector local time not changing, light levels not working due that.

09-12-2005, Vjaka
- Fixed #11: DiagonalWalkCheck caused problems with NPC spawning.

10-12-2005, Sir Dwayne (Script Pack)
- Updated: sphere_skillmenu.scp (Silver jewelry)
- Updated: spherechar_human.scp (Female barber)

11-12-2005, RanXerox (Script pack)
- Updated: maps/sphere_map_points2.scp (Rat fort teleporters)
- Updated: sphere_types.scp (Swamp terrain)

11-12-2005, Blizzard (Script Pack)
- Renamed: sphere_item_ml_weapons.scp to sphere_item_provisions_weapons_ml.scp
- Added: sphere_item_provisions_weapons_aos.scp
- Added: sphere_item_provisions_weapons_se.scp
- Updated: sphere_item_aos_se.scp
- Added DUPELIST and DUPEITEMs for all AoS, SE, and ML weapons.
- Added: sphere_item_provisions_armor_aos.scp
- Added: sphere_item_provisions_armor_se.scp
- Updated: sphere_item_provisions_weapons.scp

11-12-2005, Cloud_Br (Script Pack)
- Updated: sphere_minor_artifacts.scp (some missing minor artifacts)
- Added: sphere_item_christimas.scp (Christimas Item ids that come with 5.0.1f patch)

15-12-2005, Introvert (Script Pack)
- Updated: sphere_events_npcs.scp (fixed bugs in e_undead)

20-12-2005, Furio
- Fixed #286: Bug with @ operator (power of).

25-12-2005, Furio
- Fixed: FILE.READLINE returning strings with trailing \n and \r.
- Changed: StrTrim(args) to <STRTRIM args>.
- Fixed #298: Logging out while dragging item.

25-12-2005, Handred
- Fixed #287: Updated sphere_item_professions.scp

26-12-2005, Vjaka
- Fixed #294,#296: @SpellCast did not allow or disable to change words of power.
- Fixed #282: Operator ^= did not resolve.

28-12-2005, Radiant
- Fixed #090, #172, #237: ACTION being changed on UseQuick because of new trigger
- Fixed #136, #154, #291: Partial character updates not working
- Fixed #129: GM body can now also use the normal command prefix, instead of only '='
- Fixed #299: Transfering pets to NPCs

29-12-2005, Furio (Script Pack)
- Updated: sphere_item_provisions_weapons_ml.scp (fixed bug BLACKSMITH
  instead of BLACKSMITHING).

31-12-2005, Furio
- Fixed #324: TRYSRC is read as TRYSRV (only in message errors).
- Fixed #326: missing resource in sphere_item_provisions_weapons_ml.scp
- Fixed #315: wrong defnames in sphere_defs.scp
- Fixed #330: updated sphere_item_building_walls_se.scp and sphere_item_magic_necromancer_aos.scp

02-01-2006, Furio
- Fixed #332: support for guild chat speech mode.
- Fixed #336: PETRETRIEVE console error that shows when there's no stabled animals.
- Updated: sphere_defs.scp

03-01-2006, RanXerox (Script pack)
- Updated: sphere_types.scp

04-01-2006, Gygrazok (Script pack)
- Added: items/sphere_item_deco_evilitem.scp

08-01-2006, Shadow Dragon
- Fixed: Pets going logout.

10-01-2006, Furio
- Fixed #361: Creating characters with apostrophes ( ' ) in the name gives a random
  name in game.
- Fixed #348: Problems with FILE object.
- Fixed #356: Monsters not playing proper sounds (spherechar.scp and spherechar_evil.scp)
- Fixed #357: Some mappoints fixes (sphere_map_points0.scp and sphere_map_points1.scp)
- Updated: sphere_item_ml_misc.scp

11-11-2006, Radiant
- Ticks will no longer be given to webpages if USEHTTP is disabled in sphere.ini

12-01-2006, Vjaka
- Fixed #94: Stable master restock causing stabled pets to disappear.
- Fixed #212: Vendors do not restock money amount, unable to buy after a while.
- Fixed #343: Container functions like COUNT overrided user functions.
- Updated sphere_spells.scp fixing spell flags for polymorph (#335).

12-01-2006, K. Thorp (Script pack)
- Added: some multis to sphere_item_multis_houses_ships.scp
- Added: deeds to sphere_item_provisions_deed.scp

14-01-2006, Furio:
- Fixed #363: defining new region types. (See knowbugs.txt)
- Updated: sphere_defs.scp, sphere_types.scp, spheretables.scp

14-01-2006, Torfo:
- Fixed #371: Error on Bulletin Board (last letter missing)

15-01-2006, Radiant:
- Updated: You may now call functions on the SERV object. This affects several things,
  including the f_onserver functions, the console and packet filtering functions.

17-01-2006, RanXerox (Script pack)
- Updated: sphere_triggers.scp,sphere_item_eight_age.scp,sphere_item_ml_misc.scp
  sphere_item_provisions_weapons_ml.scp,sphere_minor_artifacts.scp
  sphere_map_points0.scp,sphere_map_points1.scp
  sphere_item_provisions_weapons_aos.scp,sphere_item_provisions_weapons_se.scp

20-01-2006, Blizzard (Script Pack)
- Updated: sphere_item_provisions_armor.scp, sphere_item_provisions_armor_se.scp,
  sphere_item_provisions_weapons_aos.scp, sphere_item_provisions_weapons_ml.scp,
  sphere_item_provisions_weapons_se.scp.

21-01-2006, Radiant
- Updated: 80 character console command limitation to SCRIPT_MAX_LINE_LEN

22-01-2006, Furio
- Fixed #380: IsNearType doesn't works whith custom typedef.
- Fixed #366: Effect of Hallucination.
- Fixed #378: Typo in sphere_admin.scp.
- Fixed: exceptions when using .charlist.
- Fixed: typo in console message.
- Sync (Vjaka): defmessage string allocation, thus binary EXE size reduced by ~200kb.
- Sync (Vjaka): SERV.console CMD to launch commands as you were in server console.
- Sync (ShadowDragon): Items in multis do not send to the client if he is not in
  the multi (OSI-compatible lag fight) as OF_OSIMultiSight.
- Updated: now ARGS in f_onchar_create contains account name.
- Updated: sphere_serv_triggers.scp.
- Added: f_onaccount_delete, ARGS contain account name, RETURN 1 block the delete.

23-01-2006, Torfo
- Fixed #264: Problem with 0xBF packet.

23-01-2006, Blizzard (Script Pack)
- Added: sphere_item_provisions_armor_ml.scp, sphere_item_provisions_clothing_ml.scp,
  sphere_item_provisions_clothing.scp.
- Updated: sphere_item_provisions_armor.scp, sphere_item_profession_tailor_tanner.scp,
  sphere_item_ml.scp.

27-01-2006, Torfo
- Fixed #411: sm_bolts in sphere_item_resources.scp and sphere_item_profession.scp
- Fixed #409: added missing ">" in sphere_item_aos_se.scp
- Fixed #405: added missing MT_FEMALE in def of succubus in spherechar_lbr.scp
- Fixed: seasons will be saved now.
- Fixed #408: <sector.season> doesn't work.

29-01-2006, Furio
- Fixed #410: Promptconsole removes all used ",".
- Fixed: strlen not working correctly with ",".

29-01-2006, RanXerox (Script pack)
- Updated: sphere_book.scp

31-01-2006, Furio
- Fixed #425: Unable to start sphere when editing sphere_msgs.scp.
- Removed: USEGODPORT in sphere.ini (and also the god port)
- Modified: USEHTTP usage. Look into sphere.ini for new options.

02-02-2006, Furio
- Fixed: players being able to track invisible (.invis) GMs.
- Sync (Vjaka): REGION.TYPE returning type from the itemdef of the multi.

10-02-2006, Furio
- Modified: replaced internal routines of TAG/CTAG/VAR/LOCALs, it improves
  speed, memory usage and decrease the occurence of leaks/exception.
- Fixed #440: Crash when selling too many items to vendors.

11-02-2006, Furio
- Fixed: new internal routines of TAG/CTAG/VAR/LOCALs in some special case.
- Added: support for OSI AuthID to avoid possible hijack to game server. By
  default is disabled, set UseAuthID = 1 in sphere.ini to use it.

15-02-2006, Furio
- Fixed: "Divide by Zero" in CChar::Tick() for "update stats" sections.

19-02-2006, Furio
- Fixed #456: NEWDUPE and DUPE doesn't copy events.
- Added: AOS properties for player characters: RES* (cold,energy,fire,poison) and
  LUCK with no built-in functionality.
- Sync (Vjaka): Added #214: ColorNoto* settings for characters color hue change.
- Sync (Vjaka): "NEWLOOT X" character function creating and equiping item X for NPCs
  if can give loot, useful to be used in @Death or @DeathCorpse triggers.
- Sync (Vjaka): "NEWGOLD N" function gives amount N of gold to the current char.
- Sync (Vjaka): character function TIMERF N,FuncName to cause a timed execution of a
  function FuncName in N secs. Specifying N as -1 will clear all TIMERF list.
  These functions are not saved, so do not store hours in the list, the purpose
  of this is to decrease overhead due to timered memory items opeations.
- Sync (Shadow Dragon): TAG.NoMoveTill for script purposes. This doesn't allow char
  to move if TAG.NoMoveTill > SERV.Time.

20-02-2006, Furio
- Fixed #462: TAG.NAME.HUE on chardef isn't working.
- Fixed: some possible overflow in some spots.
- Touchups for *NIX compilation.

20-02-2006, Cloud_Br (Script pack)
- Changed description of EVENTSPET on sphere.ini
- Add some new points to sphere_map_pointsX.scp
- Add some places with names like on OSI (places that didn't have a respective name
  before on default sphere) to sphere_mapX.scp files.

24-02-2006, Vjaka
- Fixed #158: NPC value spontaneously changing when NPC was under reactive armor.
- Fixed #314: Elf's Hair Color in creation is not correct.

25-02-2006, Torfo
- Fixed: possible PLEVEL-hack (thx to SL for reporting).

03-03-2006, Furio
- Fixed #401: Spells (incognito and mark) don't update the client tooltip.
- Fixed #478: Newgold does not update gold amount.

05-03-2006, Furio
- Fixed #483: Typo in sphere.ini.
- Fixed #484: LUCK and RES* properties throws errors when reading.

07-03-2006, Furio
- Added: Tithing points for player characters as TITHING with no built-in
  functionality.
- Fixed #492: Undefinied SCROLL_MOTD at player login.

08-03-2006, Furio
- Fixed #502: Divide by Zero Exceptions in CChar::Tick() stat section.
- Fixed #503: Tithing Points showed incorrectly in Paladin book.
- Updated: sphere_item_aos_se.scp, sphere_item_magic_necromancer_aos.scp

10-03-2006, Furio
- Fixed #501: Dropping a stackable item on another one with
  special attr (Newbie, Static, Move Never).
- Fixed #509: Cheater message with disconnect.
- Fixed #511: Tooltip Problem with Spawns.
- Fixed #517: Deleting Accounts not loging properly.

15-03-2006, Radiant
- Fixed: WHILE loops ending with weird undefined symbol error.

18-03-2006, Furio
- Fixed #526: "Resync [...]" working incorrectly.
- Fixed #520: Magic Flag IgnoreAr doesn't work.
- Updated: no 0-100 limitations to RES*.
- Updated: sphere_defs.scp

21-03-2006, Furio
- Fixed #292: Textentrylimited crashing clients (thx to Admin Ben)
- Fixed #528: Invis items in pack and/or corpse we see it, but when
  we click it, it dissappears.
- Fixed #506: ghost of the npc appears after dying when mounted.
- Updated: sphere_dialog.scp

22-03-2006, MrSugarCube (Script pack)
- Updated: sphere_menu.scp, sphere_item_misc.scp, townmagincia.scp (incorrect
  spelling of 'jewelry').
- Updated: sphere_item_provisions_armor_ml.scp (Duplicate DEFNAMEs for 02b74
  and 02b79).

23-03-2006, Furio
- Added: <FILE.FILEEXIST arg> returning 1 if arg exist.
- Added: Support for Bushido/Ninjitsu/SpellWeaving spellbooks.
- Updated: sphere_defs.scp (new typedefs), sphere_item_aos_se.scp (spellbooks).

23-03-2006, MrSugarCube
- Fixed: Incorrect spellbook packet being sent to newer clients with certain AOS
  features disabled.
- Fixed #181: Woolly sheep having wool resource on corpse after being shorn.
- Fixed: Player adding non-vendable item to vendor stock is deleted - Vendor now
  returns the item.
- Fixed #475: Taking item from hidden state does not update other clients.
- Modified: Warning message for non-vendable items will show the UID of the item
  and vendor.

23-03-2006, Handred
- Updated: sphere_spawns.scp. Changed all RESOURCES= to ID=, modified also the
  WEIGHT= for a better and easier looking to, ie: ID=c_zombie 5.

24-03-2006, MrSugarCube
- Fixed #519: Poison spell and field spell damage reveals caster after every
  damage effect.
- Fixed: Setting TARGP only working with invalid locations.
- Modified: @DropOn_Ground and @itemDropon_Ground triggers now have ARGS set
  to the location the item will be dropped to, specific points accessible
  using ARGV[x]. (readonly)
- Fixed: ARGS not being parsed correctly into ARGV when empty parameters are
  given (for example <myfunc 1,,,4,5> was treated as "1",",","4","5" and not
  "1","","","4","5").
- Modified: Attacker will not be revealed when a character is hit by a spell
  with SPELLFLAG_FIELD set.
- Added: Damage Flag DAM_NOREVEAL (04000). If this flag is applied the attacker
  will not be revealed. This is applied by default to poison damage and spell
  damage. (Note that for spells the attacker will be revealed regardless if
  SPELLFLAG_HARM is set, unless SPELLFLAG_FIELD is also set, so only affects
  field spell damage).
- Updated: sphere_defs.scp (Updated DAM_FLAGS section)

26-03-2006, MrSugarCube
- Modified: Vendor boxes will now only accept a maximum of 115 items dropped
  inside (as opposed to the 256 item limit of a normal container). A warning
  message will be displayed when the buy menu is shown if this limit has been
  exceeded.
- Fixed #540: Logged out characters can be targeted with spells (Actually
  CANSEE was returning 1 without GM/ALLSHOW priv).

27-03-2006, MrSugarCube
- Fixed #429: Unable to walk on blocking terrain with platform properties
  (eg: Palace of Paroxysmus acid).
- Fixed: Walking on stairs in certain areas (such as the ones at 925,641,-80,2
  or 7060,376)
- Updated: sphere_map0.scp, sphere_map_points0.scp, sphere_map0_ml.scp,
  sphere_map_points0_ml.scp (Moved ML locations to seperate script which can be
  uncommented to enabled ML areas).
- Updated: spheretables.scp (Added ML map files to RESOURCES block, to be
  uncommented if you wish to use).
- Updated: sphere.ini (Updated MAP0 description to remind users to uncomment ML
  map scripts).

28-03-2006, Ellessar (Script Pack)
- Updated: sphere_item_provisions_weapons_se.scp (incorrect spelling for
  i_tetsubo SKILLMAKE).

29-03-2006, MrSugarCube
- Fixed: NPCs unable to walk on the same tile as a dead/disconnected/insubstantial
  character.

30-03-2006, MrSugarCube
- Fixed #545: TARGET function with no message specified sent a blank sysmessage
  to the client. (also affected PROMPTCONSOLE).
- Updated: sphere_msgs.scp - Added missing message definitions to the list
  (27 were missing).

30-03-2006, Ellessar (Script Pack)
- Updated: sphere_item_provisions_weapons.scp (SKILL properties corrected for
  MaceFighting weapons).

31-03-2006, MrSugarCube (Script Pack)
- Updated: sphere_item_building_floors_se.scp (incorrect axis categories)
- Updated: sphere_item_provisons_deed.scp (incorrect spelling of "Provisions"
  for some axis categories)

01-04-2006, MrSugarCube
- Fixed #552: Removing items in SECTOR.ALLITEMS causes infinite loop
  (also ALLCHARS/ALLCHARSIDLE/ALLCLIENTS).

03-04-2006, Furio
- Fixed #553: Errors during SERV.MAP parsing.
- Fixed #407: Account creation with bad words.
- Removed: OF_Advanced_Los.
- Added: AdvancedLos in sphere.ini to control Los behaviour of player and npc.

04-04-2006, RanXerox (Script pack)
- Updated: sphere_item_magic_wands.scp (eliminates old ITEMDEF numbers).

04-04-2006, MrSugarCube
- Fixed #556: Exception occuring when failing to bandage another character.
- Fixed #558: DB reference still accessible with MySQL support disabled.

04-04-2006, Ellessar (Script pack)
- Updated: spherechar_lbr.scp (Changed "ICON=i_pet_orc_brute" to "ICON=i_pet_orc"
  for character c_orc_brute)

07-04-2006, MrSugarCube
- Fixed #565: Account name "account" not loaded correctly from accounts file.

08-04-2006, Ellessar (Script pack)
- Updated: sphere_item_icons_new.scp (Added missing icons: i_pet_terathanavenger,
  i_pet_meereternal, i_pet_meercaptain, i_pet_meermage)
- Updated: spherechar_lbr.scp (Added NPCs: c_mummy, c_terathan_avenger,
  c_meer_eternal, c_meer_captain, c_meer_mage)
- Updated: spherechar_se.scp (Fixed incorrect weapon for c_yomotsu_warrior)

09-04-2006, Vjaka
- Fixed #284: Character DISPID limitation changed to 2048 basing on bodyconv.def.
- Fixed #372: Weighted random templates had limitation for 64 members inside.
- Fixed #479: Off-duty vendor going off-duty with active client around.
- Fixed #497: Duplicated resources on inherited NPC.
- Fixed #541: Picking item that is too heavy is causing item to drop.
- Fixed #561: Players are unable to walk through any npc regardless of the stamina.

10-04-2006, Furio
- Added: TERRAIN.Z in SERV.MAP to know at which z is located the map tile.
- Fixed #577: SERV.ITEMDEF not behaving correctly.

10-04-2006, MrSugarCube (Script pack)
- Updated: sphere_map0.scp (Removed REGION_FLAG_UNDERGROUND from
  a_lord_britishs_castle_1, fixing lighting around west britain).

10-04-2006, Vjaka
- Fixed #575: Multiple resource lines in a REGIONTYPE not loading correctly.

11-04-2006, Ellessar (Script pack)
- Updated: sphere_backward_compatibility.scp (tweak for addnpc).

13-04-2006, MrSugarCube
- Fixed #576: Added World Statics Save to DEFMESSAGE table.
- Updated: sphere_msgs.scp (Added 'server_worldstaticsave' message)

15-04-2006, MrSugarCube
- Fixed: Players unable to dismount from their rides after attacking
  another character unless they retreated or killed the enemy.

16-04-2006, Handred (Script pack)
- Updated: sphere_menu.scp (Added Guild Transfer menu option using
  softcoded TRANSFERGUILD function. )
- Updated: sphere_triggers.scp (Added TRANSFERGUILD function. Feel
  free to fit it to your needs. )

17-04-2006, MrSugarCube (Script pack)
- Updated: sphere_spells.scp (Added SPELLFLAG_PLAYERONLY to spells
  71 and above (potion effects))
- Updated: jobbeggar.scp, jobblacksmith.scp, jobhealer.scp,
  jobtavernkeeper.scp, jobvet.scp, jobweaponsmith.scp,
  townbritain.scp (Fixed syntax errors where SRC.SEX was being used
  incorrectly)

18-04-2006, MrSugarCube
- Fixed: Adding a stack of scrolls to a spellbook consumed the whole
  pile instead of just one.

19-04-2006, coruja747 (Script pack)
- Updated: sphere_item_magic_wands (Fixed incorrect spelling of 'daemon'
  for i_wand_summon_daemon)

19-04-2006, MrSugarCube
- Fixed: Turning ships to force ship into invalid sailing location.

20-04-2006, Furio
- Fixed #600: Forcont* loops block script execution if no items found.

22-04-2006, MrSugarCube
- Fixed #622: Unable to access specific resources for spells using
  RESOURCES.n[.KEY|.VAL]
- Fixed #141: Curse spell having no effect on target.
- Fixed #476: UID.x.KEY not working correctly on region reference (under
  @Enter trigger for example).

24-04-2006, MrSugarCube
- Fixed #201: Walking off ship planks moves player to incorrect
  height (this is normal for characters with GM mode enabled).

26-04-2006, Ellessar
- Updated: sphere_item_profession_tailor_tanner.scp (Removed custom
  @TargOn_Item trigger for i_sewing_kit)

02-05-2006, Gygrazok
- Updated: sphereCrypt.ini (Added encryption keys for 5.0.2 client)

02-05-2006, Furio
- Fixed #643: Functions with similar names sometimes get miscalled (thx to SL Patch).
- Fixed #641: Deleting account when the player is online.
- Fixed #625: Cloth bolts give always 25 i_cloth, while it should give the amount of
  i_cloth specified in RESOURCES.
- Updated: sphere_item_profession_tanner.scp (Cloth bolt value).

03-05-2006, MrSugarCube
- Fixed #642: Intrinsic functions not working correctly from SERV
  object.
- Fixed #645: Possible to place invalid items on a gameboard, which
  in turn crashes clients.
- Fixed: Game board was setup incorrectly for games of Checkers.
- Modified: Game board setup for backgammon game added. (Note: Requires
  that backgammon board has MORE1 value of 2)
- Updated: sphere_item_profession_cook_barkeep_baker.scp (i_backgammon_game
  MORE1 changed to correct value)

09-05-2006, Torfo
- Fix (temp): TX-Errors are disconnecting player now (just on linux).

15-05-2006, Furio
- Modified: If VENDORMARKUP is not present on the npc or in the region the one from
  the chardef will be readed.
- Modified: Changing CLIENT properties will not show anymore annoying sysmessages.

19-05-2006, Shadow Dragon
- Fixed #638 & #639: Items outside of multi not sending when in multi.
- Fixed #655: House building on each other.

21-05-2006, V
- Fixed #611: Vendors buying without buy= assigned to them

23-05-2006, MrSugarCube
- Fixed #675: Stone wall revealing location of higher privileged characters.

28-05-2006, Furio
- Fixed #662: Skill lock tick.
- Fixed #691: serv.REGIONRESOURCE.x.REAP not working
- Modified: FeatureAOS to permit using of basic Aos feature without having tooltips.
  Look into sphere.ini for more info.

31-05-2006, MrSugarCube
- Modified: <CANCAST (spell)> now accepts an extra parameter to check the region
  flags. If the second parameter is not supplied then this check is enabled by
  default, the advantage is that you can now disable the region check when checking
  if a character can cast a spell. New usage is: <CANCAST (spell) [checkantimagic]>
- Fixed #702: Items with value=0 can not be crafted (note that without a value set the
  QUALITY property will be unavailable, and also no experience will be gained from such
  items).

31-05-2006, MrSugarCube (Script pack)
- Fixed #679: sphere_skillmenu.scp (Inscription SKILLMENU now makes use of new
  CANCAST syntax, resolving the issue of region flags preventing the crafting of
  certain scrolls)

01-06-2006, MrSugarCube
- Fixed #671: CriminalTimer=0 causes errors when setting criminal status.
- Fixed #703: Verbs not executing correctly on the default object in dialogs.

04-06-2006, MrSugarCube
- Fixed #681: Unable to execute and read the return value of scripted functions
  on the SERV object.
- Fixed: Server stats not being given when requested by UOGateway.
- Modified: The following multi properties can now be read from their ITEMDEFs:
  MULTIREGION, REGIONFLAGS and COMPONENT (COMPONENT usage is same as COMP).

05-06-2006, MrSugarCube
- Fixed: Attempts to use house keys to lock items down in containers.

06-06-2006, Furio
- Added: NAPIERPOW(arg), LOGARITHM(arg[,base]), TAN(arg).

06-06-2006, MrSugarCube
- Fixed: MULTIREGION property didn't show the value exactly as it appears in
  scripts (x1,y1,x2+1,y2+1,0 instead of x1,y1,x2,y2)

08-06-2006, MrSugarCube
- Fixed #711: EFFECT_ID property returning the EFFECT value on SPELL block.
- Fixed #413: Spell icons are bounced into backpack with MAGICF_STACKSTATS
  enabled.
- Modified: MAGICF_STACKSTATS now allows a character to be affected by
  each of the stat spells at the same time (eg. strength+bless+feeblemind).
  Note that it does not allow multiple effects from the same spell (so
  casting bless several times does not work).
- Updated: Sphere.ini with MAGICF_STACKSTATS description

08-06-2006, Furio
- Fixed #699: Removing an account on Linux cause an exception.

08-06-2006, Ellessar (Script pack)
- Updated: sphere_triggers.scp (Updated SRC.NEWITEM with SERV.NEWITEM and
  removed unnecessary SRC references)

08-06-2006, Beyonder (Script pack)
- Updated: sphere_item_building_fence.scp (Changed incorrect item defname
  i_gate_wood_2 to i_fence_wood_3 (ITEMDEF 085c))
- Updated: sphere_backward_compatibility.scp (Added i_gate_wood_2 as a
  DUPEITEM of i_fence_wood_3 for saves using incorrect defname)

11-06-2006, V
- Fixed: alligator not responding to commands
- Added: Broadcast warning 10 seconds before world save is performed to alert players

12-06-2006, MrSugarCube
- Fixed: ISNUM not working correctly with numbers in hex format.

13-06-2006, MrSugarCube
- Added #722: Support for dialog component 'buttontileart' in newer clients. Syntax
  is the same as 'button', but with 4 additional parameters for placing a tilepic
  over the gump image with a specified hue (0=normal) and offset (0,0=top left):
  "buttontileart x y up down active page id tileid tilehue offsetx offsety"
- Fixed: Remove Trap skill not starting after targeting an object.
- Fixed: Scripted & Targeted skills not starting after targeting an object.
- Fixed: Possible exceptions occuring when a reference does not exist (such as ACCOUNT
  .CHAR.x where x was an invalid index)
- Modified: Stat regeneration will now take twice as long instead of halting
  completely when a character is hungry.

13-06-2006, MrSugarCube (Script pack)
- Updated: sphere_dialog.scp (Fixed d_hair_dye dialog not dying player's hair and
  added buttontileart description to the help section)

14-06-2006, MrSugarCube
- Fixed: Exception when adding a guild member and not provided sufficient arguments.
- Fixed: Inviting someone into a party tells the wrong character they've been added.

15-06-2006, Furio
- Added: Added TAG.OVERRIDE.STATSUM/SKILLSUM/STATCAP[$statid]/SKILLCAP[$skillid] for
  players and npc to override SKILLCLASS values.
- Sync (ShadowDragon): TAG.OVERRIDE.REGEN[$statid]/REGENVAL[$statid] to modify regen
  rate and regen amount.
- Sync (Vjaka): Added <EXPLODE sep,string> operator which converts string with separators
  other than ',' to commas making possible to operate with such string using strarg/streat.
  Sample: LOCAL.S=<explode :/- ,my:test/string:2-3> should give result of "my,test,string,2,3".

17-06-2006, MrSugarCube
- Fixed #729: AntiMagic flags blocking spell effects on items even with GM mode enabled.
- Fixed #730: Immunity to spider web traps after taking damage.

17-06-2006, coruja747 (Script pack)
- Updated: sphere_item_provisions_armor_se.scp (Fixed error in t_ninja_belt)

18-06-2006, V (TYVM SL)
- Modified: TimerF is now global and works on any object. It will take optional
  arguments to the function call. Entire list is now saved and loaded upon startup.
  It no longer uses -1 to erase the TimerF list. Takes a maximum of 1024 characters.
  syntax: timerf n, function args

19-06-2006, MrSugarCube
- Fixed #653: TRAIN function causing exception when not all default skills
  are defined.
- Fixed #732: Items on buy/sell menus displaying names from muls with
  FEATURE_AOS_UPDATE_B disabled on AOS+ clients. Instead a basic tooltip packet
  containing only the name of the item will be sent to the client in this case.

19-06-2006, MrSugarCube (Script pack)
- Updated: sphere_item_provisions_weapons_se.scp (Corrected incorrect DUPEITEM
  and TDATA properties for i_fukiya)
- Updated: sphere_msgs.scp (Moved 32 hardcoded messages to defmessages and added
  1 missing defmessage)

01-07-2006, Furio
- Fixed #740: Strange price on vendors.
- Fixed #752: Resizepic not showing with dorigin.
- Fixed #757: Error on ".serv.account add".

02-07-2006, Nazghul (with thx to Ellessar)
- Fixed #639: OSI Multi Sight removes items already in sight.
- Added: TAG.ALWAYSSEND for items. An item with this TAG will always be send,
  no matter whether it is in a multi or not. The TAG works only with
  OF_OSIMultiSight on.
- Redone new items sending (should save some unneeded packets)

04-07-2006, MrSugarCube
- Modified: SERV.CLIENT.x reference no longer accepts x if it is out of range
  (use SERV.CLIENTS property to check range).
- Modified: SERV.CLIENT.x reference no longer skips clients without characters
  (such as HTTP, or telnet connections), which caused strange behaviour.
  <SERV.CLIENT.x> will return 0 if the client has no attached character, 1 if
  the client has a character attached.

05-07-2006, Nazghul
- Added: A skill trigger ON=@PreStart and a character trigger ON=@SkillPreStart
  are now called before ANY hardcoded stuff related to the skill which will start.
- Added: A skill flag SFK_NOMINDIST. With this flag on, you can mine, chop
  (distance doesn't have to be >= 1) or fish (distance doesn't have to be >= 2)
  right under yourself.
- Modified: Now an axe can be damaged during lumberjacking.
- Fixed: Fishing bug, which allowed fishing through ship floor.
- Fixed: Chopping with t_weapon_fence does not start skill Lumberjacking.

05-07-2006, Nazghul (Script Pack)
- Updated: sphere_defs.scp (added section skill_flags)
- Updated: sphere_msgs.scp (messages fishing_close, lumberjacking_close,
  lumberjacking_tool, mining_close, fishing_4)

09-07-2006, MrSugarCube
- Fixed: dtext, dcroppedtext, dhtmlgump, dtextentry and dtextentrylimited in gumps
  using a space for the text if no string was provided.
- Fixed #754: GMs losing non-vendable items when dropping them into a vendor box.
- Fixed #720: <dSOMEVAL> returning 0 for values starting with "0.".

10-07-2006, MrSugarCube
- Fixed #760: Exception caused by opening paperdoll when not all default skills
  are defined.

11-07-2006 Nazghul
- Fixed #594: Players (only if their client allows) and NPCs were able to go through
  non-static walls.
- Added: CAN-Flag mt_passwalls (08); NPC with this flag CAN pass through static
  and dynamic walls.

12-07-2006, Furio
- Fixed #690: serv.REGIONTYPE.*.resources is not working.
- Added: <serv.regiontype.*.calcmemberindex [uid]> returning the index of the
  resource selected randomly or basing on the skill of the uid passed as argument.

12-07-2006 Nazghul
- Fixed: When logging in with an unencrypted client, you were not able to see
  tooltips for objects in line of sight (0 to 18 tiles away from you),
  including yourself.

12-07-2006, Nazghul (Script Pack)
- Updated: sphere_defs.scp (updated section can_flags)
- Fixed #761: missing positioning of newly created vendor in i_deed_vendor
  (sphere_item_provisions_deed.scp)

13-07-2006, Nazghul
- Added: CURFOLLOWER, MAXFOLLOWER with no built-in functionality. These variables
  change values on a status gump.
- Fixed #764: Cannot see items in large multis (OF_OsiMultiSight).
- Sync (Vjaka): ISWEAPON and ISARMOR read-only properties for items.

14-07-2006, Nazghul
- Added: ISWEAPON and ISARMOR are now avaliable through serv.itemdef.x.* too.

16-07-2006, Nazghul
- Added: OF_Command_Sysmsgs into sphere.ini. With this flag on, you will see
  sysmessages with current status after typing .allmove, .allshow, .debug,
  .detail, .gm, .hearall, .privshow, .invis, .invul

20-07-2006, Nazghul (Script Pack)
- Fixed #776: sphere_map2.scp (Wrong Ilshenar Region description (Wisp Dungeon),
  thx Coruja747.

21-07-2006, Furio
- Fixed #780: Unable to read REPLICATE property.
- Changed: TAG.OVERRIDE.STATCAP[$statid]/SKILLCAP[$skillid]/REGEN[$statid]/REGENVAL[$statid]
  to TAG.OVERRIDE.STATCAP_$statid/SKILLCAP_$skillid/REGEN_$statid/REGENVAL_$statid.
- Added: -E to command line. Starting Sphere with it will enable the ExceptionDumper
  that will generate a .map file on unexpected exceptions. Sending that file through
  the bugtracker will help us in the debug process. (thx to Z.)
- Fixed #774: Ghost's speech when in peace mode.

21-07-2006, MrSugarCube
- Fixed: Incorrect name shown when a player declines a party invite.
- Modified: Placing a house over a staff member (Counselor+) no longer blocks
  the placement if the character cannot see them.

22-07-2006, MrSugarCube
- Added: SPEEDMODE property for players. Allows setting the speed mode that a
  client can use (and affects the movement throttle accordingly). There are
  4 different speed modes that affect the client:
    0  - Normal speed.
    1  - Double speed on foot, normal speed when mounted.
    2  - Always walk on foot and when mounted.
    3+ - Always run on foot, always walk when mounted.

22-07-2006, coruja747 (Script pack)
- Updated: sphere_map2.scp (Sorcerer Dungeon region definitions incorrect).

23-07-2006, Shadow Dragon
- Added: LOCAL.Arrow storing an UID of used arrow while archery in @Hit.
- Added: Extra combat flag COMBAT_PREHIT to allow pre hit combat style
  (first hit is instant)

26-07-2006, coruja747 (Script Pack)
- Updated: sphere_map2.scp (#793, Lake Shire region has not to be guarded)
- Added: GAINRADIUS keyword for skill definitions. Skillgain will only be calculated if
  the current skill is less than the actual difficulty + GAINRADIUS to prohibit skillgain
  by performing way too easy tasks. If not set it defaults to 100.0 (so pertaining the
  old behaviour)

27-07-2006, coruja747 (Script Pack)
- Fixed: #796, sphere_map_points2.scp (Wisp Dungeon, Kirin Passage, Cyclops Dungeon)

28-07-2006, coruja747 (Script Pack)
- Fixed: #800, missing teleports in sphere_map_points0.scp and sphere_map_points1.scp

29-07-2006, Nazghul
- Modified: @Dclick is now called for items which were dclicked by an NPC.
  (e.g. when an NPC is going to open a door, @DClick is called for this door)
- Fixed #798: If a wall was built on a spot where a paralyzed player stays,
  he was not unparalyzed.

29-07-2006, MrSugarCube
- Fixed: Vendors speak two messages when a player does not have any items to sell to them.

30-07-2006, Shadow Dragon
- Added: New trigger @Criminal called after someone becomes criminal for someone.
  [] - criminal, SRC - someone. RETURN 1 - stops hardcoded effect (memory_harmedby and so),
  so you can make your own criminal system.

31-07-2006, Kirofus (Script pack)
- Updated: sphere_types.scp (Fixed incorrect terrain definition for t_water)

31-07-2006, MrSugarCube
- Modified: MaxWeight is now sent to the client for display on the status window in
  newer clients.

31-07-2006, Nazghul
- Added: CONTP function, which allows you to change the position of an item,
  which is inside a container.

01-08-2007, Nazghul
- Added: INI flag EF_New_Walkcheck = 04000 to switch on and off new walkcheck routines
  what should prohibit NPC from passing thru walls if not explicitely stated
  (CAN-Flag mt_passwalls (08))

02-08-2006, Furio
- Added: STRREGEX(pattern,string) that execute a pattern matching supporting the
  known standard. Return: 1 match found, 0 match not found, -1 illegal pattern syntax.

04-08-2006, Nazghul
(most code revised, debugged and (re)designed by Ellessar when I was up to drop
this all in desperation)
- Added: Function AddContextEntry. what takes 2 to 4 arguments separated by a comma.
   SRC.AddContextEntry EntryTag,TextID,Flags,Color
   EntryTag - the number to return as ARGN by @(item)ContextMenuSelect. Make it unique.
            - EntryTags from 0 to 100 are reserved by Sphere for internal use, so do not
              use it.
   TextID - CLILOCed name of the button. The number from cliloc.[your_localization]
            WITHOUT the leading "300" or such! Just type "5194" or "11010"
   Flags - 01 - locked (will be grayed out)
         - 02 - consecutive entries with this flag set will be summarized under
                a golden arrow
         - 020 - can be colored
   Color (applied only if Flags & 020) - hue

- Added: Trigger @ContextMenuRequest/@itemContextMenuRequest which is fired after
  receiving a display Popup-menu client request (single click on an object).

  It can be fired two times, each call has a different ARGN.

  The first time it is fired before any hardcoded stuff is added to the Popup-menu.
  Here, Return 1 denies displaying any hardcoded entries, but if you make a softcoded
  entry, it WILL be displayed. It also will prohibit the second call of the trigger.
  Both, Return 0 and Return 2 allows hardcoded stuff to be added. If you change ARGN,
  the trigger will be called once more (but ARGN != 1).

  The second time it is fired after all hardcoded stuff was added (so you can add
  your stuff to the bottom of the Popup-menu). Return value has no effect at all.

  The first call:
   In:  ARGN = 1
   Out: Return 1 - only your stuff will be added (IF ANY), prohibits the second call
        Return 0/2 - your and hardcoded stuff will be added
        ARGN (ARGN != 1) - allows the second call

  The second call:
   In:  ARGN = 2
   Out: Return 0/1/2 - does nothing
        ARGN - does nothing

- Added: Trigger @ContextMenuSelect/@itemContextMenuSelect which is fired after
  a client selects something from a Popup-menu. ARGN is a value, which was sent
  by the server to the client as the first argument with the AddContextEntry function.

06-08-2006, MrSugarCube
- Modified: SERV.ACCOUNT.x now returns 1 if the account name or index exists, or 0 if not.
- Added: P.STATICS.x.COLOR and P.STATICS.x.Z can be used to find the colour and height
  of static items.
- Modified: Setting BONUS_STATS to 0 in SKILL definitions disables using BONUS_x properties
  when calculating stat gains for that skill instead of blocking all stat gains for it. If
  you want to prevent stat gains, you should either set STAT_x to 0, or set BONUS_x to 0
  with BONUS_STATS greater than 0.

07-08-2006, MrSugarCube (Script pack)
- Updated: sphere_msgs.scp (Fixed some 'broken' defmessages with tabs in)

10-08-2006, ShiryuX (Script Pack)
- Fixed: #827 Kirin entered twice in sphere_defs.scp

14-08-2006, Nazghul
- Added: dmgcold, dmgenergy, dmgfire, dmgpoison properties for weapons with no built-in
  functionality (yet).
- Fixed: Returned maxweight property different from maxweight property displayed
  in status gump.
- Fixed #592: Wrong spellbook packets send by Linux versions
- Updated: sphere.ini - added new experimental flag EF_NewPositionChecks.

16-08-2006, Nazghul
- Added: Experimental flag EF_NewPositionChecks, with this flag on,
  the new position-related checks behavior will be used. So far it does something only
  with resource gathering related skills (lumberjacking, mining, fishing, eating grass etc.)
  and Advanced LOS.
  The flag is HIGHLY EXPERIMENTAL!
- Modified: FORPLAYERS now loops through logouted players. If you want to loop only through
  online players, use FORCLIENTS.

17-08-2006, MrSugarCube
- Fixed: Retrieving StatLock properties with STATLOCK[statname] and SKILLLOCK[skillname]
- Fixed #835: Setting StatLocks on the status window sets the incorrect StatLock[x] property.
- Modified: Undefined region warnings are no longer reported for locations outside of the
  map boundaries.

20-08-2006, Nazghul (Changes only for servers with EF_NewPositionCheck on)
- Fixed #304: NPCs are dumber in pathfinding with EF_DiagonalWalkCheck on
  (fixed only with EF_NewPositionCheck and EF_WalkCheck on).
- Fixed #747, #767: Z not updated when you enter a multi, .fix not working inside a multi.
- Fixed #837, #829: NPCs not spawning (or on the wrong place) inside a building.
- Fixed #598: Ladders not updating Z and a player cannot step on some of them.
- Modified GOTO function: NPC will now not stop moving after the first step.

26-08-2006, Nazghul (Changes only for servers with EF_NewPositionCheck on)
- Fixed #744: Line Of Sight check going from out of a house into the house was successful,
  but not vice versa.
- Fixed: Item flags and height was always inherited from the parent item
  (the item with DUPELIST=), what damaged almost all Line Of Sight checks.

28-08-2006, Nazghul (Changes only for servers with EF_NewPositionCheck on)
- Modified: Now, archery, potion throwing, dragon breathing, stone throwing, magery can be
  used through a window.
- Modified: Now, fishing use LOS and prohibits casting through blocking objects.

28-08-2006, Nazghul
- Updated sphere_defs.scp: Added DEFNAME los_flags.
- Updated sphere_msgs.scp: Added message fishing_los.
- Removed: Multithreading support for Linux version due to its unusability on this OS.

30-08-2006, Nazghul
- MODIFIED: RESCOLD, RESENERGY, RESFIRE, RESPOISON now can also be set on NPC
  Remember that RES*=100 will give you a 100 percent immunity against the damage inflicted
  by TAG.*DAMAGE.
- Added: COMBAT_SPECIALDAMAGE to INI CombatFlags (08). If set, TAG.*DAMAGE (below) will be
  used.
- Added: COMBAT_USE_RESISTANCE to INI CombatFlags (010). If set, RES* on characters will
  also be weighted against normal damage if the old fashioned damage flags are set.
- Added: TAG.COLDDAMAGE, TAG.ENERGYDAMAGE, TAG.FIREDAMAGE, TAG.POISONDAMAGE for characters
  and items. The server will only evaluate the tags on characters, and if ComBatFlag
  COMBAT_SPECIALDAMAGE is set. Then any damage done to others (if it's damage type contains
  at least one of the physical types OR magic) will be increased by the value of the
  appropriate tag, lowered by the RES* percentage of the victim.
  Tags on items will not be evaluated by the server - their values can be used to for
  example increase the TAGs or the RES* properties on characters on equip of the item.
  This way you can use TAG.*DAMAGE on a weapon to increase the wearer's appropriate
  damage tag, or on a piece of armor to increase his RES*, or to whatever you want.

31-08-2006, Nazghul
- Added: NPC trigger @PetDesert. Fires when a pet decides to go wild.
  Default object is the pet, SRC the master. RETURN 1 changes the pet's mind.

31-08-2006, MrSugarCube
- Fixed: P.REGION reference not working correctly in areas defined via ROOMDEFs.
- Added: P.ROOM can be used to access the ROOM properties of a point, just like
  you can with P.REGION.
- Modified: P.REGION and P.ROOM now return 0 if a region or room doesn't exist at
  the point, and 1 if one does.
- Added: Support for the new BandageSelf and BandageTarget macros found in the
  latest clients (5.0.4). Using the macro will act as if the client has just
  targeted something with the bandage (and so @[item]TargOn_Item will be called).

01-09-2006, MrSugarCube
- Fixed #849: Enabling precasting does not freeze characters when casting.
- Fixed #849: With precasting enabled, skill is gained before the spell is
  completely cast at a target.
- Fixed #849: Harmful area effect spells don't affect the caster when
  MAGICF_CANHARMSELF is enabled.
- Fixed #849: TELE and POLY functions not working correctly with precasting
  enabled.
- Fixed #849: Casting from spellbook not working correctly with both
  FEATURE_AOS_UPDATE_B and MAGICF_PRECAST settings enabled.
- Fixed: Exception caused by spell effects on items with no SRC present.

02-09-2006, Nazghul
- Added: TAG.OVERRIDE.MOVERATE for NPC to speed up or slow down single NPC

05-09-2006, Nazghul
- Added: Option flag OF_Buffs. When on, Sphere will automatically add and remove buff and
  debuff icons to the affected players.
- Updated: sphere.ini - added new optional flag OF_Buffs
- Added: Functions ADDBUFF, REMOVEBUFF for adding and removing buff/debuff icons.
  syntax: ADDBUFF IconId ClilocOne ClilocTwo Seconds Text1 Text2(optional) Text3(optional)
          The text fields are supposed to hold max. 3 characters each (numbers) and will
          be cut off if larger.
  	  REMOVEBUFF IconId
  These functions only work with client 5.0.3 or above.

06-09-2006, Nazghul (script pack)
- Updated: sphere_defs.scp (added defnames for buff icons and clilocs)
- Fixed: bug with i_multi_tower_wizard - the door was placed BELOW the floor,
  so unuseable with new LOS checks

07-09-2006, Nazghul
- Updated: sphere.ini - added new debug flags DEBUGF_SCRIPTS, DEBUGF_LOS.

10-09-2006, ShiryuX (Script Pack)
- Updated: sphere_defs.scp - added a defname for rideable Polar Bear

11-09-2006, Nazghul
- Fixed #852: Trigger @SKILLSUCCESS did not fire with fighting skills

12-09-2006, MrSugarCube
- Added: FORINSTANCES to loop through all instances of a given BaseID. Usage
  is "FORINSTANCES id". If an ID is not supplied then the BaseID of the default
  object will be used. Works for both items and characters.

12-09-2006, Nazghul
- Added: A new item property IsCont, which returns 1 if an item is a container and 0 if
  it is not.
- Updated: sphere.ini - added a new debug flag DEBUGF_WALK.

15-09-2006, Nazghul
- Added: INI Flag OF_NoPrefix (0x4000) to get rid of the "A" and "An" prefixes what ere
  only an annoyance for not english language shards
- Changed: Key links will only be blanked if they are pointing to an invalid item UID now.
  Before everything what was neither container nor multi was considered "invalid", so keys
  with the UID of a door, or themselves could turn blank.
- Added #848: Character trigger @SpellSelect. Doing pretty much the same as the spell trigger
  @select and has the same arguments/parameters
- Fixed #778: Wrong spellbook recognition with more than one spellbook std., necro, ...)
  in pack.
- Updated: sphere.ini - Removed experimental flag EF_New_Walkcheck.

16-09-2006, Nazghul
- Added: OF_DyeType flag to sphere.ini. If set players are allowed to use i_dye on every
  t_dye_vat instead of only i_dye_tub. Making it switcheable for all those who have concerns
  about exploitability (even as I do not see any risk) - we all remember the times when
  injection users colored whole shards pink.

17-09-2006, MrSugarCube
- Fixed: Using Bandage macro with a target prompt already present calling @TargOn_Cancel
  on the bandages.
- Fixed #863: Changing RESFIRE/RESENERGY/RESPOISON/RESCOLD properties does not update the
  client.
- Fixed: Unable to gain magery skill with precasting enabled.
- Fixed: Various object references not accessible from the guildstone object.
- Fixed #865: GUILD.MEMBER.x.ISMEMBER property not working correctly.

20-09-2006, Nazghul
- Fixed #853: Update & DClick stopped display of weather effects

21-09-2006, Nazghul
- added TAG.OVERRIDE.AMMOTYPE and TAG.OVERRIDE.AMMOANIM for bows and xbows to - yes, OVERRIDE the
  TDATA3 and TDATA4 values on a per-item-base

21-09-2006, MrSugarCube
- Fixed #875: Exception caused by setting MASTERUID when no current guild/town master
  exists.
- Modified: Setting MASTERUID to the same uid as the current guild/town master no longer
  causes an error.
- Fixed: Calling the TRAIN function on an NPC in combat would cause an error.
- Modified #869: The TRAIN function now works on all NPC brains between 2 and 9.

21-09-2006, Nazghul
- changed GAINRADIUS so that it no longer defaults to anything - if not set on a skill
  it's just transparent (as if never invented)

22-09-2006, Nazghul
- Fixed #846: Bad character DispID displayed if there was serv.chardef called no NPC
  in the world with this ID.

24-09-2006, Nazghul
- Added: Function CONTCONSUME <arg1> <arg2>, which consumes <arg2> amount of an item with id <arg1>
  from a referenced container and its subcontainers. Function does nothing on chars (use consume)
  and on non-container items.
  Example: findlayer.29.contconsume i_gold 100000
- Added: Item trigger @Buy and character trigger @itemBuy, which are called before item is sold
  by a vendor. The trigger is called only with EF_New_Triggers on.
  ACT/DEFAULT is the item, SRC is the player, ARGN is the item amount, ARGO is the vendor.
  Return 1 prevents the player from buying the item.
- Added: Item trigger @Sell and character trigger @itemSell, which are called before item is bought
  by a vendor. The trigger is called only with EF_New_Triggers on.
  ACT/DEFAULT is the item, SRC is the player, ARGN is the item amount, ARGO is the vendor.
  Return 1 prevents the player from selling the item.
- Fixed: Serv.itemdef.xxx.skill not always returning the skill
- Fixed: A copy & paste error in TAG.OVERRIDE.AMMO* what prevented the animation stuff to run.

25-09-2006, Nazghul
- Added: EF_DamageTool (0x2000) to Sphere.ini. Only if set tools/weapons will be damaged while
  lumberjacking/mining (what includes firing @Damage on them)
- Fixed: NPCs spawning with incorrect Z position.

26-09-2006, Nazghul
- Modified: @(item)ContextMenuRequest and @(item)ContextMenuSelect now will not be called with
  EF_Minimize_Triggers on.

27-09-2006, Nazghul
- Added: TDATA3 and TDATA4 of a container type item are now holding min and max coordinates of
  the "area were items may be placed", relatively to the open container gump.
  TDATA3 is (MinX * 0x10000) + MinY, TDATA4 is (MaxX * 0x10000) + MaxY
  Be very careful with these settings - if they are set to illegal values (i.e., outside of the
  visible gump) Sphere will happily accept them, but your users will not be able to pick items
  placed there out of the container, because the client will only display then if they have the
  container gump as a background!
  If TDATA4 is not set (or set to 0), default values will apply, along with the console warning
  "unknown gump id".

28-09-2006, Nazghul
- Added: MOREM value (0..127) on digestible food will override the amount of "food units"
  what will be added to the characters FOOD property when eating this. Obviously, items
  with different MOREM will not stack. Because on=@SUCCESS on cooking will not give you
  a reference to the newly created item but only to the raw one, MOREM will be transferred
  from the raw food (what you may alter in on=@success)

29-09-2006, Nazghul
- Added: 3 defmessages, thus making the headline for the "c" console command configurable.

01-10-2006, Nazghul
- Added: Intrinsic function IsObscene what tests whether the passed argument is a forbidden
  word (list of these words are in your spheretables.scp under the section OBSCENE).
- Fixed: Obscene not matching obscened words inside a string.
- Fixed #889: Fame.* and Karma.* always returning 0.
- Updated: spheretables.scp - added KARMA and FAME sections. Now you can change, add or remove
  keys which are used behind Karma. and Fame. . First line declares steps, other lines their
  names.
  IT IS HIGHLY RECOMMENDED TO UPDATE YOUR SPHERETABLES.SCP!!!

02-10-2006, Nazghul (Script Pack)
- Fixed #867: sphere_minor_artifacts.scp, i_orcish_visage
- Updated: Flags notification on server startup

02-10-2006, Nazghul
- Fixed #898: Some stairs unwalkable with EF_NewPositionChecks, EF_WalkCheck and
  EF_DiagonalWalkCheck on.

05-10-2006, Nazghul
- Added: INI flag OF_OSIDamageMod (0x04)
  Modifying weapon damage OSI style, according to this formulas (originally provided by ClouD_Br):
  Tactics Damage Bonus% = Tactics � 1.6 (Add 6.25% if Tactics >= 100)
  Anatomy Damage Bonus% = (Anatomy � 2) + 5
  Lumberjack Damage Bonus% = Lumberjack � 2 (Add 10% if Lumberjacking >= 100)
  Strength Damage Bonus% = Strength * 0.3 (Add 5% if Strength >= 100)
  Final Damage Bonus% = Tactics Bonus + Anatomy Bonus + Lumber Bonus + Strangth Bonus + Damage Increase Items*
  Final Damage = Base Damage + (Base Damage * Final Damage Bonus%)
  * Damage Increase is capped at 100%.

05-10-2006, Nazghul
- Fixed #036: Fixed TRY and TRYSRV not working with locals (local and arg*). TRYSRC and TRYP
  do not work, since it makes no sense to use it on local variables. (Thx to Ellessar who
  finally worked out how this SHOULD work, so we found the bug deeply buried under tons of
  old code)

06-10-2006, Nazghul
- Added: Function ISNEARTYPETOP(.P) which uses new checks for resource gathering (item which
  you want to find must be at the top, if at the top there are 2 items, then the success
  depends on the priority (dynamic->multi->static->terrain) of those items). Syntax is the
  same with ISNEARTYPE(.P). NOTE: This function is called from hardcode if EF_NewPositionChecks
  are on.
- Fixed #668: Delete packets of items which cannot be seen were sent to the client.
- Modified #632: Now, IsPlayer can be used on every game object.
- Modified: sphere.ini - added an NPC AI flag NPC_AI_INTFOOD which enables smarter and more
  trustworthy food finding.

08-10-2006, Furio
- Modified: TRIGGER command. It now supports calling a trigger with arguments, the syntax is:
  TRIGGER $trigger_name[,$trigger_arg_type,...] where $trigger_arg_type can be:
  - TAT_AS_ARGN (1): uses arguments as ARGN. Example: TRIGGER @MyTest,<def.TAT_AS_ARGN>,1,2,3
                     will call @MyTest with ARGN1=1 ARGN2=2 ARGN3=3.
  - TAT_AS_ARGS (2): uses arguments as ARGS. Example: TRIGGER @MyTest,<def.TAT_AS_ARGS>,hi you 2,yo !
                     will call @MyTest with ARGS=hi you 2,yo !.
  - TAT_AS_ARGO (3): uses arguments as ARGN. Example: TRIGGER @MyTest,<def.TAT_AS_ARGO>,01
                     will call @MyTest with ARGO.UID=01 (only if object with such uid exist).
- Updated: sphere_defs.scp (with new definitions for the TRIGGER command).
- Fixed #880: Explode function not working as it should.

09-10-2006, Nazghul
- fixed problems with spellbooks obviously triggered by new Gcc compiler for Linux with a weird
  workaround.

10-10-2006, Nazghul
- Fixed #900: Added INI flag COMBAT_DCLICKSELF_UNMOUNT to unmount horse when dclicking self
  while in warmode.

11-10-2006, Nazghul (Script Pack)
- Updated: sphere_msgs.scp - more defmessages to customize text output.
- Updated (#905): sphere_item_provisions_potions.scp - Shrink potion did not behave as expected.

13-10-2006, Nazghul
- Added: Intrinsic functions SIN() and COS(). Attention: Without FLOAT math they will obviously
  only return 0 and 1 :)

16-10-2006, Nazghul
- Added: Support for floats (local variables FLOAT.younameit, which have size of double, and
  can hold precise numbers). Usage of these variables is the same like LOCAL.younameit. As
  EVAL only uses integer arithmetic, with FLOAT math you have to use <FLOATVAL ()>
  (New code was done mainly by Ellessar and Decrythe, I just "glued" it into Sphere :) )
- Changed: Return values for @SPELLSELECT trigger. Touchup for @SELECT with spells. Different
  server behaviour can be achieved with the following RETURN values in trigger scripts:
  @SELECT
  	RETURN 0 - proceed without mana, spellbook, and reagent check as if these checks were
  						 successful
		RETURN 1 - Abort processing (so aborting the spell)
	  RETURN 2 - proceed as normal
	  RETURN 6 - like RETURN 0 (for compatibility with @SPELLSELECT)
  @SPELLSELECT
  	RETURN 0 - proceed as normal
		RETURN 1 - abort processing (so aborting the spell)
	  RETURN 2 - proceed as normal
	  RETURN 6 - proceed without mana, spellbook, and reagent check as if these checks were
	  					 successful
  @SPELLSELECT will be called after @SELECT - what means, if you leave @SELECT with RETURN 0 or
  RETURN 1, @SPELLSELECT will NOT be called!

16-10-2006, Furio
- Added: DAM.HI/LO and ARMOR.HI/LO

17-10-2006, Nazghul
- Added: Defmessage if skillgain is aborted due to GAINRADIUS not met; message will only be displayed
  if TAG.NOSKILLMSG=1 on character
- Fixed: Problems with long passwords and MD5 hash on.

18-10-2006, Nazghul
- Added INI flag OF_DrinkIsFood (0x10000). If set, T_DRINK will increase FOOD lvl. like T_FOOD

19-10-2006, Nazghul
- Added: Dynamic property "height" for characters.

20-10-2006, Nazghul
- Updated: sphere_defs.scp - added defname charheight.

21-10-2006, Nazghul
- Added: New "m" paramter for TARGET function. Now you can use TARGETM and TARGETFM for targeting
  a place for your multi (you will see your multi in the "ghost mode"). TARGETM takes as an argument
  ONLY ID of the multi, TARGETFM takes 2 arguments - function_to_call,ID_ot_the_multi.

21-10-2006, Nazghul (Changes only for servers with EF_NewPositionCheck on and AdvancedLOS on)
- Modified: CanSeeLOS now uses height of a character for its checks. Height is read in this order
  and first correct entry is used:
  1. Dynamic height property of an object
  2. Height property under CHARDEF/ITEMDEF (can be inherited)
  3. Defname in format "height_dispid", while dispid is a hex number in Sphere format (0a3)
  4. Defname in format "height_dispid", while dispid is a dec number
  5. Universal height - "15"
  If a character is mounted, its height is raised by 4. CanSeeLOS reduce height of an unmounted
  character by 1 (pretending eyes height).
  NOTE: This formula is used when you are doing .show height, or <height> in scripts.

23-10-2006, Nazghul
- Fixed: #789 ModAR on characters only worked with damage of type GENERAL.

23-10-2006, MrSugarCube
- Fixed: Webpage requests always displaying the "Internal Server Error" page.

24-10-2006, Nazghul
- Added: Trigger @(item)Buy now has local.totalcost, which holds the cost of the whole purchase
  and ARGN2, which holds price of this amount of items (price * amount).
- Fixed: Trigger @(item)Buy returning bad amount in ARGN1.
- Added: Local variables LOCAL.CREATEOBJECT1 and LOCAL.CREATEOBJECT2 to @SUCCESS trigger of spells.
  These variables are _unset_ when the trigger is called. But they can be _set_ with field- and
  summon spells to change what these spells will create.
  - Summon spells (summon creature, bladeSpirit, Vortex, summon daemon, summon *elemental) take only
    the first one. If set with LOCAL.CREATEOBJECT1 = <eval c_orc> the spell will summon an orc. This
    way one can add more random daemons to the summon daemon spell, or change the spawned creature
    due to magery or whatever.
  - field spells (s_wall_of_stone, s_fire_field etc) take both variables, as usually the items for
    the field in west-east direction are different from those in north-south direction. If necessary
    they can of course be the same (s_fire_field looks impressive with i_fire_columns :) ), but BOTH
    have to be set (otherwise the unset will be replaced by the spell's default item for this dir).
    Example:
    [SPELL s_fire_field]
    ...
    on=@SUCCESS
      IF <magery> >= 99.9
        LOCAL.CREATEOBJECT1 = <eval i_fire_column>
        LOCAL.CREATEOBJECT2 = <eval i_fire_column>
      ENDIF

24-10-2006, Pilz-e (Script pack)
- Updated: sphere_map0_ml.scp (Corrected P properties for ML locations)

25-10-2006, Nazghul (Changes only with EF_NewPositionCheck, EF_WalkCheck and MountHeight on)
- Modified. You will not be able to go into a building if there is not enough space for you.
- Modified: You will not be able to mount a rideable if there is not enough space for you + ride.
- Modified: You will not be able to summon an NPC if there is not enough space for it.
- Modified: You will not be able to teleport (gate, recall) yourself to a spot where is not enough
  space for you.

25-10-2006, Nazghul
- Updated: sphere_msgs.scp - added a new defmessage msg_summon_ceiling and modified
  the msg_mounted_ceiling defmessage.

25-10-2006, Nazghul
- Changed: NPC_AI flags in sphere.ini. Started splitting them up to make it easier to track
  errors related to them. The respective INI section now reads:
  // NPC AI settings
  //	NPC_AI_PATH		0001		NPC pathfinding
  //	NPC_AI_FOOD		0002		NPC food search (objects + grass)
  //	NPC_AI_EXTRA		0004		NPC magics, etc
  //	NPC_AI_ALWAYSINT	0008		Always be as smart as possible with pathfinding
  //	NPC_AI_INTFOOD		0010		NPC food search (more intelligent and trusworthy)
  //	NPC_AI_COMBAT		0040		Look for friends in combat
  //	NPC_AI_VEND_TIME	0080		vendors closing their shops at nighttime
  //	NPC_AI_LOOTING		0100		loot corpses an the way
  //	NPC_AI_MOVEOBSTACLES	0200		if moveable items block my way, try to move them
  //NPCAI=0

27-10-2006, Nazghul
- Fixed: Fishing not displaying an animation right after start.
- Fixed: Resource gathering with EF_NewPositionChecks on did not work on tiles with Z < 0.
- Added: Some more defmessages (also to sphere_msgs.scp), this time title-related

28-10-2006, Furio
- Fixed #809: Wrong cheater message.
- Added #913: TAG.OVERRIDE.MAXITEMS/MAXWEIGHT on bank to override global settings.
- Added: TAG.PARTY_AUTODECLINEINVITE. If set on char it makes the char autodecline every invite.
- Modified: After an party invite you must wait a bit before inviting someone else.

29-10-2006, Nazghul
- Added: Spell flag "SPELLFLAG_NOUNPARALYZE", if the flag is turned on, victim won't be
  unparalyzed.
- Added: Damage flag "DAM_NOUNPARALYZE", if the flag is turned on, victim won't be unparalyzed.
- Updated: sphere_spells.scp (added spellflag_nounparalyze to the paralyze field spell)
  and sphere_defs.scp
- Updated: sphereCrypt.ini

31-10-2006, Nazghul
- Added: FEVAL and FHVAL which allow you to convert your float variable to a standard decimal or
  hexadecimal number. Numbers behind a decimal point are cut out.
  The syntax is: <feval <float.yourvar>> or <fhval <floatl.yourvar>>.
- Fixed: Addspell not working if used like <findid.i_spellbook.addspell 5>. Now, this syntax
  should return 1 if the spell passed as an argument is in the spellbook.

02-11-2006, Nazghul
- Fixed: CanSeeLOS working through a "black hole" in terrain.
- Fixed: Walls with the impassable flag off blocking movement.
- Modified: IsArmor and IsWeapon now accept UID or ItemId as an argument.

02-11-2006, MrSugarCube
- Fixed: Double "You have the key for this" message when attempting to use a lockpick or cast
  magic unlock on something you already have a key for.

03-11-2006, Furio
- Added: DB.ESCAPEDATA $field returning $field escaped using the charset of the connected db.

03-11-2006, Nazghul
- Added: Character trigger ON=@JAILED
  ARGN1 = 1 -> Char is up to be jailed, 0 -> char is up to be forgiven
  ARGN2 = Jail cell (0 if none special)
  RETURN 0 -> proceed as normal
  RETURN 1 -> stop the procedure without changing current status
- Added: Character property IsVerticalSpace, which returns 0 if there is not enough space for
  you and your mount (if you are mounted). Function takes position as an optional argument.

05-11-2006, MrSugarcube
- Modified: SERV.BLOCKIP now accepts a second argument specifying the time to block the IP for
  in tenths of a second (-1 for permanent).
- Added: f_onserver_blockip, called when an IP is blocked from the server. ARGS contain the IP
  being blocked and ARGN1 holds the amount of time the IP will be blocked for (writable).

05-11-2006, MrSugarCube (Script pack)
- Updated: sphere_serv_triggers.scp (Added f_onserver_blockip definition)

10-11-2006, Nazghul
- Added: REFx as a local reference object, where x is a number between 1 and 65535. It can be
  used like an OBJ, but will be removed after leaving a function (like a LOCAL).

15-11-2006, Nazghul
- Fixed #933: i_rune_paralyze is not removed.
- Fixed #934: NPCAI_Extra and heavy weapons.

16-11-2006, Admin BladeCraft (Script pack)
- Updated: sphere_serv_triggers.scp (Added f_onserver_blockip under [PLEVEL 7] block)

20-11-2006, MrSugarCube
- Fixed #940: Undefined keyword errors when using functions via [guildstone.]MEMBER.x.KEY.

23-11-2006, MrSugarCube
- Added: Support for ConnectUO status request packet.

23-11-2006, Furio
- Added: ALLOWBUYSELLAGENT in sphere.ini to allow rapid buy/sell.

24-11-2006, MrSugarCube
- Fixed: Exceptions caused by not definined FAME.*/KARMA.* ranges.
- Fixed: Exception caused by using a spyglass from a ship.
- Modified: Walking off a ship plank no longer moves characters to adjacent ships.

25-11-2006, MrSugarCube
- Fixed: Stamina not being sent to other party members, and stat bars for other party members
  not always showing the correct mana/stamina levels.

26-11-2006, MrSugarCube
- Fixed #949: Possibility of taking items from inside containers within the bank.
- Fixed #947: ISARMOR causing errors when no arguments given.
- Fixed #960: .Extract and .UnExtract always using map 0.
- Modified #946: Items can no longer be moved from the trade window due to client limitations.

26-11-2006, MrSugarCube (Script pack)
- Updated: sphere_msgs.scp (Added "msg_trade_cantmove" defmessage)

27-11-2006, Vjaka
- Added: ATTACKER keyword to access last attackers of a character. Usage:
  <attacker>		returns amount of attackers
  <attacker.x>		returns UID of the attacker (or 0 if there is no attacker)
  <attacker.x.dam>	returns total damage done by the attacker
  The list is being cleared upon death after @DeathCorpse trigger.
- Removed: OF_Multithreaded option flag, it actually did not work at all.
- Removed: EF_Scripts_Parse_Verbs - now it is integrated into the parser and is used when needed.
- Modified: The way the scripts are being parsed, now they are not read from the disk on each
  operation, and are actually re-read only when you are doing a manual resync.
- Added: BETWEEN2 as opposite of BETWEEN, which selected min<-cur->max to select towards
  minimum (max<-cur->min).

28-11-2006, Furio
- Fixed #951: FILE.WRITECHR not working as it should.
- Modified: Added error feedback for FOR* cycles.

28-11-2006, MrSugarCube
- Fixed #932: Removing items with a Z greater than 25 not updating view for players.

29-11-2006, Vjaka
- Modified: The exception handling routine to get more information about the place which causes
  the exception.

30-11-2006, MrSugarCube
- Fixed #804: Multiple stackable items being created in a TEMPLATE not having the correct
  amounts.
- Fixed #664: Automatic loading of backup saves not working.
- Fixed: REPORTEDCLIVER always returning 0.0.0 and CLIENTIS3D always returning 0.
- Fixed: GUILDTITLE property on guild members not working.
- Fixed: KARMA.* ranges not accepting negative values.
- Modified #494: RESURRECT function now accepts a parameter specifying whether or not to
  ignore anti-magic fields (i.e. "RESURRECT 1" to ignore anti-magic field). Note that
  specifying 1 will also cause @[Spell]Effect triggers to not fire for the resurrection
  spell.
- Modified: Adding/Accepting an offline player into a guild now shows a more appropriate
  message to the client.

01-12-2006, MrSugarCube
- Fixed: Corpses for creatures with higher RESLEVEL than the client's RESDISP not showing
  the body and hue specified in the creature's CHARDEF.

02-12-2006, Nazghul
- Added: CanSeeLOSFlag which accepts flags for LOS check as the first argument and an object
  or a position as the second argument. For flags and their explanation see sphere_defs.scp.

05-12-2006, Vjaka
- Fixed: Ships falling apart after rotation.
- Fixed #955: Some dialogs/sdialogs causing exceptions after they're opened.

06-12-2006, Nazghul
- Modified: Now only ATTACKER.* works (not ATTACKERFUBAR), now only ATTACKER.*/ATTACKER.*.UID
  returns the UID of an attacker, ATTACKER.*.DAM returns damage done by the attacker * and
  ATTACKER.*.ELAPSED returns the time in seconds since the last hit of the attacker *.
- Modified: ATTACKERs are now also saved if they deal no damage.

09-12-2006, Nazghul
- Fixed #965: Fishing with certain flags on not working.
- Fixed: Error messages about undefined item 00.

09-12-2006, Furio
- Added: Encryption keys for client 5.0.7.0.

09-12-2006, MrSugarCube
- Fixed: <REPORTEDCLIVER.> not showing the ".x" in client "5.0.6.5" and above.

10-12-2006, Vjaka
- Added: Now keyword MAX can be used instead of number in ATTACKER in order to access the one
  who have dealt most damage.
- Removed: EF_Scripts_Ret_Strings has proven to be stable and correct during years, so it is
  now a default behavior of Sphere.

16-12-2006, Furio
- Added: argument CLEAR to TIMERF. Now using x.TIMER CLEAR will delete all the timerf running on x.

16-12-2006, MrSugarCube
- Fixed #979: PRIVSHOW feedback showing incorrect ON/OFF message.
- Fixed #977: +=/-= operators not working with REFx, and exception caused when TRYSRC is
  supplied with an invalid verb.
- Fixed #936: REFx interfering with functions beginning with REF (such as REFUSECANDIDATE
  on guildstones)
- Fixed: REFx allowing x to be out of range (should only allow 1 to 65535).
- Modified: <REFx> now returns the UID of the object stored in the REF like other object
  references.
- Modified: REFx no longer ignores attempts at being set to invalid UIDs - now in this case
  the REF will be cleared.

16-12-2006, ShiryuX (Script pack)
- Updated: sphere_defs.scp (Added missing MT_MALE definition)

18-12-2006, MrSugarCube
- Fixed #985: Clients on the "Status..." window not showing on seperate lines.
- Fixed #978: Setting LevelMode to unexpected values causing server freeze when calculating
  experience.

19-12-2006, coruja747 (Script pack)
- Updated: sphere_admin.scp (Fixed IP Address and Location properties not greyed out for
  insubstantial characters)
- Updated: spherechar.scp and spherechar_evil.scp (Corrected Lava Lizard definition and
  moved it to spherechar.scp)

19-12-2006, _Epila_ (Script pack)
- Updated: sphere_menu.scp (Removed [COMMENT MENU MENU_ADMIN] as it's no longer used)

20-12-2006, MrSugarCube
- Modified: Tooltips that have been queued long enough for their object to no longer be on
  the client's screen are no longer sent.

20-12-2006, MrSugarCube (Script pack)
- Updated #988: sphere_msgs.scp (Added 3 "msg_serv_shutdown*" defmessages)

20-12-2006, Nazghul
- Fixed #972: NPCs walking on water with EF_WalkCheck on.
- Fixed #982: Teleport allowed to water with EF_WalkCheck on.

21-12-2006, MrSugarCube
- Fixed #971: Clock overflow that causes the game to freeze.
- Fixed: FRUIT property of crops not returning the correct value.

22-12-2006, Nazghul
- Fixed: HEIGHT returning wrong value on DUPEd items.

22-12-2006, Vjaka
- Fixed: HITS setting for items when MAXHITS was not specified, so you can act via HITS for
  items as well for saving with no need to differ HITS and HITPOINTS.
- Fixed: client problems with quick mounting horse while running causing no future updates
  being interpreted by client till .fix/.resend was done.
- Fixed: inject ,snoop command still having some cases to access items in undesired containers.
- Fixed #819: If we use rand(X), where X > 32767, we always get result of rand(131072).

22-12-2006, Furio
- Fixed #816: Reading non-string data from sql is autoeval'd.

23-12-2006, Vjaka
- Added: Region tag RestockVendors (in ticks) to alter time in which the vendors will auto restock.
  Default value is 10*60*10 (10 minutes).

24-12-2006, MrSugarCube
- Fixed #1000: TAG.NAME.PREFIX not overriding the Lord/Lady title in the profile and paperdoll
  menus, and TAG.NAME.SUFFIX not showing at all.
- Fixed: Sphere crashing when a player opens a container with 810+ items inside.

29-12-2006, MrSugarCube
- Fixed #973: Ship hatch contents being deleted upon turning the ship.
- Fixed #973: Ship planks becoming permanently unlocked when opened.
- Fixed #973: Fixed spam caused when attempting to attack an opponent outside of a ship.
- Fixed: MULTICREATE function not working without an SRC present.
- Fixed: Setting the ACCOUNT property of an NPC now properly sets it up as a player character
  without it being deleted by garbage collection.
- Modified #995: Logged out players are now moved along with moving ships.
- Modified #920: GMPAGE function can now be used with the arguments "ADD <Message>" to add <Message>
  to the page queue. This function should be called on a logged in player (eg: "GMPAGE ADD This is a
  page").
- Added #973: Combat flag COMBAT_ALLOWHITFROMSHIP. Removes the combat restriction that prevents
  characters attacking from ships.
- Added: TILLER, HATCH and PLANK.x references for ships. PLANKS property can be used to determine
  how many planks are present on a ship.

29-12-2006, MrSugarCube (Script pack)
- Updated: sphere_msgs.scp (Added combat_outsideship to defmessages)

30-12-2006, _Epila_ (Script pack)
- Updated: sphere_map_points3.scp (Added missing Doom dungeon teleporters)

02-01-2007, MrSugarCube
- Fixed: Loginserver not sending server IPs correctly.
- Fixed: Response not being sent when a client sends a ping packet.
- Fixed: Hallucination ignoring RESLEVEL settings on the random bodies it selects.
- Modified: Trade window contents are no longer included in searches of a character's inventory. This
  affects CONSUME, *COUNT, FIND* and FORCONT* functions.

02-01-2007, MrSugarCube (Script pack)
- Updated: spherechar.scp (Replaced c_sea_monster definition to add protection against crashing newer
  clients)

03-01-2007, MrSugarCube
- Fixed: MapChange packet not sending the correct map id for Trammel (Map 1)
- Modified: MAPx in sphere.ini now accepts a 5th parameter, for specifying the map id that should be
  given to the client (0=felucca, 1=trammel, 2=ilshenar, etc).
- Added: *Experimental* flag "EF_Mapdiff_Support" added to sphere.ini. Enables using mapdif and stadif
  files to patch terrain and statics.

04-01-2007, MrSugarCube
- Fixed: Buying from vendors allowing players to carry more weight than they should. Excess items are
  now dropped to the ground.
- Fixed: Selling to off-duty vendors showing a warning message about an illegal "buy packet" instead
  of "sell packet". Also added more detail to buy/sell packet cheater warnings.
- Modified: Resync messages are now always visible on the console.

05-01-2007, MrSugarCube
- Fixed #1011: Trade title on the paperdoll written incorrectly.

05-01-2007, Nazghul
- Fixed: Sphere now adds and removes the hiding/stealth buff icon automatically

06-01-2007, MrSugarCube
- Fixed: SERV.RESYNC command being executed from scripts causing the server to freeze. Note that using
  SERV.RESYNC from scripts will now cause the resync pause to be delayed until after the script has
  completed execution.
- Modified: EFFECT property of crafting skills can now be used to define the percentage of resources
  that are lost when failing to craft an item. A few examples of how you can use this:
   "EFFECT=x"		- Always lose x% of resources on fail
   "EFFECT=x,y"		- Lose between x% and y% of resources on fail
   "EFFECT=x,y,z"	- Lose between x% and z% of resources on fail (weighted by y)
  If EFFECT is not set then resource loss will be as normal -> 0-50% resources lost.
- Added: TAG.OVERRIDE.GUARDS on regions to specify different guards per region.
- Added: Arguments for @CallGuards trigger:
   ARGN1 = Guard ID that will be created. (writable)
   ARGN2 = Force spawning a new guard. (writable)
   ARGO  = An already spawned guard that will be used, unless ARGN2 has been set to 1.

06-01-2007, MrSugarCube (Script pack)
- Updated: sphere_skills.scp (Removed EFFECT property from Alchemy and updated [COMMENT SKILL x] block)

07-01-2007, MrSugarCube
- Fixed #1007: War/Peace button on paperdoll not correct when logging in with war mode.

08-01-2007, MrSugarCube
- Fixed #1004: Target cursor appearing when calling functions starting with "SET" or "X".
- Added #1013: SYSMESSAGELOC, for sending localized messages to clients. SMSGL can also be used as a shortcut.
  Syntax is: "SYSMESSAGELOC color,clilocid[,arguments]"
  All arguments must be separated by a comma ",". Specify -1 for color if you do not wish to override it.
  Some examples of this being used (latest clilocs) are:
   "SYSMESSAGELOC -1,502771"			- Displays "You cannot reach that."
   "SYSMESSAGELOC 2,1042758,MrSugarCube"	- Displays "You are now loyal to MrSugarCube." in blue
   "SYSMESSAGELOC -1,1062695,MrSugarCube,4,5"	- Displays "MrSugarCube rolls the dice and gets a 4 and
						  a 5!"
- Modified #1013: '@color,font,unicode' in messages is now '@color,font,mode'. You can specify 1 for mode if
  you wish to use unicode (like before), or specify 2 if you wish to use a localized message (useful for
  overriding messages in sphere_msgs.scp). The above localization examples used with this method would be:
   "SYSMESSAGE @,,2 502771"
   "SYSMESSAGE @2,,2 1042758,MrSugarCube"
   "SYSMESSAGE @,,2 1062695,MrSugarCube,4,5"

09-01-2007, Furio
- Added: MD5HASH returning the md5 hash of the argument.

11-01-2007, MrSugarCube
- Fixed: ATTACKER.x not working correctly.
- Fixed: Possible exception with handling mail message packet.
- Modified: Rewritten EF_Mapdiff_Support handling to perform much faster. This is done at the cost of some
  additional memory usage but it can now cope with populated worlds.
- Modified: Profiler now includes time spent loading map blocks.

11-01-2007, MrSugarCube (Script pack)
- Updated: sphere_spells.scp (Corrected FLAGS property of paralyze field spell)

12-01-2007, Shadow Dragon
- Added: MulDiv script function. Usage "MulDiv number,multiplier,divider". Returns result.

12-01-2007, Vjaka
- Greatly increased speed of loading large scripts (especially annoying on resync).
- Fixed parsing script files when latest useful script line not ended by carriage return.

15-01-2007, MrSugarCube
- Fixed #1027: SDIALOG claiming to be an undefined keyword when the specified dialog is already showing.

16-01-2007, Nazghul
- Added: Character trigger @charAttack, @charClick, @charClienttooltip, @charDClick, which work like
  @itemXXX triggers, but for NPCs.
- Added: An item flag CAN_I_DCIGNORELOS and a character flag mt_nodclicklos. With these flags on, LOS checks
  on a dclicked item won't be performed.
- Added: An item flag CAN_I_DCIGNOREDIST and a character flag mt_nodclickdist. With these flags on, distance
  checks on a dclicked item won't be performed.

16-01-2007, MrSugarCube
- Added #1029: @Cancel trigger to MENUs and SKILLMENUs.
- Modified: Items displayed on MENUs and SKILLMENUs can now be coloured. This can be done by prefixing the
  item description with "@color" (in the same way that sysmessages can be coloured). For example,
  "ON=i_sword_viking @2 This is a viking sword" will display a blue sword on the menu.
- Modified: Cancelling a PROMPTCONSOLE prompt no longer prevents the callback function from being called.

16-01-2007, SaCi (Script pack)
- Updated: sphere_dialog.scp (Updated descriptions in [COMMENT DIALOG HELP_SECTION])

17-01-2007, MrSugarCube
- Added: OPENPAPERDOLL character function. Without arguments it will display the current character's
  paperdoll to SRC. With the UID of a character given it will display the specified character's paperdoll to
  the current client.

20-01-2007, Ellessar
- Fixed: Problems with stairs which have odd height (1,3,5,...).
- Fixed #1037: Buffs needed FEATURE_AOS_UPDATE_B to work.

24-01-2007, MrSugarCube
- Fixed: Tillerman speech on the 3D client not shown in the correct colour.

25-01-2007, Ellessar
- Fixed #1028: Problems with terrain height.
- Rewritten the whole NPC_AI_PATH, now it should be faster, more reliable and less buggy.

28-01-2007, Ellessar
- Fixed: Pathfinding called on every NPC step.
- Fixed #987: ResMake returning wrong values if the item doesn't exist in the world.
- Fixed #1010: After casting a wall in a guard zone you were flagged as a criminal, also with the spellflag_harm
  flag off.

28-01-2007, MrSugarCube
- Fixed: GAINRADIUS on skill definitions defaulting to random values.

29-01-2007, Ellessar
- Optimized: MapCaching (using STL functions), which should result in less bugs and better performance.
- Fixed: Using .tele over water tiles was allowed.

29-01-2007, Furio
- Modified: Is now possible to always use ARGO.verb directly.
- Added: In packetfilter functions ARGO is the CClient connected now (e.g. it allows SENDPACKET through
  ARGO.SENDPACKET syntax at any time)

31-01-2007, MrSugarCube
- Fixed #771: Unicode characters being stripped from speech when keywords from Speech.mul are used.
- Added: Encryption keys for client 5.0.8.x to sphereCrypt.ini

01-02-2007, MrSugarCube
- Fixed #755: GetResourceValue error being shown for items with valid resources after being shown for the
  first time.
- Modified: Changed the "GetResourceValue reentrant item=xxx" error to make more sense.

02-02-2007, MrSugarCube
- Fixed #496: Musicianship skill triggering skill gain twice on success.

03-02-2007, MrSugarCube
- Fixed #510: Notoriety status on tooltips not shown correctly when moving around.

05-02-2007, Ellessar
- Added: Keyword GetRefType, which returns flag of the referenced type. The list of flags is in sphere_defs.scp.
- Updated: sphere_defs.scp - added ref_types defnames

06-02-2007, Nazghul
- fixed #1047: NPC AI_CAN_LOOT missed a "not" so only animals looted :).
  Domestic animals will no more poop dung if frozen, stone, insubstantial or in warmode

07-02-2007, Nazghul
- Fixed #1049: t_fire, t_campfire, t_spell are no longer dispellable if they have attr_move_never
- Added: more defmessages (update sphere_msgs.scp!)

07-02-2007, Vjaka
- Modified console output in linux build. By default it assumes that it is not colored,
  launch with argument -c (./spheresvr -c) in order to get colored output. It screwed some consoles.

08-02-2007, Nazghul
- Added: Skill flags SKF_NOANIM (don't show hardcoded anim for this skill) and SKF_NOSFX (don't play
  hardcoded sound for this skill). After setting this you can set anim/sfx yourself in @start
  or alike.

08-02-2007, Ellessar
- Fixed #1050: Problems with underground caves.

09-02-2007, MrSugarCube
- Fixed: ConnectUO Status requests sometimes reporting an encryption error.

11-02-2007, Fisicka (Script pack)
- Fixed #1051: Bug in sphere_map_points0.scp and sphere_map_points1.scp

11-02-2007, MrSugarCube
- Fixed #1037: ADDBUFF and REMOVEBUFF requiring FEATURE_AOS_UPDATE_B enabled to work.
- Fixed #1053: @color in [SKILL]MENUs displaying the wrong colour.

12-02-2007, MrSugarCube
- Fixed #1058: Exception on linux build caused by items decaying without decay flag.

13-02-2007, Nazghul
- Fixed #1059: Now NPC will be stuck with the lightsource they already have equipped.

15-02-2007, Nazghul
- Added: First version of support for TNG's webscript reader. Use console command
  "tngstrip" to create a file what contains the information TNG needs from all 
  your scripts (thus completely useless for script thieves). The file will be 
  placed at the location defined with "StripPath=" in sphere.ini and is named 
  "tngstrip.scp. Can be delivered either by a dedicated web server or the built-in 
  of sphere itself.

15-02-2007, Babidi (Script pack)
- Modified: sphere_dialog.scp - line 217, the highest skill is now SKILL_SPELLWEAVING.

16-02-2007, Nazghul
- Added: TAG.OVERRIDE.AMMOANIMHUE for bow and crossboy-type weapons to locally 
  override the color of the effect what will be used for displaying the shot.

18-02-2007, MrSugarCube
- Fixed #1069: Stable masters giving food to invisible characters.

20-02-2007, Nazghul
- Added SPELLFLAG_NO_CASTANIM (0x80000) to suppress the usual cast anim. 
  This way a custom (perhaps race-, class-, magery-, experience-related) anim 
  can be played @START/@SPELLCAST

21-02-2007, MrSugarCube
- Fixed #1071: Undefined Symbol error caused when a function returns a string.
- Fixed #1075: The last line in script files being ignored.
- Fixed #1076: ALLSHOW switching off too late upon login.
- Added: Skill flag SKF_CRAFT. Skills with this flag set will function 
  correctly with the MAKEITEM command.

21-02-2007, MrSugarCube (Script pack)
- Updated: sphere_defs.scp (Added SKF_CRAFT definition)
- Updated: sphere_map_points0.scp and sphere_map_points1.scp 
  (Removed duplicate teleporters)

22-02-2007, MrSugarCube
- Fixed #1078: Exception when walking in the top left corner of maps.
- Added #1079: ARGO in f_onchar_create, f_onchar_delete and f_onaccount_login 
  is now the the client that is performing the action (note that at the time 
  these functions are called, there is no character attached to the client so 
  character properties are not accessible).

22-02-2007, Nazghul
- Added: Character trigger @statchange (argn1: the stat, argn2: new value).

25-02-2007, Ellessar
- Added: TAG.DEATHFLAGS which changes some death related behavior. The list of 
  flags is in sphere_defs.scp and their names are pretty self-explaining.
- Fixed #1081: SERV.WRITELINE not adding a new line on Windows.

25-02-2007, Ellessar (Script pack)
- Updated: sphere_defs.scp (Added death_flags defname)

25-02-2007, Nazghul
- Added: TAG.OVERRIDE.MAXWEIGHT and TAG.OVERRIDE.MAXITEMS now are applying 
  to all containers if set. If not, maximum weight is still unlimited, while 
  max. item count is still default.

26-02-2007, Ellessar
- Modified: Region trigger @Step will now work only with EF_New_Triggers 
  on and EF_Minimize_Triggers off.

27-02-2007, Ellessar
- Added: sphere.ini settings EventsPlayer, EventsRegion. These events are 
  applied on all players/regions in the world.
- Updated: sphere.ini

01-03-2007, Furio
- Added: LASTEVENT keyword on clients, returning the time of last packet 
  receive (like serv.time).
- Modified: OF_OSIDamageMod and OF_Archery_CanMove are now CombatFlags 
  (look in sphere.ini)
- Updated: sphere.ini

01-03-2007, MrSugarCube
- Fixed #1092: Dead characters not showing on the status page.
- Fixed #1090: MOUNTHEIGHT checks preventing characters teleporting to valid 
  locations if they are stuck under a low ceiling.
- Fixed #1085: MAXBASESKILL in sphere.ini applying to skills that players are 
  unable to see in their skill menu. An INITHIDDENSKILLS setting has been added 
  to sphere.ini so that this behaviour can be toggled.
- Fixed #1084: Vendor's constantly restocking goods instantly after selling them.
- Fixed: Players able to create characters with skill in undefined skills.

01-03-2007, MrSugarCube (Script pack)
- Updated: sphere_skills.scp (Missing skill cap for Animal Lore in SKILLCLASS 0)

02-03-2007, Ellessar
- Fixed #1093: serv.restock not working. Now it updates all vendor boxes and 
  world gem bits.
- Fixed: NPCs sometimes not spawning with EF_NewPositionChecks on.
- Modified: Trigger @CallGuards now have a reference "REF1", which refers to 
  the target of the guard.
- Modified: NPCs now won't 'talk and follow' you, if your distance from their 
  spawn bit is greater than their homedist.

02-03-2007, Vjaka
- Fixed: red NPCs spawning in cities from spawns at the edges of the town.
- Modified: now clients which spawns too many exceptions are disconnected.
- Added: GOLD property for character. It counts all gold coins on character 
  and return them. Or, if used with argument, sets a new amount of gold, adding 
  gold coins to reach the new sum. The most common usage would be similar to 
  GOLD += 5000 and so on.
- Fixed: NPCs not being able to stumble upon hidden player character.

05-03-2007, Furio
- Fixed #1098: Explosion potion activate with decay timer also if not activated.

06-03-2007, Ellessar
- Added: ATTACKER.LAST, which works like ATTACKER.MAX, but returns the char which 
  hit the victim for the last time.

10-03-2007, Ellessar
- Added: Experimental flag EF_AllowTelnetPacketFilter, which allows telnet 
  connections to fire a PACKETx function.
- Updated: sphere.ini

12-03-2007, MrSugarCube
- Fixed #1062: "RETURN x" not always halting script execution or even returning 
  the correct value.
- Fixed: Exceptions that are sometimes caused when attempting to use/take an item 
  that cannot be reached.

13-03-2007, Nazghul
- Added: keyword VISUALRANGE, parameter 1..18 to limit the visualrange of a client. 
  After changing the visual range you should update the character in question once.

13-03-2007, Ellessar
- Fixed #1106: PACKETx sometimes caused errors in console.

16-03-2007, MrSugarCube
- Fixed #1113: Exception caused when an online player character is deleted.
- Fixed: ATTACKER.LAST only working when the last attack was within the last second.

17-03-2007, Beyonder (Script pack)
- Updated: sphere_item_treasure_maps.scp (Updated to use 0.56b features)

17-03-2007, Ellessar
- Added: Function SKILLTEST, which tests values of skills sent as arguments 
  on the default character. Usage: <skilltest carpentry 68.9>
- Fixed: SKILLMAKE replacing types with item names.

17-03-2007, Furio
- Fixed #1117: Unable to access subcontainers on the ground.

17-03-2007, MrSugarCube
- Fixed #1118: Ship functions being reported as invalid commands.

18-03-2007, Ellessar
- Added: ++/-- operators, which are in C languages.
- Fixed: RESENERGY is saved only if RESPOISON doesn't equal 0.
- Fixed: Possibility of double definition of events (sphere.ini + events +e...)

24-03-2007, Furio
- Updated: sphereCrypt.ini with 5.0.9.0 keys.
- Removed: MEMORY_GUMPRECORD to track open dialogs. It now uses an internal system.
- Updated: sphere_defs.scp
- Added: ISDIALOGOPEN $dialogId. It returns the number of the opened $dialogId 
  on the client.
- Fixed #1127: Items of the hatch can't be moved.
- Fixed #1129: GumpPicTiled don't work with dynamic origin.

24-03-2007, ShiryuX (Script pack)
- Updated: sphere_dialog.scp (Reference at top)

24-03-2007, RanXerox (Script pack)
- Updated: sphere_map_points0_ml.scp (Updated teleports)

26-03-2007, Nazghul
- Added: Teleport effect and sound config keywords for Sphere.ini.
  Setting it to 0 disables the effect. Defaults are
  TeleportEffectNPC=0372a
  TeleportEffectPlayers=0372a
  TeleportEffectStaff=03709
  TeleportSoundNPC=01fe
  TeleportSoundPlayers=01fe
  TeleportSoundStaff=01f3

27-03-2007, Vjaka
- Fixed: Allowed to cast spells without reagents.

29-03-2007, MrSugarCube
- Fixed #1122: Exception when fighting with -100 dexterity.
- Fixed #1137: Containers closing when targeting them with .x/set.

04-03-2007, MrSugarCube
- Fixed #1126: Creatures with neutral karma not spawning in guard zones.

04-03-2007, Furio
- Added: PARTY.ISSAMEPARTYOF $uid, checking if the current party is the
  same of the char with $uid.

06-04-2007, Nazghul
- Added: More defmessages
- Updated: sphere_msgs.scp

14-04-2007, Sir Dwayne (Script pack)
- Fixed: Various flaws in npc scripts and sphere_item_unsorted.

21-04-2007, coruja747 (Script pack)
- Updated: sphere_map2.scp (Corrected a_shrine_virtues area definition)

27-04-2007, Ellessar
- Added: Character trigger @TradeAccepted (+@charTradeAccepted), which is called 
  after both trade sides tick Accept Trade button. Default, ARGO - the first 
  trader, SRC - the second one, ARGN1 - the number of items the first trader gets, 
  ARGN2 - the number of items the second trader gets, REF1...REF<argn1> - 
  references to items the first trader gets. Return 1 prevents the trade.
- Fixed: CTAGs deleted before calling @LogOut

30-04-2007, MrSugarCube
- Modified #1162: A comma ',' can be used under the NOTOTITLES section to 
  optionally specify seperate titles for female characters.
- Modified: EF_MapDiff_Support has been removed, and map diffs are now enabled 
  via the USEMAPDIFFS setting in sphere.ini.

02-05-2007, MrSugarCube
- Fixed: Exception when using ACCOUNT.CHAR.x.KEY when the index 'x' does not exist.

03-05-2007, MrSugarCube
- Fixed: Server IPs on the server list being sent incorrectly to older clients.

05-05-2007, MrSugarCube
- Added: Experimental flag EF_UsePingServer. This will enable a server for 
  receiving pings from clients viewing the server list. Uses UDP port 12000.

06-05-2007, Ellessar
- Added: Missing character trigger @SpellFail (called before @Fail in a 
  SPELL section)

06-05-2007, MrSugarCube
- Fixed #1169: Exception caused by the count parameter being negative in the 
  STRSUB function.

08-05-2007, Ellessar
- Fixed: POW (@) does not work when using inside 'floatval'.

10-05-2007, MrSugarCube
- Fixed #1176: RANGE property on items returning 0 when the minimum range is 0, 
  when in this case it should return the maximum range.
- Fixed #1178: Automatic loading of backup saves not unloading all of the data 
  from the previous save.

17-05-2007, Sir Dwayne (Script pack)
- Updated: sphere_item_building_fence.scp, sphere_item_building_stairs.scp,
  sphere_item_building_walls.scp (Reordering of some fences, stairs and walls)

17-05-2007, MrSugarCube
- Fixed: SPELLFLAG_NOUNPARALYZE doing the opposite of its description.
- Fixed #1181: Casting field spells on players not giving criminal status even 
  when SPELLFLAG_HARM is set.
- Fixed #1182: Crash when opening the .edit menu on a player with too many 
  equipped items.

17-05-2007, Furio
- Added: DSPEECH prop to players. Its purpose is to intercept player speech 
  like SpeechSelf, but it allows multiple speech block (DSPEECH +spk_lol add spk_lol, 
  DSPEECH -spk_lol removes it). Return 1 on the speech block interrupt execution and 
  prevent the player from speaking, Return 4 blocks the execution while allowing the 
  player to speech.
- Added: ISDSPEECH prop to players. Its purpose is to chech if a speech block is in
  DSPEECH in a similar way of ISEVENT.

18-05-2007, MrSugarCube
- Modified #1155: The COMPONENT property of multi definitions can now be given 
  the ID of any scripted item.
  
20-05-2007, Furio
- Fixed: Trade windows not bouncing correctly some of the items.

20-05-2007, MrSugarCube
- Fixed: Sphere running slowly, due to new threading not ticking as much as 
  old threading.

22-05-2007, ShadowDragon
- Added: Support for Int and Color options to CHARDEF.

22-05-2007, Camelotten (Script pack)
- Fixed: jobvet.scp - an excessive '<' in "<SRC.SEX <Mi'Lord/Mi'Lady>".

26-05-2007, MrSugarCube
- Fixed #1194: Polymorph becoming a permanent effect during worldsaves.

27-05-2007, Nazghul
- Added: MODAR on weapons should modify the DAM effect of a weapon

28-05-2007, Furio
- Fixed #1201: DB.EXECUTE executing commands also when not connected.

29-05-2007, MrSugarCube
- Fixed #1203: Multis not being visible from a distance.

31-05-2007, Nazghul
- Fixed #1206: using character function ".gold" with negative numbers crashed 
  the server.

02-06-2007, Furio
- Fixed #1208: If modstat is negative and > ostat, all skills affected by 
  that stat become 65535.
- Fixed #1186: Starvation incorrectly damages affected player's equipment

02-06-2007, Almost all the dev team
- Fixed #1188: Incorrect save output.
- Fixed #1191: Sphere closing when using crafting skills (related to #1188).

02-06-2007, MrSugarCube
- Fixed: Unable to gain musicianship past 30%.

06-06-2007, Furio (Script Pack)
- Fixed #1213: "admin" in console (sphere_admin.scp)

08-06-2007, MrSugarCube
- Fixed #1211: FORCONTID and FORCONTTYPE not working.
- Fixed #1212: Reactive Armor causing a server crash when damaging self.

11-06-2007, MrSugarCube
- Fixed: Vendor menus on clients later than 4.0.0 not showing correctly for 
  renamed items when ACCOUNT.RESDISP is not correctly set to AOS+.

14-06-2007, Fire-Dragon-DoL
- Fixed #1220: typos in sphere_guild_functions.scp

26-06-2007, Nazghul
- Added: Character trigger @SkillChange. Fires whenever the skill raises due 
  to a gain. ARGN1 is the skill number (e.g. 43 for wrestling), ARGN2 is the 
  skill value AFTER the change happens. RETURN 1 (or 2, or 666) means that the 
  skill will NOT change.

29-06-2007, Torfo
- Added: ADDMD5. If md5 is enabled in the sphere.ini you can use ADDMD5 to 
  bypass the hashing algorithm, if MD5 isn't enabled it's the same as ADD.
  Usage: "ACCOUNT ADDMD5 name hash"

06-07-2007, Nazghul
- Fixed: RETURN 1 in region triggers @exit, @enter did not tell the client that 
  the movement was stopped what led to some weird rubberband effects. 
  (thx. to MrSugarCube for help)
- Added: Character triggers @RegionEnter, @RegionLeave. ARGO is the region in 
  question, RETURN 1 works like in region triggers @exit, @enter.

12-07-2007, Nazghul
- Fixed: #1222 MAGICF_IGNOREAR rendered armor useless even on non magic damage
- some cleanups regarding NPC accepting/rejecting items
- Added: Hungry NPC try to pick ripe crops if available
- Added: ACTP character property (like ACTDIFF, ACTARG etc.) to work with for 
  example ACTION 102
- Added: Poisoned Food (MOREz = poison strength [0..100]) will poison whoever 
  eats it; NPC might refuse eating poisoned food depending on their TasteID skill

15-07-2007, Ellessar
- Modified: Now you can get AREADEF regions from inside a multi with the help 
  of an additional "region" keyword (e.g. region.region.name).

17-07-2007, MrSugarCube
- Fixed: Multis from newer expansions not loading correctly.

17-07-2007, Admin BladeCraft (Script pack)
- Updated #1236: sphere_item_magic_weapon.scp, sphere_template.scp,
  sphere_backward_compatibility.scp (Changed misspelled defname 
  i_axe_war_VANQUISIHNG to i_axe_war_VANQ)
- Updated #1237: sphere_defs.scp (Fixed broken random templates)

18-07-2007, Nazghul
- Changed Ping Attack detection so that it only issues a warning if the "attack"
  comes from LocalAddress and/or 127.0.0.1

19-07-2007, MrSugarCube
- Added: Support for packet changes in client 6.0.1.7. With clients running
  on slower connections there may still be issues as Sphere cannot identify
  the 4th digit of the client version until after the client has logged in.
  If you want to override all 6.0.1.* clients to use the 6.0.1.7 packet
  changes (and thus correct the issue with slower connections, but at the
  same time remove support for 6.0.1.0-6 clients), find the following line
  in sphereCrypt.ini:
    0600010 02F2BA7ED 0A2817E7F ENC_TFISH // 6.00.10
  and change it to:
    0600018 02F2BA7ED 0A2817E7F ENC_TFISH // 6.00.18
- Added: FIXWEIGHT function for characters, which acts the same as FIXWEIGHT
  does on containers (recalculates the total weight of the items in their
  possession).

29-07-2007, Nazghul
- Just a fix in writing: Item tag.override_SKILL can also be written as
  tag.override.skill (as the other OVERRIDE tags)

04-08-2007, Ellessar
- Fixed #1239: Lumberjacking caused Sphere to crash, when failed.
- Fixed: ISNEARTYPETOP did not work as intented (also changes some hardcoded
  gathering related behavior.)
- Modified #1238: Sphere now tells you that you do not use SERV.MAP correctly
  and does not throw an exception.
- Fixed #1197: RANGE property was not inherited through ID property.

09-08-2007, MrSugarCube
- Fixed #1153: House placement checking a larger area than the multi region
  specifies.
- Fixed: Guards being attacked and calling new guards instead of fighting
  back properly.
- Fixed: Incorrect client version detection for client 6.0.1.10.

10-08-2007, MrSugarCube
- Fixed #753: Crafting skills no longer consume items that match the one
  you're attempting to create (unless the resources property specifically
  states that the item can be crafted from itself).
- Fixed #1138: Scripts could be loaded multiple times if the file extension
  was not provided.

10-08-2007, MrSugarCube
- Added: Support for AOS Custom Housing through a new item type 't_multi_custom'.
 > See the sphere_item_multis_foundations.scp and add-on/House_Placement
   scripts for examples of it's use.
 > Custom houses (t_multi_custom) will be saved to a new save file named
   spheremultis.scp.
 > Note that Sphere will require access to doors.txt, misc.txt, floors.txt,
   teleprts.txt, roof.txt, and  walls.txt from the UO folder as these provide
   lists of valid items. Also, all these items should exist in scripts for them
   to be added to a building - note that the default script pack is currently
   missing several sets of floors and walls.
 > New functions and properties have been added that can be used with items of
   the type t_multi_custom. These are:
   -- References --
    "DESIGNER"            The player currently designing the building.
   -- Properties --
    "COMPONENTS"   (r)    The number of components in the building design.
    "FIXTURES"     (r)    The number of fixtures in the building design (doors
                          and teleporters/t_door and t_telepad).
    "DESIGN.x.KEY" (r)    Accesses component x in the building design and
                          returns the given property. Possible properties are:
                            ID: The ID of the component.
                            DX: The x offset of the component.
                            DY: The y offset of the component.
                            DZ: The z offset of the component.
                            D:  The x,y,z offset of the component.
                            FIXTURE:  Returns 1 if the component is a fixture.
    "DESIGNER"     (r)    The uid of the player designing the building (or 0).
    "EDITAREA"     (r)    The editable range of coordinates when in design
                          mode (TopLeftX,TopLeftY,BottomRightX,BottomRightY).
    "REVISION"     (r)    The revision number of the building design.
   -- Functions --
    "ADDITEM id,x,y,z"    Adds an item to the building design (see COMMIT).
    "ADDMULTI id,x,y,z"   Adds a multi to the building design (see COMMIT).
    "CLEAR"               Wipes the building of all components (see COMMIT).
    "COMMIT"              Commits changes made to the building design.
    "CUSTOMIZE [uid]"     Enters the given player (or SRC) into design mode.
    "ENDCUSTOMIZE"        Forces the player to exit design mode.
    "REMOVEITEM id,x,y,z" Removes an item from the building design (see
                          COMMIT). If the given id is 0 then any items found
                          at the location will be removed.
    "RESET"               Resets the building to it's default state (see
                          COMMIT).
    "RESYNC [uid]"        Resends the building structure to the given player
                          (or SRC)
 > Players also have some new house design-related properties and triggers.
   These are:
   -- References --
     "HOUSEDESIGN"        The building this player is currently designing.
   -- Properties --
    "HOUSEDESIGN"(r)      The uid of the building this player is designing (or
                          0).
   -- Triggers --
    @HouseDesignCommit    Called on a character when they commit a new design.
                            ARGN1:    Number of components in the old design.
                            ARGN2:    Number of components in the new design.
                            ARGN3:    The revision number of the new design.
                            ARGO:     The building being designed.
                            LOCAL.FIXTURES.OLD:    Number of fixtures in the
                                                   old design.
                            LOCAL.FIXTURES.NEW:    Number of fixtures in the
                                                   new design.
                            RETURN 1: Block the commit.
    @HouseDesignExit      Called on a character when they exit design mode.
                            ARGN1:    Is set to 1 if the character being forced
                                      out of house design mode (ie. they're
                                      logging out).
                            ARGO:     The building being designed.
                            RETURN 1: Keeps the client in design mode (if ARGN1
                                      was 0).

10-08-2007, MrSugarCube (Script pack)
- Updated: sphere_defs.scp (Updated type defnames)
- Updated: sphere_item_building_walls.scp (Split i_wall_stone_4's DUPELIST into
  different defnames for different wall heights)
- Updated: sphere_item_ground_tiles.scp (Added a few missing water tiles and split the
  waterfall DUPELIST into different defnames for different waterfall heights)
- Updated: sphere_item_profession_alchemist_mage.scp (Set the types of i_rune_alchem_*
  items to t_telepad)
- Added: sphere_item_multis_foundations.scp (Added foundation multi definitions)
- Added: sphere_item_multis_stairs.scp (Added stair multi definitions)
- Added: sphere_item_building_roofs_aos.scp (Added AOS roof definitions)
- Added: sphere_item_building_roofs_ml.scp (Added ML roof definitions)
- Added: sphere_item_building_stairs_ml.scp (Added ML stair definitions)
- Added: add-on/House_Placement.zip (Added a sample script that allows custom houses
  to be design by players)

14-08-2007, Nazghul
- Modified: sphere_defs.scp, added DEATHFLAG_HASCORPSE (010) to deathflags. If set on
  a character like water elemental it will leave a corpse. Caveat: If DEATHFLAG_NOCORPSE
  and DEATHFLAG_HASCORPSE are set, the NOCORPSE takes precedence!

17-08-2007, Nazghul
- Added: Item CAN flag CAN_I_BLOCKLOS (see sphere_defs.scp). Works only if
  INI option AdvancedLOS is != 0.

18-08-2007, Nazghul
- Added: Spellflags TARG_NO_PLAYER and TARG_NO_NPC
- Updated: sphere_msgs.scp and sphere_defs.scp 

19-08-2007, MrSugarCube
- Fixed #1242: TAT_AS_ARGO Triggers not working with hexadecimal uids.
- Fixed #1243: MODAR on weapons not showing the correct minimum damage on the
  status window and tooltips.
- Fixed #1244: TAGAT.x.KEY and TAGAT.x.VAL returning the opposite properties.

21-08-2007, MrSugarCube
- Fixed #1246: Exception caused by using EQUIPWEAPON function on a character
  with no backpack.
- Fixed #1247: NPCs not moving closer to their targets when they're using a
  bow with a shorter range than the ini's archery range settings.

25-08-2007, Beyonder (Script pack)
- Fixed #815: sphere_item_resources.scp (i_blood_2 not decaying: Changed the
  definition so that i_blood_2 now has a weight)

30-08-2007, MrSugarCube
- Fixed #1248: Incorrect container weight shown on tooltips.

04-09-2007, coruja747 (Script pack)
- Updated #1251: sphere_map_points2.scp (Missing teleports in Wisp Dungeon)

05-09-2007, Furio
- Fixed #1254: Console error when guild member delete char.
- Fixed: Login relay problems from localhost.
- Added #1260: "Setup_Start acct" with IP on the same LOG line.
- Added #1261: Incognito names in kill logs.
- Added: CLEARCTAGS (working like cleartags for ctags).

06-09-2007, MrSugarCube
- Fixed: "GetMapBlock failed at x" errors when logging in or placing a multi
  over the edge of the map.

07-09-2007, Ellessar
- Fixed #1252: FloatVal not behaving correctly with negative numbers.
- Updated: sphere_msgs.scp (added login_lastlogged key)

08-09-2007, MrSugarCube
- Fixed: Character creation allowed whilst another character is still idling
  in the world.

11-09-2007, MrSugarCube
- Fixed #1256: Ship plank exit allowing players to pass over blocked paths,
  such as walls or fences.
- Modified: Added more "Bad Login x" codes along with expanded descriptions
  to assist in identifying login issues.

16-09-2007, coruja747 (Script pack)
- Fixed #1258: ctags will be cleared when leaving admin menu

16-09-2007, nazghul
- Fixed #1257: Custom damage type didn´t work with COMBAT_USE_RESISTANCE

22-09-2007, nazghul
- Added: TAG.OVERRIDE.RANGE on items and/or characters overriding the RANGE 
  property of the itemdef/chardef.

30-09-2007, nazghul
- Fixed: not-working tag override of SkillPracticeMax what may have caused 
  problems with Linux builds. Now TAG.OVERRIDE.PRACTICEMAX.SKILL_# 
  (with "#" == "40" for swordsmanship, "42" for fencing, etc.) on a training 
  dummy can override the INI default upto what skill value one can practice 
  with it.

02-10-2007, coruja747 (Script pack)
- Updated #1224: sphere_admin.scp (Added char updates when modifying flags)

03-10-2007, MrSugarCube
- Fixed #1269: Fixed house design commit issues on alternate maps.
- Fixed #1270: Fixed ISEVENT not working on regions.

04-10-2007, MrSugarCube
- Fixed: House components being affected by OF_OSIMultiSight.
- Fixed: DESIGN.x.KEY not working on custom housing.

06-10-2007, Fire-Dragon-Dol (Script pack)
- Updated #1274: sphere_map2.scp (Removed reference to non-existant resource)

15-10-2007, MrSugarCube
- Added #1283: FEATURE_ML_NINTHAGE feature flag in sphere.ini. Setting this
  enables the crystal and shadow components in custom houses.
- Fixed #1281: Unable to disembark ships on west-facing planks.
- Fixed #1278: Unable to craft crafting tools.

17-10-2007, Nazghul
- Changed: Behaviour of TAG.OVERRIDE.RANGE. Now the largest TAG value (on weapon 
  and/or char) takes precedence over the other.

18-10-2007, Nazghul
- Added: TAG.OVERRIDE.TRAINSKILLMAX and TAG.OVERRIDE.TRAINSKILLMAXPERCENT
  overriding the respective defaults from Sphere.INI based on an individual
  trainer (NPC).

19-10-2007, MrSugarCube
- Fixed #1293: Checkbox positions in dialogs not working with dorigin.
- Fixed #1292: House designer not working with RESDISP less than 3, a minimum
  client version of 4.0.0 is still required though.
- Fixed #511: Character spawn tooltip modified to avoid bad token ID messages
  with characters using random names (#NAMES_xxx).
- Fixed: Quest and Guild buttons on the paperdoll not working with RESDISP less
  than 3.

20-10-2007, MrSugarCube
- Fixed #1295: Radio positions in dialogs not working with dorigin.
- Modified: MAXCHARSPERACCOUNT limit has been raised to 7. Note that the client
  must support extra character slot(s) for them to be visible at the character
  selection menu, older clients can only display 5 or 6.
- Added: MAXCHARS property to accounts. Setting it to 0 will link it to
  MAXCHARSPERACCOUNT in the ini (default behaviour).

21-10-2007, MrSugarCube
- Fixed #1297: No resources lost when failing to craft.

26-10-2007, MrSugarCube
- Fixed #1304: Being able to light kindling whilst it is being dragged.
- Fixed #1300: Polymorphing whilst incognito'ed not updating the character's
  name correctly with creatures using random names (#NAMES_xxx).
- Fixed: Various means of removing game board pieces from their game boards.
- Modified #1303: ISTEVENT now works on items, exactly the same as it does with
  characters.

30-10-2007, MrSugarCube
- Fixed #1306: NPCs accepting every item given to them.
- Fixed #1298: Infinite loop caused by combat between two characters with the
  statf_reactive flag set and the reflected damage being greater than the
  original damage.

30-10-2007, Furio
- Fixed #1307: MySQL client running out of memory.

24-11-2007, Furio
- Fixed #1294: Error with the third parameter of "spelleffect". Now the third
  parameter refer to the current source if is -1. 
- Fixed #1318: Owned NPC's names and NPC's vendors commands.
- Fixed #1330: Problems with client and accounts with 16 characters.
- Fixed #1345: Clear Party TAG's.
- Added: Support for login protocol in 6.0.5.0+ clients.
- Added #1329: Max dist to park boats (see sphere.ini MaxShipPlankTeleport).
- Added #1296: "trigger" function returning the values returned by @CustomTrigger.

25-11-2007, MrSugarCube
- Fixed #1284: Multi regions being overlapped by area regions when map files are
  resynced.
- Fixed: Mount items are now adjusted using the RES* settings on the ride
  itself, to display themselves appropriately to lower RESDISP clients.

25-11-2007, Elric (Script pack)
- Updated: sphere_item_aos_se.scp (Removed duplicate item definitions)
- Updated: sphere_item_building_walls_se.scp (Removed duplicate item
  definitions)
- Updated: sphere_item_misc_se.scp (Removed duplicate item definitions)
- Updated: sphere_item_ml_floor_wall.scp (Removed duplicate item definition)
- Updated: sphere_item_provisions_armor_ml.scp (Corrected Vulture Helm item
  definition)
- Updated: sphere_item_unsorted.scp (Removed duplicate item definitions)

27-11-2007, MrSugarCube
- Fixed #1323: Criminal status for attacking dead players.
- Fixed #1250: Exception with region triggers.
- Fixed #1017: Magery skill being used for all spells. Now the first skill listed
  in the spell's SKILLREQ line will be the action used when casting. Note that
  unexpected things will happen if you've set this to be a non-magic skill (for
  example, Begging), so make sure the SKF_MAGIC flag is set on such skills.
  
14-12-2007, coruja747 (Script pack)
- Updated: sphere_item_building_walls_se.scp (Missing item 02753)
- Updated: sphere_item_deco_evilitem.scp (Incorrect dupeitem on itemdef 02a59)
- Updated: sphere_item_christimas.scp (Incorrect RESDISPx settings on i_Sleigh)
- Updated: sphere_map_points2.scp (Inaccessible teleports on Exodus Dungeon)

21-12-2007, MrSugarCube
- Modified: Ships now move 2 spaces at a time instead of 1. This reduces a lot
  of lag caused by ship movement and also fixes overhead messages disappearing
  whilst the ship is in motion.
- Added: SHIPSPEED property to ship ITEMDEFs. This controls how often and how far
  the ship will move. SHIPSPEED.PERIOD and SHIPSPEED.TILES can be used to return
  the separate values. Usage:
    "SHIPSPEED=5,3"     Ship will move 3 tiles every half a second.
    "SHIPSPEED=1,5"     Ship will move 5 tiles every tenth of a second.
    "SHIPSPEED=20,2"    Ship will move 2 tiles every 2 seconds.
  Note 1: If there is less space available than specified by SHIPSPEED.TILES,
  the ship will still move as far as possible before stopping (so if a ship is
  set to move 10 tiles and is heading towards a coast that is 16 tiles away, the
  ship will move 10 tiles, then 6 tiles, and then stop.
  Note 2: TAG.OVERRIDE.SHIPSPEED.PERIOD and TAG.OVERRIDE.SHIPSPEED.TILES can also
  be set on the ships themselves to override their speed on an individual basis.

22-12-2007, Nazghul
- Added: Triggers @NPCAction and @NPCSpecialAction
  @NPCSpecialAction
  If the NPC has a lot of spare time (i.e., nothing else to do) it
  looks for some special action. For example, giant spiders lay webs,
  and fire elems leave fire patches. This trigger fires on ANY type
  of creature. If you return 1, it will not do it's special action,
  on return 0 it will (what, as said above, will only be true with
  giant spiders and fire elems; you can script other NPC special
  events yourself).

  @NPCAction
  AI-related trigger. If the situation is so the NPC will do something
  due to it's AI - things like animals pooping the ground, vendors
  going off/on duty, (un)equipping a lightsource when it's dark, 
  (un)equipping a weapon when fighting, stabler feeding animals or
  giving players food for their animals etc. - (once hardcoded behaviour
  was planned also for beggars who should sleep at night, for thieves,
  undead mages, healers, and more, but never realized. Now you can script
  this yourself) this trigger will be fired. On RETURN 0 
  the NPC will continue with what it wants to do, RETURN 1 will abort it.

  Both triggers will fire only if EF_NPCAct_Triggers is SET and 
  EF_Minimize_Triggers is NOT SET in the sphere.INI. SO if you don't
  change your INI, everything will stay as it was before.

22-12-2007, MrSugarCube
- Fixed #1341: Arguments not being parsed correctly for commands entered
  on the console.
- Fixed #1331: Script verbs not being parsed correctly when there is a
  space in them (ie. TAG.xxx_<EVAL yyy> = zzz).

04-01-2008, Nazghul
- Added: Triggers @Mount and @Dismount, both are character trigger, firing 
	when a character tries to mount/dismout it's ride (and will be able to).
  @DISMOUNT
    ARGO is the UID of the (still disconnected!) pet.
    RETURN 1 stops the dismount process.
  @MOUNT
    ARGO is the UID of the NPC bound to be ridden.
    RETURN 1 stops the mounting process.

19-01-2008, MrSugarCube
- Fixed #1351: Gaining tactics when fighting players in no-pvp regions.
- Fixed #1337: Foundations of custom housing deletable by players.
- Fixed #1132: Maps other than #0 not showing up when logging in.
- Added #1003: ACTPRV property to characters. This is used in some skills, 
  for example with magery to hold the source of the spell (character, wand, 
  scroll, etc).
- Fixed: CALL not working with object references. (eg. "CALL src.myfunction")
- Fixed: ++/-- in scripts being parsed as +=1 when not being used as operators.

19-01-2008, MrSugarCube (Script pack)
- Updated #1360: sphere_admin.scp (Fixed blank client list when using .admin twice)
- Updated: sphere_backward_compatibility.scp (Added NpcCast function, which can be 
  used to make a character start casting a spell)

19-01-2008, Furio
- Fixed #1324: Undefined Symbols on attacker when accessing a bad attacker #
- Fixed: isneartype not searching through all statics.
- Updated: sphere.ini with missing values.
- Added #1358: now serv.newitem has a 4th argument if set to 1 trigger @Equip will
  be called upon item equipping.
- Added: SERV.MAPLIST.$mapid.$prop to cycle through maps to get props. The list of
  properties that can be accessed (read only) are:
  BOUND.X = maximum x for the map
	BOUND.Y = maximum y for the map
	CENTER.X = x coord of map center
  CENTER.Y = y coord of map center
	SECTOR.SIZE = size of sectors
	SECTOR.ROWS = qty of sector rows for the map
  SECTOR.COLS = qty of sector columns for the map
  SECTOR.QTY = total number of sectors for the map
- Added: FeatureKR and Kr reslevel (6). Guess what they do (it's a wip).
- Added: EF_UseNetworkMulti (00800000) to experimental flags. Tired of crashing due
  too many items/npcs, try it. Don't change it while the server is running.
  (Thx to Z. for the windows version)

21-01-2008, MrSugarCube
- Fixed #1311: NPC Pathfinding failing when EF_DiagonalWalkCheck is enabled.
- Added #738: Combat flag COMBAT_STAYINRANGE. Causes out-of-range attacks to fail
  at the end of the swing instead of waiting until the target is in range.
- Added: WEATHER property to sectors, sets or gets the current weather.

22-01-2008, MrSugarCube (Script pack)
- Updated #1107: sphere_genericstone_functions.scp (added function to control or 
  override ally status between guilds (f_stonesys_internal_isalliedwith), see
  comments for details)

24-01-2008, MrSugarCube
- Fixed #1363: Players unable to pick up single items from heavy stacks.

31-01-2008, Nazghul
- Fixed #989: Fame-titles will not be shown on NPC anymore if INI option NPCNoFameTitle
  is set.

31-01-2008, MrSugarCube
- Fixed #1372: EF_NewPositionChecks causing fishing to fail from boats when
  AdvancedLos is disabled.
- Fixed: ADVANCEDLOS_PLAYER enabling AdvancedLos for all characters including
  NPCs (ADVANCEDLOS_NPC being ignored).

02-02-2008, Furio
- Added DIALOGLIST keyword. DIALOGLIST.COUNT gives the number of open gump dialogs,
  DIALOGLIST.$x.ID ($x = a number between 0 and DIALOGLIST.COUNT-1) the ID of the
  respective gump dialog, and DIALOGLIST.$x.COUNT the number of active instances of
  this dialog. So to close a specified gump, DIALOGCLOSE <DIALOGLIST.$n.ID> should do.
- Added KRTOOLBARSTATUS (prop/verb) and @UserKRToolbar (ARGN1 type, ARGN2 arg) to
  interact with the hotbar in the KR client.

03-02-2008, Shadow Dragon
- added @KarmaChange, @FameChange. Called when Karma/Fame adjusting.
  ARGN1 = Karma/Fame modifier, it's writable.
  return 0 will use Argn1 value in adjusting.
  return 1 will break adjusting.
  return 2 will ignore Argn1 and continue default adjusting.
  Both triggers work only when EF_Minimize_Triggers isn't set.

07-02-2008, MrSugarCube
- Fixed #718: Ships unable to travel over static water tiles.
- Fixed #1378: Armour rating being factored in twice during damage calculations.

11-02-2008, MrSugarCube
- Fixed #1406: Newly created characters not starting with the MALE_DEFAULT / FEMALE_DEFAULT
  newbie templates.
- Fixed: Exception caused by using ARGO.Verb when argo is not set.
- Modified: "Vendor uid=xxx selling unmovable item" message no longer shown when
  listing the items that a player can sell to a vendor.

27-04-2008, MrSugarCube
- Fixed #1404: Restoring custom house design without first making a backup allowing players
  to remove the entire house foundation.
- Fixed #1398: Lightning spells causing @EnvironChange to be called on nearby characters.
- Fixed #1381: Maps with non-matching courses plotted can be stacked.
- Modified #1389: Character list to show filled character slots that are over the account's
  limit (eg. account containing 7 characters shows all 7 even when the limit is 5 ,assuming
  the client is capable of displaying all 7).

27-04-2008, coruja747 (Script pack)
- Updated #1402: sphere_item_building_walls_se.scp (Fixed empty dupelist property)

27-04-2008, Mordaunt (Script pack)
- Updated: sphere_item_multis_foundations.scp (Added the remaining house foundation sizes)

28-04-2008, MrSugarCube
- Fixed #1394: Advanced pathfinding (NPC_AI_PATH) allowing NPCs to make invalid movements
  (for example walking whilst paralyzed). Some other adjustments have also been made,
  allowing NPCs to properly assess characters that may be blocking the way (to walk around
  them), negotiate corners with EF_DiagonalWalkCheck enabled, and attempt to compensate
  when new obstacles block a previously valid path.
- Fixed #1390: Locals not working in SKILLMENUs.

28-04-2008, coruja747 (Script pack)
- Updated #1392: spherechar_new_mounts.scp, spherechar_mondains_legacy.scp (Updated
  RESDISPDNHUE property on rides)

02-05-2008, MrSugarCube
- Fixed #1348: Problem where <SERV.ResourceType.Id> returns 1 when the id is a different
  resource type (e.g. <SERV.TEMPLATE.i_dagger> (dagger being an item not a template)).

15-05-2008, Shadow Dragon
- Added LAYER_AUCTION that can contain container on character for script purposes, like
  auction system.

19-05-2008, Shadow Dragon
- Modified: GOLD property adds new gold stacks to bankbox.

21-05-2008, Nazghul 
- Added: Combat flags to Sphere.ini to allow stacking armor and aimed hits. Example of usage
  is in scripts/AddOns. 
  Aimed hits are controlled by tags on the "hitter": TAG.HITPREFERENCE holds the targetted
  zone: 1=head, 2=neck/throat, 3=back, 4=chest, 5=arms, 6=hands, 7=legs, 8=feet (if the value
  is out of this range it will be changed by %9; "0" means: no preference set);
  TAG.HITPREFERENCE_CHANCE (0..1000) is the chance to really hit the desired area;
  TAG.HITPREFERENCE.BONUS is the percent the damage is raised when hit where desired,
  TAG.HITPREFERENCE.PENALTY is the percent the damage is lowered if the area was missed.
  The last two values are defaulting to "30".
  The system is perhaps useful to script a system where a player can look for weak armored
  bodyparts of his opponent and try to hit him there; could be essential if armor stacking
  is used.

23-05-2008, MrSugarCube
- Fixed #1418: Tracking being used to reveal the location of invisible staff members.
- Fixed #1417: Unable to access account properties using [SERV.]ACCOUNT.x.KEY where account
  x begins with a number.
- Fixed: Characters "drifting to shore" when logging in on a ship.
- Fixed: Variety of exceptions caused when items are being set to type t_eq_memory_obj after
  after creation.
- Modified: RESTOCK function on vendors now accepts a parameter to specify whether or not
  new stock should be spawned immediately (0=empty existing stock (default), 1=empty stock
  and spawn next set).

26-05-2008, MrSugarCube
- Fixed: Code not being skipped properly when incorrect loop syntax is used.
- Modified: @UserVirtue trigger now has 2 arguments:
   ARGO  = The character whose virtue button has been pressed
   ARGN1 = The button ID pressed (1=virtue button (on paperdoll), 105-112=icons within the
           menu)
           Note: Clients only specify the character they're viewing (ARGO) when pressing the
           paperdoll button (ARGN1=1)
- Added: @UserVirtueInvoke trigger, called when a virtue is invoked through client macros.
   ARGN1 = The virtue ID (1=Honor, 2=Sacrifice, 3=Valor)

27-05-2008, MrSugarCube
- Modified: ARGN2 in @SkillChange trigger is now writeable.

27-05-2008, MrSugarCube (Script pack)
- Updated: sphere_msgs.scp (Added 2 more "tracking_*" defmessages)

25-06-2008, MrSugarCube
- Modified: Installing Sphere as a Windows service (using "-k install" with NTService=1) will
  now configure the service with an automatic restart configuration.

02-07-2008, MrSugarCube
- Fixed #1439: NPC_AI_MOVEOBSTACLES allowing NPCs to move items whilst paralyzed.
- Added #850: @SpellSuccess trigger, fires on the caster just before the @Success trigger is
  fired on spell blocks.

04-07-2008, MrSugarCube
- Fixed #1177: Client command parsing using brackets as argument separators.
- Fixed #1097: Possible infinite loop involving circular ownership (e.g. two characters set as
  owners of each other).

04-07-2008, MrSugarCube (Script pack)
- Updated #1443: sphere_guild_dlg_charlist.scp, sphere_guild_promptconsole.scp,
  sphere_town_dlg_charlist.scp, sphere_town_promptconsole.scp (Fixed guild and town stones
  using TITLE property instead of GUILDTITLE)

04-07-2008, Nazghul
- Added: skilltitles "Elder" and "Legendary"

05-07-2008, MrSugarCube (Script pack)
- Updated #1130: sphere_msgs.scp (Removed tracking_dis* defmessages and replaced them with
  simpler tracking_result* defmessages)

06-07-2008, Nazghul
- Added: SPELLFLAG_NOPRECAST what disbles PRECASTING on a per-spell-base.
  Only valid if PRECAST is activated by Sphere.ini

08-07-2008, MrSugarCube
- Fixed #1446: GM/MT_FLY enabled characters walking through stairs when EF_WalkCheck is not
  enabled. [Note: Due to potentially negative side-effects of this fix a temporary EF flag
  (EF_NoWalkingThroughStairsFix) has been added to sphere.ini which disables the fix just in
  case something bad happens (if no issues are reported that are caused by this fix then you
  can expect it to disappear very soon)]

10-07-2008, MrSugarCube
- Fixed ##3: Unstackable items becoming stacked after being bought off a player-owned vendor,
  when the buyer cannot carry the items.
- Fixed ##2: NPC_AI_FOOD causing NPCs to get stuck whilst they attempt to eat grass from a
  tile where grass has already been eaten from recently.

13-07-2008, Beyonder
- Fixed ##1: Sphere crashes with Experimental Flag UseNetworkMulti.
- Added: LOCAL.FIELDWIDTH and LOCAL.FIELDGAUGE to @SpellSuccess and @Success
  triggers.
  LOCAL.FIELDWIDTH sets the width of the field from character point of view.
  LOCAL.FIELDGAUGE sets the thickness of the field.
- Fixed #1449: Damage spells backfire when selecting summon while casting.

15-07-2008, Beyonder
- Added: Extra local arguments to @SkillStart and @Start (skill section) triggers for crafting 
  skills:
  LOCAL.CRAFTITEMDEF - the UID of defname of the item we are currently crafting. Readable/Writable.
  Accepts ONLY UIDs of ITEMDEFs, for example:
	if (<LOCAL.CRAFTITEMDEF> == <DEF.i_katana>)
		LOCAL.CRAFTITEMDEF = <DEF.i_sword_long>
	endif
  LOCAL.CRAFTSTROKECNT - amount of strokes character makes while creating the item. Each stroke 
  has DELAY specified in SKILL section. Readable/Writable.
  LOCAL.CRAFTAMOUNT - amount of items that will be created. Only usable for REPLICATable items,
  otherwise will make no effect. Readable/Writable.
- Modified: @Destroy on items and characters is triggered before deletion, not after. This way
  all of the item/character properties are fully accessible.
  "return 1" forbids deletion. WARNING! putting return 1 in this trigger means it won't be deleted
  in any possible way! Use it with caution.

15-07-2008, MrSugarCube
- Fixed: World saves being aborted when they are taking a long time to complete.

20-07-2008, MrSugarCube
- Fixed #1459: Weather effects not being updated when walking in/outdoors.
- Fixed #1458: ARGV[x] not being updated when ARGS is set to a new value.

20-07-2008, Coruja (Script pack)
- Updated #1457: sphere_items_multis_houses_ships.scp (Corrected sign height and door type for the
  stone and marble shops)
- Updated #1456: spherechar_new_mounts.scp (Added FOODTYPE for c_giant_beetle)

24-07-2008, Coruja (Script pack)
- Updated #1465: sphere_spells.scp (Wrong spellflag for MARK spell)

02-08-2008, MrSugarCube
- Fixed #1475: Undefined keyword error when using 'REGION.ALLCLIENTS' in a region with no clients.

08-08-2008, MrSugarCube
- Fixed #1479: Custom layer values not being restored correctly when loading from world save.
- Fixed #1470: Entering house customization with open dialogs causing the sphere to lose track of
  which dialogs are still open on the client.
- Fixed #1468: Exiting house customization mode sending characters to the house sign's height
  instead of ground level.

09-08-2008, MrSugarCube
- Fixed #1476: Players under the incognito spell being unable to read other players' profile
  scrolls.
- Fixed #1033: Mass Curse spell not affecting character stats.
- Modified #963: ARGN1 in @[item]DropOn_Ground can now be used to read/write the decay time (in
  tenths of a second) that will be set on the dropped item.

10-08-2008, Coruja (Script pack)
- Updated #1486: sphere_map_points4.scp (Added teleports for Yomotsu Mines and Fan Dancer's Dojo)
- Updated #1485: sphere_map3.scp (Added missing Malas locations)
- Updated #1480: sphere_map_points0.scp, sphere_map_points1.scp (Incorrect teleports for Ice
  Dungeon)

11-08-2008, MrSugarCube
- Fixed #1483: Issues with trying to load scripts from directories outside of where the Sphere
  executable is located.

12-08-2008, MrSugarCube
- Fixed #1489: Longer ships being able to manoeuvre themselves into invalid positions.

13-08-2008, MrSugarCube
- Fixed #1490: Formatting error when showing murderer/criminal title on the paperdoll.

14-08-2008, MrSugarCube
- Fixed #1484: Client showing the wrong season and light level upon login.

16-08-2008, Nazghul
- Added: Character Trigger @UserQuestArrowClick what fires if the user clicks on the quest arrow.
  No RETURN value checks, ARGN1 is the mouse button used (0=left, 1=right). Trigger works only
  with EF_MinimizeTriggers disabled.

22-08-2008, MrSugarCube
- Fixed #1496: Female NotoTitles not always being shown on the paperdoll.

25-08-2008, MrSugarCube
- Fixed: @Dismount trigger being fired multiple times under certain circumstances.

26-08-2008, Shadow Dragon
- Fixed: Skills doesn't gain when lower than 1.8
- Added: New trigger @AfterClick and @ItemAfterClick. LOCAL.ClickMsgText will contain text, that
  will be shown after click on object, LOCAL.ClickMsgHue will contain color of the message. Both
  locals are writable. RETURN 1 - will cancel showing text. Requires EF_New_Triggers to be
  enabled.
- Fixed: Mounts removing when world save (error: Ridden NPC without a mount item).

31-08-2008, MrSugarCube
- Added #1507: REVERT function to custom housing (t_multi_custom), calling this will clear any
  uncommitted changes that have been made to the building design.

03-09-2008, Nazghul
- Added #1504: Optional second parameter "amount" to MAKEITEM. Please understand that the
  "additional" items crafted will neither fire any trigger, nor give experience or skill. So,
  from that point of view there's no difference between "MAKEITEM i_dagger" and "MAKEITEM i_dagger,10"
  (except for the number of daggers created). If the resources you have are insufficiant for
  the amount, it will be shortened respectively.

08-09-2008, MrSugarCube
- Fixed #1514: Players and NPCs unable to cast spells.
- Fixed #1508: Dropped items stacking regardless of their difference in height.

09-09-2008, MrSugarCube
- Fixed #1516: NPCs unable to use pathfinding when trying to follow or walk up to another character.

13-09-2008, MrSugarCube
- Added: BASECOMPONENT property to multis. Usage is similar to COMPONENT except it returns
  information for the components specified in the mul files, and when accessing
  individual components (BASECOMPONENT.n.[ID/DX/DY/DZ/D] there is an additional "VISIBLE"
  property which returns 0 if the component is invisible (usually applies to doors and signs).

16-09-2008, Nazghul
- Added: Override Tags for item/action related sound.
  TAG.OVERRIDE.DOORSOUND_CLOSE / TAG.OVERRIDE.DOORSOUND_OPEN 
    (what it does should be obvious)
  TAG.OVERRIDE.PORTCULISSOUND - holds an sfx number played when 
    opening/closing a portculis
  TAG.OVERRIDE.DROPSOUND - sfx an items makes when dropped. Att:
    system default sounds sometimes change due to the amount dropped
    (gold, ingots), or on what surface/item the item is dropped. All
    this will be overridden!
  TAG.OVERRIDE.SOUND_HIT - on weapons holds the sound when it hits,
    regardless of WHAT it hits!
  TAG.OVERRIDE.SOUND_MISS - on weapons, sound they make when missing

  all TAGs need to hold a number (defname MAY be possible -> test!),
  what also can be "0" (zero) with the meaning: don't play any sound.

17-09-2008, Nazghul
- Added: Trigger @PICKUP_STACK what fires only if an item was picked up from a pile.
  ARGO is the remaining part of the stack. (There's a char trigger itemPICKUP_STACK
  also)

18-09-2008, Nazghul
- Added: TAG.OVERRIDE.RUNNINGPENALTY and TAG.OVERRIDE.STAMINALOSSATWEIGHT to
  override the respective INI settings on a per character base

28-09-2008, Shadow Dragon
- Fixed: Sphere crashing when injection tries to add one item to another non-container item
  (errors in injection script and so).

26-10-2008, MrSugarCube
- Fixed #1540: Server crash when invalid parameters are passed into RTIME.FORMAT.
- Fixed #1539: Infinite loop caused by "back" options on SKILLMENUs leading to a server crash.
- Fixed #1538: Possibility of quickly gaining arms lore skill through repairing, by repeatedly
  attempting to repair an item that cannot be repaired.
- Fixed #1518: Possibility of world save notification not being broadcasted.
- Fixed #1510: IsNum not working with negative numbers.
- Fixed #1158: Possibility of the statf_fly flag not being removed from players who have been stood
  still for some time.
- Fixed: "You can't think of a way to use that item." when failing to repair an item.
- Modified: EVENTSPLAYER, EVENTSPET and EVENTSREGION settings now accept a comma-delimited list of
  events.

26-10-2008, MrSugarCube (Script pack)
- Updated #1535: sphere_defs.scp (Corrected sounds for snd_rune_beetle through to snd_hiryu)

02-11-2008, MrSugarCube
- Added #1499: CanUndressPets setting to sphere.ini. Setting this to 1 will enable players to
  take equipment from their pets' paperdolls.

29-11-2008, MrSugarCube
- Fixed #1553: Repairing an item does not update its tooltip.
- Modified: IsNearType (including IsNearType.P) now accepts a third parameter, which when set to 1
  will cause the function to include multi components in the search.
- Added: New mt_mount flag (00400) which will allow character bodies to become capable of mounting
  rides. Note that this flag is not required for the bodies that could already mount rides prior
  to this flag's existence (c_man/c_woman/c_man_gm/c_elf_man/c_elf_woman). Also be aware that not
  all character bodies are intended to be used for mounting rides and won't have proper riding
  animations.

29-11-2008, MrSugarCube (Script pack)
- Updated: sphere_defs.scp (Added mt_mount to the can_flags defname section)

05-12-2008, MrSugarCube
- Fixed: Server crash caused by exceedingly large dialogs being sent to clients.

06-12-2008, jeem (Script pack)
- Updated #1555: sphere_guild_dlg_charlist.scp, sphere_town_dlg_charlist.scp (Fixed script error
  when showing guild member titles)

07-12-2008, MrSugarCube
- Added #1086: Skill degradation for skills that have been set to decrease. @SkillChange trigger
  is called for decaying skills just as it does when they gain (compare <ARGN2> to <<ARGN1>> to
  determine if the skill is being increased or lowered).
- Added: Experimental flag EF_UseNetworkMultiVersionMod. This modifies the behaviour of the
  EF_UseNetworkMulti flag (don't forget to set this too) so that clients older than 4.0.0 will
  be unaffected and continue to use the original networking code as if the EF_UseNetworkMulti
  flag was never set.

03-01-2009, Dwayne1988 (Script pack)
- Updated: spherechar_human.scp, spherechar_evil.scp (Axis Tags were messed up, came after
  @NPCRESTOCK _and_ had a leading TAB so Axis won't find them)

24-01-2009, MrSugarCube
- Fixed #1572: Exception on Linux builds when mounting a horse.
- Fixed #1569: @UserWarmode trigger not being fired.
- Fixed #1568: Default webpage paths in Sphere.ini not valid for Linux.
- Fixed #1532: Added log message to indicate the account name being referred to when an account
  is already in use, blocked, or cannot log in due to CLIENTMAX setting.

28-01-2009, Shadow Dragon
- Added: SERV.RTicks for reading purposes. Returns real system time in ticks as unsigned value (0..4294967295).
- Added: UVAL, which works like EVAL, but for unsigned values.

01-02-2009, Shadow Dragon
- Added: Basic LIST support.
  LIST.xxx to show elements in list. Also, can be used like LIST.xxx=value to clear list and add a value
  LIST.xxx.ADD to add new element to list, can be number or string
  LIST.xxx.CLEAR to clear list
  LIST.xxx.index to read/write value on element in list
  LIST.xxx.COUNT to get count of elements in list
  LIST.xxx.index.REMOVE to remove element at specified index in list
  LIST.xxx.index.INSERT to insert element at specified index in list
  LIST.xxx.FINDELEM search_value returns index of first found element in list. Search starting from begin
  LIST.xxx.index.FINDELEM search_value returns index of first found element in list. Search starting from index
  SERV.PRINTLISTS to print all lists and their elements
  SERV.CLEARLISTS to clear all lists. If used with mask parameter, then clear all lists, which name countains specified mask
- Added: SERV.Map.x.AllSectors some_verb_to_use
  If used not in this syntax, then gives old error about MAP is readonly.

08-02-2009, MrSugarCube
- Fixed #1517: Unable to cast polymorph spell.
- Fixed: Possible infinite loop when creating fight memories in scripts.

09-02-2009, Coruja (Script pack)
- Updated #1576: sphere_item_profession.scp, sphere_item_deco_dungeons_traps_dead.scp (Corrected
  portrait DUPELISTs)

15-02-2009, MrSugarCube
- Modified #1545: JOINASMEMBER function no longer requires that the new member be online.
- Fixed: Unable to connect to local server with an encrypted client when it decides to reuse its
  login server connection instead of open a new one.

21-02-2009, MrSugarCube
- Fixed #1571: Creating a player with a hyphen or period in its name causing a random name to be
  generated.
- Fixed #1548: Armor MODAR being factored in twice when calculating total armour value, and sometimes
  character MODAR being factored in twice when calculating damage.
- Fixed: Messages such as "You can't reach anything in your state." and "You can't think of a way to
  use that item." being sent to players as they try to free themselves from spider webs.
- Added #1564: PetsInheritNotoriety setting to sphere.ini. This can be used to specify which
  notoriety flags a pet will inherit from its master (so if for example a pet has an evil owner
  and the NotoEvil flag is set then the pet will also show as evil regardless of its real notoriety).

22-02-2009, MrSugarCube
- Fixed #1575: Improved handling of unicode speech in Linux build.
- Fixed #1537: TEST in skillmenus not being parsed in the same way as TESTIF.

26-02-2009, MrSugarCube
- Modified #1560: Separated PROMPTCONSOLE from the targeting system. Targeting no longer interferes
  with prompts and vice-versa.

14-03-2009, MrSugarCube
- Fixed #1585: Multiple arguments not being passed into commands when using the syntax
  [SERV.]ACCOUNT <name> <command> <args>

20-03-2009, MrSugarCube
- Fixed #1586: Exception in Linux build when using the ADDCLILOC function with DEBUGF_SCRIPTS enabled.
- Fixed: Exception when passing an invalid object uid into the NEWDUPE function.

21-03-2009, MrSugarCube
- Fixed: Crashes with EF_Unicode enabled on Linux builds.
- Fixed: SuppressCapitals causing speech to be blanked out.

22-03-2009, MrSugarCube
- Fixed #1557: Sphere only sending partial webpages to certain browsers such as FireFox.
- Fixed: Sphere only sending partial webpages to all browsers when EF_UseNetworkMulti is used.
- Modified: EF_UseNetworkMultiVersionMod now also disables the effects of EF_UseNetworkMulti for HTTP
  clients.

29-03-2009, MrSugarCube
- Fixed #1589: TWOHANDS returning 1 with items that are equipped in the second hand but aren't
  two-handed, such as shields and lanterns.

04-04-2009, MrSugarCube
- Fixed #1588: Possibility of overflow when applying markups to vendor prices (note that prices are
  limited to a maximum of 2,147,483,647gp inclusive of markup).

10-04-2009, MrSugarCube
- Fixed: Server crash caused by deeply nested SKILLMENUs.
- Modified: Menu options are no longer hidden from SKILLMENUs when Sphere is unable to fully search
  within them.

13-04-2009, MrSugarCube
- Added: SERV.RTICKS.FROMTIME year,month,day,hour,minute,second. Returns the timestamp for the given
  date.
- Added: SERV.RTICKS.FORMAT timestamp[,format]. Converts the given timestamp into a formatted date
  string (similar to SERV.RTIME.FORMAT).

14-04-2009, MrSugarCube (Script pack)
- Updated #1497: sphere_item_multis_houses_ships.scp (Fixed ship masts not blocking line of sight)

19-04-2009, MrSugarCube
- Fixed #1586: Possible exception when checking line of sight near multis when AdvancedLos is enabled.
- Fixed #1495: Ghosts able to teleport through walls when resurrecting. Line of sight is now required
  for a ghost to resurrect with their corpse.
- Fixed: Exception when EF_NewPositionChecks is enabled and there are statics placed on the map which
  don't have scripts.

19-04-2009, MrSugarCube (Script pack)
- Updated #1469: sphere_item_ground_tiles.scp (Corrected height of i_waterfall_low)

25-04-2009, MrSugarCube
- Modified: Jailing players (".JAIL cell#" command) now remembers the cell number that was specified,
  stored in Tag.JailCell on the account and used when returning players to jail.
- Modified: Jailed players are no longer blocked from being teleported within the jail region.

25-04-2009, MrSugarCube (Script pack)
- Updated: sphere_map0.scp (Renamed individual jail AREADEFs to jail cell ROOMDEFs)

02-05-2009, MrSugarCube
- Fixed #1581: Characters unable to see objects that are in the corners of their visual range.

03-05-2009, MrSugarCube
- Fixed #1526: No decay timer set on lights after they become unlit.

04-05-2009, MrSugarCube
- Fixed: Objects on the corners of .EXTRACT, .NUKE, .NUKECHAR areas not being affected by the command.

05-05-2009, MrSugarCube
- Fixed #1451: Missing mana checks, skill checks and @Select triggers not being fired before casting,
  when precasting is enabled.
- Modified: Separated the movement behaviour of the MAGICF_PRECAST flag into a new MAGIC_FREEZEONCAST
  flag. Enable MAGICF_PRECAST to enable casting before targeting, and enable MAGICF_FREEZEONCAST to
  prevent characters from moving whilst casting (enable both to retain the previous behaviour of
  MAGICF_PRECAST). Also added SPELLFLAG_NOFREEZEONCAST to disable the effects of MAGICF_FREEZEONCAST
  for individual spells.

06-05-2009, MrSugarCube
- Added #1599: SpellTimeout setting to Sphere.ini. If set to a value greater than zero then when
  casting a spell the player is given this many seconds to choose a target before the spell is
  automatically cancelled.

16-05-2009, MrSugarCube
- Modified #1610: Cure spell just sends the packet needed to update the health bar rather than sending
  a full refresh of the entire screen.
- Added #1609: MAGICF_SUMMONWALKCHECK flag to ensure that summoned creatures can only be successfully
  summoned on tiles that are walkable for them (i.e. a sea creature can only be summoned on water).

16-05-2009, MrSugarCube (Script pack)
- Updated: sphere_msgs.scp (Added msg_summon_invalidtarg defmessage)

18-05-2009, MrSugarCube
- Added #1466: MAGICF_NOFIELDSOVERWALLS flag to enable additional checks when casting field spells to
  prevent them from passing through blocking objects (CAN_I_BLOCK and/or CAN_I_DOOR).

20-05-2009, MrSugarCube
- Added #1604: PROMPTCONSOLEU function. This is an alternative to the PROMPTCONSOLE which enables the
  client to respond with unicode text.
- Added: SYSMESSAGELOCEX, an extended version of SYSMESSAGELOC which can be used for sending localized
  messages to clients with a non-localized string attached to the start or end of the message. SMSGLEX
  can also be used as a shortcut.
  Syntax is: "SYSMESSAGELOCEX color,clilocid,flags,affix[,arguments]"
  All arguments must be separated by a comma ",". Specify -1 for color if you do not wish to override
  it. Known possible values for flags are:
    0x00 = Append text to message
    0x01 = Prepend text to message
    0x02 = Forces message to show as a system message
  A couple of examples of this being used (latest clilocs) are:
   "SYSMESSAGELOCEX -1,1008078,01,MrSugarCube"                    - Displays "MrSugarCube : Attempting to heal you."
   "SYSMESSAGELOCEX -1,3002003,00,Smoking is bad for your health" - Displays "Note to self:  Smoking is bad for your health"
  For overriding messages in sphere_msgs.scp (or other message functions such as SAY and MESSAGE) the
  syntax "@hue,font,3 clilocid,flags,affix[,arguments]" can be used, for example:
   "SAY @022,,3 1008097,01,MrSugarCube"                           - Object says "MrSugarCube : poisoned you!" in red

30-05-2009, Nazghul
- Fixed: @GetHit always gave damagetype type (argn2) 0C02 (physical | slash | pierce). Now the type is set 
  to dam_physical, dam_slash or dam_pierce is added depending on weapon type (wrestling and mace weapons
  don't set extra flags).
- Added: TAG.OVERRIDE.DAMAGETYPE for weapon type items. Holds a numerical value and overrides the
  type specific damage type.

20-06-2009, MrSugarCube
- Fixed #1617: Dispel and Mass Dispel spells sending an unnecessary full client update to all players
  touched by the spell.

21-06-2009, MrSugarCube
- Added #1627: PlayerEvil setting to Sphere.ini. Similar to the PlayerNeutral setting, this
  will control the karma level at which a player will be considered evil.

25-07-2009, MrSugarCube
- Added: Support for packet changes found in client 6.0.14.2.

02-08-2009, MrSugarCube
- Fixed #1636: Exception caused when an online player character is deleted.
- Fixed #1639: Tooltips not being sent for objects on the edge of the client's screen.

29-08-2009, MrSugarCube
- Fixed: Unable to drop 'new' spell scrolls (necro+) into spellbooks even when MOREZ has
  been correctly set on the book.
- Fixed: Incorrect character race being sent to clients.

30-08-2009, MrSugarCube
- Fixed #1625: Extremely high vendor prices on Linux build.
- Fixed: Archery buttes not checking for OVERRIDE.AMMOTYPE and OVERRIDE.ANIM* tags on the
  character's weapon.
- Modified #1642: Reduced delay between asynchronous database query callbacks.
- Added: Skill flag SKF_RANGED. Combine this with the SKF_FIGHT flag to create ranged
  (i.e. archery) combat skills.

30-08-2009, MrSugarCube (Script pack)
- Updated: sphere_defs.scp (Added SKF_RANGED definition)

07-09-2009, MrSugarCube
- Added: Console command "d ui" to generate a file named "unscripted_items.scp" that
  contains *basic* definitions for items in tiledata.mul that have no corresponding
  Sphere script.

12-09-2009, MrSugarCube
- Fixed #1623: RESTEST requiring 1 of an item when checking for a quantity of 0. This also
  affects other resource-list-based functions and properties such as CONSUME, FOODTYPE,
  RESOURCES, SKILLMAKE, SKILLTEST, etc.
- Fixed #1655: Setting RAINCHANCE and COLDCHANCE to zero does did not disable rain or snow.
- Modified: When loading a WORLD* block from a save Sphere can resolve defnames to find the
  object being loaded (like the ones in sphere_backward_compatibility.scp, for example).

12-09-2009, Coruja (Script pack)
- Updated #1645: sphere_template_vend.scp, sphere_item_resources.scp, spherechar_human.scp,
  sphere_item_provisions_potions.scp, sphere_backward_compatibility.scp (Corrected spelling
  of the wyrm heart defname (i_reag_worm_heart->i_reag_wyrm_heart))
- Updated #1654: sphere_defs.scp (Adjusted height of the Meer characters)

13-09-2009, MrSugarCube
- Fixed #1595: @Destroy trigger not being fired for items inside removed containers. When
  returning 1 in @Destroy on an item inside a container about to be deleted, the item will
  be dropped to the ground (unless the item has already been moved elsewhere).
- Fixed #1656: Exception when players trade and item 01e5e has not been set as a container
  type.

05-12-2009, MrSugarCube
- Fixed: Unable to connect to remoteadmin from telnet clients that operate in 'line mode'
  and need the enter key to be pressed after CTRL+A/Space (the one in Ubuntu, for example).
- Modified: Rewritten networking system, based on the code Vjaka wrote for 0.57 combined
  with updates added since such as EF_UseNetworkMulti. This new system introduces features
  such as packet prioritisation which should help to keep clients responsive even in areas
  with a large number of objects.
  The EF_UseNetworkMulti and EF_UseNetworkMultiVersion experimental flags have been removed
  from the ini and different settings have been added to a new "Network Behaviour" section.
  The default settings should suit most users, but in some cases it may help to tweak the
  MaxPacketsPerTick and MaxQueueSize settings.

06-12-2009, MrSugarCube
- Added: Support for gargoyle character creation. For the option to be available the player
  must have a RESDISP of 7+ and the FEATURE_SA_UPDATE flag needs to be enabled in Sphere.ini.
  ARGN3 in the f_onchar_create (sphere_serv_trigger.scp) is now the character race (1=human,
  2=elf, 3=gargoyle).
- Added: Basic support for mysticism spellbook and skill (the actual spell effects need to be
  scripted).
- Added #1657: Support for the increased tiledata size in client 7.0.0+. As a consequence,
  multis must now start from 08000 instead of 04000 and scripts must be adjusted accordingly
  (the default script pack has been updated). If an older client encounters an item within the
  04000-07fff range they will only see a worldgem bit (01ea7).
- Fixed #1661: Status bar not correctly showing green or yellow in 7.0.0+ clients.
- Modified: The size of Map5.mul is now automatically detected.

06-12-2009, MrSugarCube (Script pack)
- Added: spherechar_sa.scp (Added gargoyle character definitions)
- Added: sphere_item_provisions_alchemy_magic_sa.scp (Added mysticism spellbook and scrolls)
- Added: sphere_map5.scp, sphere_map_points5.scp (Added SA map areas)
- Updated: sphere_defs.scp (Added defnames for RDS_SA RESDISP, t_spellbook_mystic)
- Updated: sphere_serv_triggers.scp (Updated description for f_onchar_create)
- Updated: sphere_skills.scp (Added base definitions for mysticism, imbuing and throwing skills)
- Updated: sphere_item_multis_foundations.scp, sphere_item_multis_houses_ships.scp,
  sphere_item_multis_stairs.scp (Increased multi IDs by 04000)
- Updated: spheretables.scp (Added sphere_map5.scp and sphere_map_points5.scp to resources,
  commented out by default)

12-12-2009, MrSugarCube
- Added: Support for gargoyle flying ability. Flying characters will have statf_hovering set
  on their FLAGS property and will be allowed to pass over items that have the CAN_I_HOVER
  flag set.
  The exact effects of the statf_hovering flag are:
   - Can pass over hidden 'hover over' tiles to get to special areas
   - Can move at the same speed as a mounted player
   - Height is increased by 4 in LOS/movement checks (same effects as when mounted)
   - When stamina is lost on movement, the running penalty is always applied
   - Always revealed when moving whilst hidden
   - Will not teleport off ships when moving on to a ship plank
- Added: MULTIDEF block. This can be used to safeguard against any future changes to the size
  of tiledata.mul. This basically acts as a 'shortcut' for ITEMDEF, except the ID will 
  automatically be increased by 08000. Items defined with this are still accessible as normal
  via SERV.ITEMDEF.id(+08000)/defname, or SERV.MULTIDEF.id/defname can be used if you prefer
  for consistency.
- Added #1674: PINS property to maps, to return the number of pins on the map.
- Fixed #1672: Situations where returning 0 in a trigger would return as 2.

12-12-2009, MrSugarCube (Script pack)
- Updated: sphere_defs.scp (Added defnames for statf_hovering, mt_hover, can_i_hover,
  tilef_hoverover, t_hoverover)
- Updated: sphere_item_multis_foundations.scp, sphere_item_multis_houses_ships.scp,
  sphere_item_multis_stairs.scp (Replaced multi ITEMDEFs with MULTIDEFs)
- Added: sphere_item_ground_tiles_sa.scp (Added hover-over item definitions)
- Updated #1684: sphere_item_magic_armor.scp, sphere_item_magic_leather.scp,
  sphere_item_magic_weapon.scp, sphere_item_misc.scp, sphere_item_profession_cartographer.scp,
  sphere_item_provisions_armor_color.scp, sphere_item_provisions_deed.scp,
  sphere_item_provisions_ore.scp (Replaced custom script IDs with defnames to fix conflicts
  with new tiledata size -- some items did not have a defname so watch out if you have any of
  these in an existing world save)

13-12-2009, MrSugarCube
- Fixed #1683: Hiding skill not properly updating clients to show the character is gray.
- Added #1678: Logging for commands issued via telnet. "TelnetLog" setting can be used
  to enable or disable this feature.
- Modified: The -E switch now shows a message in the console to indicate that is has been
  successfully enabled.

13-12-2009, Coruja (Script pack)
- Updated #1659: sphere_map2 (Renamed "Blood Dungeon Level 1" to "Blood Dungeon")
- Updated #1665: sphere_item_profession_tailor_tanner.scp (Adjusted flipping behaviour of
  spinning wheel)

13-12-2009, MrSugarCube (Script pack)
- Updated #1685: sphere_admin.scp (Updated hover flag description, added ability to hide
  status flags by blanking their description)

16-12-2009, MrSugarCube
- Fixed: Crash dumps not being created at all.
- Fixed: Wrong packets being sent to pre-7.0.0.0 clients whose encryption had been removed.
- Fixed: Summon and field spells not working correctly with EF_MinimiseTriggers set.

16-12-2009, MrSugarCube (Script pack)
- Updated: sphere_admins.scp (Added admin_resdisp_6 and admin_resdisp_7 defnames)

17-12-2009, MrSugarCube
- Fixed #1689: Unable to move with FEATURE_SA_MOVEMENT enabled.
- Fixed #1688: Characters not being logged out properly when clients disconnect.

18-12-2009, MrSugarCube
- Fixed #1663: Human characters being created as elves with the SA client and with a RESDISP
  less than 7.
- Fixed: @UserVirtue trigger not being fired.

18-12-2009, MrSugarCube (Script pack)
- Added: sphere_item_profession_barber_sa.scp (Added gargoyle horn definitions)

19-12-2009, MrSugarCube
- Fixed #1669: Maximum weight not being checked when a client equips an item.
- Fixed #1690: CheckerTrans positions in dialogs not working with dorigin.
- Fixed #1692: DIALOGCLOSE immediately after DIALOG not working due to packet priorities.
- Modified #1681: Swapped the situations where cartography_nomap and cartography_fail
  defmessages are displayed.
- Fixed: FLUSH command on clients claiming to be undefined.
- Fixed: Previous page handlers not being removed when assigning pages via GMPAGE.x.HANDLE,
  leading to possible exceptions.

19-12-2009, MrSugarCube (Script pack)
- Updated: sphere_item_profession_barber_sa.scp (Fixed defname conflicts)

20-12-2009, MrSugarCube
- Added #1667: PARTY.SETMASTER, accepts either a character uid or @<N> for the Nth party
  member, to change who the party master is. The character must be an existing member of the
  party and cannot already be the master.
- Added #1658: @TargetCancel trigger to spells (and @SpellTargetCancel to characters). This
  is called when a player cancels targeting with a spell.
    ARGN1 = the spell that was being cast
    ARGO  = the item used to cast the spell (e.g. a wand or scroll)
    RETURN 1 = suppress the cancellation message
- Added: @Wait trigger to skills (and @SkillWait to characters). This is called whenever
  Sphere wants to check if a character must wait before starting a skill. Normally this
  will be when a skill is selected from the skill menu (before @Select), but also when
  snooping a container or using a musical instrument.
    ARGN1 = the skill the character is attempting
    ARGN2 = the skill that is currently being used
    RETURN 0 = The character can start the other skill (bypasses default checks)
    RETURN 1 = The character must wait (bypasses default checks)
    RETURN 2 = Perform default checks
- Fixed: Return 0 not working in @UseQuick trigger.
- Fixed: @TargOn_Cancel trigger not being fired.
- Modified #1687: Clients are now listed in order of newest to oldest.
- Modified: TDATA1 and TDATA2 can be set on maps to specify the width and height of the gump.

21-12-2009, MrSugarCube
- Fixed #1693: CANSEELOSFLAG always returning 0.

02-01-2010, MrSugarCube
- Fixed #1691: Older clients freezing when single-clicking an item or NPC with a long name.
- Fixed #1695: "You can't think of a way to use that item." message being shown when failing
  to use a training dummy.
- Fixed #1693: CANSEELOSFLAG not working when a uid is specified.

03-01-2010, MrSugarCube
- Fixed #1700: Armor rating not updated when being resurrected.
- Added #1701: @TargetCancel trigger to skills (and @SkillTargetCancel to characters). This
  is called when a player cancels targeting with a skill.
    ARGN1 = the skill that was being used
    RETURN 1 = suppress the cancellation message

10-01-2010, MrSugarCube
- Added #1705: @RegionResourceFound trigger, fires on characters just before @ResourceFound
  is fired on a region resource (shares the same arguments and return values).
- Fixed #1706: Light sources not showing correctly on 7.0.0+ clients.
- Fixed: Guard command not working with pets.
- Modified: Pets default to guarding their master instead of following, and no longer attack
  the same target as their master when in "follow" mode.

17-01-2010, MrSugarCube
- Added: Experimental flag "EF_NetworkOutThread". If this is enabled then outgoing data will
  be sent in a separate background thread.
- Added: UsePacketPriority setting in sphere.ini. Leaving it at 1 (default) should be best
  but if this is set to 0 then [most] packets won't be prioritised.

24-01-2010, MrSugarCube
- Fixed #1713: Strange characters in the tip of the day window.
- Fixed: Previous and Next buttons not working on the tip of the day window.

25-01-2010, MrSugarCube
- Fixed: Figurines using TDATA3 from the item's DISPID instead of BASEID, when a new pet is
  spawned.

27-01-2010, MrSugarCube
- Fixed #1714: Unicode string corruption in dialogs.
- Modified: Exceptions that occur in background threads should now be recorded in logs.

20-02-2010, MrSugarCube
- Modified #1720: SERV.EXPORT now exports in a square rather than a circle.

21-02-2010, MrSugarCube
- Modified: Network thread (used by EF_NetworkOutThread) will now lower its own priority
  when there is no data to send (and raise again when needed)

15-03-2010, MrSugarCube
- Fixed: UseAsyncNetwork not working as it should on windows build.

21-03-2010, MrSugarCube
- Added: MINKARMA, MAXKARMA and MAXFAME settings in sphere.ini.
- Modified: First two lines of NOTOTITLES section are used to define the levels of karma and
  fame needed for each title.

21-03-2010, MrSugarCube (Script pack)
- Updated: spheretables.scp (Added default karma and fame levels to NOTOTITLES section)

04-04-2010, MrSugarCube
- Fixed #1734: No response sent for UOG and CUO status requests.
- Modified: (Windows) Status window now uses a courier font so that data is aligned like it
  is when using 'p' in the console.
- Modified: Improved accuracy of profile data ('p' in console, or status window in Windows)
  by recording and displaying it for each thread.

17-04-2010, MrSugarCube
- Fixed: Wrong mapdif*.mul and stadif*.mul files being used with custom maps.
- Modified: If Map1.mul is present then it will automatically be used.
- Modified: The larger ML map sizes are now automatically detected, so there should be no
  need to specify it in the ini file.

25-04-2010, MrSugarCube
- Fixed #1725: Friends stealing ownership of a pet when mounting it.

25-04-2010, MrSugarCube (Script pack)
- Updated #1733: sphere_map0.scp (Added r_brit to events list for a_townBritain)

01-05-2010, MrSugarCube
- Fixed #1738: Players calling guards on invisible staff members.
- Fixed #1740: @Abort being called when failing alchemy instead of @Fail.
- Fixed: 'msg_tingling' defmessage not being shown under the correct circumstances.

02-05-2010, MrSugarCube
- Fixed #1742: DIALOGCLOSE function not obeying the UsePacketPriority setting.

03-05-2010, MrSugarCube
- Fixed: Database connection lost when using DB.EXECUTE with a query that returns results.

09-05-2010, MrSugarCube
- Fixed #1710,#1731: Numerous causes of instability when using EF_NetworkOutThread.

13-05-2010, MrSugarCube
- Fixed #1748: Exception when dropping an item onto a non-container.

15-05-2010, MrSugarCube
- Fixed #1747: Container contents near the boundaries showing in wrong position when
  UsePacketPriority is enabled.
- Fixed #1746: Damage showing in the corner of the screen instead of above an enemy when
  UsePacketPriority is enabled.

23-05-2010, MrSugarCube
- Fixed #1751: Movement/sight checks fail when an item is too tall to fit within the Z
  boundaries.

24-05-2010, MrSugarCube
- Fixed #1756: Packets being sent for items in containers the client cannot see inside (A
  side-effect of this is that CANSEE/LOS will return 0 for such items, until the client
  opens/snoops the container).

25-05-2010, MrSugarCube
- Fixed #1754: Armor rating in status window not updated when equipped armor pieces receive
  damage.

29-05-2010, MrSugarCube
- Fixed #1759: Client not always notified about login failure when EF_NetworkOutThread is
  enabled.

31-05-2010, MrSugarCube
- Fixed #1753: Client crash when moving into view of a character sitting on a chair.
- Fixed #1760: Players unable to see items in the other player's trade window.

13-06-2010, MrSugarCube
- Added: 'TooltipMode' setting to sphere.ini. When this is set to '1', instead of always
  sending a full tooltip packet for every item, Sphere will send a smaller 'header' packet
  and wait for the client to request the full information (for unchanged tooltips, clients
  can use a local cache and less data will need to be sent).
  Note: Since the header packet requires knowledge of what the tooltip will contain,
  @ClientTooltip should be expected to fire twice in this mode (once for the header, once
  for the full data). ARGN1 can be used to determine if the client asked for the tooltip,
  but it is important that you do not use it to change the tooltip content.
- Added: Support for caching tooltip data for characters and items. Whilst a tooltip is
  cached, @ClientTooltip won't be fired. A new 'TooltipCache' setting is provided in
  sphere.ini to control how long a cached tooltip will be valid for (set to 0 to disable
  caching). If the new tooltip mode is being used then enabling this would be advisable
  to avoid having @ClientTooltip fired twice for each client.
- Modified: RESENDTOOLTIP now accepts parameters to control how the tooltip should be
  sent.
  The syntax is now: "RESENDTOOLTIP [sendfull=0,usecache=0]"
   'sendfull' - 1 to force the full tooltip to be sent, or 0 to send just the header (when
                TooltipMode=1, otherwise the full data will be sent anyway)
   'usecache' = 1 to use cached tooltip if available, or 0 to clear the cache and force
                @ClientTooltip to fire

02-07-2010, MrSugarCube
- Fixed: Possible exception on Linux builds when an NPC moves.

03-07-2010, MrSugarCube
- Modified #1761: The fix for issue #1756 (sending packets for items inside unopened
  containers) must now be activated using the EF_FixCanSeeInClosedConts experimental flags,
  since it has been reported to cause client crashes.

28-07-2010, MrSugarCube
- Added #1776: P.COMPONENTS to access multi components at a location in the same way as with
  P.STATICS. Usage is identical to P.STATICS, except that the COLOR property does not exist
  for multi components. P.COMPONENTS.n.MULTI can be used as a reference to the multi that
  contains the nth component at a location.

06-08-2010, ShiryuX
- Added #1790: TAG.NOTO.PERMAGREY which sets the player's notoriety to neutral/grey.
  This will only happen if the character is blue, everything else will override it.

07-08-2010, ShiryuX
- Fixed #1772: Cooking skill wasn't counted as a crafting skill.

07-08-2010, ShiryuX (Script pack)
- Fixed #1774: sphere_map0.scp (Renamed Occlo to Ocllo, correct spelling)

10-08-2010, ShiryuX
- Fixed #1781: Walk buffer protection was counting steps even when step wasn't possible,
  because of freeze status in the character.

12-08-2010, ShiryuX
- Fixed #1793: OpenDoor Macro now won't ignore LOS and Distance is 3 (max).

15-08-2010, MrSugarCube
- Fixed #1722: Game clients unable to connect when the server IP is set to 127.0.0.1.

17-08-2010, ShiryuX
- Added #1566: MD5PASSWORD account function/property to instert or change a MD5 hash as password.
  This way you can call: "SERV.ACCOUNT foobar MD5PASSWORD f4d9ff51c527e8ef67d924d4f0a6db66"
- Fixed #1799: Accounts created using ADDMD5 won't cut the hash anymore.
- Fixed: Dialog properties xmfhtmlgump and xmfhtmlgumpcolor not working correctly with dorigin. 

19-08-2010, ShiryuX
- Modified #1786: Disabled 'r' console command to be used by remote telnet, use 'resync' instead. 
  Any other way to access the console (physical or remote desktop) can still use it.

21-08-2010, ShiryuX
- Added: Basic support for bard spellbook and skill (the actual spell effects need to be scripted).
- Modified #1800: @UserWarMode will now have ARGN2 parameter, which by default is 1.
  ARGN2 = 1 --> Will abort the skill action
          0 --> Will _NOT_ abort the skill action
- Fixed: SA Clients wasn't considered for Async connections.

21-08-2010, ShiryuX (Script pack)
- Updated: sphere_defs.scp (Added 't_spellbook_bard' definition)

21-08-2010, khaos (Script pack)
- Updated: sphere_spells.scp (Added new bards spells from SA, no functionality though)

22-08-2010, MrSugarCube
- Fixed #1803: Items with a default value of 2147483647 on linux builds.

23-08-2010, MrSugarCube
- Fixed #1796: Vendor speech containing the text "(null)".
- Modified: MOREM on t_map items is now used to indicate which map has been drawn. Recent client
  versions (7.0.8.0+) are able to use this value to view maps other than map0.mul.

23-08-2010, MrSugarCube (Script pack)
- Updated: sphere_msgs.scp (Updated npc_vendor_s1 and npc_vendor_b1 defmessages)

25-08-2010, ShiryuX
- Fixed #1795: Characters were able to dclick equipable items with attr_move_never.

05-09-2010, Khaos (Script pack)
- Added: sphere_item_provisions_clothing_sa.scp, sphere_item_provisions_armor_sa.scp,
  sphere_item_provisions_weapons_sa.scp (These files now contain all the default scripts
  for Stygian Abyss weapons, armor, clothing, jewelry, and other miscellaneous items.
  As a note: all throwing weapons use the t_weapon_sword type. There is no archery
  animations for gargoyles)
- Updated: sphere_skills.scp (Added FLAGS=skf_ranged|skf_fight to the throwing skill (Skill 57))

09-09-2010, MrSugarCube
- Fixed #1806: Possible causes of a critical "timer expired" error on Linux builds.

11-09-2010, ShiryuX
- Fixed: 'group' keyword not being stripped with tngstrip command (used for locations tab).

13-09-2010, MrSugarCube
- Removed: EF_Unicode; its behaviour is always enabled.

14-09-2010, MrSugarCube
- Fixed #1744,#1752: Desynchronisation of players' position between client and server.

20-09-2010, Khaos (Script pack)
- Updated: sphere_item_provisions_armor_sa.scp (added layers to the wearable armor -shields.
  Skirts were being treated as gloves)
- Updated: sphere_item_ground_tiles_sa.scp (added the sparkle dupeitems for the hover over 
  animation)
- Added: sphere_item_building_floors_sa.scp (contains all the new SA floor tiles, even the
  runed items)
- Added: sphere_item_building_doors_sa.scp (this file contains all the proper doors for the
  SA expansion)

21-09-2010, Khaos (Script pack)
- Updated: sphere_item_building_doors_sa.scp (added in ruined doors (Should be the last set))

27-09-2010, MrSugarCube
- Fixed #1819: "World save has been initiated" messages not being sent until after the save
  completes.
- Fixed: Large packets sent by the client sometimes not parsed correctly, leading to strange
  behaviours or console errors.

30-09-2010, ShiryuX
- Fixed #1825: not writable books not displaying content for 5.0.0+ clients.
- Modified: Axis strip to use only ONE file to dump the stripped scripts (like TNG strip does)
  Commands are = TNG: "strip tng" or "tngstrip" (dump file sphere_strip_tng.scp)
                 Axis: "strip axis" or "strip" (dump file sphere_strip_axis.scp)

04-10-2010, MrSugarCube
- Fixed: Editing a book page can cause the following page to be deleted.

07-10-2010, MrSugarCube
- Fixed #1826: Male characters unable to walk over items with CAN_I_LIGHT set.

09-10-2010, ShiryuX
- Added: "TAG.OVERRIDE.NOTO" and "TAG.OVERRIDE.NOTO.$uid" as notoriety flag overrides.
  TAG.OVERRIDE.NOTO is a general override for the notoriety flag.
  TAG.OVERRIDE.NOTO.$uid overrides the noto flag according to the viewer $uid.
  * NOTE: The general override is applied before the viewer tag. So it will override EVERYTHING.
          Usable flags can be found on sphere_defs.scp

09-10-2010, ShiryuX (Script pack)
- Updated: sphere_defs.scp (added noto_types defintion)

11-10-2010, Khaos (Script pack)
- Updated: sphere_item_provisions_weapons_sa.scp (fixed some typos)
- Updated: spherechar_human.scp (Female barber was using male barber names instead of
  the female name list)

13-10-2010, MrSugarCube
- Added: Support for packet changes found in client 7.0.9.0.
- Added: Support for new tiledata.mul and multi.mul formats found with client 7.0.9.0.
  Since the tiledata size has increased again (supporting a maximum slot of 0FFFF),
  multis must now start from 010000. If multi scripts are already using the new MULTIDEF
  syntax then everything should work without any change to scripts.

14-10-2010, MrSugarCube
- Fixed #1832: Exception on Linux build when logging in.

18-10-2010, MrSugarCube
- Modified: Ships use their HEIGHT property to detect objects that are on the deck,
  rather than assuming a value of 3.

22-10-2010, MrSugarCube
- Fixed #1828: Instability when receiving large amounts of data from a client.
- Fixed #1838: Fixed "Bad MENU item id" error when trying to display a custom item in a
  menu or skill menu.
- Fixed #1839: Exception when showing the edit menu for a container containing more than
  64 items.

23-10-2010, MrSugarCube
- Fixed #1835: @Destroy incorrectly firing on trade window contents when the container
  is removed.

25-10-2010, MrSugarCube
- Fixed #1822: Exception when a client sends a malformed skill lock packet.
- Fixed #1782: Exception on linux build leading to sphere.pid file never being removed
  when shutting down Sphere.

27-10-2010, Khaos
- Added: Race selectors to newbie templates. Code works as follows: [newbie xxx <race>] Races
  that can be set are "human", "elf", "gargoyle", or leave it default for normal functionality.
  This works for the male_default, female_default, and all the skills defined in Newbie sections.
- Added #1598: All max* stat values (Hits, stam, mana, food) can be _safely_ set up to 1 million.
  Though you can go past this, we don't recommend it. Note: This should not be used on players
  max values, and we _highly_ don't recommend it.

03-11-2010, MrSugarCube
- Fixed: Exception on linux build when accessing guild functions without an SRC.

14-11-2010, MrSugarCube
- Fixed #1847: Crash on 7.0.0+ clients when other clients are picking up and dropping
  items.

21-11-2010, MrSugarCube
- Fixed: Unable to access basic properties for non-game clients through SERV.CLIENT.x.

22-11-2010, Coruja (Script pack)
- Updated #1851: sphere_map0.scp (renamed Trinsic Passage to Delucia Passage)

02-12-2010, MrSugarCube
- Fixed #1861: Elven players turning into gargoyle ghosts when dead.
- Fixed: Mana Vampire spell always gives mana to the caster even when the spell is blocked in
  an @Effect trigger.

03-12-2010, MrSugarCube
- Fixed #1770: Exception when NPC_AI_PATH is enabled and an NPC cannot find a route to its
  destination.

10-12-2010, MrSugarCube
- Fixed #1854: LogMask setting not have any effect on the messages being logged.

12-12-2010, MrSugarCube
- Added #1865: ARROWQUEST function now accepts a third parameter to specify the arrow's id
  (defaults to 0). This can be used to display more than one arrow at once on newer clients,
  but bear in mind that older clients can still only show one arrow at a time and so the id
  will effectively be ignored in their case.
  If an id has been specified when showing the arrow, then you will also need to specify it
  again when you want to remove it ("ARROWQUEST" with no arguments will only remove the arrow
  with id 0).
    ARROWQUEST 1000,1000,0 // show an arrow pointing to 1000,1000, id=0
    ARROWQUEST 1020,1000,1 // show an arrow pointing to 1020,1000, id=1
    ARROWQUEST 1000,1020,2 // show an arrow pointing to 1000,1020, id=2
    ARROWQUEST 0,0,1       // remove the arrow pointing to 1020,1000

21-12-2010, MrSugarCube
- Fixed #1869: Older clients freezing when an item or character with a long name speaks.

22-12-2010, MrSugarCube
- Fixed #1843: Connections sometimes remaining open long after the client has disconnected.
- Fixed #1848: Container contents slow to show when TooltipMode is set to 0.

23-12-2010, MrSugarCube
- Fixed #1874: 7.0.0.0 - 7.0.8.2 clients freezing when using ARROWQUEST function.

26-12-2010, ShiryuX
- Fixed #1729: NPC now teaches you if there's a skill to decrease and room for the new skill.
  In before, if you were near the skillcap, the npc just rejected your train request.
- Fixed #1873: Shop list tooltips are now being fully sent to the players.

26-12-2010, Coruja (Script pack)
- Updated #1876: sphere_item_deco_lightsources.scp and sphere_item_deco_furniture.scp
  (changed typo in candelabra's defnames, was using candleabra instead)

28-12-2010, ShiryuX
- Fixed #1879: 'nightsight' function now sends light level update instead of full client update.

28-12-2010, Coruja (Script pack)
- Updated #1877: sphere_item_deco_furniture.scp (fixed dupelist of items 0a2b and 0b5e)

02-01-2011, MrSugarCube
- Added: UseExtraBuffer setting to sphere.ini to enable an additional data buffer for outgoing
  network data.
- Fixed #1858: Linux build considering connections lost when a non-critical error occurs during
  data sending.

02-01-2011, MrSugarCube (Script pack)
- Updated #1876: sphere_backward_compatibility.scp (Added backward compatibility defnames for
  candelabras)

08-01-2011, MrSugarCube
- Added #1845: Support to automatically invalidate and resend tooltips when certain properties
  change on items or characters, via new AUTOTOOLTIPRESEND setting. See Sphere.ini for
  available flags that can be used to control which properties are monitored. Note that some
  scripts won't trigger the tooltips to resend (for example the 0008 flag won't detect a script
  that sets MORE1 on armour, so a manual RESENDTOOLTIP would still be needed).
- Fixed: Possible delay between sending packets required to display buy/sell menus.

09-01-2011, ShiryuX
- Added #1881: TAT_AS_FULL trigger type to TRIGGER function to set ARGO, ARGN and ARGS.
  Example: TRIGGER @MyTest,<def.TAT_AS_FULL>,01,100,200,300,here,start,my,args
           will call @MyTest with ARGO.UID=01, ARGN1=100, ARGN2=200, ARGN3=300
           and ARGS=here,start,my,args (this supports ARGV[].)
- Modified: Now sphere reads registry keys from lastest clients (no need to manually set them)

09-01-2011, ShiryuX (Script pack)
- Updated: sphere_defs.scp (added tat_as_full definition)

09-01-2011, MrSugarCube
- Fixed #1886: Exception caused by an infinite loop when AutoTooltipResend detects a property
  value being changed from within an @ClientTooltip trigger. Now, AutoTooltipResend won't
  trigger another tooltip resend if a monitored property changes during the resend.
- Fixed #1814: AutoResendTooltip setting not working when an item property is changed just
  before it is placed in a container (e.g. when the item amount changes during stacking).

10-01-2011, MrSugarCube
- Added #1872: Support for setting SPEEDMODE to 4, as handled by newer clients. This can be
  used to prevent a player from moving. Movement checks have been adjusted accordingly so
  whilst older clients won't understand this speed mode, Sphere will still block their
  movement attempts (with a slight 'rubber banding' effect as you'd normally get when freezing
  a player by other means).

11-01-2011, MrSugarCube
- Fixed #1888: Exception caused by AutoTooltipResend attempting to send tooltips for deleted
  items.

21-01-2011, MrSugarCube
- Fixed #1894: Explode function placing a comma at the beginning of the result.

21-01-2011, Coruja (Script pack)
- Updated #1893: sphere_map2.scp (Renamed "Shrine of the Virtues" to "Gargoyle Shrine", and
  "Gargoyle City" to "Vel Lor Reg").

22-01-2011, MrSugarCube
- Fixed #1868: Memory leak when TooltipCache setting is disabled (thanks Torfo).

25-01-2011, MrSugarCube
- Fixed: Wage amount not being passed through to the 'npc_pet_wage_cost' defmessage.
- Fixed: Spyglasses not searching properly for the nearest land tile.
- Fixed: Optimised UID allocation not working as expected or sometimes not functioning at all.
- Fixed: SuppressCapitals replaces unicode speech with blank text.
- Fixed: Possible exception when importing from a WSC file where item properties are listed
  in an unexpected order.

29-01-2011, MrSugarCube
- Fixed #1901: Some targeting items (bloody bandages, carpentry tools, cotton, lockpicks,
  thread, yarn, wool) using 'itemuse_weapon_promt' defmessage as their prompt instead of
  'target_promt'.

11-02-2011, MrSugarCube
- Fixed #1909: Exception when using the "d ui" command against older tiledata sizes.

12-02-2011, MrSugarCube
- Fixed #1911: Ping history not decaying over time, causing an IP to be permanently blocked
  when it exceeds the MAXPINGS setting.

13-02-2011, MrSugarCube
- Modified #1912: Teleporting clients no longer receive unnecessary item packet for the smoke
  effect they leave behind.

17-02-2011, MrSugarCube
- Fixed: Client connections being blocked for connecting too often, even though they aren't.

19-02-2011, MrSugarCube
- Modified: Profiling statistics now include number of faults that occurred in each thread.

22-02-2011, MrSugarCube
- Fixed #1821: Exception when talking to an NPC who is having a conversation with another
  player.

12-03-2011, Khaos (Script pack)
- Added: Script support of all the new High Seas ship multis (sphere_item_multi_houses_ships.scp)
  and parts (sphere_item_ship_parts_britannian.scp, sphere_item_ship_parts_gargish.scp,
  sphere_item_ship_parts_orcish.scp, sphere_item_ship_parts_tokuno.scp).
- Updated: Updated some of the axis cats in the sphere_item_multi_houses_ships.scp file.
- Updated:sphere_item_unsorted.scp with noname tiles that were with the ships. Possible
  ship component pieces.
- Updated: sphere_item_ship_parts_britannian.scp; added more parts.

13-03-2011, MrSugarCube
- Fixed #1925: SKILLBEST.n not working correctly.
- Fixed #1922: Exception caused by Sphere trying to send character position to a client
  before a character has been selected.

13-03-2011, Coruja (Script pack)
- Updated #1893: sphere_map2.scp (Add guarded and global flags to Ver Lor
  Reg).

13-03-2011, Khaos
- Fixed: Advanced Line of Sight. Couldn't shoot or cast with any intervening
  water files.
- Added #1916: sphere.ini now contains "DefaultCommandLevel". It takes a level
  of 0 - 7 (# corresponds to plevel). Default is 7. Whatever you set the value
  to will be the min plevel for a char to use all commands not in a [plevel xxx].

13-03-2011, Khaos (Script pack)
- Updated: sphere_defs.scp (added los_nc_water to los flags section. If you use
  with CANSEELOSFLAG, it will stop LOS across water (i.e. Firing from a ship to
  another ship)).

21-03-2011, MrSugarCube
- Added: Support for packet changes found in client 7.0.13.0.

07-04-2011, MrSugarCube
- Fixed #1935: Exception when using "d a" command on Linux build.
- Fixed #1940: Exception on Windows build when an invalid format string is passed
  to RTIME.FORMAT.

09-04-2011, MrSugarCube
- Modified #1941: Custom houses (t_multi_custom) display as worldgem pieces in
  debug mode.

11-04-2011, MrSugarCube
- Fixed #1942: Exception when using MD5HASH with certain lengths of text.

23-04-2011, MrSugarCube
- Fixed #1919: Exception when a client sends an incomplete handshake packet.

10-05-2011, MrSugarCube
- Fixed: Exception when trying to set REGENx and 'x' is an invalid stat id.

12-05-2011, MrSugarCube
- Modified #1954: Unplaced object details are now listed during garbage
  collection, under code 3202.

12-05-2011, MrSugarCube (Script pack)
- Updated: sphere_map_points4.scp (Corrected z-level of the moongate locations)

17-05-2011, MrSugarCube
- Added: FeatureExtra setting to sphere.ini with flags to enable new gothic
  and rustic themed items in the house designer.

18-05-2011, MrSugarCube
- Fixed #1958: Unable to pass variables as arguments to FORCHARLAYER and
  FORCHARMEMORYTYPE loops.
- Fixed #1959: Possible exception when Sphere tries to load verdata.mul file.

09-06-2011, MrSugarCube
- Fixed #1969: Timer being set to abnormally high values when attempting skills.
- Fixed #1967: Comments in sphereaccu.scp using the wrong slash direction.
- Fixed: Backspace key not working in the Linux build's console.
- Modified: Console output on Linux build will automatically have colour enabled
  for certain terminal types that support colour codes.

09-06-2011, babidi (Script pack)
- Updated #1970: sphere_map_points0.scp (Fixed start locations all using coordinates
  for Britain)

12-06-2011, MrSugarCube
- Fixed #1955: Exception when DB.QUERY/EXECUTE is used whilst a previous
  DB.AQUERY/AEXECUTE operation is still running in the background.

18-06-2011, MrSugarCube
- Fixed #1980: Unable to handle @Rename trigger at character creation using EventsPlayer.
- Fixed #1977: New player characters starting at the wrong location.
- Fixed: Possible exception when a character doesn't have enough strength to equip an item.

18-06-2011, babidi (Script pack)
- Updated #1975: sphere_map0.scp, sphere_map0_ml.scp, sphere_map1.scp, sphere_map2.scp,
  sphere_map4.scp (Updated region flags to use defnames)

18-06-2011, Coruja (Script pack)
- Updated #1966: sphere_map2.scp (Added region flags to a_lbr)

18-06-2011, MrSugarCube (Script pack)
- Updated #1983: spherechar_sa.scp (Fixed female gargoyles not having MT_FEMALE set)

19-06-2011, MrSugarCube
- Fixed #1976: Aggressor memories being removed when leaving war mode.
- Fixed #1965: SKF_IMMOBILE causing clients to become unable to move if skill is used too
  often.

20-06-2011, MrSugarCube
- Fixed #1956: Region's @Enter trigger firing when a creature is summoned, before the
  creature's @Create trigger fires.

21-06-2011, MrSugarCube
- Fixed #1986: Exception when evaluating intelligence skill is used and either one of the
  magery or necromancy SKILL sections don't exist.

01-07-2011, ShiryuX
- Fixed #1981: Now you will be able to cast spells with 'spellflag_field' flag on chars 
  if 'spellflag_targ_char' is enabled.

02-07-2011, MrSugarCube
- Added: 'NetworkThreads' and 'NetworkThreadPriority' settings to Sphere.ini. These can be
  used to enable client connections to be handled by separate threads. The NETWORKTHREADS
  setting controls how many threads should be used to handle networking (setting this to 0
  will cause networking to be handled in the main thread, like before). NETWORKTHREADPRIORITY
  can be used to control the priority of the networking threads (the default value of 255
  should be the best option to use).
  The EF_NetworkOutThread experimental flag has been removed.

08-07-2011, MrSugarCube
- Fixed #1991: Custom packet handling functions causing clients to freeze.

21-07-2011, ShiryuX
- Added #1963: OF_DClickNoTurn, if enabled players won't turn when dclick or target an item.

31-07-2011, MrSugarCube
- Fixed #1998: @Destroy not firing on player characters or their items, when deleted via the
  character selection screen or their account is deleted.
- Fixed #1997: "World save has been initiated" messages not being sent until after the save
  completes, when NetworkThreads is set to 0.

02-08-2011, ShiryuX
- Modified #2011: Enabled spells with SPELLFLAG_SCRIPTED to use LOCAL.CREATEOBJECT1,
  LOCAL.CREATEOBJECT2, LOCAL.FIELDWIDTH and LOCAL.FIELDGAUGE for spells with SPELLFLAG_FIELD
  or with SPELLFLAG_SUMMON. If width/gauge is not set, default is 7/1.

02-08-2011, ShiryuX (Script pack)
- Updated: sphere_defs.scp (A few more buff icons in the buff_icons defname)

05-08-2011, ShiryuX
- Fixed #2008: RANGEH now displays the longest range and RANGEL the shortest (High/Low)

27-08-2011, ShiryuX
- Added #2020: CUOSTATUS and UOGSTATUS, which enable/disable the response to UOGateway/ConnectUO
               Default for both is: 1 (see sphere.ini also)
- Added: SPELLFLAG_AREA to create custom area spells (you must use SPELLFLAG_SCRIPTED).
- Added: LOCAL.AREARADIUS, which let you change the radius of the hardcoded area spells
         and let you set the radius of scripted skills (if not set, default is 4).
	 Example:
	 [SPELL s_new_spell]
	 FLAGS=SPELLFLAG_SCRIPTED|SPELLFLAG_AREA|SPELLFLAG_TARG_XYZ
	 ....
	 ON=@SUCCESS
	 LOCAL.AREARADIUS = 5
- Added: Function 'attacker.clear' to clear the attackers. Use it with caution.

27-08-2011, ShiryuX (Script pack)
- Updated: sphere_defs.scp (added new spellflag definition)

31-08-2011, ShiryuX
- Fixed #2023: Now you can use custom items on LOCAL.CREATEOBJECT1/2 with SPELLFLAG_FIELD.

01-09-2011, ShiryuX
- Added #2021: Settings to edit default color and font for SysMessage/Message/Click.
  Don't forget to update your scripts. Settings are included in sphere_msgs.scp

01-09-2011, ShiryuX (Script pack)
- Updated: sphere_msgs.scp (added SMSG_DEF_COLOR, SMSG_DEF_FONT, MSG_DEF_COLOR, MSG_DEF_FONT
            IMSG_DEF_COLOR and IMSG_DEF_FONT settings)

02-09-2011, ShiryuX
- Fixed #2025: Removed any kind of internal effect for spells with SPELLFLAG_SCRIPTED.
  Since it's supposed to have a scripted effect!
- Modified: SPELLFLAG_FX_BOLT to work with SPELLFLAG_SCRIPTED.  It will fire a bolt from 
            caster to target. If SPELLFLAG_GOOD is used the effect won't explode.
            ID of the effect is 'EFFECT_ID' spell's property.

02-09-2011, ShiryuX (Script pack)
- Fixed #2006: sphere_spells.scp (commented out RUNES for Mysticism spells & changed Discordance)

03-09-2011, ShiryuX
- Fixed #2027: Wrong internal clilocs for Cunning and Agility Buffs.
- Added: Buff for Gargoyle Fly ability.
- Fixed: LOGARITHM(), TAN, SIN and COS function were returning wrong values.

03-09-2011, ShiryuX (Script pack)
- Modified: sphere_defs.scp (added buff clilocs for gargoyle fly)

03-09-2011, Coruja (Script pack)
- Updated #2028: sphere_item_misc_se.scp (wrong DUPELIST for 02417)

13-03-2012, Coruja (Script pack)
- Updated #2056: sphere_map0.scp (fixed despise and covetous levels)

20-03-2012, Coruja (Script pack)
- Updated #2057: sphere_map2.scp (fixed ilshenar regions)

23-03-2012, ShiryuX
- Added: 'AttackerTimeout' modifies how long a NPC can remember a player since his last attack, 
         that a NPC forgets his attacker. You can play with this and attacker.#.ELAPSED.
         See sphere.ini. Default value is 300 (5 minutes).
- Fixed #2034: Disabled timeout check for TELNET connections.
- Fixed #2050: Now if you set BankMaxWeight/Items to something less than 0 
               will avoid the weight/item amount check.

26-03-2012, RanXerox
- Updated #2036: sphere_map0.scp, sphere_map3.scp, sphere_map4.scp (added some missing locations)

26-03-2012, MrSugarCube
- Modified #2040: MT_EQUIP, MT_USEHANDS and MT_MOUNT flags are respected when a character's body
  changes. Characters won't be dismount or have their items unequipped if the new body has the
  relevant flags.

27-03-2012, MrSugarCube
- Added: Support for reading map data from mapXLegacyMUL.uop files found in client 7.0.24.0
  onwards. Sphere looks for the old mapX.mul file(s) first and will continue to use these if
  both file formats exist alongside each other.

31-03-2012, ShiryuX
- Fixed #2052: Players trying to move during a resync pause caused exceptions on console.

24-04-2012, MrSugarCube
- Fixed: Unable to double click console in Windows to open scripts when forward slashes are used
  in script paths.

25-07-2012, ShiryuX
- Added: SPELLFLAG_TARG_DEAD so you can create spells for dead people.
- Added: SPELLFLAG_DAMAGE for damage spells, along with HARM effect.
         You can override the Damage Type under @(Spell)Effect with LOCAL.DamageType.
- Added: MAGICF_NOANIM so you can disable animation/direction update of the character in every spell.
- Modified: SPELLFLAG_SCRIPTED changes behavoir and allows to mixed with other flags.
- Modified: SPELLFLAG_FX_BOLT will totally work now. EFFECT_ID can be overrided with LOCAL.CreateObject1.
- Modified: SPELLFLAG_AREA can be used and altered. If no specified radius, default is 4.
            The effect of course, if it's a custom spell, must be scripted.
- Modified: Spell Summon Creature can be overrided with LOCAL.CreateObject1.
- Modified: Limit for ANIM function, so you can play the new Gargoyle Anims now.
- Fixed: Can modify Flamestrike EFFECT_ID now.
- Fixed: WOPPlayer to 0 overrided the EquippedCast check and players could cast while equipped.

25-07-2012, ShiryuX
- Updated: sphere_spells.scp, sphere_defs.scp with the new spells changes

25-07-2012, Coruja (script pack)
- Updated #2069: sphere_map_points3.scp (added missing teleports in Doom)

31-07-2012, Ben
- Fixed #2085: RESURRECT not working.

30-08-2012, Ben
- Fixed #2093: Animation above 400 not showing all frames.

04-09-2012, Ben (script pack)
- Updated: sphere_spells.scp with missing SPELLFLAG_AREA.

04-09-2012, Ben
- Fixed #2096: Sommon spells not making creatures your pet.
- Fixed #2097: area spells requiring spellflag_scripted to work
- Updated: sphereCrypt.ini with keys up to 7.00.270

16-09-2012, Ben
- Fixed #2094: double @Destroy trigger on summoned char.

17-09-2012, Terrikate
- Fixed #1831: Trigger @PERSONALSPACE did not fire on NPCs
- Fixed #1651: LastLogged message always sent current time
- Fixed #1944: Some combination of stairs and delete function can remove the dirt on floor of the house
- Modified #1749: Error messages 'Bad Login' become warnings to facilitate analysis of the logs
- Modified: Resync forced to create or delete items in custom houses to update correctly on all clients

20-09-2012, Terrikate
- Added #1542: Implemented CTAGCOUNT like TAGCOUNT for clients
- Fixed #1590: Attacker list contains self uid

22-09-2012, Ben
- Added: TAG.OVERRIDE.ROCK.DAM to override the damage done by rock throwing
	 Note: TAG.OVERRIDE.ROCK was already implemented with the ability to change rock to other items.
	 It can also add the throwing ability to other NPCs that have the tag. (never reported in changelog)
- Added: TAG.OVERRIDE.BREATH.DAM to override Damage done from fire breathing.

22-09-2012, Ben (Script pack)
- Fixed #2086: added SERV.MYSQLPASSWORD to plevel 7 group in spheretables.scp

24-09-2012, Terrikate
- Fixed #2078: t_multi_custom causes memory leak in client

06-10-2012, Ben
- Fixed #2101: Added a value to i_staff_black in default pack to prevent possible crash in vendor menu.
- Fixed #2088: Char hue returning to OSKIN on reveal from invis spell.

12-10-2012, Terrikate
- Fixed: ATTACKER.n.ELAPSED: not increased the timer correctly, always returned 0
- Fixed: ATTACKER.LAST: returned one of the attackers randomly, no the last

12-10-2012, Ben
-Added: Party triggers.
        @PartyInvite(def=recipient, src=sender, return 1=stop default)
	@PartyRemove(def=char getting kicked, src= the one kicking, no return, ARGN=1 if triggered by disband)
	@PartyDisband(def=master, src=master, no return)

17-10-2012, Terrikate
- Added #1987: More information when fails to delete a character. (account, character name and ip)
	       Now will be a message of type LOG_WARNING rather than LOG_ERROR
- Added #1854: TAG.NOMUTESPEECH=1 to unmute specific areas created by items. 
	       Only makes sense to use it if the optional flag OF_NoHouseMuteSpeech is disabled
- Added #1816: f_onaccount_create function to be called when create an account by script or console
- Modified: GMs can now listen to every player without any restriction. 

17-10-2012, Terrikate (Script pack)
- Updated #1816: sphere_serv_triggers.scp (added function f_onaccount_create)

22-10-2012, Terrikate
- Fixed #2104: functions UPDATE and REVEAL forced an update unnecessary of the client

22-10-2012, Ben
- Fixed: .UOP file support. It should now be able to handle future updates.
- Updated: ML map size detection to allow for new .uop file format.

28-10-2012, Ben
- Fixed #2107: Trying to open and use .uop files even if non existant.

03-11-2012, Mordant (Script Pack)
- Added: t_forest and t_jungle TERRAIN types in sphere_types.scp

11-11-2012, Ben
- Fixed #2106: MAGICF_STACKSTATS causing crash.

23-11-2012, Ben
-Fixed #2115: Cutting custom hides producing default leather. 
		Now TDATA1 of type t_hide can hold ID or DEFNAME of custom cut leather (or any item).

27-12-2012, Ben
-Fixed #2112: Added ini setting NPCSkillSave with a default value of 10 to keep normal behaviour.
			Any NPC skills below this value will not be saved and will be reseted to 0.

04-01-2013, Ben
-Changed: OVERRIDE.REGENVAL so that it is the tagvalue or 1 instead of 1+tagvalue.
-Fixed 2123: REGEN VAL not being accurate on mounted horses.

18-1-2013, Ben
-Added: <ASCPAD size,text> Does the same as <ASC text>, but padds with 0s untill size is reached. 
		Will also truncate the text if longer then size 

2-02-2013, Ben
-Fixed #2128: IMSG_DEF_COLOR overriding Chars noto colors.
-Fixed #2131: Too many packets sent from multis.

10-02-2013, Ben
-Fixed: EQUIPPEDCAST in sphere.ini not working properly.

13-02-2013, shaklaban
-Fixed #2134: COMPONENTS of the point not working, if MAP not 0.

16-02-2013, shaklaban
Modified: sphere.ini modified to stable settings (NetworkThreads=0 and UseAsyncNetwork=0).

16-02-2013, Ben
-Fixed: small typo in sphere.ini
-Added: Support for new UOGateway status request.

20-02-2013, Ben
-Added: sphere.ini option ALLOWNEWBTRANSFER. When set to 1, will allow newbi items to stay newbied after tranfer to an NPC.
-Fixed #2139: All dung being named Horse Dung. Now it's   "animal name" dung
-Added: Read/Write (SERV.MAP.map_num.SECTOR.sec_num function) to have access to individual sectors.

23-02-2013, Ben
-Fixed #2133: <Dsomeval> returning 0 if <someval> is negative.
-Fixed #2120: Some server properties are no longer writable (ACCOUNTS, CHARS, ITEMS, SAVECOUNT, TIME)

24-02-2013, Ben
-Fixed #1494: (script pack) possible exploit with arrow value
-Fixed #1544: qval returning " " instead of "" (now returns true empty string)
-Fixed: Timezones not being calculated properly when ALLOWLIGHTOVERRIDE is on.
-Fixed #2140: Vendors are now closing shop when ISNIGHTTIME and not ISDARK.

02-03-2013, Ben
-Fixed: ascpad throwing out an error for no reason.

03-03-2013, Ben
-Fixed #2043: For loops last loop executed two times.

04-03-2013, Ben
-Fixed: COMBAT_OSIDAMAGEMOD not applying the proper bonus calculations

06-03-2013, Ben
-Fixed #2127: EF_FixCanSeeInClosedConts not updating unequiped items.
-Fixed: More COMBAT_OSIDAMAGEMOD calculation errors

20-03-2013, Shaklaban
-Added: TAG.OVERRIDE.SPEED for weapons.

23-03-2013, Shaklaban
-Added #2146: SECTOR.NUMBER for accessing index of the sector.

31-03-2013, Ben
-Fixed: LIST.xxx.num.INSERT returning an error when the list doesn't exist. It will now create it and place the item at index 0.
-Added: LOCAL.PASSWORD to f_onaccount_create as a readable variable only for now.
-Fixed: Quoted numbers inside a variable will now be properly saved as a string, and returned as a string.

23-04-2013, Shaklaban
-Added: DeadCannotSeeLiving option for sphere ini.
		 DeadCannotSeeLiving=1: Dead players cannot see npcs (except healers and their own pets).
		 DeadCannotSeeLiving=2: Dead players cannot see players and npcs.
		 DeadCannotSeeLiving=0: Old behaviour.

04-05-2013, Shaklaban
-Fixed: Begging animation cannot disabled with return 1 @prestart.
0.56c
---- 0.56c --------------------------------------------------------------------
---- 16/06/2013

12-07-2013, Coruja (Script pack)
- Updated #2171: sphere_defs.scp (added missing midis SE/ML/HS)
		
19-07-2013, Ben
-Added: Triggers @Enter, @Exit, and @Step to ROOMDEFs
(Script pack)
-Updated #2173: some components in sphere_item_multis_houses_ships.scp
-Removed: region_flag_globalname in sphere_def.scp since it's no longer in use
-Removed: region_flag_globalname from sphere_map0.scp and sphere_map2.scp
-Added: REGION_FLAG_ANNOUNCE to regions that have a TAG.ANNOUNCEMNT in sphere_map0.scp

20-07-2013, Ben
-Added: Tags functions to ROOMDEF. (TAG, TAG0, TAGAT, TAGCOUNT, TAGLIST, CLEARTAGS)
-Fixed: Setting region/room tags in game (ex: .region.tag.test 1) not setting properly.

05-08-2013, Ben
-Added #2175: local.CreateObject1 <itemdef> to create food spell. If set, it will produce this item when the spell if done.
-Modified #2181:(script pack) Incorrect DUPELIST on i_keg_wood
-Added #2148: tag.NoRestock on vendors and regions. Setting either one to 1 will stop routine restocking of vendors
-Fixed: Error in ISTEVENT.
-Added #2177: - <ISTIMERF.functionname> to check if a timerf exists. Returns the time left in sec if it exists or 0 if not.
			  - TIMERF STOP,functionname to stop a specific timerf.
-Removed #2180:(script pack) i_orb and i_minion_leather from spherechar_lbr.scp
-Added #2183: EF_FixKillTrigger 0x02 to possibly fix Exp system and @Kill trigger
-Fixed #2159: Items with ATTR attr_newbie should not be stuck on NPCs with ALLOWNEWBTRANSFER on.
-Fixed #2172: (script pack) Magery spell sound def adjusted.

13-08-2013, Ben
-Fixed #2189: Changed ATTACKER.CLEAR from readable to writable.	

25-08-2013, Ben
-Added: Auto detection of in use triggers (Vjaka's code from 0.57 source)
-Removed: ExperienceMode 0x20 and 0x40 since Auto trigger detection is enabled.
-Removed: EF_New_Triggers, EF_Minimize_Triggers, and EF_NPCAct_Triggers since Auto trigger detection is enabled.
-Removed: @NPCHearNeed trigger in sphere_events_human.scp since this trigger doesn't exist!

27-08-2013, RanXerox
-Correction to i_keg_wood_2 (it is not a container)
-Corrected spelling mistakes ("entrance" not "entrace") in sphere_map2.scp
-Added Armored Boura to mount defs in sphere_defs.scp
-Added more random sets in sphere_defs.scp
-Added more sounds in sphere_defs.scp
-Renamed some ITEMDEFs (noted in sphere_backward_compatibility.scp)
-Formatted scripts and updated syntax in numerous files
-Added t_acid terrain type to sphere_types.scp (not used yet)
-Moved numerous ITEMDEFs from one file to another
-Added numerous new ITEMDEFs
-Added more sphereCrypt.ini entries
-Differentiate mod* and max* in the info dialog
-Added placeholders for new spells
-Magery Spell flags made consistent
-Magery spell resources modified to match the spellbook in modern clients
-Numerous additions to creature height table in sphere.defs
-Replaced hardcoded magic resistance string

28-08-2013, RanXerox
-Added more ITEMDEFs
-Fixed DUPELIST entries
-Changed some Axis categories, subsections and descriptions
-Moved ITEMDEFs from one file to another
-Major changes to doors script file in preparation for making new doors work

31-08-2013, Ben
-Fixed #2193: Mounts will die instantly when killed while mounted.

01-09-2013, RanXerox
-Moved numerous ITEMDEFs
-Added numerous ITEMDEFs
-Changed some DEFNAMEs
-Fixed some spelling errors
-Affected files:
  items/sphere_item_aos_se.scp
  items/sphere_item_building_doors.scp
  items/sphere_item_building_doors_sa.scp
  items/sphere_item_building_floors.scp
  items/sphere_item_building_floors_sa.scp
  items/sphere_item_building_floors_se.scp
  items/sphere_item_building_roofs.scp
  items/sphere_item_deco_dungeons_traps_dead.scp
  items/sphere_item_deco_misc.scp
  items/sphere_item_deco_virtues.scp
  items/sphere_item_ground_tiles.scp
  items/sphere_item_magic_ninjitsu_bushido.scp
  items/sphere_item_magic_spellweaving.scp
  items/sphere_item_misc.scp
  items/sphere_item_ml_floor_wall.scp
  items/sphere_item_profession.scp
  items/sphere_item_provisions_weapons.scp
  items/sphere_item_resources.scp
  items/sphere_item_unsorted.scp
  npcs/spherechar.scp
  npcs/spherechar_mondains_legacy.scp
  npcs/spherechar_sa.scp
  sphere_backward_compatibility.scp
  sphere_menu.scp
  sphere_newb.scp
  sphere_skillmenu.scp
  sphere_template_vend.scp

02-09-2013, Ben
-Added: 04e and 052 tiles to t_water in sphere_types.scp
-Fixed #2200: Custom trigger not working with new automated trigger detection 
-Fixed #2199: Resource gembits being set to 0 everytime.

03-09-2013, Ben
-Fixed #2201: @itemXXX triggers not all working.

04-09-2013, RanXerox
-Fixed a bug in @kill trigger where, if enabled, a killer would not get credit
 (karma, fame, experience) for the kill.

07-09-2013, Ben
-Added #1805: ColorNotoInvul with default value of 0x35 and NotoInvul 0x40 flag for PetsInheritNotoriety.
-Fixed #2186: Dialoglist not being updated when closing dialogs.

08-09-2013, RanXerox
-Fixed #2203: Added missing Action values to sphere_dialog.scp
-Fixed #2204: Cooking and Crafting skills now behave like proper crafting skills

08-09-2013, Ben
-Fixed #2191: Turning at the map edge with boats will not trow a console error.
-Fixed #2192: Should not be able to turn on another boat.

10-09-2013, Ben
-Fixed #2141: WorldGem Bits should now recognise map edge properly.

11-09-2013, RanXerox
-Default DISPID for creation of T_SEED items now configured in Sphere_Defs.scp
-New SphereCrypt.ini key

15-09-2913, Ben
-Fixed: @ResourceFound trigger not working.
-Fixed: Error caused by chars spawning when a GM is standing close to point 0,0
-Fixed #2207: ARGN1 in @SELL and @ITEMSELL is now the sold amount and not the total amount.
-Added:	ARGN2 in @SELL and @ITEMSELL is the price of the items sold after vendermarkup (ARGN2 / ARGN1 = price per unit)
-Fixed #2205: Changed Noto colors to match OSI default.
-Fixed #2194: Functions starting with any hardcoded functions like LIST and followed with _ should now work as intended.

17-09-2913, Ben
-Added: Runto npc command. Accepts a point or region name as argument.
-Changed: Goto npc command to accept region name as argument.
-Added: NPC_AI_PERSISTENTPATH 0x0400 to the NPCAI setting in sphere.ini. (NPC will retry multiple times to find it's path)
-Updated: Sphere.ini and sphere_msg.scp with new settings

22-09-2013, Ben
-Fixed #2076: Picking up corpse crashing server (not tested)

01-10-2013, Ben
-Fixed #2211: Corpse having wrong MORE values.

02-10-2013, Ben
-Fixed #2214: IsTimerF.function and TIMERF STOP,function not working properly

06-10-2013, Ben
-Fixed #2080: Items with different tags will no longer stack
-Added #2210: Support for item stacking with EF_ItemStacking 0x04(probably not 100% OSI style but should do the trick (maybe even better))

12-10-2013, Ben
-Fixed #2219: P.COMPONENTS.x always returning 0 on maps bigger then 0
-Remove GM check in Item stacking

15-10-2013, RanXerox
- Removed 0x from flag explanations in sphere.ini since spherescript does not use 0x to indicate hex
- More changes to script pack than can be counted!
- Dozens of files deleted, split, added, renamed, etc.
- Many hundreds of ITEMDEFs and CHARDEFs shuffled from one place to another.
- Lots of modifications to DUPELIST and DUPEITEM, etc.

16-10-2013, RanXerox (Script Pack)
- Converted Unix files to DOS format
- Replaced: references to the missing MESSAGELOC function
- Added: i_canal ITEMDEF (now all items can be used in custom foundation multi's)
- Fixed #2212: renamed Horde Demons
- Fixed #2215: modified WEIGHT on i_dragonscale
- Removed: bad reference to i_bear_skull
- Added: some useful NPC functions
- Renamed: sphere_items_seige.scp (...it's spelled Siege)
- Finished scripting more lightsources

17-10-2013, RanXerox (Script Pack)
- Switched: 0f3e and 0f3f (i_arrow) because older clients have a rock as ITEMDEF 0f3e
- Removed: the name and title coloration from vendors, citizens, and guildmasters
- Fixed: a bad reference to random_skirts
- Fixed: broken SYSMESSAGELOC (they were all missing color)
- Improved: corrosive slime now drops acid pool when threatened
- Added: missing stair multi's
- Added: HIREDAYWAGE back to sailors and mercenaries
- Added: deed's for all the house foundations
- Added: some missing NPC functions (is cursed)
- Added: some missing combat timers (paralyzing blow and block healing)

18-10-2013, RanXerox (Script Pack)
- Fixed: armored steed figurine
- Fixed: syntax (SERV.NEWITEM instead of SRC.NEWITEM and NEW. instead of SRC.ACT.)
- Fixed: fukiya (dart shooter)
- Fixed: various mounts that had errors with the mounted animation
- Fixed: some entries in sphere_typedefs.scp
- Fixed: implementation of monsters that "summon" other monsters is now consistent
- Fixed: console errors in some NPC events
- Fixed: Paroxysmus loot (he dropped himself as an icon instead of his pet dragon)
- Fixed #1536: Pack animals with wrong maxweight

18-10-2013, Ben
-Fixed #2222: Shrink not working anymore.
-Added: UID of shrunken pet is now accessible in ACT of the player.

19-10-2013, Ben
-Fixed #2218: Client crash caused by removefromview when bank is open.
-Added: CLOSE function to container items
-Added: CLOSEPROFILE, CLOSESTATUS, and CLOSEPAPERDOLL functions to characters. 
		Can take a UID as argument of the char's window you whish to close.
-Fixed #2221,#1933,#1618: EF_Walkcheck blocking some stairs.

20-10-2013, RanXerox
- Changed: animation frames removed from DUPELIST on i_mongbat_dartboard
- Changed: value for color_o_silver
- Added: new CHARDEF placeholder for tiger animations- Changed: the value of color_o_silver
- Added: 7.0.33 encryption key

21-10-2013, RanXerox (Script Pack)
- Separated FOODTYPE and MAXFOOD in the monster files

23-10-2013, RanXerox (Script Pack)
- Added: more candy and chocolate related ITEMDEFs
- Fixed: standing lamps
- Added: Charybdis (and tentacle), Tiger, and Killer Pumpkin CHARDEFs

24-10-2013, RanXerox (Script Pack)
- Fixed: bad defname reference in loot (should be i_mask_daemon)
- Fixed: tall jack-o-lanterns
- Added: spawn groups for Hythloth
- Moved: t_equipitem moved to its own file (since it will eventually be quite large)
- Modified: t_equipitem now implements:
            TAG.ElfOnly
            TAG.GargoyleOnly
            TAG.RareItem
            TAG.Stolen
            TAG.Exceptional
            TAG.CraftedBy
            TAG.DoNotEquip
            TAG.NightSight
            TAG.RESCOLD
            TAG.RESENERGY
            TAG.RESFIRE
            TAG.RESPOISON
            TAG.RESPhysical
            TAG.LowerRequirements
            TAG.LUCK
            TAG.STR
            TAG.DEX
            TAG.INT
            TAG.HITS
            TAG.STAMINA
            TAG.MANA
            TAG.HitpointRegen
            TAG.StaminaRegen
            TAG.ManaRegen
            TAG.FasterCastRecovery
            TAG.SelfRepair
            TAG.ExtraSkill1
            TAG.ExtraSkill2
            TAG.ExtraSkill3
            TAG.ExtraSkill4
            TAG.ExtraSkill5
  WARNING: Because many of the equipable items already had these TAGs, anyone
           using those items on a live shard should make sure all those items
           in-game are unequipped before installing this change!

25-10-2013, RanXerox (Script Pack)
- Minor updates to maps 2-5

27-10-2013, Ben
- Fixed #2227: Region.ISEVENT not working.
- Fixed #2229: STRREVERSE doesnt invert the entire string. (This was also the case for STRTOLOWER and STRTOUPPER)
- Added: DEFLIST which acts like LIST but readable only (Filled by server at loading time with lists of resources)
- Added: new Section to Sphere.ini [RESOURCELIST] with a list of resource blocks to be loaded into DEFLISTs
         Ex: Adding ITEMDEF in the RESOURCELIST will create a DEFLIST.ITEMDEF with all itemdefs loaded by the server.
- Added: Category, Subsection, and Description to ITEMDEF and CHARDEF (now the server can read them if directly in the DEF section and not under @create)

28-10-2013, Ben
- Fixed #2164: NPCs attacking from different floors
- Fixed: Issue with Client 7.0.33.1+ packet change

29-10-2013, RanXerox (Script Pack)
- Fixed: CHARDEFs in sphere_monsters.scp that were missing NAME or CAN
- Fixed: Bad reference to c_sea_monster in sphere_monsters.scp
- Fixed: Bad reference to e_equipitem in sphere_item_provisions_clothing.scp

29-10-2013, Ben
- Added: Cliloc support for start location in clients 7.00.13+
- Updated: Sphere_map_points0.scp with new STARTS information ([STARTS 2] includes a cliloc line as the 4th argument)
- Tweaked: Stacked items should no longer flip.

30-10-2013, RanXerox (Script Pack)
- Fixed: Improved TAG management related to TAG.OVERRIDE.REGEN* in sphere_item_typedef_equipitem.scp
- Fixed: Removed reference to jobNecromancer event from sphere_citizens.scp

31-10-2013, RanXerox (Script Pack)
- Noted: Comments in the sphere_item_typedef_equipitem.scp file were improved
- Added: HTML_REDTEXT and HTML_WHITETEXT to sphere_defs.scp
- Added: TAG.GargoyleOnly to i_gargish* weapons in sphere_item_provisions_weapons.scp

1-11-2013, RanXerox
- Modified: The weather algorithm so that if you set a sector's rainchance to 100, it will always rain
  Note: rainchance actually means "precipitation chance". If the coldchance is high enough, the precipitation will be snow.

9-11-2013, Ben
-Fixed #2238: Muldiv returning different values on linux.
-Added #2226: Dupeitem is now readable. Return 0 if not a dupeitem.
-Added #2232: Made @Rename trigger when a player changes his name
			   ARGS IN as the proposes char name
			   ARGS OUT as new char name
			   ARGO is the char getting his name changed.
 
10-11-2013, Ben
-Added #2210: Picking up an item in a stack will cause above items to fall unless they have attr_static or attr_move_never
-Fixed #1764: LOS issue with stacked items
-Fixed: crashed caused by items stacking too high.
-Possible fix for Pathfinding on maps other then 0. (Needs testing)

11-11-2013, Ben
-Fixed: Error with @Rename trigger causing names to have random characters
-Fixed #2010: Pathfinding now works on maps other then 0 (Been tested this time)

12-11-2013, Ben
-Fixed #2240: Time running at double speed caused by new Muldiv calculation
-Tweak: Split EF_ItemStacking into 2 setting. EF_ItemStackDrop 0x08 will take care of the item dropping part.(for debuging purposes)

17-11-2013, RanXerox (script pack)
-Fixed: all typo's of the word Axel
-Fixed: arcane clothing items
-Fixed: Gargish maul and war hammer TAGs

17-11-2013, Ben
-Added: Destroy function which is like Remove, but will not be stoped by a return 1 in @Destroy

23-11-2013, Khaos
-Added: New Character and Item variables for use with EA iprops and other support. These function as TAGs and are made for static naming.
 A manual is in the works. Some of these might change as we bind them into the hard code with further support.

24-11-2013, Khaos
-Added: New Item can flags added:
	can_i_enchant
	can_i_retaincolor
	can_i_imbue
	can_i_exceptional
	can_i_makersmark
	This also allows for enchant=<bool>, etc. for each on items.
-Added: New attr_flags added.
	attr_imbued
	attr_exceptional
	attr_enchanted
	attr_questitem
	attr_insured
	attr_nodrop
	attr_notrade
-Added: sphere_defs.scp; new can_i_* and attr_* flags are now added to the files.

24-11-2013, Ben (script pack)
-Tweaked: sphere_dialog.scp to allow ATTR in .info dialog to use 8 chars instead of 4

25-11-2013, Khaos
-Added: can_i_recycle has been added to the core. As above; can be set with the CAN flags or as recycle=1/0.
-Added: attr_lockeddown and attr_secured. I removed these from the variables.

26-11-2013, Khaos
-Fixed: Variable typo for Dammodifier.
-Removed: removed NEWBIE behavior from attr_blessed2 and attr_cursed2.
-Modified: attr_blessed, attr_nodrop, attr_notrade, and attr_insured were added to this drop behavior and should
 by default not got to a corpse on death now if it is a player item.
-Added: Cliloc handling for ATTR_SECURE -> "locked down and secure" and ATTR_LOCKEDDOWN -> "locked down"
-Modified: AI Behavior now checks for not only attr_newbie items when looting, but now testes for the following:
 attr_insured, attr_blessed, attr_notrade, and attr_nodrop. These won't be looted by NPCs.
-Added: VARIABLES: SOULCHARGECOLD, SOULCHARGEENERGY, SOULCHARGEFIRE, SOULCHARGEKINETIC, SOULCHARGEPOISON, and
 INCREASEGOLD to both item and character variables.

26-11-2013, Khaos (Script Pack)
-Added: Mordaunts_House_System.zip was added to the ADDON folder containing an up-to-date version of Mordaunt's
 housing system using the new attr_flags that were added.

27-11-2013, Khaos (Script Pack)
-Changed: Spheretables.scp;
	- Commented out HELP and TOME. No function was found when tested.
	- Uncommented the maps, map points, and guild stones. Left scripts/custom commented since not everyone has this folder.
	- Moved some plevel1 functions to plevel2. They shouldn't have been in plevel1.
-Changed: sphere.ini;
	- Uncommented the maps and changed instructions for non-ml compliance.
	- Resdisp is now 7 for auto SA compliance. (I didn't touch expansion code though within the ini otherwise).
	- Uncommented ZEROPOINT for use with ML map0 and map1. Comment it out if you aren't using the newer maps.
-Changed: sphere_region.scp;
	- All regiontypes resources now add up to 100.0.

28-11-2013, XuN (Script Pack)
-Added: def.STONECONFIG_MISC_RECRUIT_MAXDISTANCE to do a control check of max distance allowed for the player being recruited.

30-11-2013, Khaos (Script Pack)
-Added: sphere_genericstone_config.scp; missing check. Sorry. XuN sent it to me after the last update.
-Modified: sphere_region.scp; it was missing the REAPAMOUNT lines from every resource. This is corrected now.

30-11-2013, Khaos
-Added: can_i_reforge/REFORGE=1/0 and attr_reforged to sphere. EA Seems to check these for reforging runic items.

-Added: PERMITTEDUSE variable on chars and items.

-Removed: ONLY* variables in favor of PERMITTEDUSE.

-Added: Permitted Player Use Event to the addon's folder in the scripts to directory; full soft code use of the new variable is
 used in that script. sphere_defs.scp now contains the soft code flag system for use with this script.
 
01-12-2013, XuN
Added NameLoc variable for items so you can set a ClilocID for using it as name and show up by script by showing NameLoc instead of Name. 

02-12-2013, Khaos
-CHANGED: PERMITTEDUSE to CANUSE variable on chars and items. (This was done on the empty variables for help with the base packs
 and to allow more free change usage. Binding this internally would have left out customization for others).

-CHANGED: Switched out Permitted use code in the scripts to CANUSE flagged code. Cleaner look and better wording.

-ADDED: Followerslots to Chars

03-12-2013, XuN
-Removed duplicated entry 'height_0c8 16 //DEFNAME=c_horse_tan' from sphere_defs.scp

03-12-2013, Ben (script pack)
-Added: NAMELOC functionality. It can be set for items and chars, in the *DEF sections or in scripts (not directly in game)
		If used, it will display this cliloc instead of the default name (where clilocs are shown)
		When used on chars, cliloc 1116690 is used instead of the original 1050045 to preserve prefix and suffix
		
04-12-2013, XuN
-Added @ResourceGather for RegionResources and @RegionResourceGather for Players:
	This trigger is being fired just before gathering skill has finished (after all animations and timings)
	Local.ResourceID is the ID of the item being gathered (Writable)
	Argn1 is the amount of local.ResourceID being gathered (Writable too)
	Return 1 cancels Gathering
05-12-2013, Khaos (Script Pack)
-Fixed the &= in the new CANUSE flags in Addons from processing an undefined symbol error.
-Added Expansion_Player_Event.rar to ADDON section for the suggested usage of EXPANSION Variable on Items and Characters.

08-12-2013, Khaos
-Fixed: Throwing is now working internally as any other ranged fight skill. It now processes gains, skilluse, etc.
 Anims were fixed for this as well. (still haven't set flying anims yet, be patient)
-Added: T_WEAPON_THROWING: Treated as a bow type with RANGE Parsing, TData3/4 values.
-Added: T_WEAPON_THROWING to sphere_defs.scp. Also added T_SOUL_FORGE and T_FURNITURE to sphere_def.scp for base pack.

13-12-2013, Khaos
-Added: EventsItem=e_youreventhere; was added to the sphere.ini and hard code. Functions as eventsplayers/pets/regions.
 This code fires on ALL items if something is in the global event and fires after tevents and before typedef. Don't overuse
 this. We found legitimacy in this addition with a few ideas it would be needed for.
-Changed: attr_nodrop and attr_notrade combined in one as Attr_NoDropTrade. Same with the two variables are now NODROPTRADE on items.
-Added: attr_artifact now takes the spot of attr_notrade
-Changed: attr_artifact items won't take fire damage on clothing unless scripted otherwise.
-Changed: sphere_defs.scp to reflect new attr_* edits.
-Changed: REQEXPANSION -> EXPANSION in the Variables on Items and Chars.

14-12-2013, Khaos
-Added: Char and Item variables for Bane and SpellConsumption
-Fixed: Possible fix for dismount trigger not being called first when mounting a mount while on a mount.

15-12-2013, Ben
-Moved: TAG.OVERRIDE.AMMOANIM , AMMOANIMHUE , AMMOANIMRENDER, AMMOTYPE to permanent variables. (ex:TAG.OVERRIDE.AMMOANIM -> AMMOANIM)
		These can be set on Items in game or in the ITEMDEF section. (They can be set on all items but only in use on archery types)
-Added: AMMOCONT to Items and ITEMDEF which can take the UID of a container (for specific container) or an ID (for a type of container)

15-12-2013, XuN
-Added: Spellflag_bless and Spellflag_curse for blessing spells like Agility, Blessing,etc and for Weaken,Curse, etc.
-Modified: sphere_defs.scp and sphere_spells.scp to add these spellflags.

15-12-2013, Khaos
-Added: BONUSHITSMAX, BONUSMANAMAX, BONUSSTAMMAX, and REGENFOOD variables to prepare for a huge overhaul of the internal overrides and status
 bar packet.
-Added: INCREASEDEFCHANCEMAX, RESPHYSICALMAX, RESFIREMAX, RESCOLDMAX, RESENERGYMAX, AND RESPOISONMAX variables for CHARACTERS ONLY. The
 new status bar packets checks for client >= 7.0.3. Full functional now with THOSE variables and those on it. Ones added earlier for the mis-
 informed information won't be leaving the servers since they might be for EC.
-Changed: PlayerStatusUpdate Packet now processes the variables it uses.

16-12-2013, Khaos (Script Pack)
-Changed: Changed colors_neutral range from { 1801 1887 } to { 1801 1908 } as noted on bugtracker.

22-12-2013, Ben
-Changed: LUCK, CURFOLLOWER, MAXFOLLOWER, and TITHING to work on all chars, not just players.
-Added: Support for local database (SQLite) through LDB. reference. (No External programs required!)
		-Syntax is similar to MySQL, but slightly different http://sqlite.org/lang.html
		-Functions are almost the same as DB. with a few changes.
			LDB.CONNECT "filename" to open a database file
			LDB.AEXECUTE and LDB.AQUERY are non existent
		-SQLite database manipulation program can be found here http://sqliteexpert.com/download.html

02-01-2014, Khaos (Script pack)
-Changed: This upload is containing the rework of multidef files with new naming conventions, price adjustments, etc. spheretables.scp
 has been updated to reflect loading of the multis folder. New syntax is m_* instead of i_multi_*.
-Added: Added variant versions of tents and evil compound with doors and signs. Wheat Cottage got doors and a sign as well.
-Added: sphere_defs_2.scp This will now be loaded after sphere_defs.scp containing any backwards compatibility I do.
-Fixed: Broken treasure multis should be fixed based on some old revisions I saw in an old script I had.
-Changed: Mordaunt sent me an updated housing system to match the new house and foundation defnames.
-TODO: Add in the new multidef info to deeds and vendors.
-Moved: spk_ship_cmds to speech folder.
-Fixed: New ships were using t_multi and not t_ship. I assume this might have been causing some of the alleged "bugs" with them. They
 are now all using t_ship.

03-01-2014, Ben
Fixed #2256: Reworked NPC object throwing..
->canseelos checks now applies to overrides
->changed tag.override.rock to NPC variable THROWOBJ (can take numerical or string ID now)
->changed tag.override.dam to NPC varialbe THROWDAM min,max (can also be "THROWDAM max" for non variating damage)
->added THROWRANGE min,max  (can also be "THROWRANGE max" with a min of 2 by default)
->All 3 variables are available on dynamic npc or in CHARDEF
Fixed: AMMOANIM,AMMOANIMHUE,AMMOANIMRENDER,AMMOCONT, and AMMOTYPE no able to be read directly from SERV.ITEMDEF...

04-01-2014, Ben
Fixed #1904: EF_WalkCheck causing some NPCs to climb impassable terrain.

05-01-2014, Ben
Added #1638: Defmessages are accessible with <DEFMSG.msg_name>
			->Also not documented but available before: Defmessages can be set with "DEFMSG.msg_name new_msg"

09-01-2014, RanXerox (Script pack)
-Fixed some duplicate itemdef and defnames

10-01-2014, XuN
Changed: MaxFood is now writable.
Added @TradeCreate trigger for chars, fired after trade windows are created:
	SRC=The other player.
	Argo=Item wich starts the trade.
	return 1 stops the trade.
Added @DropOn_Trade trigger for items:
	Act=item adding to trade window.
	Argo=Other player.
	return 1 blocks the placement.
Added @TradeClose trigger for chars, fired before a trade window is being closed (Opossed to @TradeAccepted).
	SRC=The char closing the trade window.
Fixed: Players can now open their containers while placed on trade windows (still cannot pickup items from them, nor them).
Change: Players used to be able to open the containers of other players while they were inside a trade window, these behaviour is now controled in sphere.ini.
Added: Ini option 'TradeWindowSnooping' to handle this behaviour: 0 will open the bags, 1 will call for snooping (or deny it by your scripts).
Notes:	-For now there's still a issue causing the client to crash while someone with a trade window open closes his client or just logs off.
		-invisible (hidden) players can open trade windows to another players (but only first player will see it, this behaviour will remain, it can be fixed with @TradeCreate).

11-01-2014, Ben
Fixed #2258: Some properties returning as hex instead of decimal.

12-01-2014, XuN
Change in @TradeClose:
	Src is the player closing the window.
	Argo is the other player.
Fixed: Items being able to move while inside a container inside a trade window.
Fixed: Containers on the ground not being able to open.
Changed: Ships work again in Lost Lands.
Fixed: Disconnect not working correctly with trysrv in high privileged characters.
Added: return 1 to f_onchar_create, it blocks the creation and disconnects the client.

13-01-2014, XuN
Removed: tag.override.noto.$uid, having one tag per 1 character viewing this is insane.
Added: @NotoSend, this trigger will override the default color for status bar and character 'mouse hovering' color (Replacement for tag.override.noto.$uid)
	src=The player viewing this char
	argn1=bar/char color (0 will let the default system run)
Note: The first 7 colors are the same as NOTO_* definitions, but you can use all your hues range (however the colors does not display like in items/chars)

15-01-2014, XuN
Fixed: Items being able to move inside containers placed in trade windows (semi-fixed before)
Fixed: Gold function now updates automatically the status bar.
Fixed: Move back the character data before f_onchar_create to be able to read it again.
Added: @SeeHidden trigger (Heavy load, keep it clean) fired when a char is going to see (or not) an invisible character (just like staff see other staff members while invisible)
	argn1=Invisible/Visible (but grayed out)
	No returns for this trigger.

17-01-2014, Ben
Fixed #2244: SERV.ACCOUNT UNUSED xxx can now take any functions with the account being the default in the function.

19-01-2014, Ben
-Added #1607: "LIST.XXX.SET args,..." This will clear the list and set each arguments (separated by a ,) as an element of the specified LIST
-Added: "LIST.XXX.APPEND args,..." This acts the same as SET, but will not clear the LIST. It will add to the LIST
-Change: String parsing should now respect commas(,) as a character inside double quotes ("") instead of treating it as a separator (for most places anyways)
		This allows situations like this:   LIST.XXX.SET value1,"value2,value3",value4  to have a result of:
		LIST.XXX.0 = value1
		LIST.XXX.1 = value2,value3
		LIST.XXX.2 = value4
-Added #1787,#2142: "LIST.XXX.SORT args"  This will re-order the the list using 'args' as order method.
		'No args' or 'asc' - sorts case sensitive ascending
		'i' or 'iasc' - sorts case insensitive ascending
		'desc' - sorts case sensitive descending
		'idesc' - sorts case insensitive descending

23-01-2014, XuN
Fixed #2257: Weapons now doesn't hit from Range+1
Added tag.override.SpellTimeout to alter default .ini setting to individual players.

25-01-2014, XuN
Added BUILD function to server, wich returns the svn's build number via <serv.build>, can be used on scripts to keep up versioning and stop the code or do different things between versions in example. (Ok, caught, Ben did it!)

25-01-2014, Script-Pack (Coruja)
Updated sphere_defs.scp (#2255)
colors_skin {1002 1058}
colors_hair {1102 1149}
colors_pink {1201 1254}
colors_blue {1301 1354}
colors_green {1401 1454}
colors_orange {1501 1554}
colors_red {1601 1654}
colors_yellow {1701 1754}
colors_neutral {1801 1908}
colors_snake {2001 2018}
colors_bird {2101 2130}
colors_slime {2201 2224}
colors_animal {2301 2318}

25-01-2014, Ben
-Fixed #2266: Trade Window memory not being removed.
-Change: LIST.xxx.FINDELEM args will now search as a string if 'args' is not a number regardless if it's inside double quotes "".

04-02-2014, XuN
Fixed #2273: Crafting skills with skf_craft not working like they should (Note: skf_scripted means the script is totally custom, for everything, so skf_craft won't work with skf_scripted).
Fixed #2267: Items in the cursor (layer_dragging) are now bounced if a target is opened to the player.

05-02-2014, XuN (Script Pack)
Fixed: changed back i_multi to the new m_ naming style in sphere_item_provisions_deed.scp.
Updated Mordaunt's House System to version 2.3.4.

09-02-2014, Ben
-Added: New variable TIMESTAMP to dynamic items and characters. (To allow for server time to upgrade to INT64)
-Moved: t_corpse.more1, t_book.more2, t_message.more2, t_eq_memory_obj.more2 to new TIMESTAMP
-Added: t_forest and t_jungle to sphere_defs.scp to fix ISNEARTYPE problems
-Fixed: <SERV.BUILD> returning date instead of revision number even though revision number is available.
-Changed: Most Interger types to INT64 for higher time support. Tags and Vars also can hold 64bit numbers. This fixes #1447

13-02-2014, XuN
Fixed: Players now become instantly GuildMasters when placing a Guild Stone instead of waiting until first DClick.
Added functionality to the ATTR_LOCKEDDOWN and ATTR_SECURED flags: locked down items should not be able to be moved, decay and be eaten by npcs (and some more default behaviour), secured items have all this checks but not the ones related to pick up and use.

Script Pack:
Modified: Iron ore now requires 0.0 Mining instead of 20.0.
Updated: New update of Mordaunt's house system.
Updated sphere_msgs.scp: Added ITEMUSE_SECURED, ITEMUSE_SECURE_ON and ITEMUSE_SECURE_OFF

15-02-2014, Ben
-Fixed #2275: NPCs walking through multi doors
-Fixed: Targets not removing when using SELF and LAST

16-02-2014, XuN
Modified @StatChange: now is working properly in EVERY stat change, and not only in the stat gain/loses
	argn1=statid (maxhits,maxmana,maxstam and maxfood are checked now too)
	argn2=the current stat value
	argn3=the new value
Fixed some new variables not working.

ScriptPack:
updated sphere_events_npcs.scp: Functions ModMaxHits/Stam/Mana to work better, they also accept += and the rest of operators.
added: sphere_attr.rar to Custom folder containing some basic behaviour for attr_secure and attr_nodroptrade (for now).
Updated Mordaunt's house system to version 2.3.7

16-02-2014, Ben
-Added #2270: summoned tag added to summoned creatures if CHARTAGS=1 in sphere.ini
Script Pack:
Corrected some defnames - i_fruit_cantelope -> i_fruit_canteloupe
 i_fruit_gourd1 -> i_fruit_gourd_yellow
 i_fruit_gourd2 -> i_fruit_gourd_green

17-02-2014, XuN
Added targetcancel function to force closing a target. 
Fixed some new variables returning hex values. 
Added functionality to RegenHits/Mana/Stam, they use the current tag.override.regen_x values 

Moved all @SkillChange triggers to CChar::Skill_SetBase, now every skill change is calling this trigger (as it should), no matter of .skill_name, .allskills, skillgains/loses and skill trains.
Fixed serv.Regenx returning value*10

18-02-2014, XuN
Regeneration Tweaks: 
	-Moved up a check to force stop in this stat, so useless checks are avoided in a function fired in each tick (each lil improve is a win!).
	-Added FOOD as a regen stat (RegenFood or tag.override.regen_3)
	-ADDED RegenValStat variables (RegenValHits, etc) to work as the RegenStat variables but with tag.override.regenval_x.
	-Removed @Hunger
	-Removed weird check that multiplied the regen time *2 if the stat was not food, it now works with the time specified in sphere.ini
	-Removed weird "Bonus" in HITS giving more delay than the default one, it should sustract it to be a real bonus? however, timers are handled in the trigger now and following the default ini settings.
	-Removed tag.override.regen(val)_x: RegenValStat is now readed inside @RegenStat and RegenStat is readed before it, cannot be modified inside without the trigger bein fired in each serv.tick. RegenStat overrides ini setting now (wich is more intuitive when scripting)
	-Added @RegenStat trigger fired after
		-local.StatID=(0=Hits,1=Mana,2=Stam,3=Food). Writable, never higher than 3.
		-local.Value=The amount of points being regenerated (or decreased in food's case). Writable, can be negative but 0 works like return 1
		-local.StatLimit=by default=<MaxStat>, allow this stat to pass the limit when regenerating, or limit it lower. Stats over this value will go down in each tick until they reach their limit. This does not work with food as food shouldn't ignore its limit (0).
		-return 1 Stop de regeneration of this stat, but not preventing future checks, to do that set the RegenHits to a very high value.
		
Added f_onaccount_connect to sphere_serv_triggers.scp, READ IT CAREFULLY, I switched the default return procedure here for safety, return 1 will allow the account connecting no matter you have checks or not.
Added LowerReq to the ReqSTR check when trying to equip items for both items and chars (It checks for LowerReqs on the item and in the character too to substract to the real ReqSTR)

23-02-2014, XuN
-Modified: CanUse is now only an item property, it also returns now values in hex format to work with it as a flag variable. 
-Sphere.ini: Added the maps 2-5 but commented out, added a few missing comments in some flags. 
-Added a check to IsTrigUsed to avoid trigger calls while serv is loading, this will improve load times and avoid several unexpected errors. 
-Removed SKTRIG_STROKE's checks from skills and moved to a new function to keep together all the checks giving more control to skills.
-Added skill_stroke() wich handles the strokes left and sound for craft and gathering skills and also a new trigger.
-Fixed amount of strokes to each crafting skill, they were random, now they have 2 strokes by default.
-Added @SkillStroke trigger:
        Local.Skill=Skill ID. (Read only).
        Local.strokes=Strokes left*     (Read/Write).
        Local.Sound=Sound to make in this stroke if any (Read/Write).
        Local.Delay=Delay until next stroke (10 = 1 second).
        return 1 Abort the skill.
        return 2* Abort the consumption of resources in this stroke.
 
        *Alchemy works different so its working with some exceptions:
                -Local.Strokes instead of going down it's going up until it reach the total strokes count, wich are equal to the amount of resources. In each stroke if no return is given resources are consumed.
                return 2 Its only allowed in alchemy skill, returning this will let the skill continue to next step (stroke, finish...) without consuming anything in this stroke.
-Modified @SkillStart: Local.CraftStrokeCnt is NOT writable for alchemy, since the skill works different and cannot be overriden this way, use @SkillStroke to add more Strokes if you want.
-Fixed #2267: MakeItem function now bounces any item in layer_dragging.
-Moved some new variables to return decimal numbers instead of strings.

23-02-2014, Mordaunt (Script Pack): 
Another update to sphere_item_provisions_deed.scp, adding new ships and moving their names to m_ too.

24-02-2014, XuN
-Fixed #2267: MakeItem function now bounces any item in layer_dragging. 

25-02-2014, XuN
Actual crafting skills (Blacksmithing, Tailoring...) now are not handled as crafting skills by the source, instead of that a SKF_CRAFT is required in their [Skill ] (Excepting Alchemy by the moment)
WARNING: From this version a update of sphere_skills is needed (read below) or crafting skills will not work.
Script pack:
	-sphere_skills.scp: Added FLAGS=SKF_CRAFT to blacksmithing,tailoring,tinkering,carpentry, cooking, bowcraft and inscription.

02-03-2014, Ben
-Fixed #2261: (script pack) Hairs/beards using wrong names (multiple scripts updated for this)

03-03-2014, XuN
Added local.Anim to @SkillStroke trigger.
Fixed wrong animations sent in each Stroke (Some are missing?).

14-03-2014, XuN
Fixed #2289:
-Added local.HitsHungerLoss for StatID 3 (Food) in the @RegenStat trigger, this value is still a percentaje and NOT the hitpoints to lose, but setting it to 0 will disable the loss of hitpoints for this character.
-Update: Damage received via Hunger have flags DAM_GOD|DAM_GENERAL|DAM_NOUNPARALYZE, if you want to change it just set Local.HitsHungerLoss to 0 and create your own damage there.

15-03-2014, Xun & Ben
Added support for packet 0xE2 (NewPacketAnimation), wich involves on updating some animations to a new packet and fixes most of the bugs on the gargoyles animations
(Throwing still needs some more updates to see the weapons coming back).

16-03-2014, Ben
Fixed #2285: FVAL returning wrong values in linux.

17-03-2014, XuN
Added @StatChange to ModStr/dex/int/food.

21-03-2014, Ben
Changed: Character creation to process 4th skill properly
Removed: EXTRASKILL.KEY and EXTRASKILL.VAL from f_onchar_create as they are being properly processed.

23-03-2014, matex
1. Fixed a crashbug in the nighly build.
2. @StatChange now receives argn1 for changes like:
0=OStr, 1=OInt, 2=ODex, 3=Food, 4=MaxHits, 5=MaxMana, 6=MaxStam, 7=MaxFood, 8=ModStr, 9=ModInt, 10=ModDex.

24-03-2014, matex
Fixed a calculation bug in Linux that e.g. had influence on Skilldelays

25-03-2014, matex
1. Fixed INT64 Expression handling.
2. Fixed a bug that occured when DIALOGCLOSE/DIALOG was sent to older clients
3. Fixed a minor bug in @StatChange

26-03-2014, matex
1. Fixed Cooking

26-03-2014, matex
1. Fixed a bug in ASC and ASCPAD with negative hex values
2. Fixed StatChange triggering for Food
3. Fixed a bug in the movement code, when climbing stairs with (BRIDGE|PLATFORM flags)
4. Updating logged out characters does'nt send a packet unless ALLSHOW is on

28-03-2014, Ben
Fixed #2296: Quality property not working.

28-03-2014, matex
1. Some internal values are still stored as 32bit (e.g. MORE1, ...). If they are negative their value
is now given as 64bit hex number so calculations,comparisions etc.. work on these values now.
2. Fixed an issue with MaxFood/Food. If MaxFood is set to 0, when read it will return the MaxFood level
of the chardefinition
3. Fixed: The server now only loads 1 Map, if you only use 1 Map.
4. Fixed: NPCs moving over obstacles when EF_WALKCHECK is disabled

29-03-2014, Ben
1. Uptaded Sphere.ini description for MAPx settings (These are now mandatory as of revision 1834)
2. Created an exception for MAP0 to load automatically even if not specified in sphere.ini (need at least 1 map to load)
3. Fixed another instance of 64 bit handling.
   (Script pack)
4. Fixed #2292: small change in teleport points for sphere_map_points0.scp and sphere_map_points1.scp
5. #2301 Few flag and typo changes done to sphere_map(2,3,5).scp

30-03-2014, Ben
Fixed system tray icon not removing on exit.

02-04-2014, matex
1. Introduced EF_NoContextMenuLOS => Will disable LOS checks for ContextMenu Use of npcs
2. Improved the standard Walkcheck stuff a bit (especially when dealing with landtiles)
3. Improved the placement code when items are dropped to ground
4. Increased standard LOS Zcheck treshold to 20
5. Changed the meaning of MOVERATE and TAG.OVERRIDE.MOVERATE. It is now a factor that scales the amount of DEX value 
   that should be taken into consideration for walking speed. E.g. if you only want 75% of the characters DEX value
   to be used in walkspeed calculations, you specify MOVERATE=75. Setting this to 100 has no effect.
6. Fixed: Backpack closing when items are dropped to corpse. (You can softscript this if you need it!)
7. Fixed: Use 1-Unit comparisons in Distance Checking. We can't use the axiom of pythagoras here because one tile has
   the same diagonal width as vertical and horizontal width. Doing real-world distance checkings messes up everything here!

08-04-2014, matex
1. Fixed HitsHungerloss. 
2. Modified behaviour of DiagonalWalkChecks when dclicking items in reach
3. If GM's add players to a party, the player is now added forcibly.
4. Fixed a possible itemleak when dropping too many items to the ground. (e.g. via newitem)
5. Fixed a null reference exception when DISPID of an item is set to something that wasnt defined via ITEMDEF. (e.g. change an item via set dispid)
6. Fixed an exception when you type 'c' in the serverconsole and have more than 100 players online ;)
7. Fixed a possible crash bug when players disconnect. Fixed players not logging out sometimes too. (this did only occur on VERY rare circumstances)

09-04-2014, XuN
-Added f_onaccount_pwchange to sphere_serv_triggers.scp
-Modified f_onaccount_create.
Both are fire now in each account creation / password change, no matter the source (serv.account xx ingame, via console, .set password...).

13-04-2014, Feeh
Fixed #2306: No lag should be noticeable after f_onserver_save call
Fixed #2293: Sphere should now read packets correctly from 6.0.1.7 clients

14/15/16-04-2014, Coruja (Script Pack)
sphere_map0.scp: 
-Removed: more generic non-OSI ROOMDEFs (huge cleanout) 
-Removed: some more weird ROOMDEFs 
-Added: missing regions for some islands 
-Fixed: incorrect GROUP set on Fire Temple, Ice Isle 
-Fixed: incorrect FLAGS set on Moonglow Zoo, Jail, Green Acres, shrine regions 
-Fixed: incorrect RECT set on Lord Britsh/Blackthorne Castle 
-Fixed: added missing 'region_flag_guarded' on Delucia 
-Fixed: added missing RECT tile on Cove, Green Acres 3 
-Small improvement on Britain and Mt Kendall RECT 
-Checkmate. Revised the entire script, everything is clean, fixed and categorized now 

sphere_map1.scp: 
-Moved: Solen Hive region from map0 to map1 (apparently Solen Hive exists only on Trammel) 

sphere_map_points0.scp: 
-Fixed: Delucia Passage teleporting to incorrect position 

sphere_map_points1.scp:
-Updated to match changes of previous sphere_map_points0.scp commit 

sphere_map0_ml.scp: 
-Moved: temp moved all SE/ML/HS regions to this file. Since it have only a few regions, maybe it's better disband this file and move all regions to their correct map file (map0, map3 and map4) 
sphere_map4.scp: 
-Small update on Tokuno Islands regions 

sphere_newb.scp: 
-Updated all skill to match OSI default starting items and colors. 
PS: Still need a few more additional items for professions (Warrior, Necromancer, Paladin, Samurai, Ninja) -> I can't update this for now, sphere only have support to skills on sphere_newb.scp,
	 but not for professions (it would be great if someone give a little help with this on the source :D) 

17-04-2014, XuN
Moved tag.override.SpellTimeOut to SpellTimeOut.
Changed: Now @Create trigger can be fired on EVENTS too. Note: be aware of the calls order (SkillClass -> added events -> ini -> chardef (for chars)),
		you can't retrieve the <str> ie in a custom event because it's fired before the @Create in the CHARDEF (which is the one setting it), this trigger
		doesn't have return 1 so if you set str=15 in your event it will be overwrited with the stat given in the chardef.

Changed all the variables in the 'New Variables' thread to make them readable not only from items/chars but from their BaseDef. That means, no need of IncreaseSwingSpeed
		under the @Create, you can set them like the NAME property. Added some variables too, read the post.

Script Pack:
Updated some scripts to reflect the variable's changes:
		-items/sphere_item_artifacts.scp
		-items/sphere_item_artifacts_minor.scp
		-items/sphere_item_artifacts_tokuno.scp
		-items/sphere_item_magic_jewelry.scp
		-items/sphere_item_provisions_armor.scp
		-items/sphere_item_provisions_clothing.scp
		-items/sphere_item_provisions_jewelry.scp
		-items/sphere_item_provisions_shields.scp
		-items/sphere_item_resources.scp
		-items/sphere_item_typedef_equipitem.scp
		-npcs/sphere_monsters.scp
		-npcs/sphere_monsters_custom.scp

sphere_item_vegetation.scp: Commented out TDATA3=i_vanilla_bean since it does not exist.

sphere_item_provisions_deeds.scp:
		-Fixed line 64: RESOURCES=i_deed,m_stone_and_plaster_house.
		-Changed all of the remaining i_multi_foundation_* to m_foundation_*.

sphere_item_provisions_armor.scp: changed all i_leather from gargoyle leather armor to i_hides_cut (lines 4704 - 5000).

For a complete change's track visit http://scripts.spherecommunity.net/

18-04-2014, XuN
-Fixed a Typo in sphere_item_typedef_equipitem.scp (SeldRepair -> SelfRepair)
-Updated sphere_monsters.scp to add stats to c_tiger and changed changed actual c_tiger to c_tigress
-Added item 03ec7 to sphere_item_ship_parts.scp to link it with c_tiger
-Updated sphere_defs.scp to reflect c_tiger and c_tigress as mounts.

19-04-2014, Ben
Changed: CANUSE flags can now be properly set on ITEMDEF and dynamic items (ITEMDEFs value is given to dynamic items on creation)
Fixed 1565: Removed TAG.OVERRIDE.RANGE from items and chars.
			Changed RANGE so it can be read/write on items and char (Dynamic object value overrides basedef value. Highest value between weapon and char is used in combat)
			RANGEH and RANGEL are also available as readonly variables for dynamic items and char now
			Added FIGHTRANGE to chars to replace old RANGE (readonly and returns the highest value used for combat)

19-04-2014, XuN
-Fixed 0002310: Changed t_weapon_bow in Throwing Items (sphere_item_provisions_weapons.scp) to t_weapon_throwing.
-Fixed 0002309: Mounted characters (humans & elfs) are not sending New Animation packet anymore.
-Fixed 0002294: Every CAN-related property (dye, enchant, flip...) is now working in base items instead of inheriting from DispID.
-Some internal changes related to IsHuman: changed it to IsPlayableCharacter and splitted it into IsHuman || IsElf || IsGargoyle and changed its calls.
	-Same for IsHumanID -> IsPlayableID = (IsHumanID || IsElfID || IsGargoyleID)
	-Fixed: Gargoyles are no longer able to ride anything.

21-04-2014, Ben
Fixed #2014: memory_aggreived not being set on players
Fixed #2311: t_light_lit not decaying as normal

23-04-2014, Ben
Fixed #1500: Quote causing problems for ARGS and ARGV. This is how is will work now in a simple function called TEST...
	-.TEST "a", b, "c,d"		Output: ARGS = a	ARGV[0] = a	ARGV[1] = b	ARGV[2] = c,d
	-.TEST "a"e, b, "c,d"		Output: ARGS = a	ARGV[0] = a	ARGV[1] = b	ARGV[2] = c,d
	-.TEST e"a", b, "c,d"f		Output: ARGS = e"a", b, "c,d"f	ARGV[0] = e"a"	ARGV[1] = b	ARGV[2] = c,d
	-.TEST f"a"g"h,i",b,e"c,d"	Output: ARGS = f"a"g"h,i",b,e"c,d"	ARGV[0] = f"a"g"h,i"	ARGV[1] = b	ARGV[2] = e"c,d"
	*All ARGV will now show even if quotes are found in first argument.
	*if quotes are found as the first character of an argument, what is found in the quote is the argument
	*if a quote is found but not at the beginning, or no quote is found, whole string is used as argument.

24-04-2014, Ben
Fixed #1739: ">" in QVAL's condition is now processed properly as "bigger than" instead of the end of QVAL

26-04-2014, Ben
Changed: TAG.OVERRIDE.DOORSOUND_CLOSE for DOORCLOSESOUND
		TAG.OVERRIDE.DOORSOUND_OPEN for DOOROPENSOUND
		TAG.OVERRIDE.PORTCULISSOUND for PORTCULISSOUND
Added: DOOROPENID to Items for new door system.
Fixed #2054: Should now be able to make any door work with new scripting options (default still works if no new data is found)
	-Game Item: (if no info here, use ITEMDEF info)
		-DOOROPENID=0676 //ID to change into (no DEFNAME as it's only used for dispid)
		-MOREX=-1 // X position change
		-MOREY=1  // Y position change
		-DOORCLOSESOUND=00f3 closing sound
		-DOOROPENSOUND=00eb opening sound
	-ITEMDEF: (if no info here and on game item, use default system)
		-TDATA1=00eb00f3 //WORD open | WORD close (sounds)
		-TDATA2=0676 //ID to change into (no DEFNAME as it's only used for dispid)
		-TDATA3=-1 // X position change
		-TDATA4=1  // Y position change

29-04-2014, Ben
-Fixed: VAR,TAG and LOCAL causing instability in the server with huge amount of data. Limit of 2048 caracters has been set.

30-04-2014, XuN
-Added SpellCount function for Spellbooks (Read Only).
-Tweaked Attacker system:
	Added attacker.add uid / attacker.delete uid. Self explanatory
	Changed: attacker.elapsed/dam are now writable

02-05-2014, XuN
Updated house deeds in sphere_template_vend.scp (Thx azmanomer).
Fixed: local.anim in @SkillStroke was readable but not writable. Fixed also alchemy skill sending anim 0 instead of no anim.
Rewrote totally the combat system for npcs ( I may have missed something but it's mostly done ):
	memory_war_targ is no longer used for npc combats (in the source) but is still present for scripting backwards, Sphere now uses the 'Attacker' system and a new variable added to it 'Threat'.
	added @CombatStart, @CombatEnd, @CombatAdd triggers, return 1 stops actions. (not recomendable, the actions will be called over and over obviously trying to start/add or end the combat).
	Attacker system (Added/Changed):
					NPC_AI_THREAT flag variable to ini enabling the use of the threat variable for choosing targets in combat (for npcs).
		General:	Attacker.add uid	(Write)		Adds the given UID as new enemy in the attacker list for this char.
					Attacker.Delete uid	(Write)		Remove UID from the attacker list.
					Attacker.Target		(Read)		Returns the current best target, these are the priorities: Threat -> Distance -> LOS.
					Attacker.ID uid		(Read)		Returns the 'n' id of the given uid (if in the attacker list, returns -1 if not).
		From ID:	Attacker.n.Threat 	(Read/Write)Gets or Sets the Threat of this character against me, Threat is most important factor to select a target. (this gets updated even if npc_ai_threat is disabled, but its not used)
					Attacker.n.Dam 		(Read/Write)Made it writable.
					Attacker.n.Elapsed	(Read/Write)Made it writable.
I'm updating the wiki with this new information also.

03-05-2014, Ben
-Fixed #2325: Corpse with morez > 0 were able to be draged
-Fixed #1781: Rejected moves should not count as a move for fast walk detection.

06-05-2014, Feeh
-Modified #2328: Dye tub now call @Dye on the dyed item
	ARGN1		= the hue value (r/w)
	ARGN2		= sound effect (r/w) (default 023e)
	ARGO		= the item that originated the dye target
	SRC			= who is dying the item 
	RETURN 1	= stop internal dying/sound. hue changes made from script will take place
	This will allow to change Dye behaviour for specific items without having to track the item id from other methods/scripts
	
07-05-2014, XuN
-Updated 'guards' defname in sphere_defs.scp, guards have other ID since long time ago.
-Added exception lines to the new Attacker_* functions so if something goes wrong... errors are more descriptive. Also fixed some exceptions appearing now.
-Attacker.elapsed -1 means no attacker decay.
-Fixed #2332: Range, also RangeL/RangeH not working as it should after the variables changes. Also made them return in decimal values instead of hexadecimal.
-Made BloodColor writable.
-Modified Guards system:
	Modified @CallGuards trigger for players calling separatelly than NPCs.
	This trigger will fire one time on the Player calling guards per each possible target, argn3 is set to 1 if the target is hostile, however if set to 0 nothing will happen, if this is set to 1 the character will be attacked by guards.
-Fixed guards dissapearing after calling them. They also stick now to the attacker system (if defined) being easier to create custom guards (changing how and when are they called will come in next commits)
-Added ini setting GuardsOnMurderers (1 by default), if set to 0 will only attack criminals, if set to 1 will attack criminals and murderers.
-Fixed: GuardsInstantKill now set hits to 1 before hit to ensure the kill, it was acting as instant hit instead of instant kill
-Changed: Moved the instant kill ouside the 'teleport' check, to ensure its using it everytime and not only if target.distance > 1
-Switched 2 checks to ensure that guards are not called on guards.
-Added a check in OnNoticeCrime() to avoid guards becoming criminals if send to attack any good character.

08-05-2014, XuN
Changed @Criminal trigger, now it's being called in every criminal call instead of in OnNoticeCrime(), return 1 prevents the criminal action, argn1 is how many time will the criminal status last.
Fixed CanUse returning weird values when ITEMDEF didn't have any value.
Added WeightReduction to item's weight calculations, so a item with 5.0 weight and 10 Weight Reduction will result in 4.5 weight stones.

09-05-2014, XuN
-Fixed an exception when attacking blue characters.
-Created a new vector-list to handle Notoriety: instead of having 2-5+ checks per second (and nearby character), the notoriety will be saved in this list to reduce a lot the loading related to this function.
-Added NotoTimeout to ini (default 30) to set the 'decay' for notoriety in each character for another one. However the list will be reseted in each criminal/murderer action/karma change/incognito cast.
-Fixed some Karma messages being shown even if the trigger returned 1. Fixed #2297: Trigger's returns were working wrong and any value given to argn1 was not really being considered by sphere unless return != 0.
-Fixed #2290: Now crafting skills cast animations and sounds when starting and in every Skill_Stroke > 1 (1 is the last, note that skill_stroke is called before the stroke ends, not before starting it).
-Removed SKF_NOANIM check after the @SKillStroke trigger, so even if the skill have this flag, it won't pass any value to local.anim, but if you want to have animation for a specific character, then you can write it.

09-05-2014, Ben
-Improved how RangeH/L 'fix' work and making them readable by dynamic items in every situation.

09-05-2014, Feeh
-Fixed #2326: Some mt_* CAN flags were not allowed to be assigned after char/npc creation. It should be assignable anytime from now

10-05-2014, XuN
Fixed #2334. Also forced that any character called to be a guard ( Argn1 in @CallGuards ) have brain_guard no matter what it is really.
Fixed #2333. Also fixing @Attack trigger blocking any other actions too when returning 1.
Added #1765 :New ini setting: AttackingIsaCrime making criminal any character without any damage, only attacking.

10-05-2014, Feeh (thanks to Ben)
Modified: @Dye is now called on more situations on both Items and Chars:
	-Script color changes					(SRC/ARGO = Server)
	-Dye tubs (t_dye_vat) color changes		
	-@Create color assignment				(SRC/ARGO = Server)
	-Staff .xcolor command					(SRC/ARGO = Server)

22-05-2014, Ben
Changed: char's AGE property now returns in days instead of seconds (CREATE is already in seconds)

23-05-2014, Feeh
Changed: Harvesting skills (Fishing/Mining/Lumberjacking) can now pack or place the harvested resource at feet
	Override ACTARG2 on either @SkillSuccess and @Success (remember that @SkillSuccess is called first)
	ACTARG2 = 0 -> Put the resource at feet
	ACTARG2 = 1 -> Pack the resource

26-05-2014, Ben
Removed and made permanent EF_FixKillTrigger, EF_WalkCheck, EF_NewPositionCheck, and EF_DiagonalWalkCheck

26-05-2014, matex
Fixed a small bug in the code that adds a player forcibly when GM's add to party.

27-05-2014, XuN
Changed: new order for @Create trigger in items, now the order is this; Itemdef, @ItemCreate for characters ( if proceed ), TEvents, EventsItem and Typedef
Fixed #2350: Guards working in non-guarded areas when GuardsOnMurderes=1
Fixed #2352: AttackingIsACrime checks making criminal when it shouldn't
Fixed #2351: Murderers never becoming criminal (didn't need before GuardsOnMurderers).
Fixed #2353: Wrong speech color for tillerman.
Fixed #2349. Also improved the Attacker_GetID() functions a bit.
Fixed #1491: region_flag_no_pvp not working fine. Also a wrong SkillUseQuick(tactics) related to it.
Added a new function to removed chars so they are being removed from attacker list's characters of their attacker's list. There's no reason to keep a not existing character.
Added ContextMenuLimit option to sphere.ini defining the maximum amount of options in each menu.

29-05-2014, XuN
Combat target for players will be 'reseted' after attacking a character, instead of checking for the best target ... so it now gives priority to player's choices.
Changed attacker.target also to reflect the changes and return the direct value instead of calling Fight_FindBestTarget().
Changed the way t_spawn_char creates the characters, they are now placed and the spawnitem is asigned before calling NPC_LoadScript() so, both spawn and regions can be read in the @Create (this can simulate a @CharCreate for spawns but on the character instead of the item.)
Changed summon to be placed also before the @Create.

01-16-2014, XuN
Changed @Attack: added Argn1 for npcs to allow modifying the initial 'Threat'.
Changed: Pets forced to attack (kill and attack commands) now adds 1000( plus the actual highest threat amount) to argn1 in the @Attack trigger.
Changed: Pets changes target instantly when attack is called always if NPC_AI_THREAT is off.
Updated sphere_defs_2.scp with m_keep.

06-06-2014, Feeh
Added: #2340 Sectors now do have flags, look at sphere_defs.scp for more info
Fixed: #2360
Fixed: BADSPAWN command was not stopping when the first bad spawn was found

11-06-2014, Ben
Added #2359: REGEN in REGIONRESOURCE can now have a range as argument.
Fixed #1827: Axis strip now works as case insensitive.
Fixed #2307: REGION_FLAG_INSTA_LOGOUT will now work in ROOMDEFs

23-06-2014, Feeh
Fixed #2366
Added: SERV.FUNCTIONS.x, it can display every available function and its access plevel
		Usage:
		SERV.FUNCTIONS.COUNT		- Return how many functions are available in your server
		SERV.FUNCTIONS.32			- Return the 33th function (zero-based)
		SERV.FUNCTIONS.32.PLEVEL	- Return the minimum access plevel to use this function
		SERV.FUNCTIONS.add1			- Return the minimum access plevel to use 'add1' function

1-07-2014, Ben
Updated: spherecrypt.ini with client 7.0.35
Changed: gold will now be taken from pack first and then from bank in a purchase
Fixed #2370: Not being able to walk up some stairs AGAIN!
Fixed #2371: Vendor buy/sell dialogs will now display in the same order as their templates

08-07-2014, XuN
Fixed, Updated and Improved the .dupe on both items and characters:
	- Added new variable's copy for both items and chars.
	- Duping characters now works fine: Stats, Skills, Tags, Items is copied now, by default every copied item have attr |= attr_newbie for security, using .dupe 1 will copy the items 'as they are' without mods.
	- Using .dupe 0 will create the mount's memory (if any) empty, so when npc dies... no mount appears, .dupe 1 will create another new duped mount character.

12-07-2014, Ben
Fixed #2372: Weightreduction causing errors when calculating weight.
Fixed a small issue with updating amount on items.

17-07-2014, XuN
Fixed #2345: Wrong titles for Elder/Legendary Bushido and Ninjitsu skills, updated sphere_msgs.scp.
Readjusted the skill ranges for skill titles according to http://www.uoguide.com/Skill_Title .
Added SKILL_TITLES to sphere_defs.scp to adjust the range for the skill's titles.

19-07-2014, XuN
SKF_GATHER enabled, only fishing will have this flag in sphere_skills.scp, so now @Stroke and @SkillStroke can be used.
@(Skill)Start and @(Skill)Stroke now use ACT as a reference for the worldgem.
@(Skill)Start have local.GatherStrokeCnt ONLY for gathering skills.
Fishing delay is now 8.0 (1 stroke), the splash animation is softcoded in sphere_skills.scp since working with timerf in the source will complicate things a little.
In the 'long and not even started' proccess of softcoding skills ... the sounds/animations (for fishing!) will be added in the skill's triggers.
Return 1 in @Stroke will fire @Abort.
Added RANGE for gathering skills determining the max distance for the proccess (added RANGE=4 for fishing in sphere_skills.scp)

22-07-2014, XuN
Removed default sysmessage when reading / writing Experimental and Option Flags directly ingame or from script.
SKF_GATHER is a generic flag now: Skills with this flag will automatically call for @Stroke and override default behaviour (no more calls to STAGE == SKTRIG_STROKE in the skill's function).
Added Range and SKF_GATHER to mining and lumberjacking, softcoded some code related to SKILL_STROKES of them (and fishing also) in sphere_skills.scp.

02-08-2014, XuN
Changed tag.override.breath.dam to Breath.Dam
Added Breath.Hue overriding the default explosion color for breaths.
Added @PartyLeave: return 1 stops the action
Modified Dir function, <DIR <src>> will return the dir you should have to face <src> (Same as FACE <SRC> but not turning you, just returning the DIR value).
Added Reveal (flags): Reveal statf_hidden will reveal player if has statf_hidden, same for sleeping, insubstantial and invisible. 
	Sum this flags to reveal more than 1 invis state (ie: statf_invisible|statf_sleeping will reveal player if any of these flags is present on him).
	Reveal -1 will reveal everything (Even invis staff).

Changed: SpellFlag_NoUnparalyze flag in s_explosion will affect explosion potions.
Changed: Argo is now writable ( Remember that Argo can only be accessed via script and not ingame ).
Added SysMessagef function accepting text with strings and limited to 3 args. Example: sysmessagef "Hello %s, I have a %s and %s, be aware of me!",<src.name>,<findlayer.1.name>,<findlayer.2.name>
	It needs the text to be inside " " to create the first arg with it, but first and last quotes will be removed (only these 2).
Changed: SkillUseQuick is now RW and not only Read because not always need a return.
SpellEffect ( CChar::Spell_Effect_Create() ) now set as NEW the UID of the spell's rune, IE: 'spelleffect s_poison,2000,<src>' ... 'new.remove ' will remove the poison rune.
Added @(item)MemoryEquip firing when equiping any item in memory layers (Not normal @Equip-able items), in example: paralyze rune, criminal memory ...
	argn1 = layer on which the item will be equiped.
	return 1 deletes the item and prevents default actions.
Fixed 'Range' not being properly defaulted to skill's defaults when no value is in the skill.
Fixed SKF_GATHER skills going to negative values when local.gatherstrokecnt=1.

Added SKF_FIGHT to fighting skills in sphere_skills.scp.
Fixed ADV_RATEs for parrying being too high and causing the skill to not gain.

Minor changes to 0x20 packet.

Modified ResPhysical to work like armor.lo. Modified Armor to be writable (only for items) and also Dam (for items and chars) and changed them from BYTE to WORD.
Moved Weight to dynamic items too.
Fixed bad definition of t_stone_town type in the f_stonesys_gettypename function inside sphere_genericstone_functions, should be <DEF.STONECONFIG_TYPENAME_TOWN>.
Added ColorInvis, ColorHidden and ColorInvisSpell to sphere.ini overriding (if specified) the default color for .invis, hidding or the invis spell/potion.

Fixed items remaining on the ground on Enhanced Client when equipping them via double click.
Fixed PacketMapChange being fired when DClicking an item and turning around (without OF_DClickNoTurn enabled). This should decrease the amount of rubberband effects.

NOTE: The following changes are supossed to be usefull to redo the default combat system, but not using the new trigger will make the new script and the following code useless so this is not forced,
	just a help to rewrite the actual sys without doing a whole new combat system allowing to tweak each check.
NOTE2: These changes are in 'beta' proccess, please report any problem to bugtracker.
NOTE3: If I was not clear enough... this makes no difference with current systems if the new trigger and dam_flag are not used.

Added DAM_FIXED to sphere_defs.scp: this flag will make sphere asume that the argn1 value in @gethit is the final damage and will not do any formula calculations over it,
	will only cast sounds,animations, blood, memories, attacker.n.% update and @GetHit trigger.
	It also have some effects in the hit proccess (explained under).
Changed: combat functions (hit & gethit ) to allow easy override via script with DAM_FIXED giving a better way to override the default combat system while knowing also the resulting damage
Added sphere_combat.scp with the override of the default combat system and explanations of the new changes also.
Added Swing Types in sphere_defs.scp for combat compatibility.
	//  SWING_INVALID = target is invalid, searching another one.
	//  SWING_EQUIPPING = swing made.
	//  SWING_READY = can't take my swing right now. but i'm ready
	//  SWING_SWINGING = taking my swing now.
Added Swing variable for characters setting or retrieving the SWING_TYPE they currently have.
Added FullTrigger function working like 'call' to call triggers with full support with old args and locals making possible to override default triggers with your parameters.
	FullTrigger must be write only to avoid some problems so I added the return value in local.return, which can be readed after the trigger call.
	Usage: FullTrigger @DClick
Added @HitCheck trigger just in the beggining of the hit allowing to use only custom combat checks (default ones are in the supplied script) or to override the whole combat formulas.
	- Args
		Argn1 = SWING_TYPE. Swing will be set to this value after the trigger so you can 'jump' between swings with or without default checks.
		Argn2 = DAM_FLAGS
	- Returns
		return -1 SWING_INVALID
		return 0 default checks
		return 1 will make Sphere return the SWING_TYPE applied in argn1, so if you are in SWING_SWINGING and you set argn1 to SWING_EQUIPPING you'll have to start the hit proccess again.
				(Note, argn1 there will NOT set SWING to it's value).
	- Special returns will be fired when SWING_TYPE = SWING_SWINGING & FLAGS & DAM_FIXED
		return 0 will generate the default damage formula and flags (if not set via argn2) and then call the gethit function without DAM_FIXED applied.
		return 2 will finish the hit function AS IT IS and will NOT call the gethit function (this asume you are creating the damage, formulas and calling .damage function).
Note: Using new DAM_FIXED or return 1, -1 will obviously NOT call any skillgain, memory change, exp, attacker update, notoriety, actions, etc. Using this will (almost) make you to rewrite the whole system as shown in the given script.

03-08-2014, XuN
Modified Dir and Face functions (and the not soft-coded functions) to prevent loading all items in each dir change, even if they were not send to clients they were consuming resources in the serve

04-08-2014, Ben
Fixed #2362: Old attacker code interfering with new code.
Added: BREAK and CONTINUE to script loops. (CONTINUE will skip to the next iteration, BREAK will exit the loop)

06-08-2014, XuN
Fixed a problem causing Staff with gm body (03db) to stick with this corpse and blocking following commands because of the '=' automatically appearing, Update is called when setting the body value.
Added party.create msg,uid(s) where msg is 0/1 sending default sysmessages or not (usefull when forcing groups 0 = disable ), the following args (up to 9 more) is/are the players to add to this party.
Changed all party triggers (Except the @PartyRemove when argn1=1, which means informative remove when a @PartyDisband has been fired before and is in proccess now) returnable to stop their following code.
Fixed crash bug introduced in last patch.

08-08-2014, XuN
Multiples items overplaced not doing their 'effects', ie: spell fields, because of returning the code after finding the first item. All of the changes related to this can be overriden in @Step and @itemStep.
	- Paralyzed characters won't move to any t_telepad or t_moongate location if they are freezed or stoned.
	- t_shrine was blocking the effect of any other items in its location, so now if players place any field or explotion or whatever upon it = free reskill.
Added #2380: Spell Fields check now the Z when creating, adjusting their position to it.
	Moved the FIX: code to FixZ() for CItem and CChar.
	Added also a bool bForceFix to MoveTo forcing a FixZ() after the Object positioning, updated the whole pack of *::MoveTo() to accept the new bool.
Fixed #2381: Reveal not removing the memory when spell s_invisibility was casted (layer 39) (only removing potion effect (layer 44)).
Added m_defenseBase and m_defenseRange splitting up the m_attackBase/Ranged properly between armor and damage instead of using it for everything.
Enabled some disabled variables for KR client status bar.

09-08-2014, Ben
Fixed: Another issue with stairs...

10-08-2014, Ben
Fixed #2383: Weight not changing after a baseid change resulting in weird weight calculations.
Fixed #2382: Reveal causing server freeze.
Fixed: Paperdoll not updating body color when using invis spell

11-08-2014, matex
Added EF_NoDiagonalCheckLOS = 00000001. Disables Diagonal Passage checks for legacy LOS. (Not advanced LOS)
Added FACING function to objects which will give you the direction the object/npc would turn to if it looks towards SRC.
Optionally FACING takes a location or uid as argument. This UID/location replaces SRC in that context.

16-08-2014, Ben
Fixed #2386: Ghosts can't pass through doors anymore
Fixed #2385: No swing animation during combat, @HitTry doesn't fire.
Fixed #2387: Hunger/starving causing wrong damage.
Fixed #2380: Field spells creating items on incorrect Z. (Caused by the Fix funtion. Fix should now work better in all places)

18-08-2014, XuN
Fixed some problems with ResPhysical.
Added @Resurrect trigger:
	- argn1 is the hitpoints value the char will have when resurrected (RW).
	- argo is the corpse (if any near) (R).
Fixed some items removed from view in some circumstances.

26-08-2014, Ben
Fixed: SLEEP causing NPCs to die with double corpse.

04-09-2014, matex
Fixed: character hue not updating when Char is revealed.

04-09-2014, matex
Xun made the WEIGHT property on writable on items. I renamed it BASEWEIGHT because we need
WEIGHT not to return the weight of a single instance but also of the whole stack in scripts.
So WEIGHT is read-only again. If you want to change the base weight, use BASEWEIGHT.

07-09-2014, matex
Fixed: Armor not updating when BaseID is changed on an Item.
Fixed: EF_FixCanSeeInClosedConts always enabled in Debug builds
Fixed: Walking code. Only stair statictiles are priorized now near the map-surface. Platform tiles not. (players were falling through map surface)
Fixed: Order in which NPCvendor boxes are sent to the player (display bug)

10-09-2014, matex
Refactored some of the walking code. You now need NPC's and Players to have MT_INDOORS definitely for them to be able
to go under static tiles.
Changed MT_INDOORS to MT_NOINDOORS. Think that makes more sense.

13-09-2014, matex
Built in LOCAL.ArrowHandled for @HIT, @HITMISS
so if you set this to something different from 0 in the triggers
the server will not BOUNCE drop the arrow to the Target's feet on MISS
or bounce it to the Targets BP on hit. You can handle this yourself.
If you do nothing, the arrow will be deleted if Local.ArrowHandled != 0
You can prevent it from being deleted by moving it in the Trigger.

13-09-2014, Ben
Fixed #2397: Return 1 should now prevent the guards from coming under @callguards in all instances

01-10-2014, Coruja
- Fixed: Strange walk animation when using Alchemy skill.
- Fixed: MAKEITEM refusing to craft items on Cooking skill.
- Fixed: The pet poop now comes with ATTR=attr_move_never by default.

- Changed: Improved sound of pets pooping on the ground.
- Changed: A little sound/anim tweak on some crafting/harvesting skills.
- Changed: Reduced default RANGE on Blacksmithing and Lumberjacking skills (3 -> 2 tiles).
- Changed: Alchemy skill is now a craft skill like any other. No more exclusive behaviors.
  The skill is now used clicking on it's tool (mortar & pestle) instead click on the reagent or empty bottle.
  EFFECT now can be used to control the % of lost resources on skill fail.
  Skill stroke behavior now works fine on alchemy (LOCAL.CraftStrokeCnt on skill @Start, and @SkillStroke on chars).
  [sphere_skills.scp] Added FLAGS=skf_craft to alchemy skill
  [sphere_item_provisions_potions.scp] Added missing 't_mortar' on potions SKILLMAKE
  [sphere_msgs.scp] Removed some alchemy internal messages
  WARNING: Make sure to update your scripts following these changes, otherwise alchemy skill will not work anymore.

02-10-2014, Coruja
- Changed: Cartography skill is now a craft skill too. The craft now uses default MAKEITEM instead the hardcoded DRAWMAP.
  The skill is now used clicking on it's tool (mapmaker's pen) instead click on the skill button or blank map.
  Removed obsolete DRAWMAP hardcoded function. The behavior is now softcoded using @Create on map items.
  [sphere_skills.scp] Softcoded the client skill button behavior, it comes disabled by default
  [sphere_item_profession_cartographer.scp] Added new items for maps and mapmaker's pen
  [sphere_defs.scp] Added new hardcoded typedef 't_carpentry' used on the tool to open the skill menu
  [sphere_template_vend.scp] Updated NPC Mapmaker vendor buy/sell template list
  [sphere_skillmenu.scp] Updated cartography skillmenu
  [sphere_msgs.scp] Removed some cartography internal messages
  WARNING: Make sure to update your scripts following these changes, otherwise cartography skill will not work anymore.

07-10-2014, Coruja
- Added: New formula for dragon breath damage on NPCs brain_dragon, it's now NPC_CurrentHitpoints * 0.16 (if BREATH.DAM property is set, it will override the internal damage).
- Fixed #2405: Players becoming criminal when attack someone on the same guild.
- Changed: Increased NPCs view range from 12 to 14 tiles. This also affects the range to call guards.
- Changed: Cooking skill is now a craft skill.
  The skill is now used clicking on it's tool instead click on the raw food and select a fire source (but the fire source still needed in range).
  [sphere_defs.scp] Added new hardcoded typedef 't_cooking' used on the tool to open the skill menu.
  [sphere_item_profession_cooking_barkeep_baker.scp] Added typedef t_cooking on i_fry_pan, i_flour_sifter, i_rolling_pin. Also fixed many food items using wrong MOREZ
  [sphere_msgs.scp] Added/Removed some cooking internal messages
  [sphere_skillmenu.scp] Added missing sm_cooking skillmenu
  WARNING: Make sure to update your scripts following these changes, otherwise cooking skill will not work anymore.

08-10-2014, XuN
- Added Argn3 value in @UserWarMode telling Sphere to remove Attacker list after execution.
- Added a description of deletion in argn1 for @CombatDelete:
  0 = Forced (Blocked attack, default uncategorized actions...)
  1 = Max fight time has reached (Elapsed)
  2 = Distance/LOS
  3 = The character is no longer existing
  4 = Forced via attacker.delete methods (ingame/script)

- Fixed ResPhysical no showing the correct values in the Status gump.
- Fixed Stoned players being able to dismount. 

09-10-2014, Ben
- Fixed: RETURN 6 not halting scripts when inside an IF statement.
- Fixed: .fix will now default to the first terrain elevation instead of lowest Z possible.

10-10-2014, XuN
- Added local.anim and local.animDelay (this last one only working for classic clients) to @HitTry, so animations can be disabled and fired later in @hit (to remove the odd behaviour with new animation packets, which doesn't have delay).
- Added OF_NODClickTarget to ini, enabling this will not make the cursor appear as a target when double clicking weapons to equip them.

11-10-2014, Ben
- Added #2394: SMSG_DEF_UNICODE, MSG_DEF_UNICODE, IMSG_DEF_UNICODE to sphere_msgs.scp. If set to 1, messages will be sent in unicode unless overwriten with the the mode in @hue,font,mode.

11-10-2014, Coruja
- [sphere_defs.scp] Added new BFONT_* colors to use on HTML texts. Values already match most colors used on OSI dialogs.
- [sphere_map0.scp] Fixed duplicated a_dungeon_10 AREADEF (the last one was renamed to a_dungeon_19).
- [sphere_map_points0/1.scp] Fixed Hythloth entrance teleport.

12-10-2014, Ben
- Fixed #2416: @Enter region trigger will now fire after NPC stats are set in all instances.
- Fixed: local.return not being set in FULLTRIGGER if no args were specified.

14-10-2014, Coruja
- Added: New MAGICF_NOCASTFROZENHANDS setting on sphere.ini. If enabled, this will prevent cast spells if the char got paralyzed holding something on hands.
- Added: Missing behavior for SPELLCHANNELING item property. It's now working fine, items using this property won't get unequiped when casting spells.
- Fixed: Triggers @Start (spell trigger) and @SpellCast (char trigger) unequiping weapons and playing the spell cast animation even when the cast got denied using 'return 1'.
- Changed: Updated width/radius internal values for area/field spells (nothing really changed, just hardcoded values already set on sphere_spells.scp to be the default internal value if there's no value defined on scripts to override it).
- Changed: Create Food spell is now target-based. Using SPELLFLAG_TARG_* the food will be created on ground at target location, otherwise it will be created on caster backpack.
  [sphere_msgs.scp]: Added new messages for 'spell_create_food' and 'spell_try_frozenhands'.
  [sphere_spells.scp]: Removed target flags on Create Food spell. It will now create the item on backpack by default.
  [sphere_dialog.scp]: Added missing description for 'nodispose' on help guide.

16-10-2014, Coruja
- Fixed #1860: Spell cast behavior now check for spellbook/mana/reags before check for anti-magic region.
- Changed: return 6 on @SpellCast trigger now will skip anti-magic region check too.
- Changed: Polymorph spell now doesn't change char status anymore. If needed, this behavior can be softcoded using @Success on Polymorph spell (ACTARG2 [read/write] is the new body ID)
  [sphere_spells.scp]: Added missing spellflag_noprecast and cancel functionality for polymorph spell. If used while already polymorphed, it will remove the polymorph effect.

17-10-2014, Coruja
- Added: New MediumCanHearGhosts feature on sphere.ini (default value: 100.0). At this Spirit Speak skill level players can understand ghosts speech instead hear 'oOOoO ooO'.
- Fixed: Functions GM, PRIVSET and TOGGLEABBREVIATION not updating the char tooltip correctly.
- Fixed: MSG_DEF_COLOR def on sphere_msgs.scp not working when the char click on itself.
- Fixed: Char flag [stone] overriding [frozen] and [tame] overriding [npc]. Also fixed [tame] only showing inside guarded regions.
- [sphere_msgs.scp]: Added new defs to customize EMOTE color/font/unicode. These changes are global, and EMOTE still not support @color,font,unicode on individual messages yet.
- [sphere_map_points[0/1].scp]: Fixed 'Lighthouse' teleport not working.

18-10-2014, Coruja
- Added: New VendorTradeTitle feature on sphere.ini. If enabled, it will show the job title on vendor names (eg: Alan the Carpenter).
- Changed: Corpses now will be created with TAG.OVERRIDE.MAXWEIGHT already set (value is always the same as char MAXWEIGHT). This will prevent overweight problems if someone drop many heavy items on a player corpse and then resurrect the player just to make him get stuck.

20-10-2014, Coruja
- Changed: Scissors won't cut hair/beard anymore. Now proper items are needed to do it, like items usually found on NPC Barber (hair restyling, hair dye, etc).
- Changed: Sewing Kit can't be used directly on bolts of cloth anymore. To use the bolts of cloth we must cut it using scissors first.
- Fixed #2421: Using scissors on bolts of cloth now will convert it properly to cloth.
- [sphere_msgs.scp]: Added new message 'loot_criminal_act' when opening corpses to warn that looting items will be a criminal action.

22-10-2014, Coruja
- Added: Missing functionality of EF_PetSlots feature on sphere.ini. It's working now, but still need some testing and final tweaks.
  [sphere_msgs.scp]: Added new messages for petslots_try_*

23-10-2014, Coruja
- Fixed: Minor EF_PetSlots issues. Now everything is working fine and it's ready to use.
- Changed: NPCs using BRAIN=brain_animal_trainer won't give food to players anymore (but still able to feed pets nearby).

23-10-2014, XuN
- Changed Argn3 in @UserWarMode to force a war/peace status ( 0 = do nothing, 1 = force peace, 2 = force war).
  NOTE: Argn3 is no longer deleting Attacker's lists, to do so use attacker.clear.

26-10-2014, Coruja
- Changed: Many improvements on pet stables behavior.
  Also the max limit of pets that the NPC can hold for a player now is based on player skills (Animal Taming + Animal Lore + Veterinary). Usually it can hold 2~8 pets.
  If TAG.MAXPLAYERPETS is set on the NPC, it will override the formula and will be default value for all players.

- Added: Account character creation now will create characters with MAXFOLLOWERS=5 already set.
- Fixed: House customization engine creating doors using wrong type 't_door' instead 't_door_locked'.
- Fixed: EMOTE_DEF_* defs not working on attack messages (*Someone is attacking you!*).
- [sphere_msgs.scp] Changed 'stablemaster_*' defmsg to new defs/texts. I HIGHLY recommend update it, since the old 'stablemaster_*' defmsgs won't be used anymore.

27-10-2014, XuN
- Attacker.clear can be used now even if character doesn't have a Attacker list, so no error is log in console.

28-10-2014, Coruja
- Fixed: Function REGION.REGION.* returning wrong parent region if used on regions which is already the parent region.
- Fixed: Function MAKEITEM and some crafting skills always crafting itens using amount=1 instead follow the item replication rule.
- [sphere_defs.scp] Added html color defs for BFONT_LRED, BFONT_LYELLOW and BFONT_LCYAN.
- [sphere_monsters.scp] Changed human/elf/gargoyle MAXFOOD to 20 (OSI default value).

28-10-2014, XuN
- Fixed #2396: Attacking aborted when target is out of range, even if COMBAT_StayInRange is disabled.
- Changed Read mode for 'Title', now giving it a parameter will return the 'Trade Title' (Grandmaster Swordsmanship, Journeyman bowcraft, etc) instead of the custom title. (Example of usage: <title 1>).

29-10-2014, XuN
- Added can_i_forcedc (sphere_defs.scp), adding this flag to an item will allow it to be DClickable in every situation: from one side of the map to another, or even in another map, weared by another character, or GMs too, no checks at all.
  NOTE: Player's cant DClick what they don't see but they will be able to do it with the LastObject macro, or by knowing the UID and using 3rd party programs, be aware of that.

02-11-2014, XuN
- Fixed GetNPCBrain() not working as it should and returning wrong brain (in internal usages) and ignoring the Brain used in CHARDEFS in some cases.
- Added Ignore value to Attackers: Setting it to 1 will make the character ignore this target (mostly used by NPCs), when looking for target.
  @CombatAdd has now 2 arguments:
    Argn1 = Initial Threat (If used).
    Argn2 = Setting it to 1 make this enemy to be added as Ignored. (Setting it to 1 for a player in every NPCs will make this player be 'invisible' for them, good to create a faction system and such things).

02-11-2014, XuN, Ben, Feeh (and tons of help from Karma).
- Ship's patch:
  Added Packet 0xF6 (New Ship's Movement): This packet is affecting ships on client > 7.0.8d (High Seas ones), regardless of the multi files, patched ship's or not patched ones... it's a client's packet.
  Added Packet 0xF3 (Packet Container): Used to send tons of items/chars at once in one only packet, used to send items and chars inside multis (Houses and Ships). Clients > 7.0.0 (Stygian Abyss).
  Added ShipSpeed and SpeedMode for [Multidef ] definitions:
    ShipSpeed=2,1 (Period,Tiles): Period (in Tenths of second) tell the ship the delay until it moves again, tiles means the tiles moving (Default and suggested is 1, others won't work because of ... (read next line)).
    SpeedMode=(0x01 = one tile, 0x02 = rowboat, 0x03 = slow, 0x04 = fast). This modes have no sense until we have MultiThreading and can change the ticks per sec from 10 to 100 to make ships to move each 0.25seconds (which we cannot now).

  Updated multis_ships.scp with these new values.
  Fixed ship's planks not working.
  Updated the Update and Move (and their related functions) to send the minimal updates required, hence making less rubberband effects.
  Fixed some issues with EC and ships making visual strange effects, items staying behind the ship.
  Fixed some problems when turning the ships.
  Some more minor tweaks related to ships.
  
  NOTE: Mouse Wheel Movement packet is NOT included in this commit.

02-11-2014, Ben
- Changed: ARGN2 in @Abort and @SkillAbort (and other Skill triggers) will be the spell number if magery is used

03-11-2014, XuN
- Fixed #1820: Combat_PreHit not working with Archery.
- Fixed #1621: StatLocks not working, fixed and improved the whole statgain system.
- Updated spherecrypt.ini
- Changed .shrink now can have a value which will automatically bounce the figurine.

05-11-2014, Ben
- Removed previous changes: (ARGN2 in @Abort and @SkillAbort (and other Skill triggers) will be the spell number if magery is used)
- Replaced with LOCAL.SPELL (read only) as ARGN2 was already in use by some of the skill triggers.

09-11-2014, Ben
- Fixed #1644: Corpses will now move with ships.

10-11-2014, Coruja
- Fixed: SPELLTIMEOUT char property not working correctly.
- Added: support for some human/elf racial traits (only used if FeatureML is enabled on sphere.ini)
    Tracking skill: humans always have a minimum of 20.0 tracking skill, and elves are more difficult to be tracked.
    Max weight: humans can always carry an aditional 60 stones of max weight.
    Nightsight: elves always have nightsight enabled by default.

- Changed: Some internal improvements on Tracking skill
  Improved search distance.
  Ghosts can't be tracked anymore.
  Spyglass item is no longer required to use Tracking skill inside ships/boats.
  Triggers @Stroke / @SkillStroke now are called at each tracking stroke.
  Removed redundant skillmenu button "Track anything that moves".
  New OSI formula to check tracking difficulty when trying to track players. It will use the char skills (Tracking, Detecting Hidden) vs target skills (Hiding, Stealth).
  [sphere_msgs.scp]: Updated some 'tracking_*' messages. Also merged all 'skillmenu_text_*' (only used on tracking skillmenu) into 'tracking_*'.
  [sphere_skills.scp]: Added OSI-like support for ARROWQUESTS on tracking skill (softcoded). OSI uses only the arrow to track (with no messages) but I will leave the old messages as it is for compatibility purposes with old clients.

16-11-2014, Ben
- Fixed: Added Items on ships with .add will now move with the ship.
- Fixed: Ships should now move alot smoother with SA+ clients and back to normal with older clients

18-11-2014, Coruja
- Fixed: Pet tooltip menu showing to dead players.
- Fixed: Pet tooltip menu showing 'Drop' button when the pet has no backpack access.
- Fixed: Added missing 'Release' button on pet tooltip menu.
- Changed: Pet friends now have limited access to pets commands instead full access. Friends now can only use follow / stop / stay commands and open the pet backpack (if avaible).

18-11-2014, Ben
- Changed evelation at which items are considered to be part of a ship. (-2 to +15 from top of deck).
- Fixed: party_add_notleader defmessage was wrong -> party_notleader is correct.

22-11-2014, Coruja
- Added: Wisdom racial trait on elves (they always have +20 max mana). It works only if FEATURE_ML_UPDATE is enabled on sphere.ini
- Changed: 'Open Bankbox' / 'Check Balance' context menu buttons on NPC Banker (brain_banker) now will make the NPC hear 'bank'/'balance' words instead call hardcoded functions to open bank or check balance. In other words: now both context menu buttons and spoken commands are consistent and can be softcoded.

23-11-2014, Coruja
- Added: Tough racial trait on humans (they always have +2 hitpoint regeneration)
- Fixed: @GetHit trigger not returning some ARGN2 values (like dam_fixed).
- Changed: Updated some damage flags used internally on spells.
- Changed: RegenHits/RegenMana/RegenStam char properties now will override default Regen[0/1/2] values on sphere.ini instead decrease it.
- Changed: Optimized hunger/starving engine
  Fixed FOOD property returning to 1 after reach 0.
  Fixed hunger message not showing on mounted pets.
  Fixed @PetDesert trigger showing the pet desert message even if the trigger is using return 1 to prevent the action.
  Changed starving damage flags (dam_god|dam_general|dam_nounparalyze to dam_fixed)

- [sphere_defs.scp]: Updated [DEFNAME dam_flags] section to match the correct internal flag list.

29-11-2014, Coruja
- Added: FEATURE_AOS_DAMAGE on sphere.ini now will display to pet owners the damage caused by pets.
- Fixed: .DUPE function on items not duping the item timer.
- Fixed: NPCs showing wrong color on chars on some specific cases.
- Fixed: Paperdolls showing the "," after the char name even when there's no title to display.
- Changed: only players can have skill titles on paperdoll now.

04-12-2014, Ben
- Added: OF_NoSmoothSailing in sphere.ini to disable smooth sailing and keep old behaviour

06-12-2014, Ben
- Fixed: Crash caused by 2 handed weapons no updating properly
- Fixed: EF_PetSlots not checking chardef for FOLLOWERSLOTS
- Fixed: possible more ship errors...

07-12-2014, Coruja
- Added: Eating foods now will recover stamina too (OSI default gain: rand(3,6) + FoodRestoredByItem/5)
- Fixed: Console error when ridden pets get hunger.

14-12-2014, Ben
- Fixed #2437: Ships were able to turn onto other ships in certain conditions.
- Added #2429: TAG.SpawnItem will now contain the spawngem's uid for items that are spawned.

14-12-2014, Feeh
- Added: SERV.RTIME.GMTFORMAT. Works exactly like RTIME.FORMAT but returns GMT time

17-12-2014, Ben
- Fixed #2437 & #2440: More ship movement issues.

21-12-2014, Ben
- Fixed #2442: More Ship errors.
- Fixed #2444: better detection of valid .add arguments.
- Added: d_add dialog will now be used, if it exist, for .add instead of menu_additem
- Fixed #2441: Gargoyle horn color not bing set properly.

23-12-2014, Ben
- Fixed: Minor bug in .add command since the last update that didn't allow numeric arguments.
- Fixed #2450: when COMBAT_ALLOWHITFROMSHIP is disabled, you can no longer attack someone inside a ship while outside.
- Fixed #2447: Ships not updating properly when leaving the screen.

24-12-2014, Coruja
- Fixed: Added missing 'invalid command/format' message when type '.add' command using invalid arguments.
- Fixed: Weapons wrongly using DAM property from the ITEMDEF even when it have a custom DAM property set on the created item.
- Added: New tooltips on weapons/armors to show many item properties like DAM[physical/fire/...], RES[physical/fire/...], BONUS[str/dex/int/hits/stam/mana], LUCK, etc.
- Changed: Weapons/armors won't decrease their damage/armor value based on item durability anymore (if someone still need it, this can be softcoded using @Damage trigger on weapons/armors to change their DAM/ARMOR values).
- Changed: Tooltips now will auto update when item/char properties got changed.

25-12-2014, Ben
- Fixed #2447: Again...  Ships not updating characters properly when leaving the screen.

31-12-2014, Ben
- Added: "BREAK" function under @create and @npcrestock to return to normal script interpratation after an ITEM= line since any lines under it was designed to modify the item. (any BUY or SELL line will also break ITEM loop)
- Changed #2451: Items will now be allowed to be "locked down" to ships and still move with the ship.
- Added: new .ADD dialog to replace old add menu. (old menu still available in the scripts by removing d_add dialog, but it is full of errors)

09-01-2015, Ben
- Added: Item trigger @Ship_turn with ARGN being the direction the ship is turning. It fires on all items on a ship, including the ship itself.

16-01-2015, Coruja
- Added: Support for NIGHTSIGHT property on items. Items with NIGHTSIGHT=1 will automatically enable/disable a permanent nightsight effect on equip/unequip
- Added: New optional flag OF_ScaleDamageByDurability on sphere.ini to make weapons/armors lose DAM/AR if the item get damaged. The value is based on current item durability, so the damage can be reverted if the item get repaired.
- Fixed: Tooltips not updating when some char properties (criminal/kills/flags/invul) are changed
- Fixed: Guards on 'red regions' (regions with TAG.RED=1 set) always using name hue 021 instead ColorNotoEvil set on sphere.ini
- Fixed: All item memories different from spells/potions getting wrongly named as 'Potion Cooldown'
- Fixed: Function BADSPAWN not looping through inactive spawns (spawn item with TIMER=-1 set)
- Changed: Item tooltips now can read properties set directly on ITEMDEF too

[sphere_msgs.scp]: Updated some messages (magery_6, msg_corpse_of, npc_pet_decide_master, spell_try_am)
[sphere_combat.scp]: Updated obsolete 'dam_lightning' to 'dam_energy'
[sphere_skills.scp]: Improved ARROWQUEST position on Tracking skill
[sphere_map_points5.scp]: Updated Ter Mur moongate list
[sphere_monsters.scp]:
  Added missing DAM on c_man, c_woman, c_elf_male, c_elf_female, c_gargoyle_male, c_gargoyle_female, c_man_gm
  Fixed COLOR on c_cat, c_dog

16-01-2015, Ben
- Fixed: MULDIV rounding up negative numbers when they should be rounding down.
- Fixed #2457: TAG.ALWAYSSEND will now be checked on ITEMDEF too.
- Fixed #2458: Made attr_static not movable with ships.
- Fixed #2456: Archery Butte not working properly.
- Some changes to FEATURE_SA_MOVEMENT (This seems to affect speedhacking, would require some more testing) (possible fix for #2435 for SA+ clients)

24-01-2015, Ben
- Fixed: Undefined keyword 'ITEM' error when restocking vendors.
- Modified: Order of @Create triggers to satify all situations.
    1 - CHARDEF's @Create runs first with @NPCRestock that follows (character does not have a position yet)
    2 - The character is placed in the world (This should fire @Enter in the appropriate region, and unlike before, the character is fully created)
    3 - TEVENTS @Create is fired (character now has a position)
    4 - EVENTSPET @Create is fired

24-01-2015, XuN
- Stackable items with different 'new variables' like ResPoison, UsesCur, etc cannot be stacked anymore.
- Added MaxAmount variable to stackable items with a default value of 65535 (not using this means no changes). This affect both Itemdefs and already created items (which can differ if you set to).
- Droping on self/backpack and bouncing stackable items now makes Sphere trying to reach MaxAmount,
    so if you have one pile of 50k of gold and you drop another 50k you'll end with one stack with 65535 coins and another one with 34465,
    obviously, if you set [itemdef i_gold] to MaxAmount=50000 this will not happen.
- Maximum value of MaxAmount keeps being unsigned short, the same, 65535 because of client limitation.
  Non stackable items doesn't have MaxAmount


26-01-2015, XuN
- Added 'click' function, doesn't need explanation I think.
- Setting UsesMax will raise UsesCur too if UsesCur is 0.
- Added UsesMax to tools from sphere_item_profession.scp and lumberjacking items (axes/polearms) in sphere_item_provisions_weapons.scp
- Using Destroy 1 will make the item emote it's destruction.
- Updated Lumberjacking,Fishing and Mining in sphere_skills.scp reflecthing Destroy changes.

27-01-2015, XuN
- Updated @CombatDelete trigger with a new argn1 value, now it's telling Sphere to remove or keep 1/0 the attacker's memories when removing him from the list.
- Added @HitIgnore trigger firing when one character is going to avoid an ignored target in the target selection: argn1=1 keep him ignored, argn2= un-ignore target (so character can attack him again).
- Added @Eat trigger, read wiki for more info: http://wiki.sphere.torfo.org/index.php/@Eat

28-01-2015, Coruja
- Added: Support for packet 02c to display char death animation (the famous "You are dead" black screen)
- Changed: Min account plevel to bypass MinCharDeleteTime setting on sphere.ini changed from 3 (Seer) to 2 (Counselor)
- Changed: return 1 on f_onchar_delete function (sphere_serv_triggers.scp) to deny char exclusion now will show a proper message ("couldn't carry out the request" instead "character is not old enough")
- Changed: Some tooltips behavior below
    Items amount value now will show directly on item name instead a new tooltip line
    Added missing tooltips for Insured (attr_insured), Quest Item (attr_questitem) and Crafted by [CharName] (CRAFTEDBY property)
    Added weight tooltip on all movable items if FEATURE_ML_UPDATE feature is enabled on sphere.ini (although it's not a ML feature, OSI started using this tooltip only on ML)
    [sphere_msgs.scp]: Removed 'tooltip_tag_amount' text

29-01-2015, Coruja
- Changed: Major improvement on combat engine (damage/resist calculations)
    COMBAT_SPECIALDAMAGE and COMBAT_USE_RESISTANCE settings on sphere.ini are now a single COMBAT_ELEMENTAL_ENGINE which does the same thing (but now unified).
    COMBAT_ELEMENTAL_ENGINE now totally overrides pre-AOS AR calculations with AOS damage/resist types instead use both at the same time.
    Fixed formula for AR calculation
    Fixed formula for char damage calculation. If unarmed (wrestling) the base damage will be the char DAM (usually 1-4), and using weapons the base damage will be the weapon damage. This base damage can be increased with some bonuses (if COMBAT_OSIDAMAGEMOD is enabled, it will use OSI bonus calculation, otherwise it will use sphere default bonus [STR/10]).
    On AOS+ clients, the char status menu now will show exactly the damage range that the char can deal (including all bonuses)
    New blood effects
    Old [Physical/Fire/Cold/Poison/Energy]Damage properties got removed and replaced with the new DAM[Physical/Fire/Cold/Poison/Energy].
[Sphere.ini]: Removed COMBAT_TARGETTEDHIT, COMBAT_SPECIALDAMAGE and COMBAT_USE_RESISTANCE settings, and added COMBAT_ELEMENTAL_ENGINE
[sphere_msgs.scp]: Removed all "combat_hit_*" messages.

30-01-2015, XuN
- Improved how Notoriety is checked for pets with PetsInheritNotoriety flags in the ini, now the notoriety is redirected instantly to pet's owner to avoid some checks and speed up the code. (Nothing has changed, it's just an improvement)
- Updated fonts on sphere_item_typedef_equipitem.scp for 'unidentified' value on tooltips.
- Splitted stats regens from CChar::OnTick() to CChar::Stats_Regen()
- Re-Added old polymorph stats boost under MAGICF_POLYMORPHSTATS (0800) in sphere.ini.
- Added MaxPolyStats to ini to override old hardcoded value, this limits the amount of stats gained through polymorph spell (default 150).

30-01-2015, Coruja
- Added: 5 new optional arguments on DAMAGE function to make it compatible with COMBAT_ELEMENTAL_ENGINE feature
    Sintax: DAMAGE value, dam_flag, source, physical(%), fire(%), cold(%), poison(%), energy(%)
    Example: DAMAGE 50,dam_general,012345,70,30,0,0,0 will split 50 damage into 70% physical damage + 30% fire damage
- Added: Internal support for COMBAT_ELEMENTAL_ENGINE on spells, explosion potion, etc
- Added: New OSI formula to calculate spell damage if MAGICF_OSIFORMULAS feature is enabled

04-02-2015, Ben
- Added: guardcall defname to sphere_def.scp in the [DEFNAME HARDCODED] section to allow an override of the words used to call guards. (multiple words can be defined) 
- Fixed #2473: Can't get on other ships from your ship anymore.
- Fixed #2467: Orc ship north missing 1 component.

07-02-2015, Ben
- Added: Outgoing Packet Filtering using keyword OUTPACKETx=function_name in sphere.ini (works exactly like PACKETx=function_name but for outgoing packets)

13-02-2015, Coruja
- Changed: Increased the area radius to call guards [14 -> 18 tiles].
- Changed: RESPHYSICAL won't be merged with AR anymore, now both properties can have independent values. Sphere will choose the property to display on client status gump based on COMBAT_ELEMENTAL_ENGINE setting on sphere.ini (enabled = RESPHYSICAL / disabled = AR).
- Added: Weapons and armors now will automatically set DAM*/RES* char properties on equip/unequip.
- Fixed: Login internal behavior adding TAG.LastHit=0 on chars even when COMBAT_PREHIT is disabled. This tag is only used by COMBAT_PREHIT, so if it's disabled the tag won't be added anymore.
- Fixed #2391: Nearby char names showing wrong notoriety color on client login.

15-02-2015, Coruja
- [sphere_defs.scp]: Added missing defs for 'colors_metal' and 'colors_bright'
- [sphere_template.scp]: Added missing 'random_talisman' template
- [sphere_skills.scp]: Removed USESMAX behavior from Fishing skill (I dont know why, but OSI doesn't seems to use the 'Uses Remaining' behavior on this skill)
- [items/*]: Added missing USESMAX property on skill tools items (and removed from i_pole_fishing)
- [towns/sphere_town_dlg_master.scp]: Fixed console error [replaced function f_stonesys_iswarring -> f_townsys_iswarring]
- [towns/sphere_town_functions.scp]: Fixed console error [replaced typedef t_town_town -> t_stone_town]

18-02-2015, Coruja
- Fixed: Added missing newline break (\n) on some console error messages.
- Fixed: Bulletin Board showing wrong author name on messages when the reader have GM=1 privileges.
- Added: Items with LUCK property now will set char LUCK on equip/unequip.
- Added: Missing tooltip info for recall runes.
- [sphere_msgs.scp]:
    Added new messages 'msg_targ_unexpected', 'rune_location_unk'
    Updated texts for 'itemuse_rune_name', 'rune_to'
- [sphere_skills.scp]:
    Added missing SKF_RANGED flag on Archery and Throwing skills.
    WARNING: Make sure to update your scripts following this change to prevent some problems on these skills. Previously sphere was internally setting SKF_RANGED on these skills, but now it's 100% on script-side.

21-02-2015, Coruja
- Fixed: NPCs flagging their owner criminal when attack an innocent only if the NPC can speak or have NPC=brain_berserk set.
- [sphere_item_profession_cook_barkeep_baker.scp]: Added missing t_cooking on all SKILLMAKE=Cooking lines.
- [sphere_skillmenu.scp]: Added missing title on skillmenu sm_cook_ingredients, sm_cook_baking, sm_cook_barbecue

22-02-2015, Coruja
- Fixed #2479: Combat damage bonus not being calculated correctly when COMBAT_OSIDAMAGEMOD is disabled.

23-02-2015, Coruja
- Changed: Now only players can have damage bonus. NPCs will always use the damage value set on DAM property.
- Fixed: Summoned NPCs incorrectly giving karma gain/loss on death.
- Fixed: @GetHit not inheriting ARGN2 value from @Hit.
- Fixed: Parrying skill not calling @UseQuick / @SkillUseQuick triggers.
- Fixed #2478: Some weapons using wrong swing animation.
- [sphere_msgs.scp]: Updated 'combat_parry' message.

25-02-2015, Ben
- Fixed #2477: PacketDeathAnimation causing errors.
- Fixed: New ARGN2 in @Hit not being set to the proper value.
- Fixed #2484: GMs not always succeeding at skills.
- Fixed: Unlock spell using spell level as difficulty.

02-03-2015, Coruja
Added: Internal support for SELFREPAIR property os items.
Fixed: Some internal messages using wrong message type (eg: items names incorrectly using 'talkmode_obj' instead 'talkmode_item', etc).
[sphere_msgs.scp]: Updated 'messages_settings' header, added new message 'cont_items'.

05-03-2015, XuN
Fixed Packet 0xBF.0x1C (Cast Spell) crashing server when spell does not exists (prevents crashing shard when casting packet sent directly from injection, etc and there's no spell).
Updated sphereCrypt.ini with clients up to 7.0.43.
Added 'stacking' behaviour to NightSight property to allow more than 1 item apply it's value and not removing the nightsight effect when unequipping (this will fix #2475), 
old behaviour (.nightsight (no value) to switch from 0 to 1 and viceversa) keeps working, be aware of not using both methods or problems will come.
Fixed #02488: Pets inheriting Notoriety from Masters even if .ini's value say to not do.

05-03-2015, Coruja
Changed: Internal improvements on how account characters are created.
Changed: Some minor optimizations on char notoriety checks.
Fixed: Players on the same party incorrectly using ally (green) notoriety if it choose "Party CANNOT loot me" on party menu.
Fixed: Ally/enemy notoriety not working on townstones.
Fixed: DAMAGE function making the char parry damages caused by itself.
Fixed: Console error when using SPELLEFFECT function without a valid SRC.
[sphere_newb.scp]: Added new templates for professions and race variants on skills.

06-03-2015, Coruja
Fixed: DAMAGE function not causing any damage on items when the function is called without a valid damage flag set (ARGN2).
Fixed: Roofs not working properly on AOS house customization menu.

06-03-2015, XuN
Added IsTriggerActive() and SetTriggerActive() functions to CObjBase keeping track of the running trigger.
Fixed using Remove in @UnEquip triggers crashing the server.
Fixed #2481: Usage of ResendToolTip in the @*ToolTip triggers crashing server.
Fixed CanUse receiving wrong value when value = 0 or no value.

07-03-2015, Coruja
Fixed: Fame/Karma gain/loss not working on some specific cases.
Fixed: SnoopCriminal setting on sphere.ini not working correctly. Now it works using a 0%~100% chance instead random values.
Fixed: Parrying skill blocking magic damages.
Fixed: MAGICF_OSIFORMULAS incorrectly using MANA instead INT value on spell damage calculation.
Changed: Armor/Weapons with ATTR=attr_magic set will not show +5,+10,+15,... on names anymore. Now users are able to softcode custom names on magic items without problems.
Changed: Some internal improvements on Snooping skill.
[Sphere.ini]: Updated SnoopCriminal description/value.
[sphere_msgs.scp]: Updated 'snooping_*' messages.

08-03-2015, Coruja
Added: Items with INCREASEDAM / INCREASEDEFCHANCE / INCREASEHITCHANCE now will set these properties on char on equip/unequip.
Fixed: NPCs (monsters) being flagged criminal when they attack an innocent player.
Changed: Updated minimum client version required to use some new packets.

09-03-2015, Staff_Stanic
Fixed: if the value of ExperienceKoefPVM or ExperienceKoefPVP is 0, not just the gain of experience will be disabled, but also the loss (if is allowed experience to go down).
Suppose a case that ExperienceKoefPVP=0, players will not gain experience killing npcs, consequently players will not lose experience when killed by npcs.
Fixed: not allow experience or level go to negative.

13-03-2015, Coruja
Fixed: Infinite loop when someone with Reactive Armor hit itself.
Fixed: Some items properties being saved as 0 value (when set it to 0) instead remove it at all.
Added: FASTERCASTING, INCREASESPELLDAM, INCREASESWINGSPEED gain/loss when equip/unequip items.

14-03-2015, Coruja
Fixed: 'GetDist::InvalidPoint' console error when function ISNEARTYPE try search something out of the map bounds.
Fixed: Spells with SPELLFLAG_AREA + SPELLFLAG_DAMAGE flags causing damage to nearby items on ground.
Added: LOWERREAGENTCOST / FASTERCASTING behavior when casting spells.
Added: New Reactive Armor spell behavior if COMBAT_ELEMENTAL_ENGINE feature is enabled, now it will increase RESPHYSICAL and decrease RESFIRE/RESCOLD/RESPOISON/RESENERGY.
Added: New Mana Drain / Mana Vampire spell effect if MAGICF_OSIFORMULAS feature is enabled.
[sphere_spells]: Updated FLAGS/EFFECT/EFFECT_ID values on Mana Drain / Mana Vampire / Enchantment spells.
[sphere_defs.scp]: Updated 'snd_spell_reactive_armor' value.
[sphere_skills.scp]: Removed duplicated @Fail message on Magery skill.
[sphere_item_magic_weapon.scp]: Updated all magic weapons properties to the correct values.

15-03-2015, Staff_Stanic
Added: ARGN2=0 ARGN2=0 will disable automatic message when @ExpLevelChange.

17-03-2015, XuN
Fixed #2493: Reverted MINCLIVER_NEWMOBINCOMING back to 0x700331. 
Fixed items with Res* and DMG* giving values again when save+restart, stat's additions should be placed on ItemEquip and not in LayerAdd. 
Fixed items being 'dropped' on player's characters when they are created instead of equipping (changed LayerAdd to ItemEquip in CChar::ContentAdd(), may cause some other issues?) 

17-03-2015, Staff_Stanic
[Sphere.ini] Added: ItemDamageCombat - chance of a item be damaged during a combat (PvP or PvM).
[Sphere.ini] Added: ItemDamageCombatIncrease - the difference of total and current durability of a item will increase the probability of this same item be damaged? If yes, the probability of a item be damaged during a combat will be given by: (ItemDamageCombat + Item_Total_Durability - Item_Current_Durability)%

18-03-2015, XuN
[add-on\mordaunts_housing_system]
Added to [REGIONTYPE r_houses] the following code to prevent the dialog being used in other houses skipping permissions:
	ON=@Exit
		src.dialogclose d_house_menu
		src.events -e_house_player_events

19-03-2015, XuN
Added CombatBonusStat and CombatBonusPercent properties for weapons and chars changing the default formula for damage ( having weapon equipped will override char settings, regardless of weapon having them or not)
	CombatBonusStat stores the stat id. STR = 0, INT = 1, DEX = 2
	CombatBonusPercent stores the percentaje of stat applied onto the bonus calculations, value can be negative but total bonus cannot be lower than 1.
[sphere_msgs.scp]
Added these lines:
	//msg_acc_passclear			"Password has been cleared."
	//msg_acc_passclear_relog	"Log out, then back in to set the new password.""
	//msg_acc_acceptpass		"Password has been set."
	//msg_acc_invalidpass		"Invalid password."
	//msg_acc_guesthit			"The guest curse strikes you."
	//msg_region_reddef			"You have %s the red region."
	//msg_region_redenter		"entered"
	//msg_region_redleft		"left"
	//itemuse_dye_reach1		"You can't reach it."
	//msg_gmpages_none			"No GM pages queued. Use .page ?"
	//msg_gmpages_current		"Current GM .PAGE Account=%s (%s) Reason='%s' Time=%lld."
	//npc_vendor_cantbuy		"You cannot buy that."
	//npc_vendor_cantsell		"You cannot sell that."
	//msg_targ_dynamic			"Must select a dynamic object."
	//msg_targ_moved			"Targetted item moved?"
	//msg_targ_gone				"Targetted item is gone?"
	//spell_mark_cont			"The rune must be on your person to mark."
	//npc_vendor_sellfast		"You are selling too fast."
	//npc_vendor_sellmuch		"You cannot sell so much."

Fixed StatCap not allowing stats to go to the statcap itself, but 1 point lesser (STATCAP=255 allowed only 254 stat points).
Added few more msgs to sphere_msgs.scp:
	//npc_vendor_nomoney1			"Begging thy pardon, but thou canst not afford that."
	//target_command				"Select object to set/command '%s'."

20-03-2015, Coruja
Fixed: Console error / client crash when opening some specific gump types on HS clients >= 7.0.9.0.
Fixed: Vendor menu not working on enhanced clients.
Fixed: Added missing buff icon on Meditation skill.
Fixed: Minimum client version required to use some new packets.
Fixed: Reactive Armor spell changing RESPHYSICAL to an incorrect value when COMBAT_ELEMENTAL_ENGINE is enabled.
Added: ADDBUFF function now can handle up to 5 args to support newest clilocs.
Changed: Some improvements on buff packets (now it can handle more args correctly).
Changed: Some improvements on exp/level gain/loss code.
Changed: Softcoded ItemDamageCombat / ItemDamageCombatIncrease .ini settings, the chance to get items damaged on combat now can be fully scripted using LOCAL.ItemDamageChance (value range: 0~100) on triggers @Hit (weapon) / @GetHit (armor).
[sphere_defs.scp] Updated 'buffcliloc_reactivearmor_2' value.

21-03-2015, XuN
Now skill changes (on lumberjacking,tactics and anatomy when COMBATF_OSIDAMAGEMOD is enabled) and DAM value applied on weapons and the new CombatBonusStat and CombatBonusPercente are updating the status window to reflect the dam changes.
Added to sphere_msgs.scp: 
	//menu_unexpected					"Unexpected menu info."

Changed variable times in world time handler to avoid some overflow-recycle messages.

22-03-2015, Coruja
Changed: ADDBUFF function now can handle up to 7 args.
Changed: Minor changes on COMBATBONUSSTAT / COMBATBONUSPERCENT formulas to better compatibility with damage calculation formulas.
[sphere_dialog.scp] Huge optimization on dialog d_hair_dye

23-03-2015, XuN
Changed everything related to spawns to new class CItemSpawn having everything from spawns more concentrated and prepared for future improvements.
Increased BuffIcons limit up to 1126

[sphere_defs.scp]
Added new buff definitions.
To have it a bit more organizated keept buffs as bufficon_*, changed debuffs to debufficon_* and passives to passivebufficon_*

[sphere_backwards_compatibility.scp]
Added definitions for old bufficon_* entries that have been changed to new debufficon_* or passivebufficon_*

23-03-2015, Coruja
Fixed: HS clients not parsing correctly text lists like TAGLIST/CTAGLIST/VARLIST/etc.
Fixed: Sphere crashing when COMBAT_ELEMENTAL_ENGINE is disabled and 2 chars with Reactive Armor attack each other causing an infinite loop when reflect the damage.
Added: New Magic Reflection and Protection spell behavior if COMBAT_ELEMENTAL_ENGINE feature is enabled.
Added: Support for RESDISP/RESLEVEL 8 on accounts, it's the default RESDISP for High Seas expansion (clients >= 7.0.9.0).

24-03-2015, XuN
Fixed some code from PacketWheelBoatMove (Move ships with mouse) and enabled it via 'Pilot' variable in ships holding the value of character and one memory item (acting like a horse)
Added few checks for Combat_NoDirChange

Scripts:
 Added t_pilot to sphere_defs.scp
 Updated \items\sphere_item_ship_parts_*.scp adding t_pilot.	//It seems that britannian and orcish ships got their items changed and they look empty now, i did not change this atm.
 Added \Add-On\HighSeas\Ships\HS_Pilot.scp with behaviour for t_pilot and memory item for mouse sailing.
 Added //itemuse_crook_target			"Where do you want them to go ?" to sphere_msgs.scp

26-03-2015, Coruja
Fixed: IDLE clients on login / character selection screen being disconnect on the server-side without display any feedback to client, making it freeze on a infinite 'Connecting...' screen. Now IDLE clients will get an 'timeout' message and will be able to press ok and try again without get stuck.
Fixed: PacketDeathAnimation feature not working correctly on some specific clients.
Fixed: Dispel, Dispel Field and Mass Dispell spells incorrectly removing nearby items with typedef t_fire / t_campfire set.
Fixed: Flamestrike spell missing some animation frames.
Added: Missing Protection spell behavior (spell disturb chance) if COMBAT_ELEMENTAL_ENGINE is enabled.
Added: New effect calculation on buff (Agility, Cunning, Strength, Bless) and debuff (Clumsy, Feeblemind, Weaken, Curse) spells if MAGICF_OSIFORMULAS is enabled.


26-03-2015, XuN
Added 5 more args to .effect function to give support to packet 0c7, new values are: EffectID,ExplodeID,SoundID,UID,Type. Seems to work only on EC.
Added Bonded property for npcs with very basic functionality, setting it to 1 doesn't let NPCs die.
Removed some debug msgs.
Changed some more m_Act_Targ to m_Fight_Targ.
Corpses retrieve killer's uid now from Attacker_GetLast() instead of on ACT.

27-03-2015, XuN
Changed DClick of t_ship_plank using SetDispID() instead of SetID() so they are threated as ship parts and 'fliped' with the rest of the ship.
Changed the 'Undefined symbol '' ' output format, now also prints what was the problem exactly in some situations. IE: if (<local.hello==1) // missing '>' will print 21:15:ERROR:(s_add.scp,21)Undefined symbol '' ['<local.hello==)']
[sphere_spells.scp]: Added missing '>' to local.damagetype in s_explosion.
Added another block of code for @SeeCrime, now it fires also when a 3rd part sees a crime (I'm seeing Player X attacking Player Y while Y is 'good'), to decide if mark as 'bad guy' the aggresor for this character.
	argn1 = attacker
	argn2 = victim
	argn3 = 1=criminal / 0='turn eyes away'
Fighting Memory will also remove flag MEMORY_AGGREIVED when expiring (NEED feedback on this) to avoid blue-innocent player becoming criminal when the fight memory of the attacker expires (if he attacked back).
Being attacked is not giving MEMORY_AGGREIVED to memory item, I might be attacked but it may not have to do anything with me being aggreived ... they may have been attacked by me first (Need feedback on this too).

28-03-2015, XuN
[sphere_defs.scp]:
	Added Expansion definitions.
	Added t_rope
[items/sphere_item_unsorted]:
	Added t_rope to i_rope
[multis_ships.scp]:
	Changed Height from all Tokuno ships from 7 to 17.
	Added Expansion=EXPANSION_HS to all HS ships.
[add-on/HighSeas/Ships/HS_pilot.scp]:
	Added mount check to t_pilot to prevent the memory item being bounced to pack.

Added t_rope working like t_ship_plank but making no changes on ID, by default it doesn't have any 'I'm in ship' checks when steping them for two reasons, ropes should be in ships and this way they can be used in houses to go out?
Added <TEXTF > function returning formatted text, example:
	[defname exampledef]
	test=Hello %s, I'll teach you for %d coins.
	message=<textf "<def.test>",<src.name>,15> // Quotes are A MUST.

29-03-2015, XuN
Fixed humans not regenerating hitpoints
Changed Stats Regens to automatically update the timer of next tick instead of waiting for old value when changing it via RegenHits/Stam/Mana.
Fixed CanUse not inheriting from itemdefs to items

31-03-2015, Coruja
Fixed: Arch Protection spell not working correctly with COMBAT_ELEMENTAL_ENGINE enabled.
Fixed: Resurrection spell not displaying correct EFFECT_ID / SOUND.
Added: MAGICF_OSIFORMULAS behavior on more spells.
Changed: Small improvements on drunkness effect (ale, wine, liquor).
[sphere.ini]: Moved EF_PetSlots setting (experimental flag) to OF_PetSlots (optional flag).
[sphere_admin.scp]: Added missing 'admin_resdisp_8' def.
[sphere_msgs.scp]:
	-Changed IMSG_DEF_UNICODE to 1 (to match internal client behavior, which always show item/char names using unicode by default).
	-Removed useless 'spell_alcohol_sober' msg.

01-04-2015, matex
Fixed: SYSCMD never could return an exit value and was hanging sometimes.

01-04-2015, XuN
Fixed NPCs not moving to current fight target.
Added scripts/items/sphere_item_provisions_logs.scp with different log types.
Changed scripts/items/sphere_item_provisions.scp: Moved i_log(s) / i_board(s) to scripts/items/sphere_item_provisions_logs.scp

01-04-2015, Coruja
Fixed: Buff/Debuff spells not working correctly when MAGICF_OSIFORMULAS is disabled.
[sphere_item_provisions_logs.scp]: Fixed some boards using wrong itemdef.

02-04-2015, XuN
Added Repair function (Called on Repareid item, must be called with a character as SRC, who is going to perform the repair action).
Added Smelt function ( called on Smelted item, must be called with a character as SRC. ARGS=forge or another ore pile to smelt, if no ARGS is given it will search automatically for nearest forge if any ).
Changed @StatGain trigger is not being fired anymore with any stat changes from the @Create trigger.
Fixed local.CreateObject1 & 2 in @Success trigger for field spells causing the new items to do not use the same placement checks as default items.
Updated behaviour of Bonded Pets ONLY when they are DEAD:
	-They act as normal for everything, excepting they cannot die.
	-Follow any master's command, excepting fighting ones.
	-Doesn't regenerate stats.
	-NPCs won't die if they have bonded=1, if they are dead already and bonded is set to 0 they will die in next ticks.
	-Stam required to step over them is 0.
	-Food doesn't decay.
Fixed: Pets following when recalling/teleporting/gate travelling should be more consistent.
Changed: Mounted items calls now CChar::OnTick() on the mounted character instead of doing the tick on it's own, so they regenerate stats and everything like any other character in a more realistic way.
Fixed STATSUM and STAT_STR/DEX/INT from SkillClasses not being readed correctly (or at all) in some cases, this should permanently stop the need of custom statcaps. This is how StatGain works today (** = what was fixed):
	-Only INT can be gained when Polymorphed.
	-Stats with any StatLock different than UP can't increase.
	-StatCap <= StatSum stops the execution. **
	-STAT_* > STAT_VALUE from SkillClass = ignore this stat **
	-STAT_* > STAT_VALUE for this Stat in the performed Skill = ignore this stat.
	-Then the checks for %chances are made.
[sphere_msgs.scp]:
	Added //msg_bonded_dead_cantmount			"The creature is dead and cannot be mounted."

03-04-2015, Coruja
Fixed: EXP/LEVEL going < 0 on chars when the property value is changed by scripts using @ExpChange / @ExpLevelChange triggers.
Fixed: CUSTOMIZE function not hiding correctly all dynamic items on multi when entering on customization mode.

06-04-2015, Coruja
Fixed: NPC Guards (brain_guard) incorrectly teaching skills to players.
Fixed: Protection spell not returning the Magic Resistance skill to correct value if this skill was set to lock/down on the skill menu (when COMBAT_ELEMENTAL_ENGINE is enabled).
Fixed: Mana Drain, Wall of Stone and Energy Vortex spells using wrong EFFECT / DURATION if MAGICF_OSIFORMULAS is enabled.

08-04-2015, XuN
Changes in @Effect/@SpellEffect triggers for spells:
	Local.CreateObject1 overrides the effect id.
	Added Local.EffectColor, local.EffectRender and local.EffectExplode allowing to override the values of the sent effect.

Added Local.EffectColor to @Success/@SpellSuccess to change the color of field spells.

Reordered how effects are called (now they are all together inside SpellEffect()) to have better access to them.
Removed some Effect() calls to prevent two effects being sent in some spells.
Removed Effect_Bolt(), its now handled by SPELLFLAG_FX_BOLT inside SpellEffect().
*Any of this changes are affecting lightning spells, since client ignores everything related to lightnings (.effect 1,1).

Changed @SpellCast / @Start trigger for characters / spells:
	- Added local.WOP=0/1 to disable/enable WOP for this character / spell.
	- Added local.WOPColor (default = SERV.WOPColor) to change Word of Power's color for this character / spell .
	- Added local.WOPFont (default = SERV.WOPFont) to change WOP's font for this character / spell .

11-04-2015, Coruja
Fixed: Some spell formulas incorrectly using the skill value from target instead caster.

11-04-2015, XuN
Added char* definitions for both ContextMenuRequest and ContextMenuSelect (@charContextMenuSelect/Request).
Fixed NewGold not calling @Create if any new pile was created.
Fixed NewGold not taking care of MaxAmount.

15-04-2015, XuN
Added to sphere_msgs.scp:	(emotes for poison seems to have different values for poisoned character and the other ones)
for poisoned characters:
	//spell_osipoison_lesser		"feel a bit nauseous"
	//spell_osipoison_standard		"feel disorientated and nauseous!"
	//spell_osipoison_greater		"begin to feel pain throughout your body!"
	//spell_osipoison_deadly		"feel extremely weak and are in severe pain!"
	//spell_osipoison_lethal		"are in extreme pain, and require immediate aid!"
for viewers:
	//spell_osipoison_lesser1		"looks ill."
	//spell_osipoison_standard1		"looks extremely ill."
	//spell_osipoison_greater1		"stumbles around in confusion and pain."
	//spell_osipoison_deadly1		"is wracked with extreme pain."
	//spell_osipoison_lethal1		"begins to spasm uncontrollably."

CHANGED Poison function:
	By default it accepts 1 parameter (skill level)
	It can now have a second parameter for duration ticks (If not given, ticks are calculated as always = SkillLevel /50 ).

Added new behaviour for poison spell under MAGIFC_OSIFORMULAS:
	Poison Level = (Magery + Poisoning) /2:	(Stored in MoreY)
		Lesser (0):		Level <= 65.0
		Standard (1):	Level <= 85.0
		Greater (2):	Level < 100.0
		Deadly (3):		Level > 100.0
	Poison can be Lethal also with a 10% chances if the magery and poisoning of the poisoner are greather than 100.0 and distance < 3 tiles.
	Tick Period: 
		Lesser =		2 seconds.
		Standard =		3 seconds.
		Greater =		4 seconds
		Deadly/Lethal = 5 seconds.
	Duration:(More2) (if poison spell is called from POISON function, this values will be applied only if argn2 == 0, if set to another value then the given value will be used)
		Lesser =		30 seconds.
		Standard =		30 seconds.
		Greather =		60 seconds.
		Deadly =		60 seconds.
		Lethal =		80 seconds.
	Damage:(Currently values for poisons > Lesser are calculated on SpellEffect (MoreZ), so the same damage is dealed in each tick, AFAIK this is how it works)
		Lesser =		4-7% current hp.
		Standard =		5-10% max hp.
		Greater =		7-15% max hp.
		Deadly =		15-30% max hp.
		Lethal =		16-33% max hp

Added new ini flag COMBAT_NOPOISONHIT :Disables old (55i like) poisoning style: Poisoning > 30.0 && (RAND(100.0)> Poisoning) for monsters OR weapon.morez && (RAND(100) < weapon.morez ) for poisoned weapons.
INFORMATION: These have been unchanged, i'm writing here however for information of how is the poison's strenght calculated.
	Poison applied using weapon: src.poison <eval <weapon.morez>*10>,<eval <weapon.morez>/5> (so morez*10 = poison damage and morez/5 = ticks)
	Poison applied by monsters: src.poison <eval <r<Poisoning>>>, <r<eval <Poisoning>/50>>	(so strength is a rand of the poisoning skill and ticks are poisoning skill / 50
	Poisoned food has not been altered either, but here is the formula too: src.poison <eval <morez>*10>,1+<eval <morez>/50> (so the food's morez*10 is the strenght and ticks = morez /50 too).

15-04-2015, Coruja
Fixed: Some skills only rising until 30.0% on specific situations.
Changed: Some small changes on Magic Reflection spell.

27-04-2015, Coruja
Fixed: Guilds not display notoriety correctly on players with recruit access level.
Fixed: Magic Reflection effect only working on spells with SPELLFLAG_RESIST set. Now only spells with direct target (SPELLFLAG_TARG_CHAR) can be reflected.
Fixed: Spells with SPELLFLAG_HARM flag not flagging the caster criminal when it got resisted/reflected by the target.
Changed: Some improvements on Magic Resistance (skill) effect.
[Sphere.ini]: Added new ColorNotoInvulGameMaster setting to tweak the name notoriety color on invul Game Master chars (purple by default).
[sphere_spells.scp]:
	-Added missing DURATION on Mana Drain spell.
	-Updated SPELLFLAG_RESIST / SPELLFLAG_TARG_NOSELF on some spells.

28-04-2015, Coruja
Fixed: Mounts not creating the corpse when it die while ridden.
Fixed: Corpses not setting MORE2 (last attacker UID) correctly when created.
Fixed: NPCs only showing [npc] tag on name when inside an region with guards.
Changed: Removed max limit of CURFOLLOWER=255 on OF_PetSlots feature.
[sphere_msgs.scp]: Added new 'charinfo_bonded' message to show [bonded] tag on chars with BONDED=1 set (it will override the [tame] tag by default).

02-05-2015, XuN
REMOVED tag.override.noto completely now, @NotoSend was made as an enhanced version of this tag.
Added: argn2 in @NotoSend trigger forcing the character's packet to use this value as character's color but not modifying the real notoriety.
Changed: @NotoSend argn1 value now only can have values between 1 (NOTO_GOOD) and 7 (NOTO_INVUL) if other value is given it will be ignored and default checks will be made, color will still be used (if value >= 0)
Updated http://wiki.sphere.torfo.org/index.php/@NotoSend information.

Fixed some cases in which victims of a crime (attacked characters) became criminals. Also, but not always related to the same scenario, Notoriety not checking flags for MEMORY_HARMEDBY, which was causing the 'criminal issue' and also a bunch of unnecessary checks.
Fixed Guards being able to be flagged as criminals and doing the whole checks: Guards always acts for the law and they will never be criminal (this has been this way always but checks were performed anyway).
All of this fixed too @SeeCrime from combat not always working.
CHANGED: Old @SeeCrime is now @SeeSnoop http://wiki.sphere.torfo.org/index.php/@SeeSnoop
ADDED: New @SeeCrime trigger for every crime unrelated to Snooping: http://wiki.sphere.torfo.org/index.php/@SeeCrime
Updated: http://wiki.sphere.torfo.org/index.php/Override_TAGs
Fixed some compiling warnings.

03-05-2015, XuN
When a thread is hang it will now release the stack trace to be able to follow what caused the freeze.
Some fixes on experience and level system blocking changes on some circunstances and an infinite loop freezing server.
Updated sphere_item_typedef_equipitem.scp commenting from @Equip and @UnEquip the variables we are already setting from the source.

05-05-2015, XuN
Removed 'glow effect' from parrying in the source and added it under @UseQuick in parrying skill in sphere_skills.scp
Fixed @Eat not setting values correctly in some cases.
Fixed argn2 on @NotoSend not working as intended (notice that PetsInheritNotoriety may affect and block this).

07-05-2015, XuN
Updated sphere_serv_triggers.scp with some information/comments and values for newly created characters.
Added Notoriety values changed via @NotoSend to be sent in character's names: 
	-argn2 has priority over anything else, if it's value is 0, lesser or not present at all then argn1 will be used, if there's no argn1 either then default checks will be made.
	-argn2 values from 1 to 7 will read color hues from ini ones (NOTO_GOOD,NOTO_CRIMINAL...NOTO_INVUL,etc).
Poison spell and habilities based on it are now affected by SPELLFLAG_NoUnparalyze (if set).
Fixed some errors appearing when a character dies while poisoned conflicting with PacketDeathAnimation.
Poison damage has now DAM_MAGIC flag set.
Uncommented EFFECT value for Poison spell in sphere_spells.scp

08-05-2015, Coruja
Added: New 'Add/Remove Party Member' missing popup button when click on another player to invite/remove him from an party.
Changed: Some updates/optimizations on party engine.
[sphere_msgs.scp]: Updated 'party_*' messages.
[sphere_defs.scp]: Added missing 'attr_opened' value on [DEFNAME attr_flags] list.

09-05-2015, XuN
Fixed: Ignored 'attackers' will not be chosen as targets anymore, even if they are the only enemies on the list.
Added: Field spells will fire @Create for their itemdefs/events, also @ItemCreate for characters with a 'tag.BadLoc' which will be true if they are going to be placed above any character.
	If tag keeps at 1 after the @Create trigger the field will be removed like it's been doing recently.
	Since fields will not be placed until they are allowed to (to avoid 'ghost' walls dissapearing), items will have a 'tag.pos' with the placement position.

09-05-2015, Coruja
Added: New updated Swing Speed combat formula. It's almost the same as the previous formula (pre-AOS) but more accurate and with support to Swing Speed Increase property (INCREASESWINGSPEED).
[sphere.ini]: Updated 'SpeedScaleFactor' setting to the recommended value for the new Swing Speed formula [15000 -> 80000]. Although the old (or any other value) can be used, it's HIGHLY recommended update it to get better results.
[npcs/sphere_monsters.scp]: Added MAXFOLLOWER, RESPHYSICALMAX, RESFIREMAX, RESCOLDMAX, RESPOISONMAX, RESENERGYMAX properties on playable chars (c_man, c_woman, c_elf_male, c_elf_female, c_gargoyle_male, c_gargoyle_female).
[sphere_serv_triggers.scp]: Removed RES*MAX from f_onchar_create (it was moved directly to chardefs).

10-05-2015, Ben
Added: ABS() intrinsic function wich returns the absolute of any number ( <eval abs(5)> = 5, <eval abs(-5)> = 5 )

13-05-2015, XuN
  Receiving 0 damage will not generate blood anymore.
  Improved the code for 'Attacker'.
  
  Updated/improved/cleaned Spells:
    - Added internal definitions for all spells
    - Added support for spells with id 1000 to 1055 for custom spells and other old spells, reflected changes in sphere_spells.scp*
    - t_spellbook_extra works with values 1000+
    - Changed NPCs formulas to make them able to cast spells from other books than MAGERY one, selected from skills with SKF_MAGIC**:
    - Fixed the formula to select the maximum spell NPCs can cast because any npc with magery > 10.0 could cast all spells, now maxspell is calculated like this (using magery as example):
      maxspell = MULDIV(Skill_GetValue(magery),Spells_GetMax(magery),Skill_GetMax(magery)). To get a real progression for skill's capabilities this adjusts automatically to each skill's max spells, so 78.2 necromancy will let npcs cast up to spell 12 and 71.4 magery will let npc cast up to spell 37 for example.
      Skill_GetValue() returns the current value for this skill,
      Spells_GetMax() returns the total amount of spells for this skill (64 for magery, 17 for necromancy...),
      SkillGetMax() returns the maximum amount of this skill (Based on skillclass for players and 100.0 (or tag.override.skillcap_&skill if present) for NPCs)
    - NOTE: This has not been changed, and it's ONLY for magery as it was before (since other skills was not being checked): spells are selected in a FOR loop so, for magery and to avoid big loops each time a spell must be selected, first spell being checked is <r<maxspell>>. So if maxspell = 50 it will choose spells between <r50> and 50.

  [sphere_defs.scp]:
    - added spellflag_heal             040000000  // spell used to heal hitpoints or resurrect
    - added LAYER_* definitions for all spells that need a layer item to handle their behaviour (behaviours not added).
  
  * [sphere_spells.scp]: 
    - Changed ID for spell number 64 to 1000 and so on with the next ones until spell 99.
    - Added spellflag_heal to s_heal,s_greater_heal,s_close_wounds,s_noble_sacrifice,s_gift_of_life,
    - Added flags to Spellweaving spells.
  ** [sphere_skills]: Added SKF_MAGIC to MAGERY,NECROMANCY,SPELLWEAVING,MYSTICISM and CHIVALRY
    - Added NPC_AI setting: 
      // NPC_AI_STRICTCAST    01000 NPC's will only select spells they really have in their spellbook. Old behaviour let them to select any spell with SPELLFLAG_HARM if they have magery enough to cast it regardless of spellbook.
      FIXED i_spellbook_spellweaving was MOREZ=0600, it should be 600
      FIXED argn2 for @SpellSelect couldn't be overriden for spells casted from T_WAND or T_SCROLL. ARGN2 is also set to the proper mana value (0 for T_WAND and RequiredMana /2 for I_SCROLL) for reading purposes.
      Updated comment for t_spellbook_extra       186   // some spellbook for script purposes (MOREZ=basic offset, should 1000 or more) in sphere_defs.scp
      Added morex for t_spellbook_extra to set the max amount of spells for this book, so morez = first spell and morex = last spell , for example morey=1000, morez=1016 will hold spells from 1000 to 1016

16-05-2015, Ben
- Fixed #2510: deathshroud not removing on resurrection in all cases.

17-05-2015, XuN
Updated @NPCActFight:
	Added - local.skill // Setting this to any skill will make the NPC begin this skill
	Added - local.spell // For magic skills this will be the casted spell
	Added - ACT // This will refer to the target, must be set since the trigger is using SRC for the first enemy
	Added - return 2 // The code above will only work when return = 2
Removed NPC_AI_STRICTCAST and all the invented casts from npcs.This can be reverted applying a trigger for npcs like this:
	ON=@NPCActFight
	if (<magery> > 0)
		local.spell=<r1,64>
		while (<local.spell> < 64)
			if (<CanCast <local.spell>>)
				local.skill=magery
				return 2
			else
				local.spell ++
			endif
		endwhile
	endif	//same for the other magic skills.

Added vector list storing all spells that npcs can cast and removed tons of lines of code to increase the performance of CPU when NPCs cast some spells.
WARNING:
	Added LAYER variable to spells, ALL SPHERE_SPELLS.SCP MUST BE UPDATED or spells with some effect, like polymorphs, summons, stat spells, and all that have a determinated duration will stop working
	[sphere_spells.scp]	//Seriously, this script must be updated.
		-Added LAYER=layer_spell_* to all magery, necromancy, spellweaving,chivalry and mysticism spells, ie LAYER=layer_spell_stats for s_bless,s_cunning, etc
Changed default formulas to make spells work with LAYER instead of hardcoded checks, this will help making custom spells by giving the customization enough to handle every possible effect.

Changed: MemoryEquip won't be called anymore for the memories of spell's effects.
Added character trigger @EffectAdd: This will be called when any type of effect memory is being added, like stat changes for s_bless, s_cunning... s_weaken ...
	Argo = memory item
	argn1 = spellid
returns: 
	return 0: Let default checks to happen.
	return 1: Blocks any action and stops everything, also deletes the memory (Blocking any changes, this will cause also the effect to do not have duration)
	return 2: Let the memory exist but block default checks, perfect to override default effects and do some custom stuff.
To simulate something like '@EffectEnd' just apply an event with @Timer to the memory since the 'default changes' are happening after @UnEquip and, at this point, the item must be removed in any case... so preventing this must be done before (@Timer fits perfectly).

19-05-2015, Coruja
Added: New animation on dragon breath attack.
Changed: Reduced SAY/speech max text length (1024 -> 256 chars). Client is limited to 128 chars on default speech and 256 chars on journal, so this can avoid some exploits from 3rd party assists/tools without affect the gameplay.
Changed: Major optimizations on walk, skills and general ticks code. It's working fine, but needs some heavy testing until we mark it as 100% stable.
	-IMPORTANT: Be sure to update your sphere_skills.scp with proper FLAGS on all fight/ranged/magic/craft/gather skills, otherwise these skills will not work correctly.

20-05-2015, Coruja
Fixed: Parrying skill check always returning 'true' (success) on chars with GM=1 set, making the char never receive any damage on combat even without invul flag set.
Fixed: Mounts disappearing on worldsave on some specific situations.
Changed: Improved Teleport/Dispel spell smoke animation.
Changed: Another huge optimization on skills code.
[Sphere.ini]: Updated TeleportEffectNPC / TeleportEffectPlayers settings with correct values.

22-05-2015, Coruja
Fixed: NPCs not following his owner/target correctly.
Changed: Some improvements on pet follower slots and pet bonding engine.
[sphere_defs.scp]: Added missing 't_healing_stone' on [TYPEDEFS] section.

22-05-2015, XuN
Major updates on code to fix compiler LVL4 warnings.
Changed sector's size for map 4 from 8 to 16  (so we only have 5k sectors on this map instead of 31k), improving heavily performance when this map is enabled.
NOTE: Disabling unused maps / using the less possible will increase the performance exponentially since each tick a loop for all maps and all it's sectors is fire, take this in count.

28-05-2015, Coruja
- Fixed: Spell buff/debuff icons showing wrong info on client login.
- [maps/sphere_map3.scp]: Added missing AREADEF a_isle_of_divide
- [maps/sphere_map4.scp]: Updated header comments
- [sphere_defs.scp]: Updated some cliloc values on 'buff_clilocs'
- [sphere_spells.scp]: Fixed Dispel Field spell flags [spellflag_targ_obj -> spellflag_targ_item]

29-05-2015, Coruja
- Some minor design updates on SphereSvr.exe file/console.

30-05-2015, XuN
- Added: TAG.SeenBy_uid for items with attr_invis allow these items to be seen by characters with the given uid, ie: tag.SeenBy_015af=1 will allow player with uid 015af to see this item, usefull for traps/quest items/etc.

- Changed return 2 from EffectAdd to return 0 to avoid some problems.
  Added only if FEATURE_AOS_B is enabled:
  - Behaviour for HitLeechMana on weapons: Returned mana = 0 - X. Where X is the HitLeechMana% of (Damage dealt * 0.4). More info in: http://www.uoguide.com/Hit_Mana_Leech
  - Behaviour for HitLeechLife on weapons: On every successful hit you will leech 0 to X percent health of (Damage done * 0.3) where X is the Hit Life Leech value on your weapon. (This means the same as HitLeechMana but using *0.3 instead of *0.4)
  - Behaviour for HitManaDrain on weapons: %of draining a 20% of the damage dealt from the enemy's mana. so HitManaDrain = 50 means a 50% of draining mana to the target. Mana drained = 20% of the damage done.
  - Behaviour for EnhancePotions on characters: Effect of the potion is increased by the % set on this property.
  
  Added default behaviours for the following necromancy spells (some of them was already working but not with their full effects):
  - s_curse_weapon = Adds +x HitLeechLife to any equipped weapon, while the spell is in effect unequiped weapons will get this bonus removed and equipped weapons will gain the bonus. X is stored at memory's morey (50 by default).
  - s_blood_oath = When a target of s_blood_oath damages the caster... the damage amount is increased, the target also receives the x% of damage than the caster. X by default should be 100, but its lowered to this formula: ((Resisting Spells Skill x 10) / 20) + 10. X is stored at memory's morey.
  - s_corpse_skin = Turns the victim's skin dry and corpse like. This temporarily decreases the target's fire and poison resists (Fire and Poison resist decreased by 15 (more1h) each), while increasing resistance to cold and physical damage (increasing both by 10 (more1L) each).
  - s_evil_omen = http://www.uoguide.com/Evil_Omen
  - s_pain_spike = http://www.uoguide.com/Pain_Spike
  - s_wraith_form = Gets + 15 Resphysical (more1h) and -5(more1l) ResEnergy/ResFire while the effect is active, it also grants the same effect (but not working with it's property) as HitLeechMana returning a % of the target's mana calculated from = Spirit Speak / 50 (24% at 120.0 Spirit Speak), also grants the ability to walk through creatures and players in Felucca
  - s_mind_rot = Decreases the LowerManaCost property on the character.
  - s_horrific_beast = Provides a bonus of unarmed damage (stored in more1l & more1h on the spell's memory, default = 5,9), Gains a +20 RegenHitsVal (more2) and +25 Melee damage increase (morey). It's also unable to cast other spells than polymorphing ones (@SpellCast in c_horrific_beast).
  - s_poison_strike = scripted.
  - s_wither = scripted.
  - s_strangle = Info here: http://www.uoguide.com/Strangle
  - s_lich_form = +13 RegenValMana (more1l), -5 RegenValHits (more1h), -10 ResFire and +10 ResPoison/ResCold ( all three stored in more2).
  - s_vampiric_embrace = +20% HitLeechLife (more1l), +15 RegenStamVal (more1h), +3 RegenManaVal (more2), -25 ResFire (morey).

  NOTES:
    - Almost all graphical effects for these spells are still not applied yet. Same for RUNE_ITEMs.
    - Polymorphs from Necromancy have an increased damage received from Undead Slayer Weapons, since there's no hardcoded support for Slayer Weapons (yet?) I didn't add it. Feel free to script it.
    - These Spells may not be working at 100% yet, just sent 'initial' code. sphere_spells.scp MUST be updated.
    - Some behaviours related to spells and props are going to change in the following days.
  
[sphere_defs.scp]
  - Added LAYER_Spell_BLood_Oath and modified the following values to match it's order.
[sphere_spells.scp]
  - Changed LAYER for s_strangle to LAYER_Spell_Strangle
  - Behaviour for s_wither
  - Behaviour for s_poison_strike
  - Flags, RUNE_ITEM and more values for spells 100+.
  - Added code under @Select for all spellflag_polymorph spells to unpolymorph who is already polymorphed (same as s_polymorph).
[sphere_monsters.scp]
  - Added: c_horrific_beast -> ON=@SpellCast trigger avoiding any casts for this creature if a player is morphed on it.
[sphere_item_deco_signs.scp] (Darksun)
  - Added missing definitions for all signs.
[sphere_item_magic_necromancer_aos.scp]
  - Added fake runes for all necromancy spells, they don't have real entries in tiledata but i'm using custom itemdefs with their scrolls as baseid.

- Taking in count lot of recent changes realized that some properties must properly shown or hidden according to some ini flags, so ResFire,ResPhysical, etc will only be shown on item's ToolTips if COMBAT_ELEMENTAL_ENGINE is enabled

31-05-2015, Coruja
- Changed: Some small code improvements on HITLEECH[LIFE/MANA/STAM] properties.
- Changed: Messsage 'Expansion maps supported' on server startup now will show the real map name (Felucca, Ilshenar, Malas, ...) instead UO expansion name (T2A, LBR, AOS, ...)
- [Sphere.ini]: Changed all MAPx settings to use -1 as sector size. This will make sphere use the default sector size value (64x64) instead .ini value (32x32).

01-06-2015, Coruja
- Fixed: ABS() intrinsic function not working correctly.
- Changed: Some small improvements on AddContextMenuEntry function.

02-06-2015, Coruja
- Fixed: Console error when players die.
- Fixed: PacketDeathAnimation .ini setting not working correctly.
- Changed: Some improvements on 'death' / 'make corpse' internal code. Now any NPC will have corpse when it die (unless it was an summoned NPC). So don't get confused if you see corpses of some NPCs which previously doesn't have corpse (elementals, etc), it's the default OSI behavior. Also TAG.DEATHFLAGS can be used to force removal/creation of the corpse on @Death

03-06-2015, Coruja
Changed: Paralyze spell formula (AOS -> pre-AOS) when MAGICF_OSIFORMULAS is enabled.
Added: Functionality for BONUS[STR/DEX/INT], BONUS[HITS/STAM/MANA] and LOWERMANACOST properties.

04-06-2015, Coruja
Fixed: Damages not removing Paralyze effect.
Fixed: Console error when casting spells that have effect duration.
Changed: Some improvements on Blood Oath and Evil Omen spells (necromancy).

06-06-2015, XuN
Added some missing casts
Fixed DEBUG errors when entering/leaving RED areas.
Reverted back m_uidKiller in m_itCorpse to CGrayUIDBase to fix build not compiling.

06-06-2015, Coruja
Fixed: Field spells and triggers @Step (items) / @ItemStep (chars) not working correctly.

08-06-2015, Coruja
Fixed: Function AddContextEntry not working correctly on HS clients >= 7.0.0.0
Fixed: Dead bonded pets not updating the ghost corpse correctly on resurrect.
Fixed: Explosion potions causing damage to nearby items when it explodes.

10-06-2015, Coruja
Added: Player corpses now will turn into bones when it got carved or before it decay. Also improved the corpse carving behavior, and now when the corpse got carved it will place all items inside the bone container instead drop everything on the ground.
Fixed: Wrong message appearing when the char get flagged criminal (changed 'msg_criminal' to 'msg_guards').
Fixed: Poison/Paralyze Field spells continuously hitting the player at every second instead just hit when needed.
Fixed: Console error when an NPC cast Nightsight spell or use Meditation skill.
Changed: Invulnerable chars (FLAGS=statf_invul) now are able to attack another char instead get the attack "magically blocked".
[sphere_item_deco_dungeons_traps_dead.scp]: Removed TYPE=t_meat_raw, TDATA1 and VALUE from all 'i_flesh_*' items (they aren't foot and nor sellable items).
[sphere_msgs.scp]: Updated all 'carve_corpse_*' messages and removed 'msg_criminal', 'msg_magic_block'.
[sphere_spells.scp]: Added missing 'spellflag_tard_dead' on s_resurrection spell.
	-IMPORTANT: It's HIGHLY recommended update it, or Resurrection spell will stop working.

10-06-2015, XuN
Fixed: Res* not reducing damage anymore
Fixed: Having RegenHits/Mana/Val greater than ini's setting stoping the regen process forever for this character.

11-06-2015, Coruja
Changed: Some small improvements on explosion potion effect.
Fixed: Console error "Hair/Beard not in a corpse" when corpse bones got saved on worldsave.

12-06-2015, XuN
Changed all TAG.TamingSlots entries to FollowerSlots in: sphere_monsters.scp, sphere_monsters_custom.scp and spherechar_evil.scp.
Added @FollowersUpdate trigger called in any update of followers related to OF_PetSlots:
	argn1 (R/W): 0 = Adding followers (taming, unshrinking, summoning, buying ...), 1 = sustracting followers (release, transfer ...)
	argn2 (R/W): FollowerSlots used.
	SRC: Pet causing the trigger to run, when buying in vendors there's no PET yet, so SRC will point to the vendor.
	Return 1 will not allow following actions to occur: Transfer, Summon, UnShrinks from t_figurine, Buy from vendors. Any other actions (like release, set owner...) will not take in count returns.

13-06-2015, XuN
Fixed #2515: Added local.sound to @Effect and @SpellEffect triggers, by default it uses spell->sound excepting effects from potions which will have a random value between 0x030 and 0x031 (old value), this is writable, 0 means no sound.
Fixed #2517: Added BREATH.TYPE to Breath's animation, this will tell Sphere what type of effect to use (same types as .effect).
	- To help keeping old behaviour (explosion on target instead of following fireball) I added BREATH.ANIM and BREATH.TYPE to every brain_dragon in sphere_monsters.scp and sphere_monsters_custom.scp, just remove the // on these lines with a quick find&replace to enable old style breath.

14-06-2015, Coruja
Fixed: Summoned NPCs incorrectly creating corpses on death.
Fixed: Summoned mounts not disappearing on summon timer expiration if it was mounted.
Fixed: Region flags REGION_ANTIMAGIC_RECALL_IN and REGION_ANTIMAGIC_TELEPORT incorrectly blocking Resurrection spell effect.
Fixed: Client screen not being updated correctly when ghosts got resurrected.
Fixed: Possible console error when players/NPCs try pick/drop some specific items.
Fixed: Combat not flagging the attacker criminal if the attack was parried by the target.

16-06-2015, Coruja
Changed: Some optimizations on internal walk code and spell add/remove behavior.
Fixed: Paralyze effect not updating the client immediatelly when it goes off, making the client only able to walk after ~100ms on next tick update.
Fixed: Function SERV.MAP(x,y,z,m) returning console error instead '0' when 'm' is a invalid/disabled map.
[Sphere.ini]: Added new ItemsMaxAmount .ini setting. This will globally set max allowed amount for all stackable items (default is 60000).
[sphere_msgs.scp]: Removed 'msg_invisible' and 'msg_tingling' messages.

17-06-2015, Coruja
Fixed: Stamina not decreasing correctly when walk over another char.
Fixed: Packet to update char hitpoints being sent twice to nearby party members.
Fixed: Properties like STR/ModSTR/MaxHits/etc making the char have current status value > max allowed value when the status got lowered.

18-06-2015, Coruja
Changed: Combat now will make blood effects only for physical damage (wrestling / weapons).
Changed: Field spells casted over the same field already created on ground now will make the previous field tile got replaced with the new one.
Changed: Trigger @DropOn_Ground / @ItemDropOn_Ground now is fired when the item is already on the ground instead get fired before place it on ground. So there's no more ARGS showing the drop location P (use <ACT.P> instead) and also 'return 1' will disable drop sound and decay timer.
Fixed: ATTR 'attr_magic' and 'attr_newbie' incorrectly affecting the item decay timer when it got dropped on ground.
[Sphere.ini]: Updated ClientLinger setting with correct value.

19-06-2015, Coruja
Changed: NEWNPC function won't automatically place the created NPC on source P anymore. Like NEWITEM, the NPC will be created virtually and must be placed on the world using P=x,y. This will prevent the server send unnecessary/duplicated 'update' packets to clients.
Fixed #2514: Hiding / Stealth skills and Poison / Poison Field spells not updating the client screen correctly on action success.
Fixed #2518: Mounts losing bonded status on dismount.

21-06-2015, Coruja
Changed: Improved stamina checks when walking.
Fixed: Possible console error on specific char actions like walk, teleport and cast spells.

23-06-2015, Coruja
Changed: Some internal improvements on explosion potions code.
Changed: Items dropped on invalid location on ground now will get bounced to char backpack instead get moved to char P.
Fixed: Items being able to be dropped on ground inside walls tiles.
Fixed: Possible console error when casting field spells.
Fixed: CUSTOMIZE function on customizable multis not hiding correctly all house dynamic items on ground when client enter on customization mode.
Fixed: House customization menu making the char get moved to multi center when it switch to another floor level.

23-06-2015, matex
Changed: Disabled assertions in non-debug Linux builds. This should not be necessary anymore because there is a SIGSEGV handler in linux builds.
Added: Experimental feature for Sectorsleeping which can be enabled during compilation by using _SECTOR_INTTICK. 
It basically checks in a 3x3 matrix around each sector if there are any players around to determine if the sector is sleeping. 
This leads to a more intelligent distribution of available compute power on small maps (because then the Sectorsleepmask can be 
increased without any immediately 'noticeable' effects). It is not yet available in nightly builds because I consider it too performance 
critical to make it available via a Sphere.ini setting (this would induce an additional comparison in each tick.)

24-06-2015, XuN
Added TithingUse variable for [SPELL ] working like ManaUse but for Tithing Points.
Fixed #2521: delay reseting after the the trigger, so it was impossible to change it.
Added support for Tithing in spells, note that LowerManaCost doesn't affect Tithing points but LowerReagentsCost does it unlike for mana.
Fixed a typo causing humans to create 10% of t_hide when carving corpses instead of applying a bonus of 10%
sphere_msgs.scp: Added //spell_try_notithing			"You must have at least %s Tithing Points to use this ability"	//1060173
sphere_item_provisions_armor.scp: Updated Description and Subsection for gargoyle leather armor.
sphere_spells.scp: Added TithingUse to chivalry spells.

25-06-2015, Coruja
Fixed: Walking over ghosts requiring stamina to pass.
Fixed: Mounts disappearing on worldsave on some specific situations.
Added: New REFUSETRADES (bool 0/1) char property. If set to true (1), it will prevent others clients to open secure trades with this char.
Added: New 'Allow Trades' / 'Refuse Trades' context menu buttons to toggle REFUSETRADES property. Unfortunately only clients >= 7.0.30 can see these buttons because OSI added these cliloc texts only on this client version.
Added: New Hit Chance combat formula (more info: http://uo.stratics.com/content/arms-armor/combat.php#hitchance)
[sphere_msgs.scp]: Added new message 'msg_trade_refuse'.

26-06-2015, Coruja
Fixed: Sphere crash when drop an item on a invalid ground location.
Fixed: Function GOLD creating gold piles with max amount 65000 instead use ItemsMaxAmount value.

26-06-2015, XuN
Added left Racial bonuses for Elfs, Added all for Gargoyles excepting Master Artisan.
Added a missing call to Calc_CombatChanceToHit() from Fight_Attack(), making it to no check the chances to hit.
For more info about Racial bonuses, read here: http://www.uoguide.com/Racial_Abilities .
[sphere.ini]
	-Added FEATURE_ML_RACIAL_BONUS and FEATURE_SA_RACIAL_BONUS to FeatureML and FeatureSA respectively, each one activating the bonuses for human/elfs or gargoyles.

28-06-2015, Coruja
Changed: REFUSETRADES property now can be only used on players. NPCs won't use it anymore, since NPCs can't open trade windows.
Changed: Huge optimization on NPC_AI_EXTRA code. This is a heavy code called thousands of times per second, so unfortunately some features got removed to improve Sphere performance overall:
	-Animals (brain_animal) wont poop on ground anymore.
	-Animal Trainers (brain_animal_trainer) won't give food to nearby pets anymore.
	-Vendors won't go off-duty (brain_vendor_offduty) at night time anymore.
	PS: If someone still need these features, it can be done by scripts using @NPCAction trigger or at BUY/SELL functions on file /speech/speakshopkeep.scp
[sphere_msgs.scp]: Removed messages 'animal_dung' and 'npc_animal_poop'.

29-06-2015, Coruja
[sphere_defs.scp]: Removed 'brain_beggar', 'brain_thief', 'brain_undead' and 'brain_vendor_offduty'. Unfortunately these NPC brains never had worked correctly so it won't make much difference if they got removed to clean some obsolete internal codes.
[sphere_msgs.scp]: Removed messages 'npc_beggar_*' and 'npc_vendor_offduty'.
[speakhuman.scp]: Changed a single 'brain_thief' line to 'brain_animal_trainer' brain check on train command to match these brain changes [brain_thief -> brain_animal_trainer]
[sphere_backward_compatibility.scp]: Added backward compatibility to these 4 removed NPC brains.
[sphere_skills.scp]: Added (<ISPLAYER>) check on Tracking skill to prevent console error when an NPC try to use this skill.
[sphere_menu.scp]: Updated all obsolete ADDITEM and ADDNPC lines to ADD.

03-07-2015, Coruja
Fixed: Wrong console error text when trying to set NPC brains on players.
Fixed: Dead bonded NPCs losing gray color on corpse when client redraw the NPC on screen.
Fixed: @PersonalSpace trigger not being called when walking over chars on stairs.
Changed: Improved frozen check on walk routines and ISSTUCK function.
[sphere_monsters.scp / sphere_monsters_custom.scp]: Updated obsolete NPCs brain 'brain_undead' to 'brain_monster'.

04-07-2015, Coruja
Fixed: Combat creating blood on the attacker instead target.
Fixed: Dragons (brain_dragon) always hitting breath attack even when the target get out of LOS.
Changed: Decreased dragon breath damage. The previous formula was causing too high damages when the dragon has high hitpoints.

08-07-2015, XuN
[sphere.ini]:
-Added CombatSpeedEra to switch between speed formulas that has been changed over the years, also updated the source to reflect this addition and added fully back the formula for Legacy, it was a little tweaked.
// CombatSpeedEra
// 0 = Legacy, T2A, 55x versions..., Recommended SpeedScaleFactor = 15000, Use DEX by default to calc speed, all others use stam
// 1 = AOS,							 Recommended SpeedScaleFactor = 40000
// 2 = SE, 							 doesn't use m_iSpeedScaleFactor and it's only compatible with ML speed format eg. 0.25 ~ 5.00 seconds instead 0 ~ 50
// 3 = ML, 							 Recommended SpeedScaleFactor = 80000
CombatSpeedEra= 3	// Default is ML (3)

Note that SpeedScaleFactor must be changed along with this setting.
Tweaked CombatFormulas, they were using iDelay/2 when Fighting Skill started and generating another iDelay/2 after that period of time making it impossible to fully rewrite the value under argn1 in @HitTry.

[sphere_backwards_compatibility]:
Added some more items.

09-07-2015, Coruja
Changed: Improved some internal actions to update the client screen using less packets instead always do a full resend.
Fixed: Client screen not being updated correctly on death/resurrect when PacketDeathAnimation .ini setting is disabled.
Fixed: MAGICF_OSIFORMULAS .ini setting not calculating Inscription bonus correctly.
Fixed: REVEAL function not removing 'Invisibility' buff icon correctly.
Fixed: Major walk exploit when Injection clients press 'Chat' button.
Fixed: Anti-magic regions blocking resurrect on ankh's (t_shrine).

10-07-2015, Coruja
Fixed: Status (hits/mana/stam) of all chars going down to ~15 at server startup.
Changed: Small improvement on EF_Item_Strict_Comparison .ini experimental feature.
[Sphere.ini]:
	-Removed obsolete EF_Size_Optimise and EF_Intrinsic_Locals experimental flags.
	-Added missing descriptions on Experimental and OptionFlags features.

16-07-2015, Coruja
Fixed #2538: BOUNCE function not activating item decay if it got dropped on ground by overweight.
Fixed: NPCs Healer (brain_healer) resurrecting dead bonded pets (only the pet owner can resurrect it).
Fixed: Combat hit chance formula being called twice, resulting a double chance to miss the attack.

17-07-2015, Coruja
Added: New improved NPC looting AI (NPC_AI_LOOTING).
[sphere_msgs.scp]: Added 'loot_rummage' and removed 'loot_item_from', 'skillact_looting' messages.
[sphere_dialog]: Updated dialog d_charprop1 button 18.

22-07-2015, Coruja
Changed: Some improvements on OF_PetSlots engine.
Fixed: Removed unnecessary full update on client when the player try to use any mount.
Fixed: Function MOD[STR/DEX/INT] not fixing hits/stam/mana max value after decreased.
Fixed: Magic Reflection spell not reflecting spells with SPELLFLAG_DAMAGE set.

23-07-2015, Coruja
Fixed: Function REVEAL not working correctly when used with empty args.
Fixed: Invisible chars not getting revealed when looting items from corpses.
Fixed: Telekinesis spell not flagging criminal when used to loot items from corpses.
Fixed: Paralyze spell effect not getting removed correctly.
Fixed: Clients not entering on warmode correctly after get hit by someone.

24-07-2015, XuN
Added TAG.OVERRIDE.SPEED for ITEMDEFS and Items overriding the current speed for weapons.
Fixed #2535: NPCRestock is now accepting code like any other triggers.
Added: Setting RegenX=-1 in the ini will disable regens for that stat, also the @RegenStat trigger and every related code.
[Items/Sphere_item_provisions_weapons.scp]:
	-Added TAG.OVERRIDE.SPEED for all weapons to match new speeds on OSI, uncomment these lines to enable them (These speeds are meant to be used with CombatSpeedEra=3).
Re-added detail check for parrying messages, they were being sent always regardless of the detail flag on the character.
Re-Adeed EF_Intrinsic_Locals with a warning comment in the ini.
Fixed a check in CChar::NPC_ExtraAI() giving errors when trying to find items inside a container when there was no container to search on.

25-07-2015, Coruja
Changed: Optimized many spells and some others functions to avoid send unnecessary 'update' packets to client when it's not needed (or send it using less packets when needed).

26-07-2015, XuN
Enabled again movement packet for newer clients since blocking it was causing newer clients to do not move at all and getting 'freezed' after some steps. Added a few lines of code to UserChatButton to make this packet restrict movement when this button is being pressed, hence avoiding these injection problems.

26-07-2015, Ben
Added support for future Axis connection... (details will be available when the time comes)
Added internal support for Category,Subsection.Description and ID in SPAWN and TEMPLATE sections. they can now be accessed with (eg: serv.spawn.defname_here.category)
Also added access to ID in CHARDEF to return the real anim id of the chardef in hex. (serv.chardef.c_man.id should return 0190)

28-07-2015, Coruja
[sphere_skills.scp]: Updated TITLE on skills ArmsLore, Blacksmithing and MagicResistance.
[spheretables.scp]:
	-Updated RESOURCES using an better file order to prevent some 'undefined keyword' errors on sphere startup.
	-Fixed a small notoriety typo [Imfamous -> Infamous]

04-08-2015, Coruja
[Sphere.ini]: Added new magic flag MAGICF_OVERRIDEFIELDS to prevent cast multiple field spells on the same tile, making the new field tile remove the previous field.
Changed: If there's multiple field spells on the same tile and MAGICF_OVERRIDEFIELDS is disabled, now only the first field will make effect (this will prevent some weird exploits like cast multiple Fire Field spells on the same tile to take more damage, etc).

06-08-2015, Coruja
Fixed #2541: Client screen not being updated correctly on resurrect.
Fixed: Players randomly switching to previous targets on combat.
Fixed: Client sending unnecessary mana/stam update to party members when opening the status menu.
Added: Missing Polymorph spell duration formula when MAGICF_OSIFORMULAS feature is enabled.

07-08-2015, Coruja
Fixed: Random 'walk resync' problems.
Fixed: Incorrect full update packet sent to clients when it' ID (body) got changed.
Fixed: Combat swings between attacks not working correctly.
Fixed #2539: Combat damages always creating blood using default color (red) instead follow BLOODCOLOR property.

09-08-2015, Coruja
Changed: Major improvements and optimizations on internal Hit / HitTry combat calls.
Changed: Combat swing behavior got slightly changed to be more accurate.
	-Now instead the animation speed match the swing delay duration and only do the damage at the end, the animation/damage will always occour on first 7ms and then it will keep waiting the remaining time until next swing.
	-This makes all anims/sounds perfectly match the damage timer no matter the weapon type or swing delay timer.

13-08-2015, matex
Added: OVERRIDE.NPCAI to control AI-flags on a per character basis if necessary. Otherwise NPCAI flag from sphere.ini is used.

15-08-2015, matex
Added: EF_DynamicBackgroundsave. This will enable, if necessary, if a backgroundsave tick is triggered to save more than only one Sector. 
This especially makes sense if the map has a lot of sectors. E.g. if the sectorsize deviates from 64x64 as completion of a single backgroundsave
takes circa 40 minutes with a sectorsize of 32x32 and BACKGROUNDSAVE set to 1. Using dynamic backgroundsaving this can be sped up at the cost of
some performance. You can approximately limit the amount of items/characters that will be saved as the Operation will just stop if it estimated that
saving another sector would exceed SaveStepMaxComplexity. You can further limit how many sectors will be saved at maximum per backgroundsave-tick using SaveSectorsPerTick. This is a maximum value. If the maximum complexity is exceeded it may not reach that maximum value.
Added: SECTOR.INACTIVECOUNT. Will report the number of logged-out chararacters inside that sector.

16-08-2015, Coruja
Fixed: Walk packet events causing excessive CPU/bandwidth usage.

17-08-2015, Coruja
Fixed: Char property Regen[Hits/Mana/Stam] not working correctly.
Changed: Updated internal MySQL libs version 4.1.18 to 6.1.6. 

19-08-2015, Coruja
Fixed: Combat randomly not starting the first swing.
Fixed: Rubberband when using combat skills while running.
Fixed: World teleports incorrectly showing teleport spell animation.
Fixed: Tracking skill showing empty messages instead not show any message at all when the tracking messages are blank on sphere_msgs.scp.

21-08-2015, Coruja
Fixed: NPCs (brain_monster) always trying to apply poison on hit, even if the NPC doesn't have poisoning skill or poisoned weapons.
Fixed: NPCs not moving when step on Fire Field spell.
Fixed: Tactics skill too difficult to gain on combat.
Fixed: Explosion potion not flagging criminal when hit someone.
Fixed: Spells disturb not working correctly in some specific cases.
Fixed: Missing paperdoll update when char ID (body) get changed.
[Sphere.ini] Removed COMBAT_PREHIT combat flag, it can be replaced by AttackingIsaCrime which does the same thing.
[sphere_defs.scp]: Added new 'dam_nodisturb' damage flag.

25-08-2015, Coruja
Fixed: Food items not restoring char FOOD correctly.
Fixed: HitLeech[Life/Mana/Stam] and HitManaDrain properties making hits/mana/stam rise over the max char limit.
[sphere_spells.scp]: Removed SOUND / EFFECT_ID from Teleport spell. These values are already handled by Sphere.ini settings, and sphere_spells.scp values was making it play twice.

27-08-2015, Coruja
Added: New STEPSTEALTH char property to set how many steps the char can walk invisible while using Stealth skill. This property is set when using Stealth skill, will decrease -1 on each walk step (or -2 if running) and will reveal when reach 0.
Changed: Trigger @StepStealth no longer use ARGN1 to force reveal, the ARGN1=1 can be replaced by STEPSTEALTH=0.
Fixed: Missing buff icon when using INVIS (GM command).
[sphere_skills.scp]: New Stealth softcoded skill.
	-IMPORTANT: It's HIGHLY recommended update it, or this skill will stop working.

28-08-2015, XuN
Changed the way SPAWNS works, improved them and added more access functions:
	- Removed MEMORY_ISPAWNED from source (still present as a def in sphere_defs.scp for backwards-compat)
	- Updated SpawnItem to point directly to the spawn instead of redirecting to memory's link.
	- Moved SpawnItem (R) to COjbBase to affect both chars and items.
	- Spawned OBJs are now stored in the spawn, so SpawnItem only gives quick access to the spawn.
	- Functions added to spawns:
		- AT.n.KEY (R): Retrieves the 'KEY' val for the 'n' spawned item/char, examples: <at.0.name>, <at.0.str>...
		- COUNT (R): Returns the total count of spawned items or chars.
		- RESET (W): Removes every spawned Item/Char.
		- STOP (W): Removes every spawned Item/Char and stops the Spawn.
		- START (W): Same as DClicking the Spawn, but from function, without LOS/Distance/etc limitations (It just makes it start, doesn't reset it, so won't work if it's already working).
		- ADDOBJ uid (W): Adds the given UID(the Item/Char must exist obviously, so it must be created before) to the Spawned list, it doesn't check for MORE2 < AMOUNT or anything, it's a forced add. Example:
				ON=@GetHit
					REF1=<SpawnItem>
					SERV.NEWNPC=<baseid>
					NEW.P=<P>
					NEW.FLAGS |= STATF_CONJURED
					REF1.ADDOBJ=<NEW>
		- DELOBJ uid (W): The opossite of ADDOBJ, removes one OBJ from this list (just remove from the list, it's not removing the OBJ itself).
NOTE: While updating for this build, when server is loading for first time and converting MEMORY_ISPAWNED to SpawnItem and removing these memories, Sphere will throw a memory_leak exception after loading the world because of the difference between items before loading (chars with memory_ispawned) and items after loading (memory_ispawned removed).

Added PREVBUILD storing in the worldsaves the current BUILD (__GITREVISION__), usefull to apply changes when updating the bin. Usage: <SERV.PrevBuild>


Changed iSwingDelay from CChar::Fight_Hit to CResource::Calc_CombatAttackSpeed to prevent double checks for speeds 'lower than' and to avoid guard's speed to be overriden if GuardsInstantKill=1
Also changed AnimDelay from @HitTry to initially have a duration of argn1 -=7, so this can be softcoded to match 'old style' by just adding a simple +=7
Updated fighting delays to match again the 'real' delay removing a tick from the delay (as the fighting proccess is starting in the next tick).
Fixed #2554: SkillUseQuick not checking for SKF_SCRIPTED
Fixed #2553: Animations not being displayed when fighting with COMBATF_NODIRCHANGE
Fixed #2547: Dragons will be tracked as Monsters
Fixed Tracking not displaying the direction of the target in the given message.
Fixed ML SpeedEra's formula not giving correct delays.

15-09-2015, XuN
Fixed #2542: NPCs ridden by GMs deleted on WorldSave.
Fixed #2554: UseQuick not returning false for Skills with SKF_SCRIPTED.

17-09-2015, Coruja
Fixed: Combat swing behavior not working correctly.
[sphere_skills.scp]: Updated Parrying skill to fix glow effect appearing even on failure.

18-09-2015, Coruja
[sphere_monsters.scp]: Added new dinosaurs CHARDEFs from UO Time of Legends (still incomplete yet).
[sphere_item_char_icons.scp]: Added ITEMDEF i_pet_tiger.

19-09-2015, Coruja
Fixed: LOCAL.AnimDelay on @HitTry trigger not working correctly.

25-09-2015, XuN
Fixed #2558: errors thrown when CombatSpeedEra=0 and Weapons had no SPEED defined.
Fixed #2556: Added GetDefKeyNum/Str as shortcut to get directly the values, used in CChar::Fight_Hit to send correct values to CChar::OnTakeDamage
Fixed HitLeechLife/Stam/Mana not giving the corrent amount of hits/stam/mana
CHANGED tag.override.sound_hit to AMMOSOUNDHIT and tag.override.sound_miss to AMMOSOUNDMISS to match other AMMO* properties.

25-09-2015, Coruja
Fixed: Console error when players call "Guards".
Added: Better user-friendly description to server exit codes. Now the console will show "Server terminated: [reason][code]" instead "Server terminated by error [code]".

28-09-2015, Coruja
Fixed: NPCs not facing target when starting combat swings.
Added: New 'DYE <uid>' function to open dye gump on selected UID.

01-10-2015, XuN
Fixed combat swings being aborted when range was not in the required limits regardless of COMBATF_STAYINRANGE enabled or disabled.
ReAdded COMBATF_PREHIT since AttackingIsaCrime is the setting used now to handle notoriety checks, and prehit is used to create a different combat style on some servers dealing damage first and recoaling after.
Added #2560: @TARGON_CANCEL will fire on chars now when closing a target created by TARGETF*, ARGS = function.
[sphere.ini]
	-Added: LootingReveal, setting this to 1 will force your character to be revealed when looting corpses that don't belong to you.

03-10-2015, Coruja
Fixed: Console error when using some specific functions on NPCs or offline players.
Changed: Default timer to close doors after open it changed from 60sec to 20sec.
[items/sphere_item_magic_ninjitsu_bushido.scp]: Fixed wrong MOREZ on i_spellbook_bushido, i_spellbook_ninjitsu.
[maps/sphere_map5.scp]: Added new regions from UO Time of Legends expansion.

04-10-2015, Coruja
Fixed: Hit Chance combat formula not working correctly.
Fixed: sphereworld.scp file saving many [SECTOR] templates for the same sector separately instead save everything related to this same sector on the same template.
[sphere.ini]: Removed EF_Specific / OF_Specific settings, which was incomplete since 7 years ago and was never released to public.

05-10-2015, Coruja
Added: Basic support for UO Time of Legends (TOL)
	-Added RESDISP 9 (TOL) support.
	-Added VIRTUALGOLD function to store virtual gold of chars.
	-Added support for the new trade window changes.
	-Added new 'Trade' popup button to open a trade window when click on another player (enabled only on TOL clients 7.0.46.0+)
	[sphere_admin.scp]: Added 'admin_resdisp_9' def.

08-10-2015, Coruja
[Sphere.ini]:
	-Added new FeatureTOL and FeatureExtra settings (some flags still incomplete)
	-Moved FEATURE_ML_NINTHAGE (FeatureML) to FEATURE_EXTRA_CRYSTAL (FeatureExtra)

09-10-2015, Coruja
Added: Small improvements on TOL trade window.
Added: 'physical' gold piles now will be converted to 'virtual' gold when dropped on bankbox (if FEATURE_TOL_VIRTUALGOLD is enabled).
[sphere_msgs.scp]: Added new messages 'bvbox_deposited', 'msg_trade_sent_*', 'msg_trade_received_*'.
[sphere_map_points5.scp]: Updated [MoonGates] values.

16-10-2015, Coruja
Fixed: TOL trade window not allowing trade gold when the char have 1 or more platinum.

29-10-2015, Coruja
Fixed: Context menu not working on items.
Fixed: Spells memories incorrectly being dropped to backpack instead get removed when the char is already under a spell effect and cast it again.
Fixed: Spells memories intentionally created with TIMER=-1 not being removed when the char cast the spell again to cancel the current effect.
Changed: Buff/debuff spells now will get the memory effect layer from scripts instead use hardcoded values.
	-IMPORTANT: It's HIGHLY recommended check if your sphere_spells.scp is updated and have LAYER value properly set on buff/debuff spells, or these spells will stop working.

30-10-2015, XuN
Added EquipSound to override sounds for items when equipping them.
Changed tag.override.dropsound to DropSound.

03-11-2015, Coruja
Fixed: Possible Sphere crash when DClick on items with long LINK sequence (thx roberpot).
Fixed: Key items linked to houses/boats not being recognized correctly on backpack when using locked items.

04-11-2015, Coruja
Changed: NPC Banker (brain_banker) is now considered an NPC vendor and can use BUY/SELL commands.
[Sphere.ini]:
	-Added new NPCTrainCost setting to tweak the cost of skills trained on NPCs vendors (credits to Nazghul, he did this setting 7 years ago but never enabled it, I just made some improvements and enabled it).
	-Updated NPCTrainMax value.

05-11-2015, XuN
Fixed NPCs not reacting instantly when they see a new target, they stand in the place for some random time without moving against their target.
Fixed Spawns having no NPC limit.
Added MAGIFC_NOREVEALINVISIBLE		02000	// (Old style backwards) Casts won't reveal you on SpellCast if you are under Invisible spelleffect.

07-11-2015, Coruja
[Sphere.ini]
	-Added new ClientLoginTempBan setting to tweak the temporary ban duration of client IP when it reach max wrong password tries
	-Renamed MaxAccountLoginTries setting to ClientLoginMaxTries

09-11-2015, Coruja
Fixed: Mounts disappearing on world save when ridden by NPCs.

13-11-2015, Coruja
[sphere_skills.scp]: Fixed console error when an NPC try to use Tracking skill.
[items/sphere_item_char_icons.scp]: Added TOL NPCs icons.
[npcs/sphere_monsters.scp]:
	-Updated NPCs Wild Tiger and TOL dinosaurs.
	-Added new TOL NPCs Silverback Gorilla, Infernus, Greater Phoenix, Myrmidex Drone.

16-11-2015, Coruja
Fixed #2563: FasterCasting char property incorrectly affecting spell cast delay on chars with GM=1 set.

19-11-2015, Coruja
Fixed: Items inside Trade Window container becoming unreachable after server worldsave + shutdown while the trade window is open.
Fixed: Tracking skill not aborting the action when the client logout.
[sphere_skills.scp]: Fixed console error on Tracking skill.

20-11-2015, Coruja
Fixed: Combat exploit to force start next swing immediately instead wait proper delay between swings.
Changed: Now instead char spawns (t_spawn_char) block the char creation when it reach sector max char complexity, it will spawn the char but throwing an 'Sector too complex' console warning.

24-11-2015, Coruja
Fixed: Buffs not reloading correct remaining timer on client login.
Fixed: Spiderweb (t_web) making chars stay stuck even after the spiderweb get removed.

28-11-2015, Coruja
Fixed: Protection spell not working when COMBAT_ELEMENTAL_ENGINE .ini setting is disabled.

01-12-2015, Coruja
Fixed: Players randomly switching to another target on combat.

03-12-2015, Coruja
[Sphere.ini]: Removed InitHiddenSkills setting. Now player characters are created with base values set on all skills set instead set only on skills that the player client version can see.

04-12-2015, Coruja
[Sphere.ini]:
	-Added new RacialFlags setting to tweak human/elf/gargoyle racial traits individually.
	-Removed FEATURE_ML_RACIAL_BONUS and FEATURE_SA_RACIAL_BONUS settings (they got moved to RacialFlags).

06-12-2015, Coruja
Changed: Improved walk packets on classic/enhanced clients.
[Sphere.ini]: Moved DEBUGF_WALKCODES to new EF_FastWalkPrevention experimental setting (also improved, but still incomplete yet).

17-12-2015, Coruja
Fixed: House customization not allowing clients to walk.
Fixed: Backpack not updating on death.
[Sphere.ini]: Added new pre-AOS option on CombatSpeedEra setting.
	-IMPORTANT: Option values got changed, check if the selected option is correct after update the script.

18-12-2015, Coruja
Changed: Improved the event handler when an item equip/drop request was denied. Now the item is dropped on its last location instead always drop it on player backpack.

30-12-2015, Coruja
Fixed: New player chars not creating MALE_DEFAULT / FEMALE_DEFAULT newbie items when the player select Necromancer/Paladin/Ninja/Samurai as profession on character creation screen.
Fixed: Potions not removing previous memories on layer 'layer_flag_potion' before equip new memories on this layer.
Fixed: Curse spell not working correctly when COMBAT_ELEMENTAL_ENGINE is enabled.

03-01-2016, Coruja
[sphereCrypt.ini]: Added crypt keys for clients 7.0.46 and 7.0.47 (thx XuN and Feeh, I found these values on their forum posts)
[sphere_map_points0.scp]: Updated new player start locations.

08-01-2016, Coruja
Fixed: Clients requesting unnecessary 'resync' packets to server.

10-01-2016, Coruja
Fixed: Client packet problems when players teleport while walking.

11-01-2016, Coruja
Fixed: return 1 on char trigger @EquipTest / @ItemEquipTest making the item drop on char backpack instead on its last location.

12-01-2016, Coruja
Fixed: MAGICF_STACKSTATS magic flag not working correctly.

15-01-2016, Coruja
Fixed: Damage spells disturbing the caster if casted on himself.
Changed: Telnet connections will not receive B (broadcast) messages anymore.
[Sphere.ini]: Changed AutoResDisp default value and functionality.
	Previously this setting was used to set an fixed RESDISP value to new created accounts.
	Now it's a boolean (1=on/0=off) and if enabled it will automatically set account RESDISP on @Login based on player client version.

16-01-2016, Coruja
Fixed: Exploit allowing instant hit on combat.
Fixed: TARG/TARGPROP/TARGPRV char properties returning decimal values instead hex.
Fixed: OF_ScaleDamageByDurability flag not working correctly on items using min durability (MORE1L) = 0.

19-01-2016, Coruja
Changed: Improved Detecting Hidden skill behavior.
[Sphere.ini]: Changed GameMinuteLength default value.
[sphere_monsters.scp]: Added missing stats/skills values on TOL dinosaurs.
[sphere_item_char_icons.scp]: Renamed i_pet_anchisaurus -> i_pet_anchisaur
[sphere_item_animations.scp/sphere_item_deco_lightsources.scp/sphere_item_deco_virtues.scp/sphere_item_profession_alchemist.scp/sphere_item_unsorted.scp]: Removed unused TDATA4 from all t_light_lit items.

20-01-2016, Coruja
Fixed: Console error when GM use commands to add objects on undefined regions.

21-01-2016, Coruja
Added: Missing tame/bonded/summoned tooltips on NPCs.
Fixed: t_spawn_item not saving/loading correctly spawned items.
Fixed: Spawns (worldgem bit) not updating the tooltip when add/delete objects.
Changed: Summon spells now will create NPCs with HOME and HOMEDIST=10 set by default.

22-01-2016, Coruja
Added: New pet command '* unfriend'.
Changed: Many improvements on pet commands engine.
[sphere_speech.scp]: Added UNFRIEND line on speech lists.
[sphere_msgs.scp]: Added new messages 'npc_pet_confused' and 'npc_pet_targ_*'.
[sphere_spells.scp]: Removed 'spellflag_targ_xyz' from most summon spells. The only summon spells that uses target is Blade Spirits and Energy Vortex.
[items/sphere_item_magic_spellweaving.scp]: Added missing color on i_spellbook_spellweaving.

23-01-2016, Coruja
Fixed: Pets accepting items from its owner even when the owner can't access the pet backpack.
Fixed: Polymorph spell and POLY function not working correctly.

27-01-2016, Coruja
Fixed: Items disappearing when players try equip it without have required STR.
Fixed: LOWERREQ item property not working correctly.

28-01-2016, Coruja
Fixed: Summon Creature spell not working correctly.

31-01-2016, Coruja
Fixed: Character stats gump (hits/mana/stam) showing wrong info for players on same party.
Added: New function OPENTRADEWINDOW to start an trade window between 2 players (both clients must be in range and visible).
	Usage: OPENTRADEWINDOW player_uid, item_uid (item uid is optional)

05-02-2016, Vjaka
Fixed: applied a patch by cbnolok fixing xmfhtmltok and sphere crashing on custom skils with index > 57.
    Maximal skills has been set to 99

11-02-2016, Coruja
Fixed: Hiding skill not removing previous Invisibility spell effect on success.
Fixed: Char STEPSTEALTH value being reseted to 0 when function REVEAL is called to clear a single flag but the char still invisible using other flags.
Changed: Improved handling of 'Open Spellbook' and 'Open Door' client macro.
[sphere_msgs.scp]: Added new message 'macro_opendoor' and removed 'msg_nospellbook', 'npc_generic_thanks', 'npc_pet_drop'

13-02-2016, Coruja
Fixed: Buff/Debuff bar showing wrong time left on spells memories using TIMER=-1.
Fixed: Some skills not calling skillgain when action difficulty > skill value, making the skillgain chance always be 0%.

16-02-2016, Coruja
Changed: Improved Sphere main timestamp engine.

16-02-2016, Nolok
Fixed: Ships moving but not updating the multi part on Enhanced Client with smooth sailing disabled.
Changed: Removed useless screen updates when smooth sailing is on, making sailing more fluid.
Fixed: Price of items sold by the vendor swapped on Enhanced Client.
Changed: Removed useless packets sent when opening vendor sell gump on Enhanced Client.

17-02-2016, Nolok
Fixed #2576: SpawnItem value is now readable under @Create trigger.

17-02-2016, XuN
Fully enabled MT_NONMOVER from source, NPC's with this CAN flag will not move at all (avoiding glitching with dex 0 or using tag.nomovetill, which both could screw some things). Updated on sphere_defs.scp too.
Added GetSight() to Char's range in NPC_LookAround to get a dynamic value of the VisualRange property, which was not working on NPCs.
Changed: ARGN1 = 1 in @Stroke trigger(s) calling UpdateDir on character against it's target instead of forcing it to always turn if SKF_GATHER was present.

17-02-2016, Coruja
Fixed: Functions ATTACK/FACE/SALUTE crashing Sphere if called using too many args.

19-02-2016, XuN
Fixed: T_SPAWN_ITEM not working when DClicking the Spawn.

19-02-2016, Nolok
Fixed: ACT not being updated when using .add to add an item. This solves also AxisII being unable to initialize placed spawn items.

22-02-2016, Nolok
Fixed: T_SPAWN_ITEM not automatically setting attr_invis, whereas it happened with T_SPAWN_CHAR.
Fixed: T_SPAWN_ITEM not removing spawned items when it got deleted.
Fixed: forced T_SPAWN_ITEM and T_SPAWN_CHAR to be unstackable through an internal workaround, stopping the Enhanced Client behaviour
	of "unstacking" spawn items with amount > 1 when trying to move them.
Changed: T_SPAWN_ITEM now colours itself red, like t_spawn_char, and when initialized it changes the DispID to i_worldgem_lg,
	in order to differentiate it from worldgem bits related to resource gathering and to make it more visible.
Changed: the MORE2 of a T_SPAWN_CHAR does no more indicate the amount of chars spawned, for that there is the COUNT property
	(read only, introduced time ago), which works also for T_SPAWN_ITEM.
	MORE2 is used only by T_SPAWN_ITEM to indicate the maximum pile amount	of the spawned item (if this is 0, spawn up to the total amount).
	COUNT property does not sum the amount of each spawned item.
	This resolves the ambiguity of MORE2 meaning and saves some space in the save files (you may want to set MORE2=0 to your old T_SPAWN_CHARs).

	-IMPORTANT: this change means that if in your scripts you get the amount of spawned chars with MORE2,
		you should now reference to it with COUNT!

Fixed: MORE2 property for T_SPAWN_ITEM not working as intended.
Changed: now double clicking a T_SPAWN_ITEM spawnitem has the same effect it has on T_SPAWN_CHAR, that is resetting it
	(remove existing items spawned from it) if the timer is running, otherwise starting it (forcing the spawn to work and create some items).
[sphere_msgs.scp] Removed ITEMUSE_SPAWNCHAR_NEG, ITEMUSE_SPAWNCHAR_RSET, ITEMUSE_SPAWNITEM_TRIG and unified them as:
	ITEMUSE_SPAWN_NEG and ITEMUSE_SPAWN_RESET.

22-02-2016, Coruja
Fixed: Enhanced clients not placing items on correct container GRID slot when using containers on 'list view' mode.

23-02-2016, Coruja
Fixed: Some clients not parsing correctly the last number/letter of client version.
Fixed: Spawn items resetting COUNT and AMOUNT values to 0 on server restart.

25-02-2016, XuN
Improved the code of NPC's SpellCasting engine: removed some code and updated a bit the current. Also moved some spells to give them higher priority (Healing > cure poison > buffs ...)
Added SKF_DISABLED, setting this flag on skills will not allow to use them by players or npcs
Added Skill_CanUse(skill) checking if the skill is disabled. Maybe this can be expanded to differ Players from NPCs , adding expansion & resdisp checks, etc.
WARNING: Following changes won't affect current scripts, but adapting them will remove the performance impact (Read NOTE for more tips about what to update).
CHANGED: Moved formulas for SpellEffect's damage above @SpellEffect trigger, so these formulas will be calculated regardless of the returns of the trigger,
			this will allow working with precise numbers instead of wondering what ARGN1 may be and creating own formulas to handle it.
	Also added for this trigger:
		-local.dam with final damage received (if any).
		-local.resist: Damage reduction to apply, it's set to 25 automatically when the spell is going to be resisted, then sysmessage <DEFMSG.RESISTMAGIC> will be shown. Setting it to 0 will result in no resist and no sysmessage. You can force or totally remove resists here.
NOTE: Since formulas will be calculated yes or yes from now, checks about spell's affecting this char or not should be moved to @SpellSuccess ( they should've been there from an start, but we all placed them in @SpellEffect :P) so @Effect won't even be called.
Fixed some spells not being correctly found in case of having multiple books since the code for GetSpellbook() returned the first found book, and this may not have the requested spell.

Script Pack:
	-sphere_defs.scp: Added SKF_DISABLED

25-02-2016, Nolok
Fixed: Spawn items sometimes created with random COUNT property.

28-02-2016, Coruja
Fixed: Buff spells acting like damage spells.
Changed: Some changes on spell triggers (@Effect [spells] / @SpellEffect [chars]) to allow more user customization
	-Renamed LOCAL.Dam to LOCAL.Effect, now it can be used on all spells (damage, buff, etc) instead only on damage spells
	-Added new LOCAL.Duration to change spell duration
	-ARGN2 [skill level] is now read-only
	-ARGN3 [effect multiplicator] got removed, it's no longer needed since now the spell effect value/duration can be changed using LOCAL.Effect/LOCAL.Duration

29-02-2016, Coruja
Changed: Function REPORTEDCLIVER now will return the full client version string (eg: 5.0.2d) and REPORTEDCLIVER.1 will return the raw version number (eg: 5.0.2d = 5000204).
Added: Support for [*]UpdateRange client macros.

01-03-2016, Coruja
Fixed: Sphere crash when any old UO:3D client try to connect.
Fixed: Chars not checking if it still have enough STR to use equipped items when decrease STR/MODSTR.

05-03-2016, Coruja
[sphere_monsters.scp]: Added new TOL NPCs Giant Gorilla, Tiger Cub, Tyrannosaurus Rex (incomplete yet).
[sphere_map_points0/1.scp]: Updated MoonGates template.

07-03-2016, Coruja
Fixed: Invisibility spell not removing previous Hiding skill effect on success.
Changed: SPEECHCOLOR property now can be used on players too (read-only).
Changed: WOPColor .ini setting now will inherit color from char SPEECHCOLOR value if set to 0.

08-03-2016, Coruja
Fixed: NPCs permanently adding target to ignore list when they can't see it.
Fixed: NPCs getting stuck over traps / field spells without walk away.

10-03-2016, Coruja
Fixed: Typedef t_booze returning console error when used more than once.
Changed: SRC on char trigger @EffectAdd now will point to the spell caster instead target.

11-03-2016, Coruja
Fixed: Magic Reflection spell effect not working correctly.
Fixed: Poison / Poison Field spells not calling trigger @EffectAdd on chars.
Fixed: Console error when call ATTACKER.x function using invalid 'x' value.

14-03-2016, Coruja
Added: ARCSIN, ARCCOS, ARCTAN intrinsic functions.
Fixed: Console error when NPCs cast buff/debuff spells on players and die, leaving the spell memory linked on an invalid UID.
Changed: Slightly changed armor % distribution between layers to match old T2A style.
	-Distribution on shields is now 7% of ARMOR value instead [Item ARMOR * (Char PARRYING / 10)]. This could reduce a lot of ARMOR on shields, but there's no problem since shields are used to block the entire damage (parrying) and not to raise ARMOR.

15-03-2016, Nolok
Changed: Reverted ARGN2 on @Effect and @SpellEffect to be Read/Write, since someone still may need it, but keep in mind that effect/duration/etc are calculated before these triggers.
	Also, since some commit, ARGN2 is the randomized spell "potency" used internally, not the original one used to cast/spelleffect the spell.

16-03-2016, Coruja
Fixed: Console error (object not placed in the world) when casting spells that equip memories with TIMER=-1.
Fixed: Weird walk animation when NPCs step on traps / field spells.

17-03-2016, Coruja
Fixed: Spells WOP sending an extra whitespace at the end (eg: "Rel Por ") breaking Razor/UOSteam WOP formatting feature.
[Sphere.ini]:
	-Removed COMBAT_OSIDAMAGEMOD combat flag.
	-Added new CombatDamageEra setting, which does exactly the same thing using the same formulas, but now able to switch between 3 damage formulas instead 2.

18-03-2016, Coruja
Fixed: NPCs getting stuck without move when their combat target use hiding/invisibility.
Added: New LOCAL.ItemDamageLayer (read/write) on trigger @GetHit to get/select the char LAYER that will be damaged on hit.

20-03-2016, Coruja
Fixed: Sphere not storing correct client version on some specific clients, making it send unsupported packets to these clients (resulting in client crash).

21-03-2016, Coruja
Changed: Multi placement target now will center to the multi front door (as OSI does) instead multi center.

24-03-2016, Coruja
Changed: As many users requested, walk through hidden/invisible chars won't require full stamina to pass anymore (this can be customized using ARGN1 on @PersonalSpace trigger)

25-03-2016, Coruja
[sphere_msgs.scp]: Added new CMSG_DEF_FONT and CMSG_DEF_UNICODE settings to customize character name on single click.

30-03-2016, Coruja
Added: TAG.OVERRIDE.TRAINSKILLCOST on NPCs vendors to override NPCTrainCost value from sphere.ini
[sphere_map0.scp]: Fixed RECT values on Green Acres and Green Acres 3.

05-04-2016, Coruja
Fixed: Ship planks allowing usage from distances > MaxShipPlankTeleport setting on Sphere.ini, allowing the player enter on the ship on locations that he won't be able to exit.
Fixed: Magic Reflection flagging criminal the char receiving the spell instead the caster.
Fixed: Chars creating blood on combat even when BLOODCOLOR=-1 is set to prevent the blood creation.

09-04-2016, Coruja
Changed: Reverted changes on pet command STOP. Now it will act as an duplicated command of STAY instead make the pet stop all current actions and start follow his owner again.
[sphereCrypt.ini]: Updated all crypts to use the new client version format.
0.56d, Current Nightly
----0.56d --------------------------------------------------------------------
---- 10/04/2016
10-04-2016, Coruja
Changed: Food level won't decrease on GM chars anymore.
[sphere_msgs.scp]: Removed messages 'npc_text_murd_*'.
[sphere_speech.scp]: Moved hardcoded speech commands 'I must consider my sins', 'I resign from my guild' and 'I resign from my town' to scripts.
	-IMPORTANT: It's HIGHLY recommended update this script, or these speech commands will stop working.

18-04-2016, XuN
Removed TAG.OVERRIDE.MAXWEIGHT and added ModMaxWeight on it's place for Banks and Corpses.
Fixed stackable items not checking maxweight on corpses.
Removed all references to MEMORY_WAR_TARG since they are not needed anymore, targets are handled by 'Attacker' now.
Added back old HitChance formula under CombatDamageEra = 0
Updated checks on @NotoSend trigger: it will not check anymore if ARGN1 > NOTO_INVUL, so you can create custom notoriety.

19-04-2016, Coruja
Fixed: Protection spell not working correctly if COMBAT_ELEMENTAL_ENGINE combat flag is disabled.
[Sphere.ini]: Added new CombatHitChanceEra setting to switch between Hit Chance formulas on physical combat.

20-04-2016, Coruja
Changed: Console errors/warnings now will be colored white again (as it was on old sphere builds).
Fixed: Movement checks not allowing climb some stairs/mounds.

21-04-2016, Coruja
Added: New guild functions ISALLY/WEALLIANCE/THEYALLIANCE, it works exactly in the same way as ISENEMY/WEWAR/THEYWAR but used to set alliances instead wars.

29-04-2016, Coruja
Fixed: COMBAT_ARCHERYCANMOVE combat feature not working correctly.
Fixed: Sphere internal FastLoot prevention not working correctly.
Fixed: Invisible (statf_invisible) chars not being revealed when others chars walk over him.
Fixed: Vendor buy menu showing wrong char 'gold available' value.

30-04-2016, Coruja
Fixed: Mounts disappearing on worldsave on some specific situations.

04-05-2016, Coruja
Fixed: Wrestling using wrong attack animation when unmounted.

07-05-2016, Coruja
Changed: Enhanced clients now will always have tooltips enabled (even if this feature is disabled on Sphere.ini). These clients uses tooltips instead @Click calls, so it's a must-have feature.
Fixed: Spellbook gump not working correctly on enhanced clients.
Fixed: Criminal notoriety incorrectly overriding guild notoriety (war/ally) on chars.

08-05-2016, Coruja
Fixed: Explosion potions not working correctly.
Fixed: Functions SKILLLOCK/STATLOCK not updating the lock icon on client skills/stats window.

15-05-2016, Coruja
Changed: Updated internal Libev libs v4.1 to v4.22.
Changed: Updated internal SQLite libs v3.8.11 to v3.12.2.

19-05-2016, Nolok
Fixed #62: High value FLAGS showing wrong value when retrieved.

21-05-2016, Coruja
[sphere_item_unsorted.scp]: Updated giftbox itemdefs.
[sphere_map_points0/1.scp]: Fixed Hythloth entrance and updated Covetous teleports.

24-05-2016, Coruja
Fixed: Tooltips not showing on disconnected chars when ALLSHOW is enabled.

28-05-2016, Coruja
Fixed: Function MOVENEAR not working correctly.

29-05-2016, Coruja
Fixed: Pet command 'guard me' making the pet follow the owner instead guard him.
Fixed: Jailed players being teleported to the same jail region with no reason when the client login.
Changed: Improved text formatting of basic console commands.

06-06-2016, Coruja
Fixed: Paperdoll and character profile gump showing wrong info.
[sphere_msgs.scp]: Added message 'msg_acc_age' and removed unused 'tooltip_tag_armor', 'tooltip_tag_destination', 'incognito_name_male', 'incognito_name_female'.
[sphereCrypt.ini]: Added crypt key for client 7.0.50

07-06-2016, Coruja
Fixed: Incognito spell considering char notoriety neutral/not-neutral on different actions. To avoid problems, now Incognito will always consider the char neutral (gray), which is the correct effect.
Added: Missing features on Incognito spell
	-It will change char name to a random human male/female name instead always use Man/Woman.
	-It will change char body/hair/beard to a random color temporarily.
	-It won't hide guild abbreviation anymore (the player can choose hide/show it using guild menu).

13-06-2016, Coruja
Fixed: Boat/ship parts resetting TYPE after use 'turn' commands.
Fixed: Server crash when Injection clients connect using fake client version exploit.
Changed: Renamed file Sphere.ini -> sphere.ini to avoid case-sensitive problems on Linux builds.
Changed: Updated internal SQLite libs v3.12.2 to v3.13.0.

17-06-2016, Coruja
Fixed: Paralyze / Paralyze Field making NPCs flood too many attack actions.
Fixed: Console error when for some reason an NPC got created/moved to an invalid region.

22-06-2016, Coruja
Added: Support for colored multis on target functions (only compatible with HS clients 7.0.9.0+)
	-Target functions can set the multi color using TARGETM [multiID, color] and TARGETFM [function, multiID, color]
	-Target will inherit the deed color when got triggered from an deed

27-06-2016, Coruja
Fixed: Function f_onchar_delete not being called if the player char get deleted in any other way different from client Character Selecion menu.
Fixed: Multi dynamic regions getting replaced by script static regions on server resync.
Fixed: EF_FastWalkPrevention not working correctly.
Fixed: Popup menu on players returning parsing error when send Party clilocs to unsupported clients < 6.0.0.0

28-06-2016, Coruja
[sphere_item_unsorted.scp]: Fixed wrong TYPE / TDATA2 on i_fountain_life, i_chest_combination.
[sphere_item_deco_carvings_statues.scp]: Fixed wrong TYPE / TDATA2 on i_statue_stone_blessed.
[sphere_item_deco_furniture.scp]: Fixed wrong TDATA2 on i_chest_kings_collection.
[sphere_serv_triggers.scp]: Updated 'f_onchar_delete' comments.
[sphere_defs.scp]: Updated 'mount_items' and 'mem_flags' values.
[sphere_skills.scp]: Reordered properties to follow the same default order on all skills (nothing was changed, just reordered).
[speakhuman.scp]: Fixed 'train' command returning console error when used on guards NPCs.

29-06-2016, Coruja
Fixed: Attack/Kill command on pets allowing select the pet itself as target, making it attack his owner.
Fixed: WOP flood when casting spells using extremely short delays.
Fixed: Containers using wrong rect area.

30-06-2016, Coruja / azmanomer
[sphere_item_unsorted.scp/sphere_template.scp]: Updated more giftbox itemdefs.

08-07-2016, Coruja
Changed: Some misc improvements and optimizations on combat engine.

13-07-2016, Coruja
Fixed: Chars not able to climb some small mounds.
Fixed: Spawns (worldgem bit) not updating DISPID when set SPAWNDEF on MORE1.

14-07-2016, Coruja
Changed: Improved some NPCs interactions with players.
Fixed: Spawns (worldgem bit) creating chars on stuck locations.

22-07-2016, Coruja
Fixed: Security issue setting account login as chat name when newest clients try to setup the chat window for the first time and the char name is not available.
Fixed: Invisible chars being incorrectly revealed by REVEALF_LOOTINGOTHERS reveal flag when picking items from the ground.
Fixed: Return 0/1 on spell triggers not working correctly.
Fixed: Function MOVENEAR not working correctly.

23-07-2016, Coruja
Fixed: Corpses being created without MORE2 set (last attacker UID) when the char die.
Changed: Updated pick/drop sound on items/containers.

01-08-2016, Coruja
Added: ADD function now supports a new 2nd arg to set the obj amount (eg: 'add i_bandage 10', 'add c_gargoyle 3', ...)
Fixed: Items inside trade window not firing @DropOn_Item trigger when the trade move the item to player bacpkack.
	PS: Using return 1 here will not cancel the trade, this must be done directly on @TradeAccepted/@CharTradeAccepted triggers.

03-08-2016, Coruja
Changed: Max item capacity on containers changed from 255 to 125. This is required to make containers work properly on Enhanced Clients.

05-08-2016, Coruja
Fixed: Combat swing delay not getting updated immediately when the char switch weapons on hands.

07-08-2016, Coruja
Fixed: ARGN1 on char trigger @SkillPreStart not working correctly.

10-08-2016, Coruja
[sphereCrypt.ini]: Added crypt keys for clients 7.0.51 and 7.0.52.
[sphere_monsters.scp]: Added new TOL chardefs (Turanchula, Myrmidex Drone, Myrmidex Warrior, Myrmidex Queen, Dr. Spector, Golem Aztec).

12-08-2016, Coruja
Fixed: SA+ clients showing corpses on wrong direction.
Fixed: pre-SA clients showing wrong light pattern on light sources (candle, torch, etc).
Fixed: Client war mode flag not being removed on death.
Fixed: Multi regions not reloading correctly after server resync.

13-08-2016, Coruja
Fixed: Guards not working correctly.

19-08-2016, Coruja
Changed: Updated internal SQLite libs v3.13.0 to v3.14.1.

20-08-2016, Coruja
Changed: Small improvements on tooltip engine.
Added: Missing RESDISP/RESLEVEL 0 (pre-T2A). Default RESDISP/RESLEVEL value for new created objects is now 0 (pre-T2A) instead 1 (T2A).

21-08-2016, Coruja
Fixed: Internal check to prevent drop items inside walls preventing the item drop even when the wall is on another floor.
Fixed: Message "Too many items here!" not showing correctly when items are dropped on areas with too many items.

22-08-2016, Coruja
Added: ISNEARTYPE function now supports an new 4th argument to only search objects on the same floor.
	-Syntax: ISNEARTYPE item_type, distance, check_multi, check_floor

26-08-2016, Coruja
Changed: Some internal improvements on Tracking skill.
[sphere_msgs.scp]: Updated messages 'tracking_*'.

27-08-2016, Coruja
Changed: Small improvements on container grid engine.

31-08-2016, Coruja
Changed: Some improvements to make client login proccess more reliable.

02-09-2016, Coruja
Fixed: Console error when an online account got deleted.
Fixed: Function f_onchar_delete not being called correctly when the account get deleted.
Fixed: Players with STATF_Stone flag set taking 1hr to disconnect (client linger time) after logout.

03-09-2016, Coruja
Fixed: NPCs not clearing fight action correctly when the current target get out of sight.

05-09-2016, Coruja
Fixed: TimerCall setting on sphere.ini using wrong time format (hours instead minutes) to call f_onserver_timer function.
[sphere.ini]: Removed unused FEATURE_KR_UPDATE_B feature flag.

06-09-2016, Coruja
Added: Support for races on MALE_DEFAULT / FEMALE_DEFAULT starting items template.
Fixed: Items getting equipped on invalid layer or unplaced on world when EQUIP / NEWITEM functions can't equip the item on char.
	-This also fixes new account characters being created with some starting items missing.
[sphere_newb.scp]: Added gargoyle race templates.

07-09-2016, Coruja
Changed: Temporarily disabled ATTACKER.x.IGNORE function and @HitIgnore trigger until we find a way to fix its broken functionality.

14-09-2016, Coruja
Fixed: Rubberband effect when using @Step trigger with MOVE/GO function + return 1.
Changed: return 1 now can be used on @[Item]DropOn_Ground trigger, it will cancel the drop and return the item to its previous location.

16-09-2016, Coruja
Fixed: DAM/ARMOR properties going to 65535 when set any value > 255.
Fixed: NPCs not looking around anymore after start wandering action.
[sphere_msgs.scp]: Updated messages 'skillact_*'.

23-09-2016, Coruja
Fixed: Items not going to backpack when dropped over backpack icon on char paperdoll.

26-09-2016, Coruja
Fixed: HTTP server not working correctly.
Fixed: Console error when deleting account characters.
Fixed: Account character creation not coloring skirt on female characters.
[sphere_msgs.scp]: Removed message 'msg_guildresign'.

27-09-2016, Coruja
Changed: Updated internal SQLite libs v3.14.1 to v3.14.2.

05-10-2016, Coruja
Fixed: Guards NPCs already placed on world not attacking criminal/murderer chars walking nearby.
Fixed: Potions creating cooldown memory (layer_flag_potionused) using wrong name.

06-10-2016, Ares
Changed: New Options for export to exclude own character (SRC) when performing export. The options are now:
	- 1: Only items
	- 2: Only characters without own character.
	- 3: Items and characters without own character. [1+2]
	- (4: Include own Character. But this is meaningless without flag 2)
	- (5: Only items including own character makes no sense. ;-) )
	- 6: Only characters including own character. [2+4]
	- 7: Items and characters including own character. [1+2+4]
Fixed: A rarely occuring bug when importing characters: Sometimes when characters are imported, there is a chance for identical items at same place (in backpack), which are deleted. This shouldn't happen anymore.
Fixed: Importing items with same BASEID and different DISPID at the same place in world removes one of the items unexpectedly. This is especially the case for WSC imports, where same DISPIDs of the same BASEID are is almost always intended. (For example when a part of the static is in game for a while, or migrated between CentrED and a Building-Sphere-Server) The fix is: Such items are not deleted anymore, only when the dispid (and other stuff) matches as well.

08-10-2016, Ares
Fixed: Critical Bug in background save mechanism where an unsaved offline player character disappears from worldsave when moved to an already saved sector.

17-10-2016, Coruja
Fixed: NPCs losing 'statf_spawned' flag after server restart.
Fixed: Nightsight buff icon not being enabled/disabled when using NIGHTSIGHT function or changing 'statf_nightsight' char flag.
Changed: Updated internal SQLite libs v3.14.2 to v3.15.0.

06-11-2016, Coruja
Changed: Updated internal SQLite libs v3.15.0 to v3.15.1.
[sphere_item_char_icons.scp]: Added char icons for Tarantula, Dr. Spector, Tyrannosaurus Rex, Unicorn (Rainbow)
[sphere_item_unsorted.scp]: Added ITEMDEF for TOL christmas giftbox (i_giftbox_christmas)
[sphere_monsters.scp]: Updated some TOL chardefs
[sphere_map0_ml.scp]: Added TOL regions
[sphere_map5.scp]: Moved a_valley_of_eodon, a_shadowguard to sphere_map0_ml.scp
[sphere_defs.scp]: Added mount memory for Ancient Hellhound, Tarantula, Unicorn (Rainbow)
[sphereCrypt.ini]: Added crypt key for classic client 7.0.53 and enhanced clients 4.0.33 ~ 4.0.53

12-11-2016, Coruja
Fixed: Resurrect, Reveal, Meteor Swarm and Lightning spells showing effect animation even when EFFECT_ID=0 is set
[sphereCrypt.ini]: Added crypt key for classic clients 7.0.54 ~ 7.0.55 and enhanced clients 4.0.54 ~ 4.0.55
[sphere_map0.scp]: Added missing 'region_flag_guarded' on a_townOcclo
[sphere_map1.scp]: Added missing 'region_flag_guarded' on a_old_haven_town and a_new_haven_town

27-11-2016, Coruja
Fixed: Console error related to client internal chat engine when some clients connect on server
Fixed: Worldsave not saving DAM/ARMOR properties set manually on chars/items already placed on world
	-NOTE: Changing DAM/ARMOR directly on ITEMDEF/CHARDEF scripts won't update all objects already created anymore, because Sphere will now read DAM/ARMOR values from save files instead read from scripts.
	 To update DAM/ARMOR on objects already created, it will be needed an function like FORINSTANCES to loop through all objects where the value must be updated
Added: Support for items health bar on HS clients >= 7.0.30.0
[sphere_defs.scp]: Added new CAN flag 'can_i_damageable' to enable health bar on items (MORE1L = cur hitpoints / MORE1H = max hitpoints)

30-11-2016, Coruja
Fixed: Server crash when custom clients connect using invalid client version.
Fixed: Ghost mode not setting desolated season on clients.
Changed: Small changes on some console messages to make them standard and provide more relevant data.
Changed: Updated internal SQLite libs v3.15.1 to v3.15.2.

09-12-2016, Coruja
Changed: Sphere can now startup properly without save files instead return "FATAL: missing save files" and close the server. This can make Sphere setup easier for new users.
Changed: Merged TNGSTRIP, STRIP AXIS, STRIP TNG console commands into a single STRIP command.

17-12-2016, Coruja
Fixed: Stealing skill not working correctly.
Changed: Users doesn't have to write AGREE=1 on sphere.ini to use nightly builds anymore. Sphere 56d nightlies are really stable and bug-free so it's safe to use on live servers.

21-12-2016, Coruja
Changed: Updated functionality of all polymorph-like spells (Polymorph, Horrific Beast, Lich Form, Vampiric Embrace, Wraith Form, Reaper Form, Stone Form)
Fixed: Mass Curse spell not working correctly.

22-12-2016, Coruja
Added: Missing buff icon for Criminal flag.
Fixed: Enhanced clients not able to login on accounts with no created chars.
Changed: Improved console startup messages to provide more user-friendly information.
[sphere_defs.scp]: Updated DEFs 'passive_buff_icons', 'debuff_icons', 'buff_icons', 'buff_clilocs'
[sphere_admin.scp]: Dialog 'd_sphereplayertweak' now show the client type (classic/enhanced) being used
[sphere_monsters.scp]: Updated some chardefs (Turkey, Giant Turkey, Tyrannosaurus Rex)

24-12-2016, Coruja
Added: Support for character face style on enhanced clients. It works like hairs/beards, just create the item and equip it on character.
[sphere_item_profession_barber.scp]: Added character face styles ITEMDEFs
[sphere.ini]: Added new FEATURE_EXTRA_ROLEPLAYFACES feature to enable extra roleplay face styles on character creation
[sphere_defs.scp]: Renamed layer 'layer_light' to 'layer_face'
[sphere_newb.scp]: Fixed wrong ITEMDEF on elf templates (i_leaf_tunic -> i_leaf_chest)

28-12-2016, Coruja
Removed: Support for CHARLIST function on enhanced clients, they don't have support for this packet anymore, so disabling it will prevent client crash.

05-01-2017, Coruja
Changed: Updated internal SQLite libs v3.15.2 to v3.16.1.
Changed: Item i_light_source (function EQUIPHALO) now will be equipped on layer_hand2 (2) instead layer_face (15), which previously was an unused layer but now is used by character faces on enhanced clients.
[sphere_item_unsorted.scp]: Updated LAYER value on i_dark_source / i_light_source
[sphere_spells.scp]: Fixed Blade Spirits spell using wrong RUNES value
[sphere_newb.scp]: Fixed typo i_sword_dream -> i_sword_dread

07-01-2017, Coruja
[sphere_map*.scp]: Reworked all maps files moving regions/teleports to new files based on map/expansion, and also added many missing SE/ML/SA/TOL info.
[spheretables.scp]: Updated RESOURCES list with the new map files.

08-01-2017, Coruja
Changed: Updated internal Libev libs v4.22 to v4.24.
Changed: Updated internal Zlib libs v1.2.8 to v1.2.10.
Fixed: Function 'CRIMINAL 0' not updating char notoriety/buff when removing criminal flag.

12-01-2017, Coruja
Fixed: Char death counting kill/fame/karma gain for killers that started the attack but don't have caused any damage yet.
Fixed: FeatureSE setting on sphere.ini not working correctly.
Changed: Guild function ISALLY won't consider guild alignment on alliances anymore.
[sphere_genericstone_functions.scp]: Updated f_stonesys_internal_isalliedwith function

15-01-2017, Coruja
Changed: Updated internal MySQL libs v6.1.6 to v6.1.9.
	-IMPORTANT: It's HIGHLY recommended update libmysql.dll file on Sphere folder (Windows users) or MySQL packages (Linux users) to prevent errors when using MySQL.

17-01-2017, Coruja
Fixed: Functions SYSMESSAGELOC / SYSMESSAGELOCEX using wrong default color.
[sphere_item_magic_skillmasteries.scp]: Added new file with basic i_spellbook_mastery functionality
[sphere_item_unsorted.scp]: Removed i_spellbook_bard (Bard Masteries is now Skill Masteries)
[sphere_defs.scp]: Renamed typedef 't_spellbook_bard' to 't_spellbook_mastery'

20-01-2017, Coruja
Added: New function MAPWAYPOINT to add/remove waypoints on client radar map (enhanced clients only).
	Sintax: MAPWAYPOINT ObjectUID, WaypointType
	Waypoint types:
		0 = Remove waypoint
		1 = Corpse
		2 = Party Member
		4 = Quest Giver
		5 = New Player Quest
		6 = Healer
		11 = Shrine
		12 = Moongate
		14 = Green Dot
		15 = Green Dot (flashing)

25-01-2017, Coruja
Fixed: Client encryption not being decrypted correctly on login process.
[sphereCrypt.ini]: Added crypt key for classic client 7.0.56 and enhanced client 4.0.56
[sphere_defs.scp]: Renamed 'bufficon_SavingThrow' to 'bufficon_WarriorsGifts' and added new 'mapwaypoint_types' defs
[sphere_map*.scp]: Updated some few regions and teleports (note: added new file 'sphere_map_points0_hs.scp' and removed 'sphere_map0_tol.scp')
[spheretables.scp]: Updated RESOURCES list with the new map files

26-01-2017, Coruja
[sphere_monsters.scp]: Renamed char 'c_unicorn_rainbow' to 'c_lasher'. Updated 'c_skree', 'c_dragon_turtle_hatchling', 'c_myrmidex_queen'. Added new 'c_palomino', 'c_windrunner'
[sphere_item_char_icons.scp]: Renamed item 'i_pet_unicorn_rainbow' to 'i_pet_lasher' and added new 'i_pet_myrmidex_queen', 'i_pet_palomino', 'i_pet_windrunner'
[sphere_defs.scp]: Added mount defs for new TOL mounts Palomino and Windrunner

29-01-2017, Coruja
[sphere_item_building_doors.scp]: Added Jungle / Shadowguard doors
[sphere_item_building_roofs.scp]: Added Jungle / Shadowguard roofs
[sphere_item_building_walls.scp]: Added Jungle / Shadowguard walls
[sphere_item_building_floors.scp]: Added Jungle / Shadowguard floors
[sphere_item_building_stairs.scp]: Added Jungle / Shadowguard stairs

30-01-2017, Coruja
Fixed: HS/TOL items not showing correctly on client screen.
Fixed: ML/SA/HS/TOL doors not working correctly.
[sphere.ini]: Fixed wrong SpeedScaleFactor default value and changed NPCNoFameTitle to be enabled by default

07-02-2017, Coruja
Fixed: Char flag 'statf_hovering' (gargoyle fly ability) not clearing when gargoyle chars polymorph into non-gargoyle char ID.
Fixed: Hidden/Invisible chars not getting revealed when being stumbled.
Changed: Updated internal Zlib libs v1.2.10 to v1.2.11.

09-02-2017, Coruja
Changed: Small fixes and improvements on vendor buy/sell engine.
[sphereCrypt.ini]: Added crypt key for classic client 7.0.57 and enhanced client 4.0.57
[sphere_item_wedding.scp]: Added new wedding items from latest UO patch (publish 96 / client 7.0.57)
[multis_magincia_bazaar.scp]: Updated all stalls to use proper multis instead standalone items

10-02-2017, Coruja
Fixed: Function SHRINK not working correctly.
[sphere_monsters.scp]: Added missing data on some monsters
[sphere_defs.scp]: Updated 'color_*' defs, added new sound def 'snd_monster_wildtiger'
[sphere_item_resources.scp]: Added new resources 'Tiger Pelt' (found on Wild Tiger) and 'Dragon Scute' (found on Dragon Turtle)
[sphere_item_profession_tailor_tanner.scp / sphere_item_profession_cook_barkeep_baker.scp]: Removed some obsolete code
[sphere_item_animations.scp / sphere_item_unsorted.scp]: Changed all t_telepad items to be created using MOREP=-1,-1 instead MOREP=0,0 by default (this will prevent misconfigured t_telepad items teleporting to wrong coord 0,0)

13-02-2017, Coruja
Changed: Spellbooks now store spell offset / max spells using TDATA3/TDATA4 instead MOREZ/MOREX. This will optimize worldsave files, because TDATA* can be used directly from itemdef script and doesn't need to be saved on worldfiles.
	-IMPORTANT: It's HIGHLY recommended update these scripts above, otherwise spellbooks will stop working.
[sphere_item_magic_magery.scp]: Updated i_spellbook
[sphere_item_magic_necromancer_aos.scp]: Updated i_spellbook_necromancy
[sphere_item_magic_chivalry.scp]: Updated i_spellbook_chivalry
[sphere_item_magic_ninjitsu_bushido.scp]: Updated i_spellbook_bushido, i_spellbook_ninjitsu
[sphere_item_magic_spellweaving.scp]: Updated i_spellbook_spellweaving
[sphere_item_magic_mysticism.scp]: Updated i_spellbook_mystic
[sphere_item_magic_skillmasteries.scp]: Updated i_spellbook_mastery

14-02-2017, Coruja
Fixed: Combat Hit Chance formulas incorrectly assuming that defender is always using the same combat skill as the attacker.

15-02-2017, Coruja
Fixed: Functions ATTACK / ATTACKER.ADD not working correctly on NPCs.
Fixed: Enhanced clients not updating backpack content on death.
Added: Enhanced clients now will show an map waypoint of player own corpse when it die.
Added: Better LOS support for bigger screen resolutions of TOL clients 7.0.55.27+ that uses char VISUALRANGE > 18.
[sphere.ini]: Removed 'DistanceTalk' setting, it's no longer needed because talk distance is now set automatically based on char VISUALRANGE.

20-02-2017, Coruja
[sphere_item_ship_parts.scp]: Added missing i_mt_* mount defnames
[sphere_item_building_other.scp]: Fixed Winch using wrong animation list

26-02-2017, Coruja
Added: Support to map waypoints of party members on enhanced clients.
Fixed: Linked doors not opening at the same time on DClick.

28-02-2017, Coruja
Changed: Optimized and added new security checks on account character creation to block the character creation if the client try to exploit it sending fake packets.

12-03-2017, Coruja
Added: Basic internal packet filters that will make Sphere avoid crash or consume excessive resources when under DDoS attack.
Changed: Updated internal SQLite libs v3.16.1 to v3.17.0.

14-03-2017, Coruja
Fixed: NPCs AI interacting with items out of range (eg: loot unreachable corpses, open doors on different floors, etc).
Fixed: Skill triggers not reading ARGN1 (skill number) correctly.

19-03-2017, Coruja
Fixed: Swing Speed calculation making combat stop suddenly when swing speed < attack anim speed.
Fixed: NPC_AI_LOOTING not working correctly.
Fixed: NPCs not clearing 'statf_war' char flag at combat end.
Fixed: NPCs not running away from threats like fire/fields/traps after step on them.
Fixed: NPCs trying to attack his target even when the target is out of sight.

20-03-2017, Coruja
Fixed: Message 'World save completed in X seconds' not showing correct timing precision on Linux builds.

22-03-2017, Coruja
Changed: Small improvements on EF_FastWalkPrevention experimental feature.

01-04-2017, Coruja
Changed: Updated internal SQLite libs v3.17.0 to v3.18.0.
[sphereCrypt.ini]: Added crypt key for classic client 7.0.58 and enhanced client 4.0.58

12-04-2017, Coruja
[sphere_map*.scp]: Updated some regions and teleports
[sphere_defs.scp]: Added sound def 'snd_animal_llama1' and buff/debuff defs for Sparks, Swarm and Bone Breaker
[sphere_item_char_icons.scp]: Added new char icons from publish 97
[sphere_serv_triggers.scp]: Added missing function 'f_onserver_timer' and updated description of all others functions
[sphere_monsters.scp / sphere_events_human.scp]: Fixed missing ENDDO line making sphere crash on infinite loop
	-IMPORTANT: It's HIGHLY recommended update these scripts above to prevent server crash.

16-04-2017, Coruja
Fixed: Poisoning spell not working correctly.
Fixed: Poisoning effect causing damage on items equipped on char.

19-04-2017, Coruja
Changed: Huge improvements on internal chat system, now it works fine on both SA (new chat system) and pre-SA (old chat system) clients.

21-04-2017, Coruja
Fixed: Tooltip "(tame)" not being updated correctly when pets got tamed/released.
Changed: Mount memories now can have their own i_mt_* ITEMDEFs instead use DEFNAME=i_mt_* directly on base items (usually 'boat parts').
Changed: Small improvements on gargoyle fly ability.
Changed: Function WEBLINK now will show an message telling the web browser is starting.
[sphere_msgs.scp]: Added new messages 'gargoyle_fly_cantcurrentform', 'gargoyle_fly_cantdead', 'web_browser_start'
[sphere_defs.scp]: Updated 'mount_items' section to use the new mount memories format (i_mt_* DEFNAME instead hex BASEID)
[items/sphere_item_ship_parts.scp]: Removed all i_mt_* mount memories DEFNAME from boat items to make these items be considered only boat items
[items/sphere_item_memories.scp]: Added all updated i_mt_* mount memories here
	-IMPORTANT: It's HIGHLY recommended update these scripts above to prevent conflicts between mount memories and boat items.

01-05-2017, Coruja
[items/sphere_item_char_icons.scp]: Fixed Crimson/Platinum/Stygian Dragon icons using wrong defname
[items/sphere_item_deco_carvings_statues.scp]: Added swan statues
[items/sphere_item_deco_furniture.scp]: Added vice/virtue pillows
[items/sphere_item_deco_wall_hangings.scp]: Added TOL trophies/banners/paintings
[items/sphere_item_provisions_jewelry.scp]: Added craftsman talismans
[items/sphere_item_provisions_misc.scp]: Added fletching/woodworking containers
[items/sphere_item_unsorted.scp]: Added new easter eggs (2017)
[items/sphere_item_wedding.scp]: Added missing tables
[maps/sphere_map_points5.scp]: Fixed teleport 'tp_StygianDragonsLair1_Teleport7' using wrong P
[speech/job*]: Removed many job*.scp unused speech files
[npcs/sphere_monsters.scp]: Updated status of many chardefs
[npcs/sphere_citizens.scp]: Removed unused speeches from NPCs
[npcs/sphere_guildmasters.scp]: Removed unused speeches from NPCs
[npcs/sphere_vendors.scp]: Removed unused speeches from NPCs
[npcs/spherechar_evil.scp]: Removed unused speeches from NPCs
[npcs/spherechar_human]: Removed unused speeches from NPCs
[sphere_defs.scp]: Added new sound def 'sound_monster_shadows'

06-05-2017, Coruja
[items/sphere_item_magic_armor.scp]: Removed RESOURCES from all items
[items/sphere_item_magic_leather.scp]: Removed RESOURCES from all items
[sphere_skillmenu.scp]: Removed Sphere custom menu 'sm_magic_armor', 'sm_magic_defense_armor', 'sm_magic_guarding_armor', 'sm_magic_hardening_armor', 'sm_magic_fortification_armor', 'sm_magic_invulnerability_armor', 'sm_leather_armor_magic', 'sm_leather_studded_magic'
[sphere_template_magic.scp]: Updated TEMPLATE 'random_magic_custom_greater'

07-05-2017, Coruja
[npcs/sphere_vendors.scp]: Updated CHARDEFs 'c_beekeeper', 'c_beekeeper_f', 'c_scribe', 'c_scribe_f'
[sphere_menu.scp]: Updated menu 'm_addi_weparm_vanq'
[sphere_skillmenu.scp]: Updated skillmenu 'sm_bowcraft', 'sm_wood_misc', 'sm_jewelry', and removed 'sm_bows_excep'
[sphere_template_misc.scp]: Updated template 'random_item_misc_rare'
[sphere_template_vend.scp]: Updated vendor template 'vendor_s_tavernkeeper', 'vendor_b_tavernkeeper', 'vendor_s_mage_1st'

08-05-2017, Coruja
[items/sphere_item_artifacts.scp]: Updated all artifacts info
[items/sphere_item_artifacts_minor.scp]: Updated all artifacts info
[items/sphere_item_artifacts_tokuno.scp]: Updated all artifacts info

12-05-2017, Coruja
Changed: Updated internal MySQL libs v6.1.9 to v6.1.10.
	-IMPORTANT: It's HIGHLY recommended update libmysql.dll file on Sphere folder (Windows users) or MySQL packages (Linux users) to prevent errors when using MySQL.

14-05-2017, Coruja
[items/sphere_item_building_roofs.scp]: Removed RESOURCES of non-crafted items
[items/sphere_item_building_walls.scp]: Removed RESOURCES of non-crafted items
[items/sphere_item_buildings.scp]: Removed RESOURCES of non-crafted items
[items/sphere_item_deco_carpet_rugs.scp]: Removed RESOURCES/SKILLMAKE of non-crafted items
[items/sphere_item_deco_carvings_statues.scp]: Removed RESOURCES/SKILLMAKE of non-crafted items
[items/sphere_item_deco_dungeons_traps_dead.scp]: Removed RESOURCES/SKILLMAKE of non-crafted items
[items/sphere_item_deco_furniture.scp]: Removed RESOURCES/SKILLMAKE of non-crafted items
[items/sphere_item_deco_wall_hangings.scp]: Removed RESOURCES/SKILLMAKE of non-crafted items
[items/sphere_item_profession.scp]: Removed RESOURCES/SKILLMAKE of non-crafted items
[items/sphere_item_profession_alchemist.scp]: Removed RESOURCES/SKILLMAKE of non-crafted items
[items/sphere_item_provisions_jewelry.scp]: Removed RESOURCES/SKILLMAKE of non-crafted items
[items/sphere_item_unsorted.scp]: Removed RESOURCES/SKILLMAKE of non-crafted items
[items/sphere_item_vegetation.scp]: Removed RESOURCES/SKILLMAKE of non-crafted items

16-05-2017, Coruja
[items/sphere_item_artifacts.scp]: Updated ID of itemdef 'i_yomotsu_mines_tower_lantern'
[items/sphere_item_deco_furniture.scp]: Added new items 'i_bar_marble'
[items/sphere_item_deco_lightsources.scp]: Updated RESOURCES/SKILLMAKE of many items and renamed all generic defnames 'i_lantern_paper*' (1, 2, 3, ...) to correct lantern names
[items/sphere_item_deco_signs.scp]: Added new items 'i_sign_customizable' and 'i_sign_bar'
[items/sphere_item_magic_weapon.scp]: Removed all custom weapons
[items/sphere_item_misc.scp]: Removed all custom resources
[items/sphere_item_profession.scp]: Removed all custom items
[items/sphere_item_profession_barber.scp]: Updated RESOURCES/SKILLMAKE of item 'i_scissors_barber' and removed custom item 'i_hair_dyes'
[items/sphere_item_profession_cook_barkeep_baker.scp]: Removed custom resources and updated RESOURCES/SKILLMAKE of many items
[items/sphere_item_provisions_armor.scp]: Removed RESOURCES/SKILLMAKE and armor properties of decorative armors that can't be crafted and weared
[items/sphere_item_provisions_clothing.scp]: Removed custom item 'i_hat_wizards_magic' and updated RESOURCES/SKILLMAKE of many items
[items/sphere_item_provisions_deed.scp]: Removed RESOURCES of non-crafted deeds
[items/sphere_item_provisions_misc.scp]: Removed RESOURCES of item 'i_bedroll_open'
[items/sphere_item_provisions_weapons.scp]: Updated RESOURCES/SKILLMAKE of many weapons
[items/sphere_item_resources.scp]: Removed all custom resources
[sphere_backward_compatibility.scp]: Added backward compatibility defs for Bonsai and Paper Lantern items
[sphere_template_misc.scp]: Removed unused items and templates

21-05-2017, Coruja
[items/sphere_item_deco_furniture.scp]: Fixed item 'i_chest_kings_collection' using wrong ID
[items/sphere_item_profession.scp]: Updated item 'i_book_giant' to 'i_unabridged_atlas_eodon' and added its dialog 'd_unabridged_atlas_eodon'
[items/sphere_item_unsorted.scp]: Updated item 'i_chest_gothic' to 'i_chest_sending'
[items/sphere_item_vegetation.scp]: Updated item 'i_bonsai_tree' to 'i_bonsai_ancient_oak'
[sphere_backward_compatibility.scp]: Added some few itemdefs on backward compatibility list
[sphere_template.scp]: Fixed wrong itemdefs on def 'random_other_food'

22-05-2017, Coruja
[items/multis/multis_foundations.scp]: Updated code syntax
[items/multis/multis_houses.scp]: Updated code syntax
[items/multis/multis_misc.scp]: Updated code syntax
[items/multis/multis_ships.scp]: Updated code syntax
[items/multis/multis_stairs.scp]: Updated code syntax
[items/multis/multis_wandering_camps.scp]: Updated code syntax

24-05-2017, Coruja
[items/sphere_item_char_icons.scp]: Added new icon 'i_pet_kotl_automaton'
[items/sphere_item_deco_wall_hangings.scp]: Removed items 'i_tapestry_elven_3' and 'i_tapestry_map_eodon' (these items got moved to the script above using correct defname)
[items/sphere_item_profession_cartographer.scp]: Added items 'i_tattered_wall_map', 'i_wall_map_eodon', renamed 'i_map' to 'i_map_blank', and removed all custom map items
[npcs/sphere_monsters.scp]: Updated some chardefs (Gallusaurus, Kotl Automaton, Lasher, Palomino, Windrunner) and added new publish 97 monsters (Triceratops, Saber-Toothed Tiger, Platinum Drake, Crimson Drake, Stygian Drake, Blood Fox, Frost Mite, Ossein Ram, Lion)
[sphere_defs.scp]: Added new sound defs 'snd_monster_blade' and 'snd_animal_lion'

28-05-2017, Coruja
Changed: Updated internal SQLite libs v3.18.0 to v3.19.2.
[maps/sphere_map0_hs.scp]: Renamed region 'Wreck of the Ararat' to 'Underwater World'
[maps/sphere_map3.scp]: Added missing region 'Gravewater Lake'
[maps/sphere_map5.scp]: Fixed 'Royal City' region RECT
[maps/sphere_map_points5.scp]: Removed moongate def 'mg_valley_of_eodon' (it got moved to the script below)
[maps/sphere_map_points5_tol.scp]: Added moongate def 'mg_valley_of_eodon'

29-05-2017, Coruja
Changed: Misc improvements on cartography maps packets.
[items/sphere_item_treasure_maps.scp]: File removed (this old system got replaced by the new system below)
[systems/]: Added this new folder to store Sphere default systems
[systems/sphere_system_treasure_maps.scp]: Added new treasure maps system. The script got entirely redone, now easy to customize and updated with latest OSI features
[spheretables.scp]: Added scripts/systems/ folder on RESOURCES list

30-05-2017, Coruja
Changed: Misc improvements on spells Recall, Gate Travel and Mark
	-Recall now can be used on ship keys to recall to boats
	-Gate Travel now will fail if there's already another moongate/teleport on the same spot where moongates will be created
[sphere_msgs.scp]: Updated messages 'spell_gate_*', 'spell_recall_*' and 'spell_mark_*'

31-05-2017, Coruja
Fixed: Skillgain not working correctly when SKILLSUM value is > 6553.5 on sphere_skills.scp.

02-06-2017, Coruja
Changed: Misc fixes and improvements on training items (Training Dummy, Pickpocket Dip and Archery Butte)
[items/sphere_item_profession.scp]: Added CAN=can_i_dcignoredist on item 'i_archery_butte' and fixed 'i_pickpocket_dip' using wrong ID
[sphere_msgs.scp]: Replaced messages 'itemuse_archb_*' with 'itemuse_archbutte_*', 'itemuse_pdummy_*' with 'itemuse_pickpocket_*', 'itemuse_tdummy_*' with 'itemuse_trainingdummy_*'

04-06-2017, Coruja
Fixed: Added missing 'dam_nounparalyze' flag on damage of Poison spell.

06-06-2017, Coruja
Fixed: Throwing weapons not working correctly.
Added: Missing animation of throwing weapons returning after throw it.

08-06-2017, Coruja
Fixed: NPCs canceling combat immediately when its target get out of LOS.
Fixed: NPCs vendors not calculating skill train price correctly.
[sphere_events_npcs.scp]: Fixed event 'e_trainer' showing wrong trainable skill list on vendor's context menu

09-06-2017, Coruja
Changed: Updated internal SQLite libs v3.19.2 to v3.19.3.

16-06-2017, Coruja
Added: New item property PICKUPSOUND to override default pickup sound for items (it can be used together with DROPSOUND).
Changed: DeadCannotSeeLiving setting on sphere.ini now will always show GM chars.
Changed: NPCAI flags NPC_AI_FOOD/NPC_AI_INTFOOD on sphere.ini now will make NPCs search for food only when food level percent (<FOOD>*100/<MAXFOOD>) is < 40% instead (<FOOD> < 10).
[sphere.ini]: Removed unused 'AutoPrivFlags' setting and updated description of NPCAI flags

17-06-2017, Coruja
Fixed: Function BADSPAWN not working correctly.
Changed: Default region flags for MULTIDEF items without REGIONFLAGS set is now 'region_flag_nobuilding' instead 'region_flag_nodecay|region_antimagic_teleport|region_antimagic_recall_in|region_flag_nobuilding'.
Changed: 'return 1' on char trigger @Rename of account characters being created now will block the character creation instead create the character using generic names.
Changed: Server trigger 'f_onchar_create' now is called after skills/stats are already set on the character being created.
	-This will allow users to create characters with custom skills/stats without get these values overridden by default values later.

20-06-2017, Coruja
[items/sphere_item_provisions_armor.scp]: Fixed item 'i_gargish_leather_leggings' returning console error calling an undefined function
[npcs/sphere_citizens.scp]: Fixed NAME/TITLE of all CHARDEFs
[npcs/sphere_guildmasters.scp]: Fixed NAME/TITLE of all CHARDEFs
[npcs/sphere_vendors.scp]: Fixed NAME/TITLE of all CHARDEFs
[sphere_region.scp]: Fixed REGIONTYPE 'r_default' making the client play the same region music again when walking through regions that have the same music

05-07-2017, Coruja
Changed: Reverted Energy Vortex new chardef '023d' to old '0a4' (OSI created this new chardef on AOS age but it was never really used).
[npcs/sphere_monsters.scp]: Removed chardef 023d (the new/broken AOS Energy Vortex) and renamed old chardef 0a4 'c_elemental_swamp' back to 'c_energy_vortex'. Also updated Blade Spirit and Energy Vortex stats
[sphere_spawns.scp]: Removed 'c_elemental_swamp' from spawn lists
[sphere_template_loot.scp]: Removed template 'loot_elem_swamp'

06-07-2017, Coruja
Fixed: Vendor NPCs not training player skills correctly.
[npcs/spherechar_evil.scp]: Replaced CAN 'mt_fly' with 'mt_run' on all chardefs that doesn't have flying animations
[npcs/sphere_monsters.scp]: Replaced CAN 'mt_fly' with 'mt_run' on all chardefs that doesn't have flying animations
[npcs/sphere_monsters_custom.scp]: Replaced CAN 'mt_fly' with 'mt_run' on all chardefs that doesn't have flying animations

25-07-2017, Coruja
Changed: Updated internal MySQL libs v6.1.10 to v6.1.11.
	-IMPORTANT: It's HIGHLY recommended update libmysql.dll file on Sphere folder (Windows users) or MySQL packages (Linux users) to prevent errors when using MySQL.

26-07-2017, Coruja
[sphereCrypt.ini]: Added crypt key for classic client 7.0.59 and enhanced client 4.0.59

27-07-2017, Coruja
[sphere_defs.scp]: Added missing sounds 'snd_monster_orc2', 'snd_animals_panther2', and removed unused typedefs 't_telescope', 't_bed', 't_it_stone', 't_garbage', 't_table', 't_hair_dye'
[items/sphere_item_buildings.scp]: Removed typedef 't_telescope' from items
[items/sphere_item_deco_furniture.scp]: Removed typedef 't_table', 't_bed' from items
[items/sphere_item_profession.scp]: Removed typedef 't_table' from items
[items/sphere_item_profession_alchemist.scp]: Removed typedef 't_table' from items
[items/sphere_item_provisions_misc.scp]: Removed typedef 't_garbage' from items
[items/sphere_item_unsorted.scp]: Removed typedef 't_garbage' from items

04-08-2017, Coruja
Changed: Updated internal SQLite libs v3.19.3 to v3.20.0.
Added: New function CHANGEFACE to open client internal 'Face Selection' dialog (enhanced clients only).
[items/sphere_item_profession_barber.scp]: Updated all items
[npcs/sphere_vendors.scp]: Removed obsolete vendor 'c_barber' and added new 'c_body_sculptor', 'c_hairstylist'
[speech/speakshopkeep.scp]: Updated speech 'spk_shopkeep' and added new 'spk_bodysculptor', 'spk_hairstylist'
[sphere_dialog.scp]: Updated dialog 'd_hair_dye' and added new 'd_body_sculptor', 'd_hairstylist', 'd_hair_style', 'd_beard_style'
[sphere_menu.scp]: Removed obsolete 'i_bottle_hair_dye' from menus
[sphere_template_vend.scp]: Removed obsolete 'i_bottle_hair_dye' from vendor templates

10-08-2017, Coruja
Fixed: Weapons not playing hit/miss sounds on combat.
[npcs/sphere_monsters_custom.scp]: Changed obsolete MODAR to RESPHYSICAL
[npcs/sphere_monsters.scp]: Changed obsolete MODAR to RESPHYSICAL and updated NAME of some named NPCs
[npcs/spherechar_evil.scp]: Changed obsolete MODAR to RESPHYSICAL and updated NAME of some named NPCs
[sphere_name.scp]: Updated many names lists

11-08-2017, Coruja
[items/sphere_item_deco_furniture.scp]: Renamed some defnames (i_table_elven_ornate_2 -> i_table_hardwood, i_table_elven_storage -> i_chest_ornate_elven, i_chest_gargoyle -> i_chest_gargish)
[items/sphere_item_unsorted.scp]: Renamed some defnames (i_chest_ornate_elven -> i_chest_rarewood, i_chest_ornate_elven_2 -> i_box_decorative)
[items/sphere_item_misc.scp]: Added missing TDATA2 on items 'i_checkerboard' and 'i_chessboard'
[sphere_backward_compatibility.scp]: Added some few itemdefs on backward compatibility list

12-08-2017, Coruja
[items/sphere_item_ship_parts_britannian.scp]: Fixed ship hatches type (t_container -> t_ship_hold) and added its missing TDATA2
[items/sphere_item_ship_parts_gargish.scp]: Fixed ship hatches type (t_container -> t_ship_hold) and added its missing TDATA2
[items/sphere_item_ship_parts_orcish.scp]: Fixed ship hatches type (t_container -> t_ship_hold) and added its missing TDATA2
[items/sphere_item_ship_parts_tokuno.scp]: Fixed ship hatches type (t_container -> t_ship_hold) and added its missing TDATA2
[items/sphere_item_unsorted.scp]: Fixed item 'i_dice_cup' not working correctly and removed unused triggers from items 'i_person_lord_british', 'i_person_black_thorne', 'i_deathshroud', 'i_robe_gm'

15-08-2017, Coruja
[items/sphere_item_deco_carvings_statues.scp]: Added publish 98 statues
[items/sphere_item_halloween.scp]: Added new file with publish 98 halloween items
[items/sphere_item_provisions_armor.scp]: Added publish 90 armors
[items/sphere_item_provisions_clothing.scp]: Added publish 90 clothes
[items/sphere_item_provisions_misc.scp]: Added publish 98 items
[items/sphere_item_vegetation.scp]: Added publish 94 plants
[items/sphere_item_wedding.scp]: Added publish 98 wedding items


16-08-2017, Coruja
[speech/jobbanker.scp]: File removed
[speech/speakshopkeep.scp]: Added new speech 'spk_banker' with updated commands: bank, balance, check, withdraw (all commands are fully compatible with FEATURE_TOL_VIRTUALGOLD setting)
[npcs/sphere_vendors.scp]: Renamed speech 'jobBanker' to 'spk_banker' on Banker/Minter NPCs
[items/sphere_item_provisions_deed.scp]: Added new item 'i_bank_check'

18-08-2017, Coruja
[items/sphere_item_deco_carvings_statues.scp]: Moved all halloween items to sphere_item_halloween.scp
[items/sphere_item_deco_dungeons_traps_dead.scp]: Moved all halloween items to sphere_item_halloween.scp
[items/sphere_item_deco_lightsources.scp]: Moved all halloween items to sphere_item_halloween.scp
[items/sphere_item_deco_wall_hangings.scp]: Moved all halloween items to sphere_item_halloween.scp
[items/sphere_item_halloween.scp]: Added publish 98 halloween items
[items/sphere_item_profession.scp]: Moved all halloween items to sphere_item_halloween.scp
[items/sphere_item_profession_cook_barkeep_baker.scp]: Moved all halloween items to sphere_item_halloween.scp
[sphere_backward_compatibility.scp]: Added some few itemdefs on backward compatibility list

21-08-2017, Coruja
[items/sphere_item_christmas.scp]: File renamed to 'sphere_item_holiday_christmas.scp' 
[items/sphere_item_halloween.scp]: File renamed to 'sphere_item_holiday_halloween.scp'

26-08-2017, Coruja
[items/sphere_item_theme_pack_kings_collection.scp]: Added new file with King's Collection theme pack items
[items/sphere_item_deco_furniture.scp]: Moved all Kings's Collection items to sphere_item_theme_pack_kings_collection.scp
[items/sphere_item_deco_lightsources.scp]: Moved all Kings's Collection items to sphere_item_theme_pack_kings_collection.scp
[items/sphere_item_deco_wall_hangings.scp]: Moved all Kings's Collection items to sphere_item_theme_pack_kings_collection.scp
[items/sphere_item_resources.scp]: Added missing itemdef 'i_workable_glass'
[items/sphere_item_unsorted.scp]: Moved all Kings's Collection items to sphere_item_theme_pack_kings_collection.scp
[sphere_backward_compatibility.scp]: Added some few itemdefs on backward compatibility list

27-08-2017, Coruja
[items/sphere_item_theme_pack_gothic.scp]: Added new file with Gothic theme pack items
[items/sphere_item_building_stairs.scp]: Moved all Gothic items to sphere_item_theme_pack_gothic.scp
[items/sphere_item_building_walls.scp]: Moved all Gothic items to sphere_item_theme_pack_gothic.scp
[items/sphere_item_deco_carvings_statues.scp]: Moved all Gothic items to sphere_item_theme_pack_gothic.scp
[items/sphere_item_deco_furniture.scp]: Moved all Gothic items to sphere_item_theme_pack_gothic.scp
[items/sphere_item_profession.scp]: Moved all Gothic items to sphere_item_theme_pack_gothic.scp
[items/sphere_item_unsorted.scp]: Moved all Gothic items to sphere_item_theme_pack_gothic.scp

28-08-2017, Coruja
[items/sphere_item_theme_pack_rustic.scp]: Added new file with Rustic theme pack items
[items/sphere_item_building_stairs.scp]: Moved all Rustic items to sphere_item_theme_pack_rustic.scp
[items/sphere_item_building_walls.scp]: Moved all Rustic items to sphere_item_theme_pack_rustic.scp
[items/sphere_item_deco_carvings_statues.scp]: Moved all Rustic items to sphere_item_theme_pack_rustic.scp
[items/sphere_item_deco_furniture.scp]: Moved all Rustic items to sphere_item_theme_pack_rustic.scp
[items/sphere_item_profession_cook_barkeep_baker.scp]: Moved all Rustic items to sphere_item_theme_pack_rustic.scp
[items/sphere_item_unsorted.scp]: Moved all Rustic items to sphere_item_theme_pack_rustic.scp

02-09-2017, Coruja
[items/sphere_item_holiday_valentines.scp]: Added new file with Valentine's Day items
[items/sphere_item_animations.scp]: Moved all Valentine's items to sphere_item_holiday_valentines.scp
[items/sphere_item_deco_carvings_statues.scp]: Moved all Valentine's items to sphere_item_holiday_valentines.scp
[items/sphere_item_unsorted.scp]: Moved all Valentine's items to sphere_item_holiday_valentines.scp
[items/sphere_item_vegetation.scp]: Moved all Valentine's items to sphere_item_holiday_valentines.scp

04-09-2017, Coruja
[items/sphere_item_animations.scp]: Add publish 98 items
[items/sphere_item_deco_lightsources.scp]: Update all lightsource items with correct light pattern and others misc infos
[items/sphere_item_holiday_christmas.scp]: Fixed some wrong ITEMDEF names

09-09-2017, Coruja
[items/sphere_item_char_icons.scp]: Added publish 98 items
[items/sphere_item_provisions_jewelry.scp]: Updated gargish jewelry properties
[items/sphere_item_unsorted.scp]: Removed some duplicated ITEMDEFs
[items/sphere_item_vegetation.scp]: Added some missing trees and potted plants

17-09-2017, Coruja
[items/sphere_item_theme_pack_shadow.scp]: Added new file with Shadow theme pack items
[items/sphere_item_animations.scp]: Moved all Shadow items to sphere_item_theme_pack_shadow.scp
[items/sphere_item_boulders_rocks.scp]: Moved all Shadow items to sphere_item_theme_pack_shadow.scp
[items/sphere_item_building_doors.scp]: Moved all Shadow items to sphere_item_theme_pack_shadow.scp
[items/sphere_item_building_floors.scp]: Moved all Shadow items to sphere_item_theme_pack_shadow.scp
[items/sphere_item_building_roofs.scp]: Moved all Shadow items to sphere_item_theme_pack_shadow.scp
[items/sphere_item_building_stairs.scp]: Moved all Shadow items to sphere_item_theme_pack_shadow.scp
[items/sphere_item_building_walls.scp]: Moved all Shadow items to sphere_item_theme_pack_shadow.scp
[items/sphere_item_deco_carvings_statues.scp]: Moved all Shadow items to sphere_item_theme_pack_shadow.scp
[items/sphere_item_deco_fireplace_chimney_oven.scp]: Moved all Shadow items to sphere_item_theme_pack_shadow.scp
[items/sphere_item_profession_cartographer.scp]: Moved all Shadow items to sphere_item_theme_pack_shadow.scp
[items/sphere_item_unsorted.scp]: Moved all Shadow items to sphere_item_theme_pack_shadow.scp

18-09-2017, Coruja
[items/sphere_item_theme_pack_crystal.scp]: Added new file with Crystal theme pack items
[items/sphere_item_building_doors.scp]: Moved all Crystal items to sphere_item_theme_pack_crystal.scp
[items/sphere_item_building_floors.scp]: Moved all Crystal items to sphere_item_theme_pack_crystal.scp
[items/sphere_item_building_roofs.scp]: Moved all Crystal items to sphere_item_theme_pack_crystal.scp
[items/sphere_item_building_stairs.scp]: Moved all Crystal items to sphere_item_theme_pack_crystal.scp
[items/sphere_item_building_walls.scp]: Moved all Crystal items to sphere_item_theme_pack_crystal.scp
[items/sphere_item_deco_carvings_statues.scp]: Moved all Crystal items to sphere_item_theme_pack_crystal.scp
[items/sphere_item_deco_furniture.scp]: Moved all Crystal items to sphere_item_theme_pack_crystal.scp
[items/sphere_item_profession.scp]: Moved all Crystal items to sphere_item_theme_pack_crystal.scp
[items/sphere_item_unsorted.scp]: Moved all Crystal items to sphere_item_theme_pack_crystal.scp

19-09-2017, Coruja
Fixed: Client 'Open Spellbook' macro making the client crash if it try to open the requested spellbook gump when the spellbook item is not loaded yet.
Fixed: Recall spell always using default teleport effect/sound values set on sphere.ini instead EFFECT_ID/SOUND values set on sphere_spells.scp.
[sphere_spells.scp]: Added missing EFFECT_ID value on Recall spell

29-09-2017, Coruja
[items/sphere_item_quests.scp]: Added new file with The Shattered Obelisk (publish 98) quest items
[items/sphere_item_deco_wall_hangings.scp]: Added missing publish 97/98 items

01-10-2017, Coruja
Changed: Updated internal SQLite libs v3.20.0 to v3.20.1.
Fixed: Lightsource items not updating tooltip after toggle light state.

03-10-2017, Coruja
Fixed: AutoTooltipResend .ini setting not working on equipped items.
Fixed: Summoned NPCs not showing smoke effect when they got released.

08-10-2017, Coruja
[maps/sphere_map0_hs.scp]: Updated 'Sea Market' region
[maps/sphere_map1_tol.scp]: Added new file with 'Event Arenas' regions
[maps/sphere_map1.scp]: Updated 'New Haven' regions
[maps/sphere_map_points1.scp]: Added missing 'New Haven Mine' teleports
[npcs/sphere_monsters.scp]: Added publish 98 monsters

15-10-2017, Coruja
Fixed: MODMAXWEIGHT property not working correctly
Changed: Updated 'weight' tooltip on containers

17-10-2017, Coruja
[items/multis/multis_misc.scp]: Added publish 98 / 98.2 multis
[items/sphere_item_char_icons.scp]: Added publish 98.2 items
[items/sphere_item_holiday_christmas.scp]: Updated some item names
[items/sphere_item_memories.scp]: Added publish 98.2 items
[items/sphere_item_provisions_misc.scp]: Added publish 98 / 98.2 items
[items/sphere_item_wedding.scp]: Added 'undead wedding veil/hat' missing functionality
[npcs/sphere_monsters.scp]: Added publish 98.2 mount (Ethereal Serpentine Dragon)
[sphere_defs.scp]: Added mount def for 'Ethereal Serpentine Dragon'
[sphereCrypt.ini]: Added crypt key for classic client 7.0.60 and enhanced client 4.0.60

18-10-2017, Coruja
[items/sphere_item_vice_virtue.scp]: Added new file with Vice vs Virtue items
[items/sphere_item_deco_wall_hangings.scp]: Moved all Vice vs Virtue items to sphere_item_vice_virtue.scp

21-10-2017, Coruja
[items/sphere_item_veteran_rewards.scp]: Added new file with Veteran Rewards items
[items/sphere_item_deco_furniture.scp]: Moved all Veteran Rewards items to sphere_item_veteran_rewards.scp
[items/sphere_item_deco_wall_hangings.scp]: Moved all Veteran Rewards items to sphere_item_veteran_rewards.scp
[items/sphere_item_provisions_misc.scp]: Moved all Veteran Rewards items to sphere_item_veteran_rewards.scp
[items/sphere_item_unsorted.scp]: Moved all Veteran Rewards items to sphere_item_veteran_rewards.scp

23-10-2017, Coruja
[items/sphere_item_holiday_anniversary.scp]: Added new file with Anniversary items
[items/sphere_item_deco_carvings_statues.scp]: Moved all Anniversary items to sphere_item_holiday_anniversary.scp
[items/sphere_item_deco_furniture.scp]: Moved all Anniversary items to sphere_item_holiday_anniversary.scp
[items/sphere_item_deco_signs.scp]: Moved all Anniversary items to sphere_item_holiday_anniversary.scp
[items/sphere_item_deco_virtues.scp]: Moved all Anniversary items to sphere_item_holiday_anniversary.scp
[items/sphere_item_deco_wall_hangings.scp]: Moved all Anniversary items to sphere_item_holiday_anniversary.scp
[items/sphere_item_holiday_halloween.scp]: Moved all Anniversary items to sphere_item_holiday_anniversary.scp
[items/sphere_item_profession.scp]: Moved all Anniversary items to sphere_item_holiday_anniversary.scp
[items/sphere_item_profession_cook_barkeep_baker.scp]: Moved all Anniversary items to sphere_item_holiday_anniversary.scp
[items/sphere_item_provisions_clothing.scp]: Moved all Anniversary items to sphere_item_holiday_anniversary.scp
[items/sphere_item_provisions_shields.scp]: Moved all Anniversary items to sphere_item_holiday_anniversary.scp
[items/sphere_item_unsorted.scp]: Moved all Anniversary items to sphere_item_holiday_anniversary.scp
[items/sphere_item_vegetation.scp]: Moved all Anniversary items to sphere_item_holiday_anniversary.scp

24-10-2017, Nolok
Fixed: Skillgain never occurred when using SkillUseQuick.

28-10-2017, Coruja
[items/sphere_item_deco_themed_collections.scp]: Added new file with themed collection items (Spring Decor / Evil Home Decor)
[items/sphere_item_deco_carvings_statues.scp]: Moved all themed collection items to sphere_item_deco_themed_collections.scp
[items/sphere_item_deco_furniture.scp]: Moved all themed collection items to sphere_item_deco_themed_collections.scp
[items/sphere_item_deco_lightsources.scp]: Moved all themed collection items to sphere_item_deco_themed_collections.scp
[items/sphere_item_deco_wall_hangings.scp]: Moved all themed collection items to sphere_item_deco_themed_collections.scp
[items/sphere_item_profession.scp]: Moved all themed collection items to sphere_item_deco_themed_collections.scp
[items/sphere_item_profession_cook_barkeep_baker.scp]: Moved all themed collection items to sphere_item_deco_themed_collections.scp
[items/sphere_item_unsorted.scp]: Moved all themed collection items to sphere_item_deco_themed_collections.scp

05-11-2017, Coruja
[items/sphere_item_holiday_easter.scp]: Added new file with Easter items
[items/sphere_item_deco_carvings_statues.scp]: Moved all Easter items to sphere_item_holiday_easter.scp
[items/sphere_item_deco_wall_hangings.scp]: Moved all Easter items to sphere_item_holiday_easter.scp
[items/sphere_item_unsorted.scp]: Moved all Easter items to sphere_item_holiday_easter.scp
[items/sphere_item_vegetation.scp]: Moved all Easter items to sphere_item_holiday_easter.scp

12-11-2017, Coruja
[items/sphere_item_holiday_thanksgiving.scp]: Added new file with Thanksgiving items
[items/sphere_item_profession_cook_barkeep_baker.scp]: Moved all Thanksgiving items to sphere_item_holiday_thanksgiving.scp

26-11-2017, Coruja
Changed: Updated internal SQLite libs v3.20.1 to v3.21.0.
[items/sphere_item_artifacts.scp]: Added missing Doom, Shadowguard and Enchanted Origin artifacts
[items/sphere_item_deco_furniture.scp]: Fixed wrong info on many gargish items and also removed unused typedef 't_chair' lines
[items/sphere_item_deco_wall_hangings.scp]: Fixed wrong info on some few items

05-12-2017, Coruja
[systems/sphere_system_aquarium.scp]: Added new file with aquarium system (still incomplete yet)
[items/sphere_item_deco_furniture.scp]: Moved all aquarium items to sphere_system_aquarium.scp
[items/sphere_item_profession_cook_barkeep_baker.scp]: Moved all aquarium items to sphere_system_aquarium.scp
[items/sphere_item_unsorted.scp]: Moved all aquarium items to sphere_system_aquarium.scp

10-12-2017, Coruja
[systems/sphere_system_secret_chest.scp]: Added new file with 'secret chest' system
[items/sphere_item_deco_lightsources.scp]: Fixed lantern items using wrong id
[items/sphere_item_theme_pack_kings_collection.scp]: Added missing King's Collection items
[items/sphere_item_unsorted.scp]: Moved 'secret chest' item to sphere_system_secret_chest.scp

12-12-2017, Coruja
[items/multis/multis_houses.scp]: Updated COMPONENT/DUPEITEM of some MULTIDEFs and moved m_blue_tent, m_green_tent, m_wheat_cottage to multis_misc.scp
[items/multis/multis_ships.scp]: Updated VALUE of some MULTIDEFs
[items/sphere_item_provisions_deed.scp]: Added missing VALUE of vendable deeds

13-12-2017, Drk84
Possible fix for stat cap issue when the sum of the char stats reach StatCap - 1.

20-12-2017, Coruja
[items/sphere_item_boulders_rocks.scp]: Updated crystals/geodes and added new moonstone items
[items/sphere_item_deco_carvings_statues.scp]: Updated all items with correct info
[items/sphere_item_deco_dungeons_traps_dead.scp]: Added missing Kotl City items

26-12-2017, Coruja
Fixed: Deeds not setting ATTR=attr_move_never on multi parent item after create it.
Fixed: Deeds showing multi targets on wrong Y position.
Fixed: 'memory_guard' memories not being removed after its linked item get deleted.

29-12-2017, Drk84
Fixed: SPELLCHANNELING item property not working correctly.

02-01-2018, Coruja
Changed: Improved how ranged weapons handle ammo.
Fixed: ENHANCEPOTIONS item property only working when FEATURE_AOS_UPDATE_B feature is enabled on sphere.ini.

03-01-2018, Nolok
Fixed: when playing a sound from a character from Samurai Empire and later expansions, it was chosen the wrong sound ID for the given action.
	This is caused by the different order of IDs in the sound file after that expansion.
[sphere_defs.scp + npcs/sphere_monsters.scp]: Updated lots of old sounds, added new ones. Still, some are missing.
[sphere_defs.scp]: Added SOUNDTYPE_RAND, SOUNDTYPE_IDLE, SOUNDTYPE_NOTICE, SOUNDTYPE_HIT, SOUNDTYPE_GETHIT, SOUNDTYPE_DIE defs. They are meant to be used with BARK, which has always accepted as parameter the sound type (even if the wiki at this day doesn't say so), not the sound ID (use SOUND for this).
[items/sphere_item_deco_dungeons_traps_dead.scp]: Fixed typo (09cdc item).
[items/sphere_item_deco_furniture.scp]: Changed defname of 03d8a from i_bed_ruined to i_bed_ruined_dupe, because there was already a i_bed_ruined (0c26), plus they look very similar, if not identical.
[items/sphere_item_provisions_armor.scp + items/sphere_item_provisions_clothing.scp]: Added to the defname the suffix "_3d" to the items which gumpart is only available in the old 3D Client. This also solves the presence of two i_shoes_jester.
[items/sphere_item_vegetation.scp]: Changed 026ef (plum blossoms) defname from i_foliage_plum to i_blossoms_plum, because there was already another i_foliage_plum.
[sphere_backward_compatibility.scp]: Removed duplicated defnames i_post_stone, i_rail_stone_4, i_floor_cracks, i_wall_cracks, i_ladder_wood_tall, i_chest_ornate_elven, i_fountain_splash, i_fx_oil_flask, i_chest_gothic.

04-01-2018, Coruja
Added: SOUND property on chars now can be splitted into SOUNDHIT, SOUNDGETHIT, SOUNDDIE, SOUNDIDLE, SOUNDNOTICE
	-SOUND* splitted values are optional, and when set it will have priority over default SOUND value.

04-01-2018, Nolok
Added: SOUNDIDLE, SOUNDNOTICE, SOUNDHIT, SOUNDGETHIT, SOUNDDIE CharDef properties can now have -1 as value: this value prevents that action-related sound to be played.

18-01-2018, Coruja
Changed: Updated MySQL engine
	-All functions got optimized
	-Function DB.CONNECT now will warn if MySQL client (win: libmysql.dll file / linux: libmysqlclient package) or MySQL server are outdated
	-Function DB.QUERY now can handle results with up to 64 columns instead 12
	-Added more info on error messages
	-Fixed some console exceptions

22-01-2018, Coruja
Changed: Updated internal SQLite libs v3.21.0 to v3.22.0.
Fixed: Spells being disturbed even when they have INTERRUPT=0.0 set.

27-01-2018, Coruja
Fixed: Items placed on char backpack not checking char weight limit correctly before get equipped.

30-01-2018, Coruja
Fixed: Ship commands not working correctly.
Fixed: Items not getting amount stacked when dropped on ground.
Fixed: EF_ItemStacking .ini feature stacking items on unreachable Z heights.

31-01-2018, Coruja
Changed: Increased char max stats value from 32.767 to 65.535.

09-02-2018, Coruja
Changed: Linux builds now will require MySQL libs package 'libmysqlclient20' (MySQL 5.7) instead obsolete 'libmysqlclient18' (MySQL 5.5).
	-This doesn't affect Windows builds, because libmysql.dll is already updated since a long time ago.
[sphere.ini]: Added new ChatStaticChannels and ChatFlags settings to set server static channels and customize chat features.

13-02-2018, Coruja
[items/multis/multis_misc.scp]: Removed duplicated MULTIDEFs
[items/sphere_item_buildings.scp]: Added 'Dragon Turtle Fountain' MULTIDEFs
[items/sphere_item_deco_carpet_rugs.scp]: Added 'World Tree' ITEMDEFs/MULTIDEFs
[items/sphere_item_deco_wall_hangings.scp]: Fixed tribal banners using wrong names
[items/sphere_item_holiday_anniversary.scp]: Added 'Codex of Virtue' items and fixed color of 'Enormous Venus Flytrap', 'Japanese Maple', 'Harpsichord Deed'
[items/sphere_item_holiday_thanksgiving.scp]: Added publish 98 items
[items/sphere_item_profession.scp]: Removed duplicated ITEMDEFs
[items/sphere_item_provisions_misc.scp]: Added 'Hildebrandt Dragon Rug' MULTIDEFs
[items/sphere_item_theme_pack_kings_collection.scp]: Fixed 'Dragon Lantern' using wrong ID
[items/sphere_item_veteran_rewards.scp]: Added missing Veteran Rewards items

19-02-2018, Coruja
Fixed: Sphere console not closing correctly when it get closed before load startup files.
Fixed: Function CANSEELOS not working correctly on clients with increased view distance (screen resolution > 800x600).
Fixed: Multis (houses/boats) not being loaded at proper distance when client is walking.

25-02-2018, Coruja
Fixed: Server sending unnecessary 'update' packets to clients.

01-03-2018, Coruja
[sphereCrypt.ini]: Added crypt key for classic client 7.0.61 and enhanced client 4.0.61

02-03-2018, Coruja
[items/sphere_item_holiday_valentines.scp]: Added new Valentine's Day 2018 items
[items/sphere_item_provisions_clothing.scp]: Added new Hooded Britannia Robes
[items/sphere_item_unsorted.scp]: Updated some item names

03-03-2018, Coruja
Fixed: MOUNT property/function not working correctly.

06-03-2018, Coruja
Fixed: Console error when PetsInheritNotoriety .ini setting is enabled.

09-03-2018, Coruja
Fixed: Multi placement making players get stuck when place the multi over his own char.
Fixed: Multi placement being incorrectly blocked by region flags region_flag_underground, region_flag_guarded, region_flag_safe

12-03-2018, Coruja
[sphere.ini]: Removed unused ContextMenuLimit setting

14-03-2018, Coruja
Fixed: Combat swing speed formula not working correctly.
Fixed: Server function 'f_onaccount_connect' not being called correctly when AccApp=2 (free/auto account) is set on sphere.ini.

24-03-2018, Coruja
[items/sphere_item_deco_wall_hangings.scp]: Updated city banners and added missing shard symbols
[items/sphere_item_quests.scp]: Added Prism of Light and Twisted Weald quest items
[items/sphere_item_resources.scp]: Added some missing SA resources
[items/sphere_item_unsorted.scp]: Removed duplicated ITEMDEFs
[items/sphere_item_veteran_rewards.scp]: Added some missing items

02-04-2018, Coruja
Changed: Updated internal SQLite libs v3.22.0 to v3.23.0.
Added: New char trigger @UserUltimaStoreButton, fired when click on 'Ultima Store' button on new clients 7.0.62+
[sphereCrypt.ini]: Added crypt key for classic client 7.0.62 and enhanced client 4.0.62

08-04-2018, Coruja
Added: RES*MAX properties functionality, now they are fully working
	-When RES*MAX is set on chars, RES* will be limited to RES*MAX value

09-04-2018, Coruja
[items/sphere_item_holiday_halloween.scp]: Added missing item 'shackled heart'
[items/sphere_item_magic_magery.scp]: Fixed 'recall rune' being created using wrong MOREP value
[items/sphere_item_profession.scp]: Removed duplicated ITEMDEFs
[items/sphere_item_profession_cartographer.scp]: Added missing TYPE=t_map on cartography maps
[npcs/sphere_monsters.scp]: Fixed NPCs with 'spawn creature' special ability summoning too many creatures

10-04-2018, Coruja
Changed: Updated internal SQLite libs v3.23.0 to v3.23.1.

17-04-2018, Coruja
Fixed: Animal Taming skill not checking follower slots limit when OF_PetSlots is enabled.
[sphereCrypt.ini]: Added crypt key for classic client 7.0.63 and enhanced client 4.0.63

18-04-2018, Coruja
Changed: Small improvements on tooltip engine.

26-04-2018, Coruja
Changed: Connections from 'localserver' won't bypass 'ClientLoginMaxTries' .ini setting anymore.
[sphere.ini]: Changed 'ClientLoginMaxTries' default value [0 -> 10] to increase security against brute-force password attacks

28-04-2018, Coruja
Fixed: Random 'CChar::OnTick' console exception when clients connect.

06-05-2018, Coruja
Fixed: Worldsave not writing [EOF] at the end of sphereaccu.scp file.
Fixed: Worldsave not creating sphereacct.scp file when it doesn't exist.
Fixed: Console command 'I' (view server info) showing wrong server AGE value.
Fixed: Console command 'L' (toggle log file) not working correctly.

21-05-2018, Coruja
Fixed: Console error when TradeWindowSnooping=0 is set on sphere.ini.
[items/sphere_item_animations.scp]: Fixed wrong lightsource pattern (MOREZ) on energy/fire/paralyze field items
[items/sphere_item_building_doors.scp]: Updated some doors DEFNAMEs
[items/sphere_item_building_floors.scp]: Updated some floors DEFNAMEs
[items/sphere_item_deco_virtues.scp]: Removed duplicated DEFNAMEs
[sphere_backward_compatibility.scp]: Updated doors/floors ITEMDEFs on backward compatibility list

25-05-2018, Coruja
Fixed: Lumberjacking skill not working correctly.

26-05-2018, Coruja
Fixed: Sphere crash when call GOLD/NEWGOLD function with args > 65535.

01-06-2018, Coruja
Changed: Updated SQLite engine
	-All functions got optimized
	-Added more info on error messages
	-Fixed some console exceptions

03-06-2018, Coruja
Fixed: <SERV.BUILD> function returning build date instead build number.
Fixed: Containers showing wrong weight on item tooltip when FEATURE_ML_UPDATE feature is enabled on sphere.ini.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Sendpacket
By Taran
One of the coolest new features that has arrived with the 56-series versions of SPHERE is the SENDPACKET command. This command allows us to directly send streams of data to the client. To those of us who know a bit about programming, this is probably one of the coolest features they've implemented in a long time. Let's start from the beginning.
UO is obviously an online game. Everyone knows this, considering it's in the name, "Ultima Online." However, I don't know that many people actually know how an online game works. Well, first we need to talk a bit about networking and protocols. UO uses what's known as a client-server protocol to accomplish its goal. In networking, a client is a program which connects to a server somewhere else on the internet. A server is a program which allows clients to connect and processes data it receives. Many times, the server will also send data back to the client in response to the client's messages. This is known as "serving information," which is how those types of programs acquired their name.
Servers and clients must speak a common language. If they did not, it would be like a person speaking English trying to communicate with a person who only speaks French or Chinese or Russian. For example, if you try to connect to a mail server with your UO client, the two programs will not be able to communicate. The language spoken by the mail server is different than the language spoken by your UO client. In the computer world, a language spoken between two programs is called a protocol. We use protocols every day without realizing it. When you request a website, your web browser speaks HTTP (Hypertext Transfer Protocol) with a web server somewhere. Some people may have used an FTP (File Transfer Protocol) program to upload and download files from a remote computer. When you send mail, you are communicating using SMTP (Simple Mail Transfer Protocol) with the mail server. When you receive mail, you're probably using POP3 (Post Office Protocol, version 3). In fact, all messages sent across the internet have their own protocols, such as TCP/IP (Transmission Control Protocol/Internet Protocol) or UDP (User Datagram Protocol).
UDP is used by many online FPS games, like Quake and Unreal Tournament. The advantage of UDP is that it's fast, and that you don't have to maintain a connection. However, for whatever reason, the people at Origin (the company that developed UO) decided that they were going to use the TCP/IP protocol instead. This means that there is a constant connection over the internet between your client and someone else's UO server. Or, if you run a server, there are many clients with constant connections to your server. If you want to see how many TCP/IP connections your computer is currently maintaining, go to a command prompt in Windows or Unix and type "netstat".
Some protocols (such as HTTP and SMTP) were designed so that humans could easily emulate them. For example, if you connect using a simple telnet client to a mail server, you can type the same commands that your mail program would send, and the mail would be sent exactly as though you used Netscape or Outlook to send it. A sample communication with a mail server might look something like the following:
HELO
220 Hello!  I'm rit.edu!  Pleased to meet you!
MAIL FROM:<joe@joesmail.com>
250 Email address accepted
RCPT TO:<joesfriend@joesmail.com>
250 Recipient address accepted
DATA
250 Okay, end with <CRLF>.<CRLF>
Subject: Hello!

This is a test email.
.
As you can see, any person reading this transmission would know exactly what was happening. The SMTP protocol is what we call a plain-text protocol. It uses normal English words, and responds as though it's talking to a person. The protocol used by the UO server/client (UOP) is slightly different. It is sent as a simple stream of data which no one could understand unless they knew how to interpret it. However, to help the client and server do their jobs better, Origin decided that it would be best to use clumps of data to send commands back and forth. One "clump" of data that describes one of those EFFECT command animations might contain the following information:
That this command tells the client how to display an effect
Which type of effect we're using
Which item is used in the effect
Who is the source of the effect?
Who is the destination of the effect?
Should the effect change direction to follow the target?
Should the effect explode when it hits the target?
What color is the effect?
Is the effect transparent?
... Many more things ...
A clump of data describing the local light level to a player probably contains much less information:
That this command is telling the client about the local light level
The player in question
The light level
So, each clump of data has a few things in common. Each performs exactly one function (displaying an item, displaying an effect, displaying a character, changing the light level). Each clump is capable of identifying itself to the client, and each clump contains a bit of additional information as necessary. These bits of data have a name. In the world of programming, we'd call these clumps of data "packets." A packet is simply a collection of data that is sent as part of a protocol between two computers. In the case of UO, these packets tell the server and the client what the other is doing. There are packets for anything and everything you can do in the game, from using a skill to displaying your radar to opening a container. Even the process of logging in and out require the use of special packets.
You can find a list of these packets
here
. That link will take you directly to Jerrith's UO Packets Guide, the most well-known guide to UO packets on the Internet. You can find it on many sites other than the one I've linked.
After reading over that list, you're either very confused or very enlightened. You now know that when you do something in the game, the client will send a packet to the server informing it of your actions. You also know that the server sends a lot of packets to the client telling it to display certain things (items, characters, etc) or to perform certain actions (change the light level). Other packets are simply a response to an information request. When you open your status window, your client sends a packet to the server, which asks it for your character information. The server replies with a different packet, detailing your character's strength, dexterity, intelligence, and all of the other vital information for that status window.
You may also notice references to bytes and lengths and sizes in that packet guide. We're going to have to introduce another new concept here. All computers think in a numbering system known as binary. The binary numbering system consists of only 2 digits (0/1). When a computer sends data to another computer over a network, the data is also sent in binary. Instead of sending letters and numbers, it sends a long string of zeros and ones. When you store music or images or programs on your computer, they are stored on your hard drive not as those things, but as long strings of zeros and ones. The advantage of doing this is that it's convenient for the hardware. Hardware that works with zeros and ones to perform a task is known as digital hardware. Tasks performed on those zeros and ones are digital logic. When we talk about those zeros and ones, we refer to them as bits (which is a contraction of "binary digit").
In binary, each bit represents a power of two. Just like in our base-10 (decimal) system that we use every day, each digit represents a power of ten. The number 1564 can be represented as the sum of powers of ten. For example:
1564 = 1*1000 + 5*100 + 6*10 + 4*1

1000 = 10 ^ 3

100 = 10 ^ 2

10 = 10 ^ 1

1 = 10 ^ 0
In the same way, a binary number can represent any number by using powers of two. Here's a short table of some bytes in binary and how they can be expanded into powers of two. If you would add and multiply those expressions, you would find that they add up to a decimal number. This means that for every decimal number, there is a number to match in binary. In fact, any number can be represented in ANY number base, without changing the value of the number. Certainly, you'll change what it looks like to a human, but you won't change the actual numeric value of the number.
10010101
1 * 2 7 + 0 * 2 6 + 0 * 2 5 + 1 * 2 4 + 0 * 2 3 + 1 * 2 2 + 0 * 2 1 + 1 * 2 0
10011100
1 * 2 7 + 0 * 2 6 + 0 * 2 5 + 1 * 2 4 + 1 * 2 3 + 1 * 2 2 + 0 * 2 1 + 0 * 2 0
00100011
0 * 2 7 + 0 * 2 6 + 1 * 2 5 + 0 * 2 4 + 0 * 2 3 + 0 * 2 2 + 1 * 2 1 + 1 * 2 0
01000101
0 * 2 7 + 1 * 2 6 + 0 * 2 5 + 0 * 2 4 + 0 * 2 3 + 1 * 2 2 + 0 * 2 1 + 1 * 2 0
00000011
0 * 2 7 + 0 * 2 6 + 0 * 2 5 + 0 * 2 4 + 0 * 2 3 + 0 * 2 2 + 1 * 2 1 + 1 * 2 0
So, as you can see, powers of two are very important to the computer and to the computer programmer. So, when someone decided that we needed to make groupings of bits (similar to the way that we have groupings called hundreds and thousands in the decimal system), they decided they were going to use powers of two to group them. The smallest grouping of bits is called a nibble. A nibble is equal to exactly 4 binary digits. For example, 1001 and 0001 are nibbles, but 0001010 consists of more than one nibble. Can you spot them? You're right, the two nibbles in 0001010 are 0000 and 1010. Adding a zero to the front of a binary number does not change its value.
The second and most important division of binary numbers is called the byte. A byte is exactly 8 bits and is the basic unit of storage on any sort of device. Your computer probably uses gigabytes, megabytes, and kilobytes on a regular basis. You probably know from school that the prefix "kilo" usually means 1000. For example, a kilometer is exactly 1000 meters. However, in keeping with our practice of using powers of 2, the people who invented the computer decided that one kilobyte should be 1024 (2 10 ) bytes. A megabyte is exactly 1024 kilobytes, which means that one megabyte is equal to 1048576 (1024 2 )bytes. A gigabyte is equal to 1024 megabytes, so one gigabyte is equal to 1073741824 (1024 3 ) bytes. Transforming these numbers into binary brings us to the not-so-surprising realization that the two larger numbers are also powers of 2. (If you think about it, you'll also realize that RAM comes in quantities of 32 MB, 64 MB, 128 MB, 256 MB, 512 MB, and 1024 MB. Each of those numbers is, of course, a power of two.)
However, we're not going to be using anything close to even a kilobyte when we play with packets. The vast majority of computers store numbers in one of three sizes: 1 byte, 2 bytes (a word), or 4 bytes (a double word, or dword). You will, of course, notice that 1, 2 and 4 are powers of two. In fact, data is almost never stored in 3 bytes or 5 bytes. Sometimes it's stored in 8 bytes, which is the next power of two after 4. Later, I might refer to these numbers using their bit equivalences. 1 byte is 8 bits, 2 bytes is 16 bites, and 4 bytes is 32 bits.
(Sidenote: The fact that 2 bytes is 16 bits and 4 bytes is 32 bits is also important in computing. The 32 in "Win32" or "FAT32" is the same number that appears in the phrase "32-bit." The reason for this is far too complicated for this tutorial, but it deals with the fact that memory is now represented by one 32-bit, or four byte, number instead of two 16-bit, or two byte, numbers.)
Now, Jerrith's packet guide might make a bit more sense when it's referring to certain numbers of bytes and bits. Let's look at an example packet from the guide:
0x05 Packet
Attack Request (5 bytes)
BYTE cmd
BYTE[4] ID to be attacked
The first two lines tell us the number of the packet and a short description. Sometimes these descriptions are a bit cryptic, but I chose this one because it's obvious. This packet is sent to the server by the client when the player double-clicks on someone in war mode. It is actually requesting permission from the server to attack something on the screen. The next lines are the actual data that must be sent with this packet. The first bulleted line tells us that we need to send a piece of data that is 1 byte long. This data must represent the command we're sending. In the last line, BYTE[4] means that value should be represented using 4 bytes. If you look at a UID in the game, you'll find that it is indeed represented by exactly 4 bytes. Also, when you see a number preceded by 0x, such as 0x4A, it means that number is in hexadecimal. The SPHERE equivalent is 04A.
Generally packets have this format. The first byte of any packet is the ID of that packet. So in our case, the first byte is going to contain the number 05. The four bytes following that one are going to be the UID of the character that's being attacked. The client knows the UIDs of characters on the client's display as well as the server, and can inform the server which character is being attacked by the player.
Now, finally, we reach the formatting of the SENDPACKET command. It's a bit confusing and very different than anything you've seen before.
SENDPACKET
Type:
Client Function
Usage:
SENDPACKET <bytes in hexadecimal>
Description:
The SENDPACKET function sends the bytes specified exactly as-is to the client. If the client isn't expecting that command, or the command is not formed correctly, the client WILL crash. All SENDPACKET strings must therefore be perfectly formed and expected.
Example:
SENDPACKET 05 040 00 010 011
// Sends an attack request (in the wrong direction) to attack player with UID 040001011
You'll notice that the bytes must be represented in hexadecimal. 1 byte is exactly 2 hexadecimal digits. (In the example above, those bytes are 05 40 00 10 11.) This is not difficult. Most numbers in UO are already represented in hexadecimal when displayed. However, just to be sure, you can force a number to display in hex by using the HVAL function: <HVAL <number>>
The real problem arises when we realize that the SENDPACKET function treats each number as a single byte, but most of our numbers are displayed as longer numbers. A UID is diaplyed as 040001011, not 040 000 010 011. In the past we had to create the most hieous function I've ever seen to take care of this problem, but now we can actually prefix each number with a character that identifies how many bytes a number should fill. These prefixes are B (1 byte), W (word, 2 bytes) and D (dword, 4 bytes). Our example above could be rewritten to become:
SENDPACKET 05 D040001011
// Sends an attack request (in the wrong direction) to attack player with UID 040001011
This tells Sphere that the number 040001011 is a DWORD value and should fill 4 bytes. The same thing works with smaller number,
D01
would be  the same as writing
00 00 00 01
.
So, finally, we have all of the tools we need to use SENDPACKET successfully! Scroll up and see how far we've come. Don't get lost. When you return, we'll take a look at a script that alters the personal light level of a player (like nightsight) without altering the base light level. It turns out that there's actually a separate packet for personal light and global light.
0x4E Packet
Personal Light Level (6 bytes)
BYTE cmd
BYTE[4] creature id
BYTE level
We've got three parameters we need to provide here. We need a one-byte command ID (04E in this case), a 4-byte creature id (the UID of the person whose light level we're changing), and a one-byte level. So, let's form the SENDPACKET command:
[FUNCTION change_light_level]
// Usage:  change_light_level lightlevel
SENDPACKET 04E D<UID> <ARGV[0]>
That isn't very hard, is it? The first byte is 04E, which is the command ID. The second 4 bytes are provided by prefixing the UID with a "D", and they represent the UID of the person whose light level we are changing. The last byte is given in the argument to the function. Don't worry too much about what happens if the value of ARGV[0] does not fit into a single byte (e.g. 010292). Since we did not prefix the value with a W or D, Sphere will assume that the value is intended to be a single byte and will treat it as such, although obviously the value 010292 won't fit into a byte so the value will be something else completely. If you're worried about invalid values being passed into the function then you should add some form of validation (for example,
IF (<ARGV[0]&gt> < 30
).
That was easy, wasn't it? Now let's look at a more complicated function, written by Acratia and altered to use Sphere's W and D prefixes:
[FUNCTION huedeffect]
// Usage: huedeffect type,itemid,speed,frames,explode,hue,rendermode
SERV.ALLCLIENTS SENDPACKET 0C0 <ARGV[0]> D<SRC.UID> D<UID> W<ARGV[1]> W<SRC.P.X> W<SRC.P.Y> <SRC.P.Z> W<P.X> W<P.Y> <P.Z> <ARGV[2]> <ARGV[3]> 00 00 00 <ARGV[4]> D<ARGV[5]> D<ARGV[6]>
We see here that this command requires a lot of information, which explains the long script. Actually, the best idea would be to break the script down into its constituent pieces. You'll see that each piece corresponds to a part of the packet description.
Data
Length
Description
0C0
1 byte
The command ID
<ARGV[0]>
1 byte
The first argument, which is a one-byte EFFECT type
D<SRC.UID>
4 bytes
The UID of the source of the effect
D<UID>
4 bytes
The UID of the target of the effect
W<ARGV[1]>
2 bytes
The ID of the item to display as the effect
W<SRC.P.X>
2 bytes
The X coordinate of the source
W<SRC.P.Y>
2 bytes
The Y coordinate of the source
<SRC.P.Z>
1 byte
The Z coordinate of the source
W<P.X>
2 bytes
The X coordinate of the destination
W<P.Y>
2 bytes
The Y coordinate of the destination
<P.Z>
1 byte
The Z coordinate of the destination
<ARGV[2]>
1 byte
The speed of the effect (if it's flying)
<ARGV[3]>
1 byte
The duration of the effect (in animation frames)
00 00
2 bytes
This is marked in the packet guide as "unknown."  Usually, if something is unknown, it's safe to leave it as 0, so we put two 0 bytes here.  It would also be safe to do this:
W00
00
1 byte
Fixed direction.  I'm not sure what this means, but we're going to set it to zero since we're not sure.  It does not adversely affect the script.
<ARGV[4]>
1 byte
Explosion.  This should either be a 1 or a 0, depending on if you want an explosion or not.
D<ARGV[5]>
4 bytes
The hue of the effect.  I wasn't aware that hues were 4 bytes, but apparently they are.  That's odd, because SPHERE represents colors as 2 bytes. Anyway, the D prefix doesn't care how many bytes you give it. You're getting four in the return value, no matter what.
D<ARGV[6]>
4 bytes
Change the seventh argument into a 4-byte number.
Interestingly enough, this "render mode" number determines transparency or fading of effects. This could lead to some fun things.
See? After we split it into its constituent parts, it isn't very difficult at all. In fact, the only thing that remains a mystery is the fact that we're using SERV.ALLCLIENTS with this command. That's simple when you think about it as well. The only people who will see this effect are those who receive the packet. Therefore, if we want everyone in the area to see the effect, we need to send everyone the packet. The only way to be absolutely certain that everyone in an area receives a packet is to send it to the entire server. Certainly, it'll increase lag by an infinitesimal amount to send 36 bytes to 200 players, but that's the price you pay for colored effects.
And that's about it for sending packets. Maybe later I'll post a way to divide a string up into packets, unless one of the other gurus gets there first. SENDPACKET is actually very simple. However, it does have a few limitations:
It can't do anything for which there is no packet. This one should seem obvious. An example is an idea that proposed coloring tilepics in gumps. The client simply doesn't support that, so we can't do it. It can't do anything that requires two-way communication. For example, you could send a dialog to the client using a very very long SENDPACKET, but the server won't be expecting a response, and you won't be able to handle events in your dialog. It could become very laggy if you send a lot of huge packets to a lot of players. Different clients support different packets. I believe that the hued effects are relatively new, so older clients like 2.0.0 or 1.26.4 may not support them. Clients greater than about 2.0.7 should support all packets listed in the Guide. And that's it. Easy, right?  :)

--- PAGE BREAK ---

Help
Available languages
Missing languages
Skill Gain Theory
By Taran
This is a topic of much debate on any SPHERE scripting forum, because no one can seem to agree on an appropriate method to implement a customized skill gain script. What IS agreed upon, however, is that the default skill gain system that is hardcoded into SPHERE is not customizable enough to meet the standards of today's shards. Stat gain is equally terrible.
The obvious way to implement a skill gain script is to use the
@SkillStart
event, which fires any time the player starts to use any skill. The skill being used is passed into @SkillStart as <ARGN1>
ON=@SkillStart
    IF (<ACTION> == SKILL_HIDING)
        SYSMESSAGE You are using the hiding skill!
    ENDIF
To implement customized skill gain, you must set the automatic skill gain rate for any customized skills to zero. Open up spheretables.scp and look for the [SKILL] sections. Set the three numbers after ADV_RATE to zero (or 0FFFFFFFF, because it is inconceivable that a player will use a skill over 4 billion times). One of these will work, and I'm not really sure which, so try it yourself.
I have devised several methods for skill gain scripting, and I will discuss each of them here.
Contents
1
Random Skill Gain
2
Modified Random Skill Gain
3
Linear Subskill Gain
4
Variable Subskill Gain
5
Exponential Subskill Gain
6
Skill Numbers as Variables
Random Skill Gain
This is the method whereby a player gains skill randomly every time he uses the skill. I will not offer distinct code examples in most cases, but rather a bit of pseudocode.
ON=@SkillStart
    IF (<EVAL RAND(10)> == 1)  // 1 in 10 chance
        gain skill
    ENDIF
Now, one of the major obvious problems with this script is that the player will gain skill at the same rate whether he or she has 10 skill or 99 skill. It's still approximately 1 out of every 10 trials. It is also conceivable that the player will NEVER gain skill with this method, because RAND(10) may NEVER return 1. The chances of that are extremely small, but it still remains possible. However, this IS the simplest method of skill gain, and the method that many shards have chosen to implement.
Modified Random Skill Gain
This method modifies the above section to allow for increasing difficulty as the player gains skill. In this method, we use their actual skill value as the argument to RAND, thus returning a number between 0 and their current skill. We can then check whether that number is greater or less than a certain value, which will determine whether or not skill is gained. Here is an example:
ON=@SkillStart
    IF (RAND(<SWORDSMANSHIP>) < 10.0)
        gain skill
    ENDIF
Of course, you can put any skill where I have
<SWORDSMANSHIP>
. You can also use the currently-being-used skill, which I will discuss toward the end of this article. This method is superior to the previous method, because, as you can see, the skill gain is dependent upon the player's current skill.
For example, let's assume that the player has 20.0 skill in Swordsmanship.
RAND(<SWORDSMANSHIP>)
will return a number between 0 and 200. We then check if that number is less than 10.0, which will occur approximately 50% of the time. Therefore, with 20.0 skill, the player gains skill 50% of the time he uses that skill.
If the player has 50.0 skill,
RAND(<SWORDSMANSHIP>)
will return 0 to 500, and the player will gain skill approximately 20% of the time.
As you can see, this method is greatly improved over the previous method. However, there are still better ways to implement skill gain. It still remains conceivable that the player will never gain skill with this method. We need a way to assure that a player will always gain skill.
Linear Subskill Gain
Yes, I am making up these names as I go. I thought that one sounded pretty awesome.
This method implements what I will refer to as a subskill. This is a separate value from the skill, usually stored in the form of a TAG on the player, which holds a value. Once that value crosses a certain threshold, the skill is incremented by 0.1 automatically. Every time the player uses the skill, the value is increased.
ON=@SkillStart
    TAG0.SUBSKILL += 5
    IF (<TAG0.SUBSKILL> > 100)
        TAG0.SUBSKILL = 0
        Increment skill by 0.1
    ENDIF
As you can see, this method will assure that the player gains skill after a certain number of trials. If you want to speed up the skill gain rate, add more to the subskill each try (in my example, you would change the 5 to something larger). If you want to slow it down, add less. Different skills will require different gain rates, so it is imperative that you experiment with the values for the subskill.
Incidentally, this is very similar to the way that the internal system calculates skill. Those numbers after ADV_RATE in the file can be equated to the 100 in my script above. However, the gain method used by ADV_RATE is what is called "variable linear", because as the player gains skill, it becomes significantly more difficult to gain skill. With the above example, the skill gain rate is fixed.
Variable Subskill Gain
I am not going to bother with this one. If you want to use this method, just use the default skill gain system.
Exponential Subskill Gain
This is the best method I have discovered yet, although there may still be others which are an improvement over this. Rather than comparing the subskill to a particular number (100 for example) we compare it to the player's current skill.
ON=@SkillStart
    TAG0.SUBSKILL += 5
    IF (<TAG0.SUBSKILL> > <SKILL>)
        TAG0.SUBSKILL = 0
        Increment skill by 0.1
    ENDIF
Of course, you would be replacing TAG.SUBSKILL with a more descriptive name, and SKILL with the skill in question. Either way, you get a nice rate of skill gain that increases as the skill increases. If you would like to express it mathematically, you would write:
ds/dt = ks
Of course, for those of you who understand calculus, it becomes obvious that the solution to this equation is
s = e kt
A nice exponential skillgain curve. To speed up skillgain, increase the value added to the subskill, and do the opposite to slow it down.
Skill Numbers as Variables
The final item to be discussed in this article is the use of a skill number as a variable. SPHERE already has this ability included in the system. More specifically, For example, ALCHEMY will be 01, because it is defined in spheretables as skill #1. Now, in the game, type this:
.01 100.0
Surprise! Your alchemy went up to 100.0! This proves that we can use ACTION numbers as variables. Now, how is this useful to us? Here is a script WITHOUT skill numbers as variables:
ON=@SkillStart
    IF (<ARGN1> == Skill_Swordsmanship)
        SWORDSMANSHIP += 0.1
        ELIF (<ARGN1> == Skill_hiding)
        HIDING += 0.1
        ELIF (<ARGN1> == Skill_taming)
        TAMING += 0.1
        ELIF (<ARGN1> == Skill_Macefighting)
        MACEFIGHTING += 0.1
        ELIF (<ARGN1> == Skill_MAGICRESISTANCE)
        MAGICRESISTANCE += 0.1
        ELIF (<ARGN1> == Skill_begging)
        BEGGING += 0.1
        ...
        ...
        ...
Ugly eh? Not only that, but the system has to parse and process that script every time you one of your players uses a skill. That could be rather slow don't you think? Well, no, it wouldn't be unless your processor was significantly slow, but enough scripts like that would begin to lag the server. Now, try this script on for size:
ON=@SkillStart
    TRY <ARGN1> = <EVAL <<ARGN1>> + 0.1>
That's it.  :)
Two lines. It looks a lot better than the script above it, right? But how does it work? Well, SPHERE parses this line like this, before trying to run it:
TRY <ARGN1> = <EVAL <<ARGN1>> + 0.1>
TRY 01 = <EVAL <01> + 0.1>
TRY 01 = <EVAL 451 + 1>
TRY 01 = 452
Execute "01 = 452"
In-game, type .01 452 and see what happens. Your alchemy goes to 45.2. Now, do it again with a different skill number. Try 01D, I think that's taming. So you see, this script will increment the skill for ALL skill numbers, in two lines of code.

--- PAGE BREAK ---

Contents
1
Introduction
2
Never, Ever Memorize Code
3
Plan Your Project Before You Begin
3.1
The Requirements Stage
3.2
The Specifications Phase
3.3
The Design Phase
3.4
The Coding Phase
3.5
The Debugging Phase
4
Ask For Help
5
Never Stop Learning
Introduction
You've seen it. Swindler posts on the boards those long extensive posts, which can make huge scripts seem like simple, trivial tasks. Belgar posts something, which you read over, and wonder why you didn't think of it. Then, you sit down to write a script like theirs, and you end up with a 28kb script which can probably be condensed by at least 90%. I've done it. Swindler has done it. Belgar has done it. The difference is, we've all learned from our mistakes.
So what do we have that you don't? It certainly isn't knowledge. If you read my tutorials, you will have an equal amount of knowledge as Belgar, Swindler, Kell, pmouse, or any of the other good scripters. None of them use techniques that will be beyond your scope. Does that make you stupid? Certainly not! There are some brilliant scripters on the boards, who cannot seem to put together a coherent program if their lives depended on it.
Now, there are entire majors in college involving what I am about to summarize. I'm in one: software engineering. Yes, you read that right. The first person I said that to asked me if it was meant to be an oxymoron. You see, many new programmers have only been exposed to programming via movies and literature, where programmers are depicted as a single man in a dark room, who types code and then a program runs. That is absolutely nothing like the real world. But I won't get into that, because all we're dealing with is SPHERE scripting.
This tutorial will be a lesson on learning. Doesn't that sound strange? Many people seem to have the idea in their minds that if they read a tutorial many times, and memorize every nuance of the scripting language, they will suddenly become a good scripter. And then they feel stupid when they post their incomprehensible scripts and a perfectionist comes along, cleans it up, and reduces it to three lines of code.
Never, Ever Memorize Code
"But how am I supposed to learn this if I don't memorize code?" you are asking. Learning and memorizing are two different things, and use two different functions of the brain. If you memorize, you can regurgitate perfectly, for example, the objects you receive when the @DClick event fires, and what each of those objects represents. However, your brain has not realized that these objects are also related to other objects (for example, a person is related to everything he is wearing, and vice versa).
The most common instance of this problem is trying to place items into a container that is not the backpack, or equipping them on someone else. A person in this situation will look through my reference database, and find that there is a command called BOUNCE which puts the referenced item into the backpack of the SRC (SRC is the person dclicking in this trigger), like so:
ON=@DClick
    SRC.SAY The sword is mine!
    SERV.NEWITEM i_cool_sword
    NEW.BOUNCE
The i_cool_sword item magically is placed into the backpack of the SRC. What most people don't seem to understand is that this piece of code is only one of many ways to achieve the same effect. For example, what if there is no SRC? What if this script is a @Timer script running on a memory object, where the player in question is that object's CONT or TOPOBJ?
ON=@Timer
    CONT.SAY The sword is mine!
    SERV.NEWITEM i_cool_sword
    NEW.BOUNCE
This will be the most common attempt to complete this script. However, it is WRONG . BOUNCE only places the item into the backpack of the SRC. In this case, there is no SRC, so the item will not move from its undefined location. In-game, no item will appear, because in theory, none was ever created in the real world. What we need to solve this problem is a different approach. One must realize how objects interact. What exactly do we want to do with this i_cool_sword? We desire to place it into the player's backpack. In other words, the player's backpack must become the container of the i_cool_sword. So why not just:
ON=@Timer
    CONT.SAY The sword is mine!
    SERV.NEWITEM i_cool_sword
    NEW.CONT <CONT.FINDLAYER.layer_backpack.UID>
Now what does this do? It looks more complicated, you're saying. Look at it for a moment. CONT contains the UID of the container of a particular item. In this script, we are SETTING that CONT object to be the UID of the player's backpack. We access the player's backpack object through the FINDLAYER function, and retrieve its UID.
Now, if our scripter had learned the concepts behind containers and items, before memorizing the BOUNCE command, he would have realized that the code in green is the correct way to implement the solution. In fact, it is a far better method, because it is easily changable. For example, what if we want to place this item into the player's bank box instead of his backpack? We'd simply change layer_backpack to layer_bankbox, and it would be finished. No fancy functions, no new commands to learn. We're simply altering a command we already know to provide new functionality.
That is step one in your becoming a proficient SPHERE scripter. You must learn to extend what you already know to provide new functionality. SPHERE scripting can do nearly anything. Yes, that's right. Anything. But how? You'll just have to sit back and think about it:
Plan Your Project Before You Begin
This is another result of the lone hacker syndrome that people pick up in the media. If you read a programming book, the entire beginning chapters will be on the proper design of a program. My entire major in college is devoted to the proper design of a functioning program. That's what I will be doing for the rest of my life, and being paid large sums of money to do so.
All programming projects come in five stages:
Requirements
Specifications
Design
Coding
Debugging
This is known as the "software life cycle" and was one of the first things I was taught in my very first computer class as a software engineering student. Notice that you don't even begin to write lines of script until the second to last step of the process.
The Requirements Stage
The requirements stage is simply the statement of the problem, and what you want your script to do:
"This in-game command .build should create a house which can be of any specified size and number of floors. The style of the walls, floor, and roof (which must be slanted) should also be specified. Houses always take rectangular form. The roof adjusts itself according to the length and width of the house. Houses which are narrower in the north-south direction should have a north-south facing roof, and the same is true for east-west houses."
That is a requirement. You know it as an idea. Notice that we have not yet even MENTIONED a scripting command. However, from the problem we should have a more general idea how we want our program to work. Next, we write the specifications of the problem. This is basically subdividing and conquering the problem, to make it easier. In the real world, different pieces of the problem would be handed off to different people. For example, one person might design the roof script, one might design the walls, and one might design the floor. Of course, as a SPHERE scripter, you rarely have the chance to work with anyone else. SPHERE scripting is simply not that type of programming language.
The Specifications Phase
Next, we reach the specifications stage of the project. This is slightly longer, and in my case, it takes the form of a numbered list:
Retrieve the styles from the command line
Use the styles to find the correct items to construct the house
Set the variables to their defaults
Build the current floor using the specified type
Build the walls for the current floor
If this is not the final floor, increment the Z location by 20, and start from step 4
Otherwise, choose the appropriate roof type and build it
Doesn't the problem seem slightly easier now that you've laid out a plan? You COULD code at this point, but what if you made a mistake in your specification. Obviously, this is a rather small specification. This stage of the process, in the professional world, usually takes the form of a report which can be up to 100 pages in length.
Next, we must subdivide further, and design how we are going to implement the specifications.
The Design Phase
First, we see that several functions are going to be needed. Let's name them now and write down what they are supposed to do:
FUNCTION build
This is the main function called by the command line. All it does is call other functions.
Call function retrieve_cmd_line
Check if the command line information was valid, and exit if not (we don't want to build a bad house)
Call function get_style_data
Call function variable_defaults
Call function do_all_floors
Call function do_roof
FUNCTION retrieve_cmd_line
This function is a bit more difficult. We know that we need six pieces of information. What would be the best way to retrieve this information. If you read the tutorial correct, you know that we have a trick where we store the <ARGS> variable into the MOREP of an item, which we can then access as four different variables MOREX, MOREY, MOREZ, and MOREM. However, we need six, so where do the other two come from? The answer is, they don't. Why can we not store three different numbers into MOREX? If the user types 300, could this not be interpreted as a 3, a 0, and a 0? Therefore, our build command, must have the following parameters:
.build [floor type][wall type][roof type] [width] [length] [number of floors]
Notice that there are no spaces between the first three parameters. Now, here are the steps this function takes:
Create a new i_memory item
Store ARGS into the MOREP of that item
Fill VAR.FLOORTYPE, VAR.ROOFTYPE, and VAR.WALLTYPE with the data from MOREX
Fill VAR.WIDTH with MOREY
Fill VAR.LENGTH with MOREZ
Fill VAR.FLOORS with MOREM
You get the idea. The design phase is where you lay out exactly what each part of your program should do. The idea is that any scripter should be able to take your design and create a working script from it. If I cannot understand your design, then chances are you cannot either, and you should either divide it farther, or explain it better. The reason you can all understand Swindler's scripts that he posts on the message boards is because he places his design comments directly within the scripts themselves. If not there, he certainly offers some explanation as to why his script is built the way it is.
The Coding Phase
Before you begin, CAREFULLY review your specifications to make sure that they meet the requirements. Also review your design to be sure it makes sense. If your find a mistake in an early stage of the Software Life Cycle, you must REDO all steps following it, because they will no longer be accurate. It is a terrible thing to develop a complete working script, and then find out that it doesn't do what you originally wanted it to do. Usually, that situation involves a complete rewrite of the script. When your scripts are over a thousand lines, that is a BAD thing.
Now, implement your code one piece at a time. You should be able to develop it in the order specified in the design phase. If you cannot, there is something wrong with your design, and you need to go back and fix it. If you learned the scripting language enough, you should only have to consult the tutorial once or twice during your script. The design will make the steps obvious.
The Debugging Phase
This phase is endless. A quote I read one time goes something like this:
"It is twice as difficult to debug a program as to write it. Therefore, if you put all of your creativity and effort into writing the program, you are not smart enough to debug it."
However, that doesn't mean you can't go look for help. Chances are, this is the step where you will approach the members of the SPHERE community for help. However, don't blindly post help. First, check for typos. The biggest source of errors is simple typos. Did you type ! where you mean ~? Did you type a ( where you wanted to insert a <? Those simple errors cause innumerable problems. Also, check to see if your EVAL statements have that closing bracket.
<EVAL
will not work, but
<EVAL &ltVAR.HELLO>> will.
In fact, today in my computer science class, the instructor had two variables. In SPHERE, they would be called VAR.BOLD and VAR.ITALIC. Here is what her program would have looked like, translated into the SPHERE language:
IF (<some condition>)
    VAR.BOLD = 1
ELSE
    VAR.BOLD = 0
ENDIF
IF (<some other condition>)
    VAR.ITALIC = 1
ELSE
    VAR.BOLD = 0
ENDIF
See the problem? Obviously the VAR.BOLD in the second ELSE should be VAR.ITALIC. This caused the very interesting effect that when you deselected the "italicized" option in her program, the text stayed italic, and lost its boldness instead. We spent 10 minutes trying to find the error. Fortunately, she had 50 people in the class to help her find it.
Ask For Help
Never be afraid to ask someone else for help. However, there are certain rules that you are expected to follow when seeking help. Before seeking help from a person, try to find the answer yourself. Not only will you learn more in the process, but chances are you won't make the same mistake again.
After this fails, post a message on the message boards. Do NOT send someone a message on ICQ begging that person to help you. This is simply common courtesy. If you do not receive a satisfactory answer on the message boards, resort to ICQ. My ICQ number is listed on the main page. However, if I do not respond to your first message, do not continue to message me saying "Hello?" and "Are you there? I need some help?" every five minutes. That is an excellent way to end up on my or any other expert's ignore list. If I do not respond, I am busy.
The method in which you ask for help is also very useful. First, clearly define the problem you are trying to solve. This does not help at all:
SUBJECT:  HELP!!!!!!!!!!!!!!11111

Why doesn't this script work????///  I've tried everything and it won't work!  WHY?!?1/1/  HELP ME!

IF !<EVAL <ARGTXT[1]> >
    SRC.SYSMESSAGE You MUST enter a valid price!!
    DIALOG d_auction_item
ELSE
    VAR.CURRENTPRICE=<EVAL 0<ACT.TAG.ITEM<EVAL <TAG.SELECTED> >PRICE> >
    IF (<VAR.CURRENTPRICE> <<EVAL <ARGTXT[1]> >
        VAR.BID=<EVAL <ARGTXT[1]> >
        IF (<SRC.FINDLAYER(LAYER_BANKBOX).RESCOUNT i_gold> <<EVAL <VAR.BID> >)
            SRC.SYSMESSAGE Sorry, you don't have enough money in your bank box to bid that.
        ELSE
            TRYP 0 ACT.TAG.ITEM<EVAL <TAG.SELECTED> >PRICE=<EVAL <VAR.BID> >
            SRC.SYSMESSAGE You bid <EVAL <VAR.BID> > gold on the item!
            SRC.CONSUMEGOLD <eval <var.bid> >
            //SYSMESSAGE ACT=<ACT.TAG.ITEM<EVAL <TAG.SELECTED> >TIMERMEM>
            ACT=<ACT.TAG.ITEM<EVAL <TAG.SELECTED> >TIMERMEM>
            ACT.TAG.HIGHBID=<EVAL <VAR.BID> >
            VAR.OLDHIGHBIDDER=<ACT.LINK>
            ACT.LINK=<SRC.UID>
            // Give the previous bidder his money back, since he lost
            // The owner of the item gets no money back, it's his risk
            IF <EVAL <VAR.OLDHIGHBIDDER> >!=<ACT.MORE>
                SRC.NEWITEM=i_gold
                SRC.ACT.AMOUNT=<eval <var.currentprice> >
                TRYP 0 SRC.ACT.CONT=<UID.OLDHIGHBIDDER.FINDLAYER(LAYER_BANKBOX).UID>
            ENDIF
        ENDIF
    ELSEIF (<VAR.CURRENTPRICE> ==<EVAL <ARGTXT[1]> >)
        SRC.AUCTION
    ELSE
        SRC.SYSMESSAGE You must bid MORE than the previous bidder!
    ENDIF
ENDIF
Can you tell me what that script is supposed to do? Can you tell me how it fits into the entire system? There are context clues (for example, the presence of ARGTXT) that would suggest that it belongs in a gump button section, but other than that, we have no idea what it is supposed to do. We also don't know where all these mysterious objects, like ACT, are coming from. None of the code is indented either, so we have spend ten times longer than we should, just to work out what's happening in that particular piece of code.
Also, learn to hold down the shift key for the entire time you are typing ! or ? characters.  !!!!111 and ???// are irritating to see.
Never Stop Learning
You will never learn all of the SPHERE language. Even I don't know all of the language. Even Swindler doesn't. We are both constantly learning and figuring out new ways to use old concepts. Well, he is, I have stopped scripting to continue my writing. That is the only way you will become better at scripting. That is the only way that you will ever reach a level where you can help other people.
I will end this lesson on design by introducing you to something interesting known as Bloom's Taxonomy. It was developed by a researcher in the 1950s, I believe, and it lays out the process in which the human mind learns information. It works in a hierarchy. You start on the bottom step (Knowledge) and cannot move your way upward until you complete that step. Here is Bloom's Taxonomy in SPHERE terms:
Step 1: KNOWLEDGE
This is the step where all new scripters enter the process. You have probably never seen a program before. You don't understand logic. You don't understand how the variables work. This is the stage where you learn how to place your brackets and parentheses correctly. You also learn the majority of the scripting commands here and most of the objects. Read over other people's scripts and try to make sense of them. This step is mostly that memorization I told you avoid. Leave it as fast as possible! If you continue to memorize, rather than comprehend scripts, you will never leave this level of learning.
Step 2: COMPREHENSION
This is the step where most scripters are lost. Unfortunately, as you can see, it is the second step. You must understand not only WHAT to type, but WHY. For example, in my above example using the CONT vs BOUNCE, you must understand why BOUNCE is an inappropriate choice for that situation, and you must understand how the objects are interacting. Continue to study other people's scripts, and try to understand not only THAT they work, but how they work.
Step 3: APPLICATION
Script, script, script. You know what to do, and why to do it. Now do it. Practice. Chances are you'll learn more in the process. Don't be afraid to ask for help.
Step 4: ANALYSIS
This is the step where you can compare and contrast methods of scripting. Those of you who have reached this stage are very far along indeed. It is those people who find the technical errors in my scripting techniques, and will probably ICQ me about errors in this very tutorial. You should not begin helping others with scripting until you reach this stage.
Step 5: SYNTHESIS
This is where the fun begins. This is where you begin taking old things and make new things. You begin designing your own library of functions to make your life easier. You begin posting complex scripts onto the message boards, with the full design document attached. You also are revered as a high member of the SPHERE community. Chances are that if you have reached this stage, you are able to post scripted bugfixes to many of the problems with the current release of the software. You've been around a while, and are probably ready for a much-deserved break from SPHERE.
Step 6: EVALUATION
Unfortunately, since SPHERE is a closed-source project, this option is unavailable. Generally, it would make you think about how to improve the system, like I tried to do when I suggested the TARGET function to the SPHERE devs back in version .42, when no one thought targeting was possible. Just be as cordial as possible in the process.

--- PAGE BREAK ---

Doors
Image
DEFNAME
FIXME
FIXME

--- PAGE BREAK ---

Help
Available languages
Missing languages
Just to give you an impression about who is who of the contributors of this website, here's a small image gallery.
All pictures were taken from public sources. So if
you find your picture here accidentally and want it removed,
just drop me a mail to nazghul AT dv-team DOT de.
The same applies if you would be kind enough to provide a
photography of yourself to this page - just drop it into a
mail at the same mail address as above.
http://www.lostland.de/swiki/bladecraft.jpg
Admin BladeCraft
http://www.lostland.de/swiki/cloudBR.jpg
ClouD_BR
http://www.lostland.de/swiki/furio.jpg
Furio
http://www.lostland.de/swiki/Jdog.jpg
Jdog
http://www.lostland.de/swiki/maximus.jpg
Maximus
http://www.lostland.de/swiki/pyromapes.jpg
Pyromapes
http://www.lostland.de/swiki/rattle.jpg
Rattlehead
http://www.lostland.de/swiki/saciBR.jpg
SaCi_BR

--- PAGE BREAK ---

Modern SphereServer Nightly Downloads (Server)
https://forum.spherecommunity.net/sshare.php?srt=4
Older/Classic SphereServer downloads (Server)
https://forum.spherecommunity.net/sshare.php?srt=4&prj=7
Sphere-X Script Pack (Scripts)
https://github.com/cbnolok/SphereX-Scriptpack
Julians Script Vault (Scripts)
https://github.com/JulianUO/SphereX-ScriptsVault
List of UO Packets (Info)
https://docs.polserver.com/packets/index.php
Ultima Online Downloads (Clients)
https://mega.nz/folder/6uYxnIpY#tahGzzz_yOkLgNM1c_DxdQ
Axis 2 Downloads (GM tool)
https://forum.spherecommunity.net/sshare.php?srt=4&prj=1
Leviathan (GM tool)
https://github.com/cbnolok/Leviathan/releases/download/v0.4.3/LeviathanWin64-automated-v0.4.3.zip
CentrED (Worldbuilding)
https://uo.wzk.cz/centred/
UO-Pixel (Graphics)
http://www.uo-pixel.de/
UO Fiddler ( MUL Viewer)
http://uofiddler.polserver.com/
UO Grafiken by Nyray (Graphics)
https://nyray.wordpress.com/
Vestimisu (Graphics)
http://vestimisu.blogspot.com/
Ultima Online Graphics By Rubra (Graphcs)
http://uographicsrubra.blogspot.com/
Isis‘ UO Grafiken (Graphics)
https://isispixel.wordpress.com/
ServUO (Graphics)
https://www.servuo.com/archive/categories/assets.13/
UOGateway (Shard Listing)
https://uogateway.com/

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Wiki Translations HOWTO
2
The Instructions for the Languages Template
2.1
Brief Instruction
2.2
Pages with Title in Foreign Language
2.3
Interface Selection
Wiki Translations HOWTO
Find the English version of a page in the main namespace.
(If there is no english version, you create one by following the HOWTO).
If the languages tool bar is not displayed at the top (as you see on
this
page for example) then edit the page, and add the following wiki text:
{{Languages|Page_name}}
While you're editing, copy the wiki text of the entire page to your clipboard.  ...now 'Save'
Where it says 'missing languages', follow a red link to begin creating the new wiki page. Paste in the text and start rewriting it in english. New new page title should have a language prefix.
See also
Wiki Help
.
Note: before saving the new page, your language is shown as a missing language in the preview. However, after you have saved it, your language is still shown in the missing language box with black colour and bold type. This strange thing is caused by a template cache.
Purge cache
to rescan the available languages. Your language will be shown as available.
The Instructions for the Languages Template
This
is a template that lists all languages available. It is based on
parser functions
from mediawiki and the
ISO 639-1
language code.
Brief Instruction
All page names are in English.
Every translated page needs a page name with a language code as a prefix, followed by a colon and the english page name.
If the "plain" english page name content is written in English, the english page name does not have a prefix in the file name. If the "plain" english page name content is written in some other language (ie
WikiProject France
), the english translated page does need a prefix of "en" (ie
en:WikiProject France
).
Example:
Page_name
-
fr:Page-name
-
de:Page_name
the following has to be included in each page:
{{Languages|Page_name}}
If you click on "missing languages", and then you click on a red link, it automatically opens a new page with the right suffix and the right page name. Copy the original text to this page and translate it. In the first line you put
{{Languages|Page_name}}
Example for actually implemented namespaces and languages (2009-6):
Page_name
DE:Page_name
EN:Page_name 
ES:Page_name
FR:Page_name 
IT:Page_name 
NL:Page_name
This automatically generates a language menu consisting of links to the original page (in English) and all translated pages. The links are written in the respective language: Deutsch, English, Français, etc.
Pages with Title in Foreign Language
Pages with names in a national language or other names can create the automatic menu by redirect:
in
XX:Page_name
:
#REDIRECT [[Page_name]]
in
XX:translated title of "Page_name")
the English title has to be added as parameter in the template:
{{Languages|Page_name}}
Interface Selection
If you want to change the design of the bar, translate messages or change where the
help
bottom links to, you can do it by adding the 2nd parameter of your design template.
{{Languages|Key:highway|Fi:Languages/Interface}}
Copy the
Template:Languages/Interface
as your first template.
Note
: Technically, you can make a interface with the translated language as above, it is not recommended to use. Because
this template is set for other language users
to go back to their language versions, the translated messages can not be read for them. See also
this discussion page
.

--- PAGE BREAK ---

Script pack for Sphere X version (recommended)
Github
File
Script pack for Sphere 56d version
Github
File

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires on all characters who are responsible for another character's death.
The trigger is fired based on the Attacker list, @Death is called before it and @DeathCorpse after, so the @Death trigger can pre-handle who will receive this trigger by adding or removing attackers.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
character
who has been killed.
I
The
character
doing the killing.
SRC
The
character
doing the killing.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The total number of characters involved in the character's death.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the killer from receiving credit for the kill.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Properties and Functions
2
Examples
Properties and Functions
Here is a list of all attacker properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
This parameters must use with
ATTACKER
. For examples, please go
Examples
.
ATTACKER
.key
Read/Write
Description
R
Gets the number of opponents who have damaged the character.
n
R
Gets the UID of the nth opponent who has damaged the character. (zero-based)
CLEAR
R
Clears the attacker list
LAST
R
Gets the UID of the opponent who most recently damaged the character.
MAX
R
Gets the UID of the opponent who has dealt the most damage to the character.
ID
R
Gets the Attacker.number of the specified character, -1 if its not in the attacker list for this character.
TARGET
R
Returns the UID of this character's best target with this priorities (Threat -> Distance -> LOS).
ADD
W
Add this uid to the attacker list.
DELETE
W
Removes this uid from the attacker list
n
.
DAMAGE
RW
Gets or Sets the amount of damage that the nth opponent has dealt to the character. (zero-based)
n
.
ELAPSED
RW
Gets or Sets the length of time since the nth opponent has damaged the character, in seconds. (zero-based)
n
.
UID
R
Gets the UID of the nth opponent who has damaged the character. (zero-based)
n
.
THREAT
RW
Gets or Sets the Threat generated by the enemy to this character, NPCs will attack the character with most Threat in certain Distance when in LOS (Check for
TARGET
).
n
.
DELETE
W
Remove this opponet from the list.
Examples
The following examples are about
attacker
.
ATTACKER
[Events e_example]
On=@Death
    SERV.LOG Number Of Attacker: <attacker>
You will see
number of attacker
output to the console.
'
ATTACKER
[.ID]
[EVENTS e_example]
ON=@GetHit
    Serv.Log <src.name> is the attacker number '<attacker.id <src>>' on my list.
ATTACKER
.n
[.UID]
[Events e_example]
On=@Death
    SERV.LOG First Attacker: <uid.<attacker.0>.name>
    SERV.LOG Fourth Attacker: <uid.<attacker.3.uid>.name>
You will see
first and fourth attackers
output to the concole.
OR
[Events e_example]
On=@Death
    for 0 <eval <ATTACKER>-1>
        SERV.LOG <eval <DLOCAL._FOR>+1>. Attacker: <uid.<attacker.<dlocal._for>>.name>
    endfor
You will see
all attackers
output to the console.
ATTACKER.LAST
[Events e_example]
On=@Death
    SERV.LOG Last Attacker: <uid.<attacker.last>.name>
You will see
last attacker
output to the console.
ATTACKER.MAX
[Events e_example]
On=@Death
    SERV.LOG Max Attacker: <uid.<attacker.max>.name>
You will see
the attacker who dealt the most damage to the character
output to the console.
ATTACKER.TARGET
[Events e_example]
On=@Death
    ref1=<attacker.target>
    SERV.LOG My current target is: <ref1.name>
This will output in the console the name of the current best target.
Note: Enabling NPC_AI_THREAT in the ini's npc_ai settings will make characters to check for Threat when looking for targets.
ATTACKER
.n
.DAMAGE
[Events e_example]
On=@Death
    SERV.LOG Damage from first player: <attacker.0.dam>
You will see
amount of damage which first attacker has dealt
output to the console.
ATTACKER
.n
.ELAPSED
[Events e_example]
On=@Death
    SERV.LOG Attack time of the first player: <attacker.0.elapsed>
You will see
the length of time since the first opponent has damaged
output to the console.

--- PAGE BREAK ---

Targetf is a command you can use to directly target a character or item and using a function on it without manually creating an memory item or such. Using the targetf itself works like calling an ordinary function and you can put arguments after the function normally.
ex. targetf f_hello or targetf f_hello 1,2
In targetf:
SRC= player using the function
ARGO= target's UID
TARGP= ID of the tiles when target is a static tile
local.id stores the ID of the targeted object

--- PAGE BREAK ---

The reference compendium documents everything you may find in a Sphere script, ranging from things such as definitions in scripts to objects and their associated functions, properties, references and triggers.
Subcategories
This category has the following 15 subcategories, out of 15 total.
C
Characters
Combat
D
Definitions
F
Functions
I
Items
N
NPCS
O
Objects
P
Players
R
Regions
S
Scripts
Skills
Spells
Statements
T
Triggers
V
Variables
Pages in category "Reference Compendium"
The following 200 pages are in this category, out of 242 total.
(previous page) (
next page
)
@
@Abort
@AfterClick
@Attack
@Buy
@CallGuards
@CharAttack
@CharClick
@CharClientTooltip
@CharDClick
@CharTradeAccepted
@Click
@ClientTooltip
@CliPeriodic
@CombatAdd
@CombatDelete
@CombatEnd
@CombatStart
@ContextMenuRequest
@ContextMenuSelect
@Create
@Criminal
@Damage
@DClick
@Death
@DeathCorpse
@Destroy
@Dismount
@DropOn Char
@DropOn Ground
@DropOn Item
@DropOn Self
@DropOn Trade
@Dye
@Eat
@Effect
@EffectAdd
@EffectRemove
@EffectTick
@Enter
@EnvironChange
@Equip
@EquipTest
@Exit
@ExpChange
@ExpLevelChange
@Fail
@Fail (Spell Trigger)
@FameChange
@Gain
@GetHit
@Hit
@HitMiss
@HitParry
@HitTry
@HouseDesignCommit
@HouseDesignExit
@ItemAfterClick
@ItemBuy
@ItemClick
@ItemClientTooltip
@ItemContextMenuRequest
@ItemContextMenuSelect
@ItemCreate
@ItemDamage
@ItemDClick
@ItemDropOn Char
@ItemDropOn Ground
@ItemDropOn Item
@ItemDropOn Self
@ItemEquip
@ItemEquipTest
@ItemPickUp Ground
@ItemPickUp Pack
@ItemPickUp Self
@ItemPickUp Stack
@ItemSell
@ItemSmelt
@ItemSpellEffect
@ItemStep
@ItemTargOn Cancel
@ItemTargOn Char
@ItemTargOn Ground
@ItemTargOn Item
@ItemToolTip
@ItemUnEquip
@Jailed
@KarmaChange
@Kill
@Login
@Logout
@Mount
@MurderDecay
@MurderMark
@NotoSend
@NPCAcceptItem
@NpcActCast
@NPCActFight
@NPCActFollow
@NPCAction
@NPCActWander
@NPCHearGreeting
@NPCHearUnknown
@NPCLookAtChar
@NPCLookAtItem
@NPCLostTeleport
@NPCRefuseItem
@NPCRestock
@NPCSeeNewPlayer
@NPCSeeWantItem
@NPCSpecialAction
@PartyDisband
@PartyInvite
@PartyLeave
@PartyRemove
@PayGold
@PersonalSpace
@PetDesert
@PickUp Ground
@PickUp Pack
@PickUp Self
@PickUp Stack
@PreStart
@Profile
@ReceiveItem
@Redeed
@RegenStat
@RegionEnter
@RegionLeave
@RegionResourceFound
@RegPeriodic
@Rename
@ResourceFound
@ResourceGather
@ResourceTest
@Resurrect
@SeeCrime
@SeeHidden
@SeeSnoop
@Select
@Select (Spell Trigger)
@Sell
@SkillAbort
@SkillChange
@SkillFail
@SkillGain
@SkillMakeItem
@SkillMenu
@SkillPreStart
@SkillSelect
@SkillStart
@SkillSuccess
@SkillUseQuick
@SkillWait
@Smelt
@SpellBook
@SpellCast
@SpellEffect
@SpellEffectAdd
@SpellEffectRemove
@SpellEffectTick
@SpellFail
@SpellSelect
@SpellSuccess
@SpellTargetCancel
@Start
@Start (Spell Trigger)
@StatChange
@Step
@StepStealth
@Success
@Success (Spell Trigger)
@TargOn Cancel
@TargOn Char
@TargOn Ground
@TargOn Item
@Timer
@ToggleFlying
@ToolTip
@TradeAccepted
@TradeClose
@TradeCreate
@UnEquip
@UseQuick
@UserBugReport
@UserChatButton
@UserExtCmd
@UserExWalkLimit
@UserGuildButton
@UserKRToolbar
@UserMailBag
@UserQuestArrowClick
@UserQuestButton
@UserSkills
@UserSpecialMove
@UserStats
@UserVirtue
@UserVirtueInvoke
@UserWarmode
@Wait
A
Accounts
(previous page) (
next page
)

--- PAGE BREAK ---

Description
CAN is a Flag like variable, predefined values must be added with special characters and not with sums or sustractions ( + or - ).
These values adds some behaviour modification for items, like make sphere they are water (can_i_water), a tile where Gargoyles can hover over (can_i_hover) and much more.
On X version: CAN flags are read only. You can't edit them after the item/char creation. I you want modify the can Flags you should use
CANMASK
Usage
[itemdef i_test]
id=i_pickaxe
name=Pickaxe
can=can_i_flip|can_i_dye|can_i_repair //This is how values must be added, using the | means they are being sum.


ON=@DClick
    src.say <name>'s current can_flags are: <can>
    //To check any specific flag this is how its done:
    
    if (<can>&can_i_dye)
        src.say and can be dyeable.
    endif
CANMASK EXAMPLE ON X VERSION

IF <CANMASK>&mt_nonmover //  is on, turn it off
    CANMASK &=~mt_nonmover
    SYSMESSAGE @,,1 Can move
    else//  is off, turn it on
    CANMASK |= mt_nonmover
    SYSMESSAGE @,,1 Can't move
ENDIF
Actual Flags
CAN_I_DOOR             000001   // Is a door UFLAG4_DOOR
CAN_I_WATER            000002   // Need to swim in it. UFLAG1_WATER
CAN_I_PLATFORM         000004   // we can walk on top of it. (even tho the item itself might block) UFLAG2_PLATFORM
CAN_I_BLOCK            000008   // need to walk thru walls or fly over. UFLAG1_BLOCK
CAN_I_CLIMB            000010   // step up on it, UFLAG2_CLIMBABLE
CAN_I_FIRE             000020   // Is a fire. Ussually blocks as well. UFLAG1_DAMAGE
CAN_I_ROOF             000040   // We are under a roof. can't rain on us. UFLAG4_ROOF
CAN_I_HOVER            000080   // We are hovering. UFLAG4_HOVEROVER
CAN_I_PILE             000100   // Can item be piled UFLAG2_STACKABLE (*.mul)
CAN_I_DYE              000200   // Can item be dyed UFLAG3_CLOTH? (sort of)
CAN_I_FLIP             000400   // will flip by default.
CAN_I_LIGHT            000800   // UFLAG3_LIGHT
CAN_I_REPAIR           001000   // Is it repairable (difficulty based on value)
CAN_I_REPLICATE        002000   // Things like arrows are pretty much all the same.
CAN_I_DCIGNORELOS      004000   // when dclicked, ignore LOS checks
CAN_I_DCIGNOREDIST     008000   // when dclicked, ignore distance checks
CAN_I_BLOCKLOS         010000   // blocks LOS, but not walking thru

--- PAGE BREAK ---

Gets or sets the item type.
Examples
Ingame commands:
.XTYPE T_NEW_TYPE // Set T_NEW_TYPE as type of targetted item.
.XSHOW TYPE // Show the TYPE of targetted item.
Sphere scripting:
TYPE T_NEW_TYPE // Set T_NEW_TYPE as type of the item.
<TYPE> // Return the type of the item.

--- PAGE BREAK ---

Description
CAN is a Flag like variable, predefined values must be added with special characters and not with sums or sustractions ( + or - ).
These values adds some behaviour modification for items, like make sphere they are water (can_i_water), a tile where Gargoyles can hover over (can_i_hover) and much more.
This flag is only readable in X branch. Please check @CANMASK instead.
Usage
[chardef c_test]
id=c_man
name=Dummy
can=mt_male|mt_swim|mt_walk //This is how values must be added, using the | means they are being sum.


ON=@Create
    str=10
    dex=10
    
ON=@DClick
    src.say <name>'s current can_flags are: <can>
    //To check any specific flag this is how its done:
    
    if (<can>&mt_swim)
        src.say and can walk on water.
    endif
Actual Flags
mt_male           00000
mt_nonmover       00000
mt_ghost          00001   // Moves through doors
mt_swim           00002   // Moves on water
mt_walk           00004   // Can walk on land
mt_passwalls      00008   // Walk through walls
mt_fly            00010
mt_fire_immune    00020
mt_indoors        00040   // Can go under roof
mt_hover          00080   // Hovers (can follow gargoyle flight paths)
mt_equip          00100
mt_usehands       00200
mt_mount          00400   // can ride mountables
mt_female         00800
mt_nonhum         01000   // Body type for combat messages
mt_run            02000
mt_nodclicklos    04000   // when dclicking sth., ignore LOS checks
mt_nodclickdist   08000   // when dclicking sth., ignore distance checks

--- PAGE BREAK ---

Description
X branch only. This property is a bitmask, like the CAN property, and stores the
CAN (Characters)
flags to be dynamically switched on or off from the base CAN property.
When retrieving the CAN property, now it is first XORed with CANMASK (the return value will be CAN ^ CANMASK), so in other words:
If a flag set in the CANMASK is also set in CAN, the flag is ignored;
If a flag set in the CANMASK isn't set in CAN, the flag is considered as set.

--- PAGE BREAK ---

Usage
REFERENCE.CANSEELOS TARGET
Description
CANSEELOS is a test, so it is most often used in an IF statement.  What it does is calculate a direct line from the eyes of the character (typically SRC) to the item, character, or point location... and if there is anything that blocks on that path, then you can't see.
If you
can
see the target, the return value is 1, and if you
cannot
see, the return value is 0.
When testing... keep in mind that a GM has line of sight to everything!
Example
ON=@TargOn_Item
    IF !(<SRC.TARG.CANSEELOS>)
        SRC.SYSMESSAGE @032 That item is not within line of sight
        RETURN 1
    ENDIF
ON=@TargOn_Ground
    IF !(<SRC.CANSEELOS <SRC.TARGP>>)
        SRC.SYSMESSAGE @032 That location is not within line of sight
        RETURN 1
    ENDIF

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an object is deleted from the world.
Fires on:
Characters
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
or
item
being deleted.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the object from being deleted.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Properties and Functions
2
Examples
Properties and Functions
Here is a list of all dialoglist properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
This parameters must use with
DIALOGLIST
. For examples, please go
Examples
.
DIALOGLIST
.key
Read/Write
Description
COUNT
R
Gets the number of number of dialogs currently considered to be visible on SRC's screen.
n
.
COUNT
R
Gets the number of instances of nth dialog SRC has open (zero-based).
n
.
ID
R
Gets the ID of the nth dialog that SRC has open (zero-based).
Examples
The following examples are about
dialoglist
.
DIALOGLIST.COUNT
[Function dialogtotal]
SERV.LOG Total number of dialogs: <dialoglist.count>
You will see
total number of dialogs
output to the console.
DIALOGLIST
.n
.COUNT
[Function dialogtotal]
SERV.LOG Instant dialogs: <dialoglist.0.count>
You will see
how many dialog same id with first dialog
output to the concole.
DIALOGLIST
.n
.ID
[Function dialogtotal]
SERV.LOG First dialog id: <dialoglist.0.id>
You will see
id for first dialog
output to the console.

--- PAGE BREAK ---

Usage
EFFECT type, item_id, speed, loop, explode, colour(hue), rendermode
Description
Type is a number 0-3 from the table below.  Item_id is the base id (this must be a "base" item ID - which you can identify as an [ITEMDEF 0xxx] where xxx is a number not a name) of the item or animation.  If the ID is a animation, you likely want to use the first id of the animation loop.  Speed is a number determining the speed of the animation and the travel speed if it's a projectile, with 1 being the slowest and higher numbers being faster.  Loop specifies the time the animation will play, 16 is a good default. This is NOT frames of animation, as a high speed results in more frames per given loop setting. Explode is a boolean defining whether the projectile should make an explosion animation when reaching the character.
The EFFECT
always
applies to SRC (and in the case of type 0, that means the item will always move from SRC to it's target.)  That means any reference you put in front of EFFECT (for example: OBJ.EFFECT, REF1.EFFECT, TARG.EFFECT, ec...) is ignored.  To force a type 0 animation to go
to
the SRC, you need to use TRYSRC (which lets you alter SRC temporarily) to reverse the direction.
Effect Types
Effect Number
Short
Long Description
0
Standard flying object
The object will follow its target until it hits, and then explode if that flag is set
1
Lightning effect
This is the only way to achieve the lightning effect in-game
2
Ground-based effect
This effect will stay at a particular point on the map until it expires. As a result, it will appear lower than a type 3 effect. This is the only way to get an effect onto an item.
3
Character-based effect
This effect will follow the character as he moves, the way a flamestrike does when the spell is cast. The bottom of the effect is somewhere around the character's knees.
4
Flash effect
(New 6+ (needs verification)) Clients Only) Provides a screen-wide effect. All other parameters besides Item Id is ignored.  Item Id controls the flash type:
Item Id
Effect
Description
0
Fade to Black (Slow)
Fades the screen to black before returning to normal similar to the death effect found on some client versions
1
Fade to White (Slow)
Fades the screen slowly to complete white followed by a return to normal
2
Fade to white (Fast)
Fades the screen quickly to complete white followed by a return to normal (lightning flash type effect)
3
Fade to White then Black (Slow)
Fades to complete white then to black.  Behaves as if effect 1 is played immediately followed by effect 0.
4
Fade to Black (Fast)
Fades the screen quickly to complete black followed by a return to normal

--- PAGE BREAK ---

Usage
EFFECTLOCATION x,y,z,type, item_id, speed, loop, explode, colour(hue), rendermode
Example:
[FUNCTION testLocationZ]
  effectLocation <p.x>,<p.y>,<height>+1,0,i_sword_long,1,0,0,colors_red,3
Description
X branch only. x,y,z are de coordinates where the effect will show on the ground.  Type is a number 0 or 2 from the table below (other effects will not be played, only effect 0(bolt) and 2(ground level) seems valid, probably cause they don't accept a map point).  Item_id is the base id (this must be a "base" item ID - which you can identify as an [ITEMDEF 0xxx] where xxx is a number not a name) of the item or animation.  If the ID is a animation, you likely want to use the first id of the animation loop.  Speed is a number determining the speed of the animation and the travel speed if it's a projectile, with 1 being the slowest and higher numbers being faster.  Loop specifies the time the animation will play, 16 is a good default. This is NOT frames of animation, as a high speed results in more frames per given loop setting. Explode is a boolean defining whether the projectile should make an explosion animation when reaching the character.
EffectLocation Types
Effect Number
Short
Long Description
0
Standard flying object
The object will follow its target until it hits, and then explode if that flag is set
2
Ground-based effect
This effect will stay at a particular point on the map until it expires. As a result, it will appear lower than a type 3 effect. This is the only way to get an effect onto an item.

--- PAGE BREAK ---

Usage
REFERENCE.MAPWAYPOINT ObjectUID,WayPointType
Description
This function adds/removes waypoints on client radar map (enhanced clients only).
Waypoint types:
	0 = Remove waypoint
	1 = Corpse
	2 = Party Member
	4 = Quest Giver
	5 = New Player Quest
	6 = Healer
	11 = Shrine
	12 = Moongate
	14 = Green Dot
	15 = Green Dot (flashing)
Example
ON=@Dclick //let's suppose that dclicked item is a map (for example) where the target is stored in its link.
    src.mapwaypoint <link>,4

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an object is clicked, just before the overhead message is displayed to the client.
Fires on:
Characters
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
or
item
being clicked.
SRC
The
character
doing the clicking.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
LOCAL.CLICKMSGHUE
IO
The colour of the message.
LOCAL.CLICKMSGTEXT
IO
The message to display.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the message from being displayed.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when one character initiates an attack on another.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
initiating the attack.
SRC
The
character
being attacked.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Name
Description
ARGN1
Threat being assigned to the target after starting the fight (Only for NPCs).
ARGN2
replace Ignore status. 1->Force to ignore attacker 0->Force to unignore attacker (X-ONLY)
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from attacking.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character calls for the guards to attack a criminal.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The guard
character
who is going to attack the criminal (if one exists in the area).
I
The
character
calling for guards.
REF1
The
criminal
who the guards are being called upon.
SRC
The
criminal
who the guards are being called upon.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The
BASEID
of the
character
to spawn as a guard.
ARGN2
O
If set to 1, a new guard will be spawned regardless of whether a nearby guard is available.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the guards from reacting. (When firing on a player, will prevent the guards attacking the next possible targets)

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when one character initiates an attack on another.
This trigger fires on the character being attacked.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
character
initiating the attack.
I
The
character
being attacked.
SRC
The
character
initiating the attack.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from attacking.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character clicks on another character, just before the overhead message is displayed to the client.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
character
being clicked.
I
The
character
doing the clicking.
SRC
The
character
doing the clicking.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents any hardcoded behaviour from taking place.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a client requests tooltips for another character. the
ADDCLILOC
function can be called on the
I
object to send custom tooltips to the client.
Fires on:
Clients
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
character
whose tooltips are to be sent.
I
The
client
who is receiving tooltips.
SRC
The
character
whose tooltips are to be sent.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents Sphere from sending its own tooltips.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character double clicks another character.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
character
being double clicked.
I
The
character
doing the clicking.
SRC
The
character
doing the clicking.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents any hardcoded behaviour taking place.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when two players have accepted a trade agreement. The trigger will be fired on both characters.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
player
the player is trading with.
ARGO
The
player
accepting the trade.
I
The
player
accepting the trade.
REF
1 to
REF
<ARGN1>
The
items
that the other player is receiving.
SRC
The
player
the player is trading with.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The number of items that the other player is receiving.
ARGN2
I
The number of items that the player is receiving.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the trade from taking place.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an object is clicked, just before the overhead message is displayed to the client.
Fires on:
Characters
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
or
item
being clicked.
SRC
The
character
doing the clicking.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents any hardcoded behaviour from taking place.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when tooltips are about to be sent to a client. the
ADDCLILOC
function can be called on the
SRC
object to send custom tooltips to the client.
Fires on:
Characters
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
or
item
whose tooltips are to be sent.
SRC
The
client
who is receiving tooltips.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents Sphere from sending its own tooltips.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when someone is being added to my attacker list.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
Myself, someone is being entering in combat with me (or I am entering in combat with
SRC
The character entering in my list.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Name
Description
ARGN1
Threat set to this SRC, if enabled on ini and I'm not a player.
ARGN2
Sets wether to add SRC as ignored or not.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents src of being added to my list, however I will try to add him each time I can.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when someone is being deleted from my attacker list.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
Myself.
SRC
The character being removed from my list.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
Shows if the deletion was forced by your scripts (1) or called by Sphere (0)
ARGN2
I
Type description
Values
Forced (Blocked attack, default uncategorized actions...)
0
Max fight time has reached (Elapsed)
1
Distance/LOS
2
The character is no longer existing
3
Forced via attacker.delete methods (ingame/script)
4
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents src of leaving my list, however I'll try to delete him as soon as possible.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when someone is being deleted from my attacker list and I don't have any more viable targets.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
Myself.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
No return values allowed for this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when i'm in peace and i'm to begin a combat.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
Myself.
SRC
The character forcing me to start a combat.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the 'engage' however I will try again soon.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character attempts to access the context menu on an object. The
ADDCONTEXTENTRY
function can be called on SRC to add custom menu entries to the menu.
Fires on:
Characters
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
or
item
being accessed.
SRC
The
client
requesting the menu.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
1 on the first fire, 2 on the second. Set to a value other than 1 during the first call to have the trigger fire again after hardcoded menu entries have been added.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents hardcoded menu entries being added.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a client selects a context menu option for an object.
Fires on:
Characters
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
or
item
displaying the menu.
SRC
The
character
who selected the option.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The ID of the menu option selected.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents any hardcoded action taking place.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an object is initially created, before it is placed in the world.
Fires on:
Characters
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
or
item
being created.
SRC
The
character
responsible for the object's creation.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character is going to become criminal.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
criminal
.
SRC
The
character
seeing the crime.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
How much time will be criminal for this action ( Reading ini's setting, writable).
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the char of becoming criminal.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an object is double clicked.
Fires on:
Characters
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
or
item
being double clicked.
SRC
The
character
doing the clicking.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents any hardcoded behaviour taking place.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character's health reaches zero and they are about to die.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
about to die.
SRC
The
character
about to die.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the death from taking place.
Note:
The trigger will fire again unless the script changes the character's health to above zero.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character dies and a corpse has been created.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The character's corpse.
I
The
character
who died.
SRC
The
character
who died.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character dismounts from a ride.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
ride
being dismounted.
I
The
character
dismounting the ride.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the dismount from taking place.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item is dyed by a dye tub. It is also called in script color changes, dye tub color changes, @Create color assignment, and staff .xcolor command.
Fires on:
Items
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
item
being dyed.
SRC
The
character
dyeing the item.
ARGO
The
item
originating the dye target.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The hue value.
ARGN2
IO
Sound effect (Default 023E).
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Stop internal dye sound. Hue changes made from script will take place.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when someone is eating something.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
item
being ate (X ONLY).
I
/
SRC
The
character
doing the clicking.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
Argn1
I/O
Set to 1 to let it pass your MaxStats, ie: MaxHits=100 and local.hits + hits = 150, having it to 1 will set hits to 150 and setting it to 0 will raise hits up to MaxHits only.
local.hits
I/O
Amount of HitPoints to regenerate.
local.mana
I/O
Amount of Mana to regenerate.
local.stam
I/O
Amount of Stamina to regenerate.
local.food
I/O
Amount of Food to regenerate.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the gain of stats but not the eating.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when the environment (light, season, weather) changes for a character, or when the character moves in to a new sector.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
SRC
The
character
affected by the environment change.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character's experience level is changed.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
character
that was killed, if the experience change originated from a kill,
I
The
character
whose experience is being changed.
SRC
The
character
whose experience is being changed.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The amount of experience being added (can be negative).
ARGN2
IO
If non-zero, a message will be displayed to the client to inform them of the change.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character's experience level from being changed.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character's experience level is about to change.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
whose experience level is about to change.
SRC
The
character
whose experience level is about to change.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The number of experience levels being added (can be negative).
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the experience level from being changed.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character's fame level is about to change.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
whose fame is changing.
SRC
The
character
whose fame is changing.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The amount of fame being added (can be negative).
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character's fame from being changed.
0
Applies changes to I.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character receives damage.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
being damaged.
SRC
The
character
responsible for the damage.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
Sphere X only?
ARGN1
IO
The amount of damage being applied. (Before Slayer calulation if applicable)
ARGN2
IO
The type of damage being applied.
ARGN3
IO
Hits will be fixed to this amount after the hit if the value is greater than it, default = maxhits.
LOCAL.ITEMDAMAGECHANCE
IO
Sets the chance for the hitted part of the body (Armor or shield, if any) to be damaged (Default: 40% in Sphere D, 25% in Sphere X).
LOCAL.DAMAGEPERCENTPHYSICAL
I
The amount in % of the physical damage received, only set if Elemental Engine is enabled.
X
LOCAL.DAMAGEPERCENTFIRE
I
The amount in % of the fire damage received, only set if Elemental Engine is enabled.
X
LOCAL.DAMAGEPERCENTCOLD
I
The amount in % of the cold damage received, only set if Elemental Engine is enabled.
X
LOCAL.DAMAGEPERCENTPOISON
I
The amount in % of the poison damage received, only set if Elemental Engine is enabled.
X
LOCAL.DAMAGEPERCENTENERGY
I
The amount in % of the energy damage received, only set if Elemental Engine is enabled.
X
LOCAL.SPELL
I
Display the spell number that damaged the character.
X
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents damage from being applied.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character hits someone using a combat skill.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
weapon
being used (can be nothing, if fists are used).
I
The
character
doing the hitting.
SRC
The
character
being hit.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The amount of damage being dealt.
ARGN2
IO
The type(s) of damage.
LOCAL.ARROW
I
UID of the arrow used (Archery only)
LOCAL.ARROWHANDLED
IO
if set to !=0, you can do whatever you want with local.arrow
LOCAL.ITEMDAMAGECHANCE
IO
Sets the chance for the weapon to be damaged (Default: 40).
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Cancels the combat swing.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character is about to miss a combat swing.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
weapon
being used (can be nothing, if fists are used).
I
The
character
doing the hitting.
SRC
The
character
who was missed.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
LOCAL.ARROWHANDLED
IO
if set to !=0, you can do whatever you want with local.arrow
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Cancels the attack swing.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
X branch only. The trigger is fired before the trigger @(Skill)UseQuick for parrying is succesfull. By default a parried hit will reduce the damage by 100% and thus negating the hit and the following triggers (@Hit and so on).
There are two for changing the damage reduced:
Overwriting the Argn1 value in the @HitParry trigger.
By using the EFFECT property in the skill definition of the Parrying Skill, in this case the damage will be reduced by the EFFECT value:
- If only one values is defined (Example:EFFECT=75) the damage will always be reduced by 75% no matter skills.
- If one or more values are defined (Example: EFFECT=25,75) the damage will be reduced by 25% when the Parrying skill is near 0.0 and by 75% when the Parrying skill is near 100.0, that is damage reduction will be scaled according to the character parrying skill.
- If no values are defined, the default value of 100 will be used.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
that is attempting to parry the strike.
SRC
The
character
that did the strike.
ARGO
The
weapon
or shield used for parry, if any.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARNG1
IO
Percent of damage that will be reduced (default 100%).
ARNG2
IO
Damage type.
LOCAL.PARRYCHANCE
IO
The chance to parry the blow. The chance will be passed to the SkillUseQuick/UseQuick triggers.
LOCAL.PARRYSKILLID
IO
The skill used for parrying, this can be changed by setting the appropriate skill ID.
LOCAL.ITEMPARRYDAMAGECHANCE
IO
The chance that the parrying item will be damaged (default 100%).
LOCAL.DAMAGE
IO
The amount of damage (raw) before the parry reduction.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Completely blocks the damage as if the parry damage reduction was set to 100.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character is about to swing their weapon or fist using a combat skill.
More info on
How_Combat_Works
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
weapon
being used (can be nothing, if fists are used).
I
The
character
doing the hitting.
SRC
The
character
being hit.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The time, in tenths of a second, until the swing will complete.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the combat swing.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player attempts to commit a new house design.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
custom multi
being designed.
I
The
player
committing the design.
SRC
The
player
committing the design.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The total number of components in the current house design.
ARGN2
I
The total number of components in the house design being committed.
ARGN3
I
The revision number of the house design being committed.
LOCAL.FIXTURES.NEW
I
The total number of fixtures in the house design being committed.
LOCAL.FIXTURES.OLD
I
The total number of fixtures in the current house design.
LOCAL.MAXZ
I
The value of the top placed item
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the house design from being committed.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player exits house design mode.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
Customizable Multis|custom multi
being designed.
I
The
player
designing the multi.
SRC
The
player
designing the multi.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
Indicates whether or not the player is being forced out of design mode (e.g. due to logout)
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the player from leaving design mode, if ARGN1 is 0.

--- PAGE BREAK ---

Description
This trigger was removed and merged in
@RegenStat

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character clicks an item, just before the overhead message is displayed to the client.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
being clicked.
I
The
character
doing the clicking.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
LOCAL.CLICKMSGHUE
IO
The colour of the message.
LOCAL.CLICKMSGTEXT
IO
The message to display.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the message from being displayed.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character buys an item from a vendor. The trigger fires once for each item that is bought in the transaction.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
being bought.
ARGO
The
vendor
the item is being bought from.
I
The
character
buying the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The amount of the item being bought.
ARGN2
I
The cost of the item.
LOCAL.TOTALCOST
I
The total cost for the transaction.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from buying the item (blocks the entire transaction).

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character clicks an item, just before the overhead message is displayed to the client.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
being clicked.
I
The
character
doing the clicking.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents any hardcoded behaviour from taking place.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when tooltips for an item are about to be sent to a client. the
ADDCLILOC
function can be called on the
I
object to send custom tooltips to the client.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
whose tooltips are to be sent.
I
The
client
who is receiving tooltips.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents Sphere from sending its own tooltips.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character attempts to access the context menu on an item. The
ADDCONTEXTENTRY
function can be called on I to add custom menu entries to the menu.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
being accessed.
I
The
client
requesting the menu.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
1 on the first fire, 2 on the second. Set to a value other than 1 during the first call to have the trigger fire again after hardcoded menu entries have been added.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents hardcoded menu entries being added.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a client selects a context menu option for an item.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
displaying the menu.
I
The
character
who selected the option.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The ID of the menu option selected.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents any hardcoded action taking place.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character is responsible for an item being created, before the item is placed in the world.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
used for create the
item
.
ARGO
The
item
being created.
I
The
character
responsible for the item's creation.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

Help
Available languages
Missing languages
__FORGETOC__
Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character damages an item.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
taking damage.
I
The
character
responsible for the damage.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The amount of damage being applied.
ARGN2
I
The damage attributes.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being damaged.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character double-clicks an item.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
being double clicked.
I
The
character
doing the clicking.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents any hardcoded behaviour taking place.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character drops an item is dropped on to a character.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
being dropped.
ARGO
The
character
the item is being dropped on to.
I
The
character
dropping the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being dropped.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character drops an item on to the ground.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
being dropped.
I
The
character
dropping the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The decay time, in tenths of a second, that will be set on the item.
ARGS
I
The location that the item was dropped at.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being deleted if dropped on water.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character drops an item on to another item.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
being dropped.
ARGO
The
item
the item is being dropped on to.
I
The
character
dropping the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being dropped.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character drops an item inside another item (e.g. a backpack).
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
that is being dropped on to.
ARGO
The
item
being dropped on to the item.
I
The
character
dropping the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being dropped on to the item. If no CONT is set, item will drop on ground.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character equips an item.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
being equipped.
I
The
character
equipping the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Treats the item as failed to equip.
Note:
This trigger is not reliable for blocking the equipping of an item. Use the
@EquipTest
trigger instead which is designed for blocking the equip action.
Hint: As an example, use "cont=(<findlayer(21).uid>)" to put an item pack into the backpack if you wish to block the equip action

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character equips an item and Sphere is deciding whether or not the character is allowed to equip it.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
being equipped.
I
The
character
equipping the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being equipped.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character picks up an item from the ground.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
being picked up.
I
The
character
picking up the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The amount of the item being picked up.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being picked up.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character picks up an item from inside a container.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
being picked up.
I
The
character
picking up the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The amount of the item being picked up.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being picked up.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character picks up an item from inside a container.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
container
the item is being taken from.
ARGO
The
item
being taken from the container.
I
The
character
picking up the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being taken from the container.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character picks up an item from a pile of items.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
that was picked up from the stack.
ARGO
The stack of
items
that the item was taken from.
I
The
character
picking up the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being picked up.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character sells an item to a vendor. The trigger fires for each item that is sold in the transaction.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
being sold.
ARGO
The
vendor
the item is being sold to.
I
The
character
selling the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The amount of items sold.
ARGN2
I
The price of the items sold after vendermarkup.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from selling the item (blocks the entire transaction).

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger is fired when the character is smelting an item by a forge or by using the SMELT command.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The item being smelt.
SRC
The character smelting the item..
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
Mining skill of the character (adjusted value, base skill + stat bonuses).
ARGN2
I
The total amount of different resources the item being smelted has.(For example a mace is made of iron  ingots and logs, so the number of different resources is 2,  for t_ore item the values is always 1.
local.resource.
n
.ID
IO
The ID of the itemdef that will be created if the smelting check is succesfull, n starts at 0.
local.resource.
n
.amount
IO
The amount value that will set on that particular resource if the smelting check is succesfull, n starts at 0.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Fails the smelting attempt and block default smelting behaviour..

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character hits an item with a spell. The item may have been targeted directly or it may have been hit by an area-effect spell.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
being hit by the spell.
ARGO
The
item
used to cast the spell (e.g. a wand or scroll).
I
The
character
responsible for the spell.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The number of the spell that has hit the object.
ARGN2
IO
The strength of the spell.
ARGN3
IO
A multiplier for the spell's duration or effect.
Note:
Only used when a character is hit by a spell.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being affected by the spell.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character steps on an item. After being stepped on, this trigger will periodically fire until the character steps off the item.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
being stepped on.
I
The
character
stepping on the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
If 1, the character is standing still on the item.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being stepped on.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player cancels targeting with an item (ESC key).
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
that the target cursor originated from.
I
The
character
cancelling the target.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the cancellation message from being shown.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player targets a character with an item.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
that the target cursor originated from.
ARGO
The
character
that was targeted.
I
The
player
targeting a character.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents Sphere from processing the default target behaviour.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player targets the ground with an item.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
that the target cursor originated from.
I
The
player
targeting the ground.
Note:
The
TARGP
property on the player can be used to acquire the target coordinates.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
If a static item was targeted, the ID of the item.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents Sphere from processing the default target behaviour.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player targets an item with an item.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
that the target cursor originated from.
ARGO
The
item
that was targeted.
I
The
player
targeting the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents Sphere from processing the default target behaviour.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a client requests old-style tooltips for an item.
Fires on:
Clients
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
whose tooltip is being requested.
I
The
client
requesting the tooltip.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the tooltip from being shown.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character unequips an item.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
being unequipped.
I
The
character
who had the item equipped.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character is sent to or released from jail.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
being sent to or released from jail.
SRC
The
character
responsible for the jailing or releasing.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
Indicates if the character is being sent to jail (1 = sent to jail, 0 = released from jail)
ARGN2
I
The cell number the character is to be sent to.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from being jailed/released.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character's karma level is about to change.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
whose karma is changing.
SRC
The
character
whose karma is changing.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The amount of karma being added (can be negative).
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character's karma from being changed.
0
Applies changes to ARGN1.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player logs in to the server.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
player
who is logging in.
SRC
The
player
who is logging in.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
O
If set to 1, welcome messages won't be displayed to the player (i.e. server description, client count, last logged date)
ARGN2
IO
If set to 1, no messages will be displayed to the player (as above, but also includes guards notification)
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the player from logging in.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player logs out.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
player
who logged out.
SRC
The
player
who logged out.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The length of time that the character will linger in the world, in tenths of a second.
ARGN2
IO
If non-zero, the character will instantly log out.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled by this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character attempts to mount a rideable creature.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
creature
being mounted.
I
The
character
attempting to mount the creature.
SRC
The
character
attempting to mount the creature.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The itemID of the item containing the animation use when moounting.(Anim # is in tiledata of this item) [Sphere X]
NOTE: When mounting a pet you'll read a non sense random value in ARGN1 but you can replace it by an ITEMID to force anim
   EX: 03ea6 for Llama anim or 03e9f for gray horse anim. Yes 03ea6 is a ship part but in tiledata it link to anim 828
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from mounting the creature.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character's murder count (
KILLS
property) is about to decrease.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
whose murder count is changing.
SRC
The
character
whose murder count is changing.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The new murder count that will be set.
ARGN2
IO
The length of time until the murder count will next decay, in tenths of a second.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled by this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character's murder count (
KILLS
property) is about to increase.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
whose murder count is changing.
SRC
The
character
whose murder count is changing.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The new murder count that will be set.
ARGN2
IO
If non-zero, the character will be flagged as a criminal.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Notoriety Values
5
Return Values
Description
This trigger fires when a character's notoriety is being sent on a packet update (its fired a lot of times, keep it light and clean of code).
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
whose noto is changing.
SRC
The
character
retrieving this character's Notoriety.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The notoriety value (Limited from 1 to 7, other values are ignored).
ARGN2
IO
The color sent in the character's packet (what is seen in status bar, character's hover, etc).
Notes:
-
The default colors are listed above but you can set any color (note that the colors are not the same as for items/chars from hues.mul).
-
Modifying the argn1 value will stop default behaviours checks and make the function 'NotoGetFlag' to return this value.
Notoriety Values
These are the default Notoriety Values (also listed in sphere.ini).
Name
ID
Description
NotoGood
1
Blue character.
NotoGuildSame
2
Green character (Ally)
NotoNeutral
3
grey (can be attacked)
NotoCriminal
4
grey (criminal)
NotoGuildWar
5
orange (enemy guild)
NotoEvil
6
red
NotoInvul
7
yellow
Return Values
This trigger doesn't have return values, notoriety something that must always be sent.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an NPC is about to accept an item that another character is giving them.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
item
the NPC is accepting.
I
The
NPC
accepting the item.
SRC
The
character
giving the item away.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Returns the item to SRC.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger is fired when the NPC is about to select a
spell
to cast.
When assigning spells to a NPC make sure these spells does not have the SPELLFLAG_PLAYERONLY flag.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The current NPC's target.
I
The NPC caster.
SRC
The NPC caster.
REF1
The new target, this will override the target set on
ARGO
.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The spell being cast, this can be a spell not found in the NPC's spellbook.
ARGN2
O
If 1 the spell is being cast by a wand. (If the NPC is wielding a wand it has a 50% chance to cast the spell from the wand instead of the spellbook.
local.healthreshold
IO
This value determines at what health threshold (in percent) the NPC will successfully select a
spell
with the SPELLFLAG_HEAL flag. The value is taken from the
sphere.ini
property NPCHealThreshold and the default value is 30.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Interrupts the spell selection.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires periodically whilst an NPC is fighting.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
NPC
who is fighting.
SRC
The
character
the NPC is fighting with.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The distance between the NPC and its target.
ARGN2
IO
The NPC's motivation level to fight.
Note:
NPCs, excluding pets, with a motivation less than zero will flee from their target.
local.Skill
O
Force the NPC to stop current checks and start this skill.
local.Spell
O
Force to cast an specific spell in case LOCAL.SKILL is set to a SKF_MAGIC skill.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
0
Allows the NPC to fight, but skips making a decision to use a special action such as fire breathing or rock throwing.
1
Stops the NPC from taking any action.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an NPC attempts to move closer to or further away from another character.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
NPC
doing the following.
SRC
The
character
the NPC is trying to get closer to or further from.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
If non-zero, the NPC is attempting to flee from the target.
ARGN2
IO
The distance between the NPC and target that it is trying to achieve.
ARGN3
IO
If non-zero and the NPC is trying to move closer, then the NPC will move further away from the target if they are closer than the distance they were trying to achieve.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
0
Prevents any movement from taking place, and aborts further attempts to follow the target.
1
Prevents any movement from taking place, and allows the NPC to make further attempts to follow the target.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an NPC is making a decision to perform an AI action.
The revision notes for this trigger say "This trigger will fire only if EF_NPCAct_Triggers is set and EF_Minimize_Triggers is NOT set in the sphere.ini file...", however in more recent versions this trigger may be controlled by the NPC_AI_EXTRA setting.
AI-related trigger. If the situation is such that the NPC will do something due to it's AI - things like animals pooping the ground, vendors going off/on duty, (un)equipping a lightsource when it's dark, (un)equipping a weapon when fighting, stabler feeding animals or giving players food for their animals etc... this trigger will be fired.
On RETURN 0 the NPC will continue with what it wants to do, RETURN 1 will abort it.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
NPC
performing the action.
SRC
The
NPC
performing the action.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents any hardcoded AI action taking place.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
X branch only. This trigger is called each step an NPC does while wandering.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
NPC
performing the action.
SRC
The
NPC
performing the action.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
0 if it will continue to wander, 1 if randomly deciding to stop, 2 if deciding to stop because
after looking around it found something interesting.
ARGN2
IO
1 if it's returning to home, 0 otherwise.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
stops decisions for this step, so it will not return to home, do another step or stop wandering (again, for this step).

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an NPC first hears some speech from another character.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
NPC
hearing the speech.
SRC
The
character
speaking to the NPC.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the NPC from hearing the character.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an NPC hears something that they don't understand. This means that the speech was not a command, nor was it handled by a speech trigger.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
NPC
being spoken to.
SRC
The
character
doing the speaking.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the NPC from considering to end the conversation.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an NPC looks at another character.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
NPC
looking at a character.
SRC
The
character
being looked at.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
0
Prevents the NPC from seeing the character, allows it to look at other characters.
1
Prevents the NPC from seeing the character, does not allow it to look at other characters.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an NPC looks at an item.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
item
being looked at.
I
The
NPC
looking at the item.
SRC
The
NPC
looking at the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The distance between the NPC and the item.
ARGN2
IO
How much the NPC wants the item, as a percentage (0 - 100).
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
0
Prevents the NPC from seeing the item, allows it to look at other items instead.
1
Prevents the NPC from seeing the item, does not allow it to look at other items.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an NPC gets lost and is about to be teleported back to its
HOME
location. The LOSTNPCTELEPORT setting in Sphere.ini controls how far an NPC can wander from its home location before it is considered to be lost.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
NPC
who has gotten lost.
SRC
The
NPC
who has gotten lost.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The distance between the NPC and its home location.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the NPC from being teleported back home.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an NPC is about to refuse an item that another character is giving them.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
item
the NPC is refusing.
I
The
NPC
refusing the item.
SRC
The
character
giving the item away.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Places the item into the NPC's backpack.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an NPC is having its stock replenished.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
NPC
being restocked.
SRC
The
NPC
being restocked.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an NPC first takes notice of a nearby player.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
NPC
seeing the player.
SRC
The
player
being seen.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the NPC from remembering they saw the player.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an NPC sees an item that they want to take.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
item
that the NPC wants.
I
The
NPC
seeing the item.
SRC
The
NPC
seeing the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the NPC from reacting to the item.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an NPC is about to perform a special action. This can be used to script new actions or to intercept the following actions:
Fire elementals dropping fire.
Spiders dropping spider webs.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
NPC
performing the action.
SRC
The
NPC
performing the action.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the NPC from performing its hardcoded special action.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character pays to train, buy something, or hire them.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
paying for the service.
SRC
The
character
receiving the gold..
ARGO
The stack of gold used to pay (if any) (ie training).
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
Gold to pay.
ARGN2
IO
Payment type ( 0 = training, 1 = buying something, 2 = hiring the NPC)
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Stops the payment from occurring.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character is stepped on by another character.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
being stepped on.
SRC
The
character
doing the stepping.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The amount of stamina needed to step on to the character.
ARGN2
O
Setting it to 1 allow NPCs to pass over another NPCs, 0 reject the movement.
ARGN3
IO
Maximum stamina requirement (default 1 = require maximum stamina)(X-Only)
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from being stepped on.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an NPC leaves its owner for one of the following reasons:
The owner harmed the NPC.
The NPC became too hungry.
The owner hasn't paid the NPC's wages.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
NPC
who is deserting their owner.
SRC
The
owner
of the NPC.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the NPC from deserting its master.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player's paperdoll profile is accessed by another player.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
player
whose profile is being accessed.
SRC
The
player
accessing the profile.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the player's profile from being displayed.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an NPC is given an item from another character, before they have decided whether or not to accept it.
Fires on:
NPCs
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
item
the NPC is being given.
I
The
NPC
receiving the item.
SRC
The
character
giving the item away.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Returns the item to SRC.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Aditional Notes
5
Return Values
Description
This trigger fires when a character is going to regenerate any stat (Hits,Mana,Stam or Food).
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
whose strength, dexterity or intelligence is being changed.
SRC
The
character
whose strength, dexterity or intelligence is being changed.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
local.StatID
I/O
The stat being changed.
Value
Stat
0
Hits
1
Mana
2
Stam
3
Food
local.Value
I/O
The amount of points being regenerated (or decreased in food's case).
local.StatLimit
I/O
by default=<MaxStat>, allow this stat to pass the limit when regenerating, or limit it lower.
Aditional Notes
local.Value: It can be set to negative values, 0 will stop any default action like return 1. By default its set to RegenValStatID (ie: RegenValHits)
Local.StatLimit: Stats over this value will go down in each tick until they reach their limit. This does not work with food as food shouldn't ignore its limit (0).
RegenStat is checked before this trigger but it can be changed inside so the next time the trigger will be fired will correspond to this value, setting it to high values is the only way to simulate a regeneration stop.
You can see your current points in the current stat using <local.StatLimit> as it retrieve (before you modify it) the current stat value.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the process to ocur.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character enters a region.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
region
being entered.
I
The
character
entering the region.
SRC
The
character
entering the region.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from entering the region.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character exits a region.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
region
being exited.
I
The
character
leaving the region.
SRC
The
character
leaving the region.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from leaving the region.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a resource is being gathered. (Equivalent trigger
@ResourceFound
on
Regions
)
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
worldgem bit
that represents the resource in the world.
I
The
region resource
being gathered.
SRC
The
character
gathering the resource.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Sets the amount of resource to zero, preventing it from being gathered.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player renames another character. The trigger also fires at character creation when the player's name is set.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
character
being renamed.
I
The
player
renaming the character.
SRC
The
player
renaming the character.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGS
I
The name that is being set.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Disallows the new name.
Note:
During character creation, this will force the character to be named using the NAMES_HUMANMALE or NAMES_HUMANFEMALE
name pool
.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character is about to be resurrected.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
being resurrected.
SRC
The
character
being resurrected.
ARGO
The corpse (If any is near) (Readable only).
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
Hit point value when resurrected.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Stops resurrection from occurring.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character witnesses a crime taking place.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
victim
of the crime.
I
The
character
witnessing the crime.
SRC
The
character
performing the criminal action.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
If ARGN1 this character will add MEMORY_SAWCRIME to SRC's memory, so SRC will be flagged as criminal for this character.
Return Values
There are no return values related to this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Notes
5
Return Values
Description
This trigger fires when character is going to see a hidden character so it can control whether to see it or not.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
viewing.
SRC
The
character
hidden.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
0 will remain invisible for the viewer/ 1 the viewer will see this character grayed (like an Admin sees an invisible GM).
Notes
This trigger is being fired a lot, keep it clean.
Return Values
The following return values are explicitly defined for this trigger:
This trigger doesn't have return values, characters must be send always.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character aborts a skill.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
aborting the skill.
SRC
The
character
aborting the skill.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number being aborted.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Bypasses normal skill fail behaviour.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character's skill level is about to change.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
whose skill level is changing.
SRC
The
character
whose skill level is changing.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The number of the skill being changed.
ARGN2
IO
The new value of the skill.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the skill level being changed.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character fails at an attempt to use a skill.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
failing the skill attenot.
SRC
The
character
failing the skill attempt.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number being failed.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Bypasses normal skill fail behaviour.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character receives an opportunity to gain in skill.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
trying to gain skill.
SRC
The
character
trying to gain skill.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number being gained.
ARGN2
IO
The chance to gain skill. (1 - 1000)
ARGN3
IO
The maximum skill level that the character can gain to.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from gaining skill.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character successfully crafts an item.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ACT
The
item
that was crafted.
ARGO
The
item
that the item was crafted from.
I
The
character
who crafted the item.
SRC
The
character
who crafted the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The amount of skill used to craft the item.
ARGN2
I
The quality of the crafted item.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
0
Proceeds with rewarding experience (if enabled) and placing the crafting item into the character's backpack, but does not play any potion sounds or display quality messages.
1
Prevents any further action taking place for the skill. The crafted item will also be deleted.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a
skill menu
is displayed to a player. Note that the trigger only fires when Sphere attempts to display the menu through hardcoded behaviour, using the
SKILLMENU
command will not cause this trigger to fire.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
player
who the menu is being shown to.
SRC
The
player
who the menu is being shown to.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGS
I
The skillmenu's defname. This is expected to be one of the following:
sm_alchemy
sm_blacksmith
sm_bolts
sm_bowcraft
sm_carpentry
sm_cartography
sm_inscription
sm_polymorph
sm_summon
sm_tailor_cloth
sm_tailor_leather
sm_tinker
BIG change on X
I
https://github.com/Sphereserver/Source-X/blob/3b2c4d9c6dec393eaea725770bb86237e2a85074/Changelog.txt#L3408
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the skillmenu from being displayed.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character attempts to start using a skill, before any hardcoded behaviour occurs.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
trying to use the skill.
SRC
The
character
trying to use the skill.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number being started.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from using the skill.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character selects to use a skill from their skill menu.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
selecting the skill.
SRC
The
character
selecting the skill.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number that was selected.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from using the skill.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character has begun an attempt to use a skill.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
starting to use the skill.
SRC
The
character
starting to use the skill.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number that has started.
LOCAL.CRAFTAMOUNT
IO
For crafting skills, the amount of the item that will be created.
LOCAL.CRAFTITEMDEF
IO
For crafting skills, the item
BASEID
that will be created.
LOCAL.CRAFTSTROKECNT
IO
For crafting skills, the number of 'strokes' until the skill completes.
LOCAL.GATHERSTROKECNT
IO
For gathering skills, the number of 'strokes' until the skill completes.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Aborts the skill attempt.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character succeeds at an attempt to use a skill.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
succeeding the skill attempt.
SRC
The
character
succeeding the skill attempt.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number that has succeeded.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Aborts the skill attempt.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character attempts to quickly use a skill without changing their
ACTION
property.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
quickly using the skill.
SRC
The
character
quickly using the skill.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number that is being used.
ARGN2
IO
The difficulty of the skill attempt.
ARGN3
IO
If 0 then the skill failed, if 1 then it succeeded.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
0
Fails the skill use without awarding skill gain.
1
Succeeds the skill use without awarding skill gain.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger is used in character definitions (a related
@Wait
exists for skill definitions). This trigger is called whenever Sphere wants to check if a character must wait before starting a skill. Normally this will be when a skill is selected from the skill menu (before
@Select
), but also when snooping a container or using a musical instrument.
Fires on:
Characters
References
The following object references are explicitly available for this trigger
(this needs to be tested/validated)
:
Name
Description
I
The
character
selecting the skill.
SRC
The
character
selecting the skill.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behavior
(this needs to be tested/validated)
:
Argument
In/Out
Description
ARGN1
?
The skill the character is attempting
ARGN2
?
the skill that is currently being used
Return Values
The following return values are explicitly defined for this trigger
(this needs to be tested/validated)
:
Return Value
Description
0
The character can start the other skill (bypasses default checks)
1
The character must wait (bypasses default checks)
2
Perform default checks

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player opens a spellbook.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
spellbook
being opened.
I
The
player
opening the spellbook.
SRC
The
player
opening the spellbook.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the spellbook from being opened.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character begins to cast a spell.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
item
being used to cast the spell (e.g. a wand or scroll).
I
The
character
casting the spell.
SRC
The
character
casting the spell.
ACT
The target of the spell.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The spell number being cast.
ARGN2
IO
The difficulty of the spell.
ARGN3
IO
The length of time it will take to cast the spell, in tenths of a second.
local.WOP
IO
Enables/Disables the WOP for this character and spell.
local.WOPColor
IO
Sets the color of WOP.
local.WOPFont
IO
Sets the font of WOP.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the spell from being cast.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an object is hit by the effects of a spell. The object may have been targeted directly or it may have been hit by an area-effect spell.
Fires on:
Characters
Items
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
item
used to cast the spell (e.g. a wand or scroll).
I
The
character
or
item
being hit by the spell.
SRC
The
character
responsible for the spell.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The number of the spell that has hit the object.
ARGN2
IO
The strength of the spell.
ARGN3
IO
A multiplier for the spell's duration or effect.
Note:
Only used when a character is hit by a spell.
LOCAL.DamageType
IO
Can be used to override the damage flags for spells that have SPELLFLAG_DAMAGE.  The value can be a bitmask of dam_* flags.  For example, to change the s_magic_arrow SPELL definition to cause physical and magic damage:
ON=@Effect
  LOCAL.DAMAGETYPE=(<DEF.dam_physical>|<DEF.dam_magic>)
LOCAL.AreaRadius
IO
Can be used to override the default radius (which is 5) for spells that have SPELLFLAG_AREA.
Local.CreateObject1
IO
Changes the ID of the effect for this spell, IE: Local.CreateObject1=0eed in FlameStrike spell will change the Fire Column for a Gold Coin.
local.EffectColor
IO
Changes the color of the effect for this spell.
local.EffectRender
IO
Changes the Render Mode for this spell's effect.
local.EffectExplode
IO
Sets wether the effect should explode or not after reaching the target.
local.Resist
IO
Changes the default behavior on Magic Resistance (being local.resist 100 the same as resisting 100%. [Effect = Effect * Local.resist/100])
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
0
For scripted spells, prevents any hardcoded behaviour from taking place.
1
Prevents the object from being affected by the spell.
Note:
For the recall and gate travel spells, returning 0 prevents the spell from proceeding and returning 1 has no effect.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a spell memory item is equipped on the character.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The target of the spell.
SRC
The caster of the spell.
ARGO
The spell item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The spell number.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
0
Let default checks happens.
1
Blocks any action and stops everything, also deletes the memory (Blocking any changes, this will cause also the effect to do not have duration).

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a spell memory item is going to be removed from the character.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The target of the spell.
SRC
The caster of the spell.
ARGO
The spell item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The spell number.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
0
Remove the spell memory item but don't execute the default spell behaviour when the spell item is removed.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character is under effect of a periodic spell (like Poison spell).
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The object that is going to be affected.
SRC
The object that is going to be affected.
ARGO
The spell memory.(Argo.link holds the caster UID)
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
Spell Id
ARGN2
IO
Spell Level
LOCAL.CHARGES
IO
How many charges are left on the spell memory, this will be automatically decreased by 1 at the end of the method execution. Default value is 1.
LOCAL.DELAY
IO
How many seconds until the next spell effect tick. Default value is 5 seconds.
LOCAL.EFFECT
IO
The effect value of the spell, harmful or beneficial (if SPELLFLAG_HEAL is enabled).
LOCAL.DAMAGETYPE
IO
The damage type of the spell, if you are making a custom spell you must set a value otherwise the spell will not cause damage.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Destroy the spell memory and block the spell execution.
0
If the spell has the flag SPELLFLAG_SCRIPTED blocks the spell execution

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character fails to cast a spell.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
item
used to cast the spell (e.g. a wand or scroll).
I
The
character
failing to cast the spell.
SRC
The
character
failing to cast the spell.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The spell that was being cast.
The following arguments are use only in the X version:
Argument
In/Out
Description
ARGN2
IO
The mana loss if the spell is failed.
local.tithingloss
IO
The tithing points loss if the spell is failed.
While both are writeable, they only works if  ManaLossFail or ReagentLossFail ( also for tithing points) are enabled in the sphere.ini
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents normal fail behaviours (fail message, fizzle effect, reagent loss).

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character selects to cast a spell. It fires multiple times during the different stages of a spell being cast.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The source of the spell. Could be the
item
used to cast the spell (e.g. a wand or scroll) or the
character
casting the spell.
I
The
character
casting the spell.
SRC
The
character
casting the spell.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The spell being cast.
ARGN2
IO
The amount of mana needed to cast the spell.
ARGN3
I
Flags representing what stage of the casting process the trigger is being used at.
Flag
Meaning
01
Just a test (no reagents or mana will be consumed)
02
Display fail message if unable to cast
Spell Casting Stage
Expected Flags
Spell selected for casting
01
Spell is about to start casting
03
Spell is about to finish casting
03
Spell casting finished successfully
02
Spell casting finished unsuccessfully
00
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the spell from being cast.
6
Allows the spell to be cast.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character successfully casts a spell.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The source of the spell. Could be the
item
used to cast the spell (e.g. a wand or scroll) or the
character
casting the spell.
I
The
character
casting the spell.
SRC
The
character
casting the spell.
ACT
The target of the spell, if any.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The spell that was cast.
ARGN2
IO
The strength of the spell.
LOCAL.CREATEOBJECT1
O
For field spells, overrides the item
BASEID
to use for the east-west direction.
For summon spells, overrides the character
BASEID
to summon.
LOCAL.CREATEOBJECT2
O
For field spells, overrides the item
BASEID
to use for the north-south direction.
LOCAL.FIELDGAUGE
O
For field spells, overrides the default gauge of the field (1).
LOCAL.FIELDWIDTH
O
For field spells, overrides the default width of the field (7).
LOCAL.EFFECTCOLOR
O
For field spells, overrides the color of the fields.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Aborts casting the spell.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character cancel the spell target.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
who cancel the spell target.
SRC
The
character
who cancel the spell target.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The spell that was cancel.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character's strength, dexterity, intelligence, food, maxhits, maxmana or maxstam is changed.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
whose strength, dexterity or intelligence is being changed.
SRC
The
character
whose strength, dexterity or intelligence is being changed.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
In
The stat being changed.
Value
Stat
0
Strength
1
Intelligence
2
Dexterity
3
Food
4
MaxHits
5
MaxMana
6
MaxStam
7
Maxfood
8
Modstr
9
Modint
10
Moddex
ARGN2
In
The current stat value.
ARGN3
I/O
The new stat value.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character's stat from being changed, even if argn3 has been changed.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character moves whilst hidden. Any one of the following flags being set on the character will cause the trigger to be fired:
statf_invisible
statf_hidden
statf_sleeping
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
who moved.
SRC
The
character
who moved.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
If non-zero, the character will be revealed. Replaced by STEPSTEALTH property since 27/08/2015
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled by this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a Gargoyle player is about to fly, or to land.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
performing the action.
SRC
The
character
performing the action.
Arguments
The are no arguments for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the gargoyle to proceed with the action.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a client requests old-style tooltips for an object.
Fires on:
Characters
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
or
item
whose tooltip is being requested.
SRC
The
client
requesting the tooltip.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the tooltip from being shown.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when two players have accepted a trade agreement. The trigger will be fired on both characters.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
player
accepting the trade.
I
The
player
accepting the trade.
REF
1 to
REF
<ARGN1>
The
items
that the player is receiving.
SRC
The
player
they are trading with.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The number of items that the player is receiving.
ARGN2
I
The number of items that the other player is receiving.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the transaction to take place.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when one player is closing a trade with another player. The trigger will be fired on both characters.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
SRC
The
player
closing the Trade Window.
ARGO
The other
player
.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
This trigger doesn't have return values.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when one player is going to begin a trade with another player. The trigger will be fired on both characters.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
items
that the player is offering.
I
The
player
beggining the trade.
SRC
The
player
they try to trading with.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the trade to begin.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player submits a bug report.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
player
submitting the report.
SRC
The
player
submitting the report.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The report category code. Expected codes are:
Code
Meaning
1
Environment
2
Wearables
3
Combat
4
UI
5
Crash
6
Stuck
7
Animations
8
Performance
9
NPCs
10
Creatures
11
Pets
12
Housing
13
Lost Item
14
Exploit
15
Other
ARGS
I
The report text.
LOCAL.LANG
I
The language the report was submitted in.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player presses the Chat button the paperdoll.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
player
accessing Chat.
SRC
The
player
accessing Chat.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the player from accessing Chat.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player sends an extended command packet (packet 0x12).
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
player
sending the command.
SRC
The
player
sending the command.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The command type. Known commands are:
Command
Description
0x24
Use Skill macro
0x27
Cast spell from book
0x2F
Auto targeting macro
0x43
Open Spellbook macro
0x56
Cast Spell macro
0x88
Open Door macro
0x6B
God Client command
0xC7
Bow or Salute macro
0xF4
Invoke Virtue macro
ARGS
IO
The command text.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents Sphere from processing the command.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player exceeds the walking limit defined by the WALKBUFFER and WALKREGEN settings in Sphere.ini. This could indicate that the player is using a cheat to run faster than they should (i.e. speedhacking) or it could be a result of a poor connection between the server and client.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
player
exceeding the walk limit.
SRC
The
player
exceeding the walk limit.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Allows the player to continue moving without being restricted.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player presses on the Guild button on their paperdoll.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
player
pressing the button.
SRC
The
player
pressing the button.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player presses a button on a Kingdom Reborn toolbar.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
player
pressing the button.
SRC
The
player
pressing the button.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The button command type. Known values are:
Type
Description
1
Cast spell
2
Weapon ability
3
Use skill
4
Use item
5
Scroll
ARGN2
I
The button's command parameter.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents Sphere from processing the command.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player has a mail bag dropped on to them by another character.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
who the mail bag was dropped on.
SRC
The
player
dropping the mail bag.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character being notified about the action.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player clicks on the quest arrow that is displayed using the
ARROWQUEST
command.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
player
clicking the quest arrow.
SRC
The
player
clicking the quest arrow.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The mouse button that was used. (0 = Left Click, 1 = Right Click)
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player clicks on the Quest button on their paperdoll.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
player
pressing the button.
SRC
The
player
pressing the button.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a skill update is sent to a client. This normally fires when the player accesses their skill menu, or when they receive a skill gain. It can also fire when the
INFO
command is used.
Fires on:
Clients
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
client
receiving the skill update.
SRC
The
character
whose skill(s) they are receiving.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number they are receiving an update for. (-1 = All skills)
ARGN2
I
If 1, then the skills update is being sent due to the
INFO
command being used.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the skills update from being sent.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player attempts to use a special move.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
player
using the special move.
SRC
The
player
using the special move.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The special move being used.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a status update is sent to a player.
Fires on:
Clients
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
client
receiving the status update.
SRC
The
character
whose status they are receiving.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN3
I
If 1, then the client requested the update (i.e. opened their status window)
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the status update from being sent.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a client attempts to access the virtue dialog for a character, or double clicks a virtue icon on the dialog.
Fires on:
Clients
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
character
whose virtue dialog is being requested.
I
The
client
attempting to access or use the virtue dialog.
SRC
The
client
attempting to access or use the virtue dialog.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The action that the client is attempting. Known values are:
Action
Description
1
Requesting
ARGO
's virtue dialog.
105
Compassion button double clicked.
106
Honesty button double clicked.
107
Honoe button double clicked.
108
Humility button double clicked.
109
Justice button double clicked.
110
Sacrifice button double clicked.
111
Spirituality button double clicked.
112
Virtue button double clicked.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player attempts to invoke a virtue by using a macro.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
player
invoking the virtue.
I
The
player
invoking the virtue.
SRC
The
player
invoking the virtue.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The virtue being invoked. Known values are:
Value
Description
1
Honor
2
Sacrifice
3
Valor
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player attempts to switch between war and peace mode.
Fires on:
Players
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
player
changing between war and peace mode.
SRC
The
player
changing between war and peace mode.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
If 0, the player is entering peace mode.
If 1, the player is entering war mode.
ARGN2
I
If 1 will trigger skill fail for the current skill.
ARGN3
I
Setting it to 1 will force a attacker's cleanup.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the player from changing to the requested mode.

--- PAGE BREAK ---

Syntax:
ADDCLILOC <cliloc id>, [arguments]
Clilocs are used to build the tool tips, there are many cliloc ids most of which you are not able to customize.
There are however some that you may, some of which (at least) are listed below.
The color of any
customizable
cliloc text may be changed by using html defs listed in sphere_defs.scp
1062028 //Condition: [custom arguement]
1062613 //Colored Text with ""
1070722 //[custom arguement]
1071302 //Donator: [custom arguement]
1071340 //Note: [custom arguement]
1071345 //Skill: [custom arguement]
1071346 //Duration: [custom arguement] "minutes"
1071518 //Current Setting: [custom arguement]
1072304 //Owned by: [custom arguement]
1074784 //Value: [custom arguement]
1075611 //Time left: [custom arguement] seconds
1077467 //add !
1078457 //[custom arguement] Difficulty: Too Challenging
1078458 //[custom arguement] Difficulty: Very Challenging
1078459 //[custom arguement] Difficulty: Challenging
1078460 //[custom arguement] Difficulty: Optimal
1078461 //[custom arguement] Difficulty: Easy
1078462 //[custom arguement] Difficulty: Very Easy
1078463 //[custom arguement] Difficulty: Too Easy
1078512 //Skill: [custom arguement]
1078597 //Requires: [custom arguement]
1080155 //[custom arguement] pts
1080166 //Use: [custom arguement]
1080337 //Ability: [custom arguement]
1094805 //Faction Rank: [custom arguement]
1113212 //Duration: [custom arguement] minutes
1113218 //Cooldown: [custom arguement] minutes
1113943 //Cooldown: [custom arguement] hours
1114057 //[custom arguement]
1114778 //[custom arguement]
1114779 //[custom arguement]
1115719 //armor points: [custom arguement]
1115880 //Host: [custom arguement]
1115881 //Arena: [custom arguement]
1116466 //amount: [custom arguement]
1116696 //Reward: [custom arguement]
1116697 //Reward: [custom arguement]
1116698 //Reward: [custom arguement]
1116699 //Reward: [custom arguement]
1116700 //Reward: [custom arguement]
1149571 //Owner: [custom arguement]
1149572 //Name: the [custom arguement]
1149574 //Location: [custom arguement]
1149847 //Condition: [custom arguement]
1149934 // add % at the end
1150301 to 1150310 //add [ ] around the entry
1150312 // add " " around the entry
1151396 //Type: [custom arguement]
1151398 //Type: [custom arguement]
1151400 //Target: [custom arguement]
1151763 //From: [custom arguement]
1151764 //To: [custom arguement]

--- PAGE BREAK ---

AddContextEntry takes 2 to 4 arguments separated by a comma:
SRC.AddContextEntry EntryTag,TextID,Flags,Color
EntryTag
the number to return as ARGN by @(item)ContextMenuSelect. Make it unique.
EntryTags from 0 to 100 are reserved by Sphere for internal use, so do not use those.
TextID
CLILOCed name of the button. The number from cliloc.[your_localization]
the legal range is between 3,000,000 and 3,032,767 (or 0 and 32,767... in which case, 3000000 is added for you.)
Flags
01 - locked (will be grayed out)
02 - consecutive entries with this flag set will be summarized under a golden arrow
020 - can be colored
Color
applied only if Flags & 020
any hue value can be specified

--- PAGE BREAK ---

The layers are defined in the sphere_defs.scp file.
Contents
1
Paperdoll
2
Others
3
Spells
4
Flags
Paperdoll
Layer ID
Default Layer Defname
Description
1
layer_hand1
2
layer_hand2
3
layer_shoes
4
layer_pants
bone legs + pants
5
layer_shirt
6
layer_helm
7
layer_gloves
8
layer_ring
9
layer_talisman
talisman (se and ml)
10
layer_collar
gorget or necklace
11
layer_hair
12
layer_half_apron
13
layer_chest
armor chest
14
layer_wrist
watch
15
layer_light
a itemid_light_src equip item can be put here
16
layer_beard
17
layer_tunic
jester suit or full apron
18
layer_ears
earrings
19
layer_arms
armor
20
layer_cape
cape
21
layer_pack
only used by itemid_backpack
22
layer_robe
robe over all
23
layer_skirt
skirt or kilt
24
layer_legs
plate legs
Others
these are not part of the paper doll (but get sent to the client)
Layer ID
Default Layer Defname
Description
25
layer_horse
ride this object. (horse objects are strange?)
26
layer_vendor_stock
the stuff the vendor will restock and sell to the players
27
layer_vendor_extra
the stuff the vendor will resell to players but is not restocked. (bought from players)
28
layer_vendor_buys
the stuff the vendor can buy from players but does not stock
29
layer_bankbox
contents of my bank box
internally used layers - don't bother sending these to client.
30
layer_special
can be multiple of these. memories
31
layer_dragging
Spells
32
layer_spell_stats
stats effecting spell. these cancel each other out
33
layer_spell_reactive
34
layer_spell_night_sight
35
layer_spell_protection
36
layer_spell_incognito
37
layer_spell_magic_reflect
38
layer_spell_paralyze
or turned to stone
39
layer_spell_invis
40
layer_spell_polymorph
41
layer_spell_summon
magical summoned creature
Flags
42
layer_flag_poison
43
layer_flag_criminal
criminal or murderer ?
44
layer_flag_potion
some magic type effect done by a potion. (they cannot be dispelled)
45
layer_flag_spiritspeak
46
layer_flag_wool
regrowing wool
47
layer_flag_drunk
booze effect
48
layer_flag_clientlinger
49
layer_flag_hallucination
shrooms etc
50
layer_flag_potionused
track the time till we can use a potion again
51
layer_flag_stuck
in a trap or web
52
layer_flag_murders
how many murders do we have ? and decay timer
53
layer_flag_bandage
bandages go here for healing

--- PAGE BREAK ---

Speed formulas that were used in Sphere.
All variables are Integer and numbers after point,
truncated
to nearest INT.
Formulas EXAMPLES CURRENTLY UNCOMPLETED & UNTESTED!
09-05-2015
ibs = 50;
iss = Char.IncreaseSwingSpeed;

if (Weapon) {
  ibs = Weapon.TAG.OVERRIDE.SPEED;
  
  if (ibs <= 0) {
    ibs = MAX(0, Weapon.SPEED);
  }
}

iss = MAX(1, ibs * (100 + iss) / 100);
iss = (iSpeedScaleFactor / (DEX + 100) * iss) - 2;
swingSpeed = (MAX(5, iss) * 10) / 4;
Older
Coming soon...

--- PAGE BREAK ---

Description
X branch only.
This property is a bitmask, like the CAN property, and stores the
CAN
flags to be dynamically switched on or off from the base CAN property.
When retrieving the CAN property, now it is first XORed with CANMASK (the return value will be CAN ^ CANMASK), so in other words:
If a flag set in the CANMASK is also set in CAN, the flag is ignored;
If a flag set in the CANMASK isn't set in CAN, the flag is considered as set.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item is bought from a vendor. The trigger fires on each item that is bought in the transaction.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
vendor
the item is being bought from.
I
The
item
being bought.
SRC
The
character
buying the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The amount of the item being bought.
ARGN2
I
The final cost of the item (amount * value).
LOCAL.TOTALCOST
I
The total cost for the whole transaction ( the sum of the final prizes of all items ).
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from buying the item (blocks the entire transaction).

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
5
Notes
Description
This trigger fires when an item receives damage.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
item
taking damage.
SRC
The
character
responsible for the damage, in the case of a weapon, it's the
character
that receive the hit.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The amount of damage being applied.
ARGN2
I
The damage attributes.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being damaged.
Notes
Damage function in items doesn't mean the amount of hitpoints receiving but a chance to receive 1 point of damage, so by default Sphere is using this formula to calc the chace of receive damage:
local.success = <eval <MaxHits>*16>
if (<r<local.success>> > damage)
    return 1// and block the damage
endif
So if a random number between 1 and MaxHits*16 is higher than the damage dealt, there's no damage.
In a PickAxe with 45 Hits it will mean that a number higher than 720 (45*16) have to be given to force one point of damage.
Here's a damage formula to force damage:
damage=<eval <maxhits>*16>,<src>,dam_physical

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item is dropped on to a character.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
character
the item is being dropped on to.
I
The
item
being dropped.
SRC
The
character
dropping the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being dropped.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item is dropped on to the ground.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
item
being dropped.
SRC
The
character
dropping the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The decay time that will be set on the item.
ARGS
I
The location that the item was dropped at.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being deleted if dropped on water.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item is dropped on to another item.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
item
the item is being dropped on to.
I
The
item
being dropped.
SRC
The
character
dropping the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being dropped.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item has an item dropped on to it. For example, when an item is placed inside a backpack this trigger will fire on the backpack.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
item
being dropped on to the item.
I
The
item
that is being dropped on to.
SRC
The
character
dropping the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being dropped on to the item. If no CONT is set, item will drop on ground

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item is dropped on to a character.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
character
trading with you.
I
The
item
being dropped.
SRC
The
character
dropping the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being dropped on the trade window.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item is equipped.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
item
being equipped.
SRC
The
character
equipping the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Treats the item as failed to equip.
Note:
This trigger is not reliable for blocking the equipping of an item. Use the
@EquipTest
trigger instead which is designed for blocking the equip action.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item is being equipped and Sphere is deciding whether or not the character is allowed to equip it.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
item
being equipped.
SRC
The
character
equipping the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being equipped.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
X branch only. This trigger is called when the player enters on design mode in a t_custom_multi multi.
Fires on:
Multis
References
The following object references are explicitly available for this trigger:
Name
Description
I
The multi about to design.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
If set to 1 Redeeds all addons on the multi. (Default = 1)
ARGN2
IO
If set to 1 Transfer all Locked Items and Secured containers to the Moving Crate (default = 0)
ARGN3
IO
If set to 1 Ejects from the house all chars inside the house excepting the player entering in design mode, if set to 2 Ejects everyone from the house, if set to 0 doesn't eject anyone.
All chars ejected will be moved to the House sign.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Forces the char to exit Customize mode.
WARNING: Forcing the char to exit here and setting argn1=0 in @HouseDesignExit will make it enter in customize mode, exit, enter... infinitelly, hence crashing the server with an infinite loop.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
X branch only. This trigger fires when an item is about to commit when using house designer.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
item
being commited.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
local.id
I
ID of the item
local.p.x
I
The x location of the item
local.p.y
I
The y location of the item
local.p.z
I
The z location of the item
local.visible
I
0 or 1 (non-visible items are things like doors and signs) return false will remove this item from the commit. If not return false a local.MaxZ will check the P.Z value of the item and update it if it's higher than the old one.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being commited.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item is picked up from the ground.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
item
being picked up.
SRC
The
character
picking up the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The amount of the item being picked up.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being picked up.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item is picked up from inside a container.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
item
being picked up.
SRC
The
character
picking up the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The amount of the item being picked up.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being picked up.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item is taken from inside a container.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
item
being taken from the container.
I
The
container
the item is being taken from.
SRC
The
character
picking up the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being taken from the container.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item is picked up from a pile of items.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The stack of
items
that the item was taken from.
I
The
item
that was picked up from the stack.
SRC
The
character
picking up the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item from being picked up.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a multi is about to redeed. Valid for t_multi, t_ship, t_multi_custom and t_addon.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The deed
I
The multi
SRC
Player doing the redeed (If Any). When the multi is being removed there is no SRC (also when an Addon is being redeeded from internal functions).
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
ID of the deed (Default=i_deed)
ARGN2
I
(Default = 1). If set to 1 all items will be moved to the Moving Crate (and Addons redeeded).
ARGN3
I
If set to 1 the Moving Crate will be transfered to Owner's Bank (if there is any).
Note: the crate is moved to the OWNER's bank, not SRC.
If argn2 = 0 then argn3 will be not used regardless of the value it has.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the deed from being created, but will not block the code from argn2 and argn3

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item is sold to a vendor. The trigger fires on each item that is sold in the transaction.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
vendor
the item is being sold to.
I
The
item
being sold.
SRC
The
character
selling the item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The amount of items sold.
ARGN2
I
The price of the items sold after vendermarkup.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from selling the item (blocks the entire transaction).

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger is fired when an item is being smelt nearby a forge or by using the SMELT command.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The item being smelt.
SRC
The character smelting the item..
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
Mining skill of the character (adjusted value, base skill + stat bonuses).
ARGN2
I
The total amount of different resources the item being smelted has.(For example a mace is made of iron  ingots and logs, so the number of different resources is 2,  for t_ore item the values is always 1.
local.resource.
n
.ID
IO
The ID of the itemdef that will be created if the smelting check is succesfull, n starts at 0.
local.resource.
n
.amount
IO
The amount value that will set on that particular resource if the smelting check is succesfull, n starts at 0.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Fails the smelting attempt and block default smelting behaviour..

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item or region is stepped on by a character. When an item is stepped, this trigger will periodically fire until the character steps off the item. For regions, the trigger only fires when the character takes a step.
Fires on:
Items
Regions
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
item
or
region
being stepped on.
SRC
The
character
stepping on the item or region.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
If 1, the character is standing still on the item.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the item or region from being stepped on.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a player cancels targeting with an item (ESC key).
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
item
that the target cursor originated from.
SRC
The
character
cancelling the target.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the cancellation message from being shown.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character is targeted with an item.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
character
that was targeted.
I
The
item
that the target cursor originated from.
SRC
The
player
targeting a character.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents Sphere from processing the default target behaviour.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when the ground is targeted with an item.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
item
that the target cursor originated from.
SRC
The
player
targeting the ground.
Note:
The
TARGP
property on the player can be used to acquire the target coordinates.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
If a static item was targeted, the ID of the item.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents Sphere from processing the default target behaviour.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item is targeted with an item.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
item
that was targeted.
I
The
item
that the target cursor originated from.
SRC
The
player
targeting an item.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents Sphere from processing the default target behaviour.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item's timer property reaches zero.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
item
whose timer has expired.
CONT
The
character
who is the container for this
item
.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the default action taking place.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an item is unequipped from a character.
Fires on:
Items
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
item
being unequipped.
SRC
The
character
who had the item equipped.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a resource is being created.
Fires on:
Region Resources
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
worldgem bit
that represents the resource in the world.
I
The
region resource
being gathered.
SRC
The
character
gathering the resource.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Sets the amount of resource to zero, preventing it from being gathered.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when the gathering proccess is going to finish.
Fires on:
Region Resources
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
worldgem bit
that represents the resource in the world.
I
The
region resource
being gathered.
SRC
The
character
gathering the resource.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
Local.ResourceID
IO
The id of the item being gathered.
ARGN1
IO
The amount of the resource being gathered at this time.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the resource from being gathered, showing up the related messages.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a resource is being gathered and Sphere is determining which resource to spawn. This trigger fires on every region resource attached to the region that Sphere is selecting from.
Fires on:
Region Resources
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
region resource
being gathered.
SRC
The
character
gathering the resource.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents Sphere from selecting the resource.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character enters a region's boundaries.
Fires on:
Regions
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
region
being entered.
SRC
The
character
entering the region.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from entering the region.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character leaves a region's boundaries.
Fires on:
Regions
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
region
being exited.
SRC
The
character
exiting the region.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from exiting the region.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a skill is aborted.
Fires on:
Skills
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
aborting the skill.
SRC
The
character
aborting the skill.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number being aborted.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Bypasses normal skill fail behaviour.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an attempt to use a skill fails.
Fires on:
Skills
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
failing the skill attenot.
SRC
The
character
failing the skill attempt.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number being failed.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Bypasses normal skill fail behaviour.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a skill gain calculation occurs.
Fires on:
Skills
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
trying to gain skill.
SRC
The
character
trying to gain skill.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number being gained.
ARGN2
IO
The chance to gain skill. (1 - 1000)
ARGN3
IO
The maximum skill level that the character can gain to.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from gaining skill.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a skill is used, before any hardcoded behaviour occurs.
Fires on:
Skills
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
trying to use the skill.
SRC
The
character
trying to use the skill.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number being started.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from using the skill.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a skill is selected from the skill menu.
Fires on:
Skills
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
selecting the skill.
SRC
The
character
selecting the skill.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number that was selected.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the character from using the skill.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an attempt to use skill has started.
Fires on:
Skills
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
starting to use the skill.
SRC
The
character
starting to use the skill.
ACT
The
backpack
trying to peek for snooping.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number that has started.
LOCAL.CRAFTAMOUNT
IO
For crafting skills, the amount of the item that will be created.
LOCAL.CRAFTITEMDEF
IO
For crafting skills, the item
BASEID
that will be created.
LOCAL.CRAFTSTROKECNT
IO
For crafting skills, the number of 'strokes' until the skill completes.
local.GatherStrokeCnt
IO
For gathering skills, the number of 'strokes' until the skill completes.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Aborts the skill attempt.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an attempt to use skill has succeeded.
Fires on:
Skills
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
succeeding the skill attempt.
SRC
The
character
succeeding the skill attempt.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number that has succeeded.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Aborts the skill attempt.
0
Aborts the skill, but grants Skillgain.
2
Aborts the skill, but grants Skillgain.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an attempt to quickly use a skill is made without changing the character's
ACTION
property.
Fires on:
Skills
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
quickly using the skill.
SRC
The
character
quickly using the skill.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number that is being used.
ARGN2
IO
The difficulty of the skill attempt.
ARGN3
IO
If 0 then the skill failed, if 1 then it succeeded.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
0
Fails the skill use without awarding skill gain.
1
Succeeds the skill use without awarding skill gain.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger is used in skills definitions (a related
@SkillWait
exists for characters). This trigger is called whenever Sphere wants to check if a character must wait before starting a skill. Normally this will be when a skill is selected from the skill menu (before
@Select
), but also when snooping a container or using a musical instrument.
Fires on:
Skills
References
The following object references are explicitly available for this trigger
(this needs to be tested/validated)
:
Name
Description
I
The
character
selecting the skill.
SRC
The
character
selecting the skill.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behavior
(this needs to be tested/validated)
:
Argument
In/Out
Description
ARGN1
?
The skill the character is attempting
ARGN2
?
the skill that is currently being used
Return Values
The following return values are explicitly defined for this trigger
(this needs to be tested/validated)
:
Return Value
Description
0
The character can start the other skill (bypasses default checks)
1
The character must wait (bypasses default checks)
2
Perform default checks

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when an object is hit by the effects of a spell. The object may have been targeted directly or it may have been hit by an area-effect spell.
Fires on:
Spells
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
item
used to cast the spell (e.g. a wand or scroll).
I
The
character
or
item
being hit by the spell.
SRC
The
character
responsible for the spell.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The number of the spell that has hit the object.
ARGN2
IO
The strength of the spell.
ARGN3
IO
A multiplier for the spell's duration or effect.
Note:
Only used when a character is hit by a spell.
Local.CreateObject1
IO
Changes the ID of the effect for this spell, IE: Local.CreateObject1=0eed in FlameStrike spell will change the Fire Column for a Gold Coin.
local.Duration
IO
Overrides the default duration of spell in tenths of second (local.duration = 10  is 1 second).
local.Effect
IO
Changes the EFFECT value of the spell (For changing EFFECT_ID see Local.CreateObject1).
local.EffectColor
IO
Changes the color of the effect for this spell.
local.EffectRender
IO
Changes the Render Mode for this spell's effect.
local.EffectExplode
IO
Sets wether the effect should explode or not after reaching the target.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
0
For scripted spells, prevents any hardcoded behaviour from taking place.
1
Prevents the object from being affected by the spell.
Note:
For the recall and gate travel spells, returning 0 prevents the spell from proceeding and returning 1 has no effect.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when any type of effect memory is being added, like stat changes for s_bless, s_cunning... s_weaken ...
Fires on:
Spells
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The memory item.
I
The
character
affected by the effect.
SRC
The
character
responsible for the spell.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The spell ID
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
0
Let the memory exist but block default checks, perfect to override default effects and do some custom stuff.
1
Blocks any action and stops everything, also deletes the memory (Blocking any changes, this will cause also the effect to do not have duration).
Note:
Poisoning spells are not affected by this trigger

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a spell memory item is removed (and after the @Destroy trigger of the item).
Fires on:
Spells
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The memory item.
I
The
character
affected by the effect.
SRC
The
character
responsible for the spell.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The spell ID
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
0
prevents default spell behaviour be executed when the spell item get removed. This is necessary when return 0 is used in @EffectAdd of the same spell.
For Summoning spells, returning 0 in @EffectRemove will prevent the summon to disappear.
Note:
Poisoning spells are not affected by this trigger

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character is under effect of a periodic spell (like Poison spell).
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The object that is going to be affected.
SRC
The object that is going to be affected.
ARGO
The spell memory.(Argo.link holds the caster UID)
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
Spell Id
ARGN2
IO
Spell Level
LOCAL.CHARGES
IO
How many charges are left on the spell memory, this will be automatically decreased by 1 at the end of the method execution. Default value is 1.
LOCAL.DELAY
IO
How many seconds until the next spell effect tick. Default value is 5 seconds.
LOCAL.EFFECT
IO
The effect value of the spell, harmful or beneficial (if SPELLFLAG_HEAL is enabled).
LOCAL.DAMAGETYPE
IO
The damage type of the spell, if you are making a custom spell you must set a value otherwise the spell will not cause damage.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Destroy the spell memory and block the spell execution.
0
If the spell has the flag SPELLFLAG_SCRIPTED blocks the spell execution

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character fails to cast a spell.
Fires on:
Spells
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
item
used to cast the spell (e.g. a wand or scroll).
I
The
character
failing to cast the spell.
SRC
The
character
failing to cast the spell.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The spell that was being cast.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents normal fail behaviours (fail message, fizzle effect, reagent loss).

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character selects to cast a spell. It fires multiple times during the different stages of a spell being cast.
Fires on:
Spells
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The source of the spell. Could be the
item
used to cast the spell (e.g. a wand or scroll) or the
character
casting the spell.
I
The
character
casting the spell.
SRC
The
character
casting the spell.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The spell being cast.
ARGN2
IO
The amount of mana needed to cast the spell.
ARGN3
I
Flags representing what stage of the casting process the trigger is being used at.
Flag
Meaning
01
Just a test (no reagents or mana will be consumed)
02
Display fail message if unable to cast
Spell Casting Stage
Expected Flags
Spell selected for casting
01
Spell is about to start casting
03
Spell is about to finish casting
03
Spell casting finished successfully
02
Spell casting finished unsuccessfully
00
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
0
Allows the spell to be cast.
1
Prevents the spell from being cast.
6
Allows the spell to be cast without checking mana, spellbook, and reagent(s).

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character begins to cast a spell.
Fires on:
Spells
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
item
being used to cast the spell (e.g. a wand or scroll).
I
The
character
casting the spell.
SRC
The
character
casting the spell.
ACT
The
character
or
item
being hit by the spell.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
IO
The spell number being cast.
ARGN2
IO
The difficulty of the spell.
ARGN3
IO
The length of time it will take to cast the spell, in tenths of a second.
local.WOP
IO
Enables/Disables the WOP for this character and spell.
local.WOPColor
IO
Sets the color of WOP.
local.WOPFont
IO
Sets the font of WOP.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Prevents the spell from being cast.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character successfully casts a spell.
Fires on:
Spells
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The source of the spell. Could be the
item
used to cast the spell (e.g. a wand or scroll) or the
character
casting the spell.
I
The
character
casting the spell.
SRC
The
character
casting the spell.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The spell that was cast.
ARGN2
I
The strength of the spell.
LOCAL.CREATEOBJECT1
IO
For field spells, overrides the item
BASEID
to use for the east-west direction.
For summon spells, overrides the character
BASEID
to summon.
LOCAL.CREATEOBJECT2
IO
For field spells, overrides the item
BASEID
to use for the north-south direction.
LOCAL.FIELDGAUGE
IO
For field spells, overrides the default gauge of the field (1).
LOCAL.FIELDWIDTH
IO
For field spells, overrides the default width of the field (5).
LOCAL.AREARADIUS
IO
For Area of effect (AoE) spells, overrides the default radius of the effect (4).
LOCAL.EFFECTCOLOR
IO
For field spells, overrides the color of the fields.
LOCAL.DURATION
IO
Overrides the default duration of spell in tenths of second (local.duration = 10 is 1 second).
LOCAL.DAMAGETYPE
IO
Overrides the default damage type of spell. (Check sphere_defs.scp "dam_flags" definition for damage types)
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Aborts casting the spell.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Mit dem
DB
-Objekt können Skripte auf eine externe MySQL Datenbank zugreifen. Folgende Tabelle beschreibt die verschiedenen Eigenschaften des DB-Objekts in Sphere.
Anm:
Um das DB-Objekt zu nutzen, muss in der Sphere.ini zunächst MySQL aktiviert und konfiguriert werden.
Contents
1
Eigenschaften und Funktionen
Eigenschaften und Funktionen
Hier eine Auflistung aller Datenbankeigenschaften und -funktioen. Falls eine Funktion als lesbar (mit einem R für readable) markiert ist, dann liefert sie einen Wert zurück, wenn sie in der Form von <KEY> benutzt wird. Um Beispiele und detaillierte Informationen zu erhalten, kann jeweils der Name angeklickt werden. Wenn auf eine Eigenschaft zugegriffen wird, die nicht existiert, dann wird Sphere versuchen auf ein
ITEMDEF
zuzugreifen.
Name
Lesbar(R)/Schreibbar(W)
Beschreibung
AEXECUTE
function, command
R
Führt in einem Hintergrundthread einen SQL-Befehl aus und ruft
function
auf, wenn dieser Vorgang abgeschlossen ist. Liefert 1, wenn der Befehl erfolgreich in die Abarbeitungswarteschlange eingereiht wurde.
AQUERY
function, command
R
Führt einen SQL-Befehl in einem Hintergrundthread aus, ruft dann
function
auf, wenn das geschehen ist. Liefert 1, wenn der Befehl erfolgreich in die Abarbeitungswarteschlange eingereiht wurde.
CLOSE
W
Schliesst die Verbindung zum Datenbankserver.
CONNECT
W
Öffnet eine Verbindung zum Datenbankserver mit den Einstellungen aus der Sphere.ini.
CONNECTED
R
Liefert 1, wenn die Verbindung zur Datenbank besteht.
ESCAPEDATA
text
R
Liefert
text
als escaped SQL-String (einige Sonderzeichen werden umgewandelt, um bspw SQL-Injection zu vermeiden).
EXECUTE
command
W
Führt einen SQL-Befehl aus, der kein Ergebnis liefert.
QUERY
command
W
Führt einen SQL-Befehl aus, der ein Ergebnis liefert.
ROW
.NUMCOLS
R
Liefert die Anzahl der Spalten der letzten Abfrage.
ROW
.NUMROWS
R
Liefert die Anzahl der Zeilen der letzten Abfrage.
ROW
.n.col_index
R
Liefert den Wert in der Spalte
col_index
und der Zeile n (beginnend bei 0)
ROW
.n.col_name
R
Liefert den Wert einer Spalte, die den Namen
col_name
trägt, in der Zeile n (beginnend bei 0)

--- PAGE BREAK ---

Properties and Functions
Here is a list of all notoriety properties and functions. If a function is marked as readable then it can return a value when used as <KEY>. Click on the name for more detailed information such as usage and examples.
Notoriety list saved on you holds the values others can read when seeing you or retrieving any notoriety data, ie: notosave.1.value=01 and notosave.2.value=07 will make you appear as NOTO_GOOD (1) for the character in slot 1 of your list and NOTO_INVUL (7) for the character number 2 of your list.
NOTOSAVE
.key
Read/Write
Description
R
Gets the number of characters you've sent your notoriety.
n
R
Gets the UID of the nth character for who you have stored your notoriety. (zero-based)
ID
R
Get's the id on the list for the character with the given UID.
n
.
VALUE
R
Get's the value of notoriety I have to send to this character.
n
.
COLOR
R
Get's the color of notoriety I have to send to this character.
n
.
ELAPSED
R
Get's the time elapsed since this index has been saved, when reaching ini's setting 'NotoTimeout' the notoriety for this character will be refreshed if needed.
To reset the Notoriety list for this character use
NotoUpdate
.
Modifying Notoriety
All Notoriety changes are made inside the
@NotoSend
trigger

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Seçenekler
2
Örnekler
Seçenekler
Aşağıda attacker komutu için mümkün olan seçenekler bulunmaktadır. Eğer parametrelerden herhangi biri "Okunabilir" olarak seçilmiş ise, bu parametre <KOMUT> ile okunabileceğini gösterir. Eğer bir parametre "Yazılabilir" görünüyorsa bu parametre değiştirilebilir demektir.
Bu parametreler
ATTACKER
. ile birlikte kullanılır. Örnekler için,
Örneklere
tıklayınız.
İsim
Oku/Yaz
Açıklama
O
Karaktere hasar veren toplam kişi sayısını öğrenmeye yarar.
n
O
Karaktere hasar veren n. karakterin UID'ini öğrenmeye yarar. (sıfır-tabanlı)
CLEAR
O
Karaktere hasar veren karakterlerin kayıtlarını temizler.
LAST
O
Karaktere hasar veren son karakterin UID'ini öğrenmeye yarar.
MAX
O
Karaktere en çok hasar veren karakterin UID'ini öğrenmeye yarar.
n
.
DAMAGE
O
Karaktere hasar veren n. karakterin UID'ini öğrenmeye yarar. (sıfır-tabanlı)
n
.
ELAPSED
O
Karaktere hasar veren n. karakterin saldırı süresini
saniye
cinsinden öğrenmeye yarar. (sıfır-tabanlı)
n
.
UID
O
Karaktere hasar veren n. karakterin UID'ini öğrenmeye yarar. (sıfır-tabanlı)
Örnekler
Attacker
hakkında örnekler.
ATTACKER
[Events e_example]
On=@Death
    SERV.LOG Saldıran Sayısı: <attacker>
Konsolda
saldıran toplam oyuncu sayısını
görürsünüz.
ATTACKER
.n
[.UID]
[Events e_example]
On=@Death
    SERV.LOG İlk Saldıran: <uid.<attacker.0>.name>
    SERV.LOG Dördüncü Saldıran: <uid.<attacker.3.uid>.name>
Konsolda
birinci ve dördüncü saldıranların isimlerini
görürsünüz.
VEYA
[Events e_example]
On=@Death
    for 0 <eval <ATTACKER>-1>
        SERV.LOG <eval <DLOCAL._FOR>+1>. Saldıran: <uid.<attacker.<dlocal._for>>.name>
    endfor
Konsolda
saldıran tüm oyuncuların isimlerini
görürsünüz.
ATTACKER.LAST
[Events e_example]
On=@Death
    SERV.LOG Son Saldıran: <uid.<attacker.last>.name>
Konsolda
son saldıranın ismini
görürsünüz.
ATTACKER.MAX
[Events e_example]
On=@Death
    SERV.LOG En Çok Hasar Veren: <uid.<attacker.max>.name>
Konsolda
en çok hasar verenin ismini
görürsünüz.
ATTACKER
.n
.DAMAGE
[Events e_example]
On=@Death
    SERV.LOG İlk Saldıranın Verdiği Hasar: <attacker.0.damage>
Konsolda
ilk saldıran oyuncunun verdiği hasarı
görürsünüz.
ATTACKER
.n
.ELAPSED
[Events e_example]
On=@Death
    SERV.LOG İlk Saldıranın Saldırı Süresi: <attacker.0.elapsed>
Konsolda
ilk saldıran oyuncunun saldırı süresini
saniye cinsinden görürsünüz..

--- PAGE BREAK ---

Contents
1
Description
2
Syntax
3
Return Values
4
Examples
Description
This function will queue up a query and run it asynchronously in a background thread (rather than the script waiting for it to complete like the
EXECUTE
function). Once the query has been executed, a specified callback function will run.
Note 1
: An open database connection is required for this function to work correctly. See the
CONNECT
function for information regarding the opening of a database connection.
Note 2
: The
AEXECUTE
and
EXECUTE
functions are intended to run SQL commands that do not return any results (such as DELETE or UPDATE). For commands that return results (that you want to then read back) see the
AQUERY
and
QUERY
functions.
Valid for the following objects:
Database
Syntax
AEXECUTE
function
,
command
Argument
Type
Description
function
string
A script function to call when the command has been executed.
Argument
Description
ARGN1
The type of command (0 =
AEXECUTE
, 1 =
AQUERY
)
ARGN2
0 = Command failed, 1 = Command succeeded.
ARGS
The command that was executed.
command
string
The SQL command to execute.
Return Values
This function returns one of two values when executed. See the table below for the meanings of the return values:
Return Value
Description
0
Command has not been successfully queued.
1
Command has been successfully queued.
Examples
//
// Queues up an SQL command.
//
[FUNCTION f_execute]
SERV.LOG Deleting all rows from table 'tbl_name'.
IF (<DB.AEXECUTE f_execute_callback, DELETE FROM tbl_name> == 0)
    SERV.LOG Failed to queue command.
ELSE
    SERV.LOG Command queued.
ENDIF
RETURN

//
// This function will be called when the query has been executed.
//
[FUNCTION f_execute_callback]
IF (<ARGN2> == 0)
    SERV.LOG The command failed to execute. (<ARGS>)
ELSE
    SERV.LOG The command succeeded. (<ARGS>)
ENDIF
RETURN

--- PAGE BREAK ---

Contents
1
Description
2
Syntax
3
Return Values
4
Examples
Description
This function will queue up a query and run it asynchronously in a background thread (rather than the script waiting for it to complete like the
QUERY
function). Once the query has been executed, a specified callback function will run.
Unlike the
QUERY
function, results are not stored in the
ROW
object. Instead they are passed in to the callback function as
LOCALs
. The following table shows the differences between accessing the results for the two functions:
QUERY
AQUERY
ROW
.NUMROWS
LOCAL.NUMROWS
ROW
.NUMCOLS
LOCAL.NUMCOLS
ROW
.
row_index
.
col_index
LOCAL.
row_index
.
col_index
ROW
.
row_index
.
col_name
LOCAL.
row_index
.
col_name
Note 1
: An open database connection is required for this function to work correctly. See the
CONNECT
function for information regarding the opening of a database connection.
Note 2
: The
AQUERY
and
QUERY
functions are intended to run SQL commands that return results (such as SELECT). For commands that do not return results consider using the
AEXECUTE
and
EXECUTE
functions.
Valid for the following objects:
Database
Syntax
AQUERY
function
,
command
Argument
Type
Description
function
string
A script function to call when the command has been executed.
Argument
Description
ARGN1
The type of command (0 =
AEXECUTE
, 1 =
AQUERY
)
ARGN2
0 = Command failed, 1 = Command succeeded.
ARGS
The command that was executed.
command
string
The SQL command to execute.
Return Values
This function returns one of two values when executed. See the table below for the meanings of the return values:
Return Value
Description
0
Command has not been successfully queued.
1
Command has been successfully queued.
Examples
//
// Queues an SQL query.
//
[FUNCTION f_aquery]
SERV.LOG Selecting some values in the background.
IF (<DB.AQUERY f_aquery_callback, SELECT 10 AS test1, 20 AS test2, 30 AS test3> == 0)
    SERV.LOG Failed to queue command.
ELSE
    SERV.LOG Command queued.
ENDIF
RETURN

//
// This function will be called when the query has been executed.
//
[FUNCTION f_aquery_callback]
IF (<ARGN2> == 0)
    SERV.LOG The command failed to execute. (<ARGS>)
ELSE
    SERV.LOG The command succeeded, <dLOCAL.NUMROWS> row(s) of data returned. (<ARGS>)
    FOR 0 <EVAL <LOCAL.NUMROWS> - 1>
        SERV.LOG #<EVAL <LOCAL._FOR> + 1>. <LOCAL.<dLOCAL._FOR>.test1>, <LOCAL.<dLOCAL._FOR>.test2>, <LOCAL.<dLOCAL._FOR>.test3>
    ENDFOR
ENDIF
RETURN

--- PAGE BREAK ---

This function will close the connection with the current database.
USES
: DB.CLOSE

--- PAGE BREAK ---

Database Method
Connects to the database set in sphere.ini at this lines:
MYSQL=0
MySqlHost=
MySqlUser=
MySqlPassword=
MySqlDatabase=
USES:
DB.CONNECT

--- PAGE BREAK ---

This function will return if sphere is connected to any database.
Must be checked in a condition like:
IF
,
WHILE
,
QVAL
.
USES
: <DB.CONNECTED>
Examples
IF <DB.CONNECTED>
    // Sphere is connected to the database.
ELSE
    // Sphere is not connected to the database.
ENDIF

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger periodically fires in regions that clients are active in. The trigger will fire once for each client in the region.
Fires on:
Regions
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
region
the client is in.
SRC
The
client
the trigger is firing for.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger periodically fires in regions that clients are active in. Unlike the
@CliPeriodic
trigger, this trigger will only fire once.
Fires on:
Regions
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
region
with active client(s).
SRC
A
client
that is inside the region.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
No return values are handled for this trigger.

--- PAGE BREAK ---

SERV.RTIME.FORMAT <args>
SERV.RTIME.FORMAT accepts arguments as a string, e.g. SERV.RTIME.FORMAT %d returns the number of the day.
Acceptable variables are:
%a= day name 3 letter
%A= day name full
%b= month name 3 letter
%B= month name full
%c= date & time numeric
%d= day of month
%H= hour 24hr clock
%I= hour 12hr clock
%j= day of year 1-366
%m= month number
%M= minutes
%p= AM/PM
%S= seconds
%U= week number 0-52 with Sunday as the first day of week 1
%w= week day numerical Sunday = 0
%W= week number in year 0-52 with Monday as the first day of week 1
%x= date numeric
%X= time numeric
%y= year 2 digit
%Y= year 4 digit
%z= Time zone

--- PAGE BREAK ---

Help
Available languages
Missing languages
Intrinsic Funktionen sind spezielle Funktionen, die nur innerhalb von "evals", wie bspw.
EVAL
,
FEVAL
,
FVAL
und
HVAL
benutzt werden können. Manche der eingebauten Funktionen sind sehr speziell und können automatisch übergebene Paramater automatisch evaluieren, wie bspw
IF
und
WHILE
, wodurch in solchen Fällen Intrinsics nicht innerhalb eines "evals" benutzt werden müssen.
Anders als die normale Syntax für Funktionen (<FUNCTION args>), ist die Syntax bei der Verwendung eines Intrinsics:
FUNCTION(
args
)
Folgende Tabelle listet alle in Sphereserver verfügbaren Instricfunktionen auf:
Name
Description
COS
(
value
)
Berechnet den Kosinus von
value
.
ID
(
defname
)
Berechnet die ID eines
defname
s.
ISOBSCENE
(
text
)
Liefert 1, wenn der
text
Wörter aus der OBSCENE-Liste enthält (siehe
Kapitel 2
).
ISNUMERIC
(
value
)
Liefert 1, wenn
value
eine Zahl ist.
LOGARITHM
(
value
)
Liefert den Logarithmus von
value
zur Basis 10.
LOGARITHM
(
value
,
base
)
Liefert den Logarithmus von
value
zur Basis
base
. Für die Basis kann "e", "pi" oder ein beliebiger Zahlenwert angegeben werden.
NAPIERPOW
(
value
)
Liefert e (2.7182818) hoch
value
.
QVAL
(
a, b, kleiner_als, gleich, größer_als
)
Liefert
kleiner_als
, wenn
a
kleiner als
b
,
gleich
wenn
a
gleich
b
und
größer_als
wenn
a
größer als
b
ist.
RAND
(
value
)
Liefert eine Zufallszahl zwischen 0 und
value
- 1.
RAND
(
min, max
)
Liefert eine Zufallszahl zwischen
min
und
max
.
RANDBELL
(
value, variance
)
Berechnet eine Zufallszahl basierend auf einer Glockenkurve (siehe:
Normalverteilung
).
SIN
(
value
)
Liefert den Sinus von
value
.
STRCMP
(
string1, string2
)
Vergleicht
string1
mit
string2
und liefert das Ergebnis. Unterscheidet zwischen Groß- und Kleinschreibung. (<= 1 =
string1
kleiner als
string2
, 0 =
string1
gleich
string2
, >= 1 =
string1
größer als
string2
)
STRCMPI
(
string1, string2
)
Vergleicht
string1
mit
string2
und liefert das Ergebnis. Unterscheidet nicht zwischen Groß- und Kleinschreibung. (<= 1 =
string1
kleiner als
string2
, 0 =
string1
gleich
string2
, >= 1 =
string1
größer als
string2
)
STRINDEXOF
(
text, search, n
)
Liefert den Index  von eines ersten Auftreten von
search
innerhalb von
text
, beginnend beim
n
ten Buchstaben. (0 ist der erste Buchstabe)
STRLEN
(
text
)
Liefert die Länge von
text
.
STRMATCH
(
pattern, text
)
Liefert 1, wenn
text
zum angegebenen Wildcard
pattern
passt.
STRREGEX
(
pattern, text
)
Liefert 1, wenn 1 if
text
zum angegebenen regulären Ausdruck
pattern
passt.
SQRT
(
value
)
Liefert die Quadratwurzel von
value
.
TAN
(
value
)
Liefert den Tangens von
value
.

--- PAGE BREAK ---

Contents
1
LIST Functions
2
Examples
2.1
Adding to LIST
2.2
Referencing the LIST
2.3
Referencing Single Elements
2.4
Sorting the LIST
LIST Functions
These functions will allow the insertion and referencing of elements in a list, this is a global property much like VAR and can be referenced or set globally.
LIST
.key
Read/Write
Description
SERV.
LIST
.
xxx
R
Shows elements in LIST.
xxx
SERV.
LIST
.
xxx
.ADD
<args>
W
Adds
<args>
as a new element in LIST.
xxx
SERV.
LIST
.
xxx
.APPEND
<args>,...
W
Sets each
<args>
as a new element in LIST.
xxx
SERV.
LIST
.
xxx
.CLEAR
W
Clears LIST.
xxx
SERV.
LIST
.
xxx
.SET
<args>,...
W
Clears the list and sets each
<args>
as a new element in LIST.
xxx
SERV.
LIST
.
xxx
.SORT
<args>
W
Re-orders LIST.
xxx
according to
<args>
. (possible values are:
no args
,
i
,
asc
,
iasc
,
desc
,
idesc
)
SERV.
LIST
.
xxx
.
n
R
References the
nth
zero based index of the LIST.
xxx
SERV.
LIST
.
xxx
.COUNT
R
Gets the total number of elements in LIST.
xxx
SERV.
LIST
.
xxx
.
n
.REMOVE
W
Removes the
nth
element in LIST.
xxx
SERV.
LIST
.
xxx
.
n
.INSERT
<args>
W
Inserts
<args>
at the
nth
index of LIST.
xxx
SERV.
LIST
.
xxx
.FINDELEM
<args>
W
Searches LIST.
xxx
for
<args>
starting from the beginning of LIST.
xxx
SERV.
LIST
.
xxx
.
n
.FINDELEM
<args>
W
Searches LIST.
xxx
for
<args>
starting from the
nth
index of LIST.
xxx
SERV.PRINTLISTS
R
Prints all LIST
s
and their respective ELEMENTS
SERV.CLEARLISTS
W
Clears all LIST
s
. If used with mask parameter, then it will clear LIST
s
with specified name
Examples
Below are examples of the use of the
LIST
functions:
Adding to LIST
This example shows how to add elements to your LIST.
xxx
:
[FUNCTION f_add_to_mylist]
SERV.LIST.MyList.ADD MyElement1
SERV.LIST.MyList.ADD MyElement2
SERV.LIST.MyList.ADD MyElement3
SERV.LIST.MyList.ADD MyElement4

...

SERV.LIST.MyList.SET MyElement1,MyElement2,MyElement3,MyElement4 - will have the same effect as the f_add_to_mylist function above
Referencing the LIST
To reference your LIST.
xxx
:
[FUNCTION f_show_mylist]
serv.log <serv.list.MyList>
displays; "MyElement1","MyElement2","MyElement3","MyElement4"
Referencing Single Elements
in the LIST above, in order to reference by index :
serv.list.MyList.0 - outputs "MyElement1"
serv.list.MyList.1 - outputs "MyElement2"
. . .
Sorting the LIST
This example shows how to sort your LIST.
xxx
:
SERV.LIST.MyList.SORT - ascending sort in case sensitive
SERV.LIST.MyList.SORT asc - ascending sort in case sensitive
SERV.LIST.MyList.SORT i - ascending sort in case insensitive
SERV.LIST.MyList.SORT iasc - ascending sort in case insensitive
SERV.LIST.MyList.SORT desc - descending sort in case sensitive
SERV.LIST.MyList.SORT idesc - descending sort in case insensitive

--- PAGE BREAK ---

Help
Available languages
Missing languages
Funções intrínsecas são funções especiais que somente podem ser usadas em funções de avaliação, como
EVAL
,
FEVAL
,
FHVAL
,
FVAL
e
HVAL
. Algumas das funções e propriedades embutidas irão avaliar automaticamente seus parâmetros, por exemplo a função
IF
e
WHILE
automaticamente irão avaliar suas condicionais.
Diferente da sintaxe para funções normais (<FUNCTION args>), a sintaxe para retornar um valor de uma função intrínseca é:
FUNCTION(
args
)
A tabela a seguir detalha todas as funções intrínsecas no SphereServer:
Nome
Descrição
COS
(
valor
)
Retorna o cosseno de
valor
.
ID
(
defname
)
Retorna o valor numérico de
defname
.
ISOBSCENE
(
texto
)
Retorna 1 se
texto
é considerado como texto obsceno.
ISNUMERIC
(
valor
)
Retorna 1 se
valor
é numérico.
LOGARITHM
(
valor
)
Retorna o logarítimo na base-10 de
valor
.
LOGARITHM
(
valor
,
base
)
Retorna o logarítimo de
value
na base-
base
. (Aceita "e" e "pi" como bases, bem como valores numéricos)
NAPIERPOW
(
valor
)
Retorna e neperiano (2.7182818) para o power de
valor
.
QVAL
(
a, b, less_than, equal_to, greater_than
)
Retorna
less_than
se
a
é menor/menos que
b
,
equal_to
se
a
é igual a
b
, ou
greater_than
se
a
é maior/mais que
b
.
RAND
(
valor
)
Retorna um valor aleatório entre 0 e
valor-1
.
RAND
(
min, max
)
Retorna um valor aleatório entre
min
e
max
.
RANDBELL
(
valor, variância
)
Calcula um valor baseado na curva em forma de sino (Gauss).
SIN
(
valor
)
Retorna o seno de
valor
.
STRCMP
(
linha1, linha2
)
Compara
linha1
com
linha2
e retorna o resultado. Sensível a caixa alta. (<= 1 =
linha1
menor/menos que
linha2
, 0 =
linha1
igual a/equivalente
linha2
, >= 1 =
linha1
maior/mais que
linha2
)
STRCMPI
(
linha1, linha2
)
Compara
linha1
com
linha2
e retorna o resultado. NÃO sensível a caixa alta. (<= 1 =
linha1
menor/menos que
linha2
, 0 =
linha1
igual a/equivalente
linha2
, >= 1 =
linha1
maior/mais que
linha2
)
STRINDEXOF
(
texto, search, n
)
Retorna o indice da sequencia de caracteres
search
no
texto
, a começar do caractere número
n
. (começando de zero)
STRLEN
(
texto
)
Retorna o comprimento de
texto
.
STRMATCH
(
padrão, texto
)
Retorna 1 se
texto
corresponde especificamente ao
padrão
.
STRREGEX
(
padrão, texto
)
Retorna 1 se
texto
corresponde à expressão regular especificada
padrão
.
SQRT
(
valor
)
Retorna a raiz quadrada de
value
.
TAN
(
valor
)
Retorna a tangente de
value
.

--- PAGE BREAK ---

Description
The main purpose of EVAL is to retrieve the specified number as Decimal, usefull for tags/vars/locals... wich gives results as Hex by default. There is an example:
Usage
[Function test]
local.value=10
say Default:<local.value>, Eval: <eval <local.value>>
Notes
You can short it by using <dlocal.value>,<dtag.value> or <dvar.value>.

--- PAGE BREAK ---

Description
FEval is a function that returns the given value treating the last number as a decimal and removing it, the best example is to retrieve your skill points without decimals.
Usage
[function ShowAlchemy]
alchemy=99.9
say Alchemy is: <feval <alchemy>> // This will say 'Alchemy is: 99', removing the last number (.9).

--- PAGE BREAK ---

Description
Fval is a number formating function that returns the given value like a Skill or a one-decimal number, ie <fval 1000> will return 100.0

--- PAGE BREAK ---

DESCRIPTION
HVAL is the
Hexadecimal
version of
EVAL
, it returns the given values as HEX and it's the default numerical system used by Sphere and the one that will be used to store the numerical values you give in most variable types (TAG,VAR,LOCAL...).
USAGE
[FUNCTION TestHVAL]
LOCAL.str=<str>
Sysmessage=My real STR is <STR> and when it's stored Sphere uses this value <LOCAL.str>
Sysmessage=I can also get this value using <HVAL <STR>>

--- PAGE BREAK ---

The first QVAL Syntax
<QVAL CONDITION ? TRUE : FALSE>
QVAL is a simple form of the IF-ELSE structure. It is used to test if an argument is true or false in a single line of code.
For example, this:
IF (<EVAL <LOCAL.A>+1> < <LOCAL.B>)
   SYSMESSAGE A+1 is smaller than B
ELSE
   SYSMESSAGE A+1 is greater than or equal to B
ENDIF
...is the same as:
<QVAL <EVAL <LOCAL.A>+1> < <LOCAL.B> ? SYSMESSAGE A+1 is smaller than B:SYSMESSAGE A+1 is greater than or equal to B>
In the above statement, if we say that local.a=3 and local.b=5, then local.a+1=4
Since 4 is less that 5, the condition is true, and so the first output (before the : sign) in the true:false condition will be executed
If local.a=5 and local.b=5, then local.a+1=6
Since 6 is not less than 5, the condition will return as false and the second output (after the : sign) in the true:false result will be executed.
Your "if condition" is separated from the results by the ? character.  The true and false results are separated by the : character (which is mandatory, even if you dont want anything to happen in one of the cases.)
Be careful if the true:false conditions also require you to use "greater than"  It is easy to inadvertently close an argument too soon with a misplaced > after the ? or : in a QVAL argument. You should use always Less than ( < ) or Less or Equal ( <= )
The second QVAL Syntax
QVAL(VALUE1,VALUE2,LESSTHAN,EQUAL,GREATERTHAN)
This form of the QVAL statement is useful when comparing two values.
For example:
<eval qval(<VAR.X>,<VAR.Y>,<VAR.ONE>,<VAR.TWO>,<VAR.THREE>)>
...will return <VAR.ONE> if X is less than Y, <VAR.TWO> if they are equal, and <VAR.THREE> if X greater than Y. If some of the arguments are omited like qval(1,2,,3) it will default to zero.

--- PAGE BREAK ---

Characters
Here is a list of all
character
triggers. Click on the trigger name for more detailed information such as arguments and examples.
Name
Description
@AfterClick
Fires when the object has been single-clicked, just before the overhead name is shown.
@CallGuards
Fires when the character calls for guards.
@CharClick
Fires when the character is clicked by another character.
@CharClientTooltip
Fires when the tooltips are about to be sent to the character.
@CharDClick
Fires when the character double clicks another character.
@CharTradeAccepted
Fires when another character accepts trade with the character.
@Click
Fires when the object has been single-clicked.
@ClientTooltip
Fires when tooltips for this character are about to be sent to a client.
@ContextMenuRequest
Fires when a client requests the context menu options for the object.
@ContextMenuSelect
Fires when a client selects a context menu option for the object.
@Create
Fires when the object is initially created, before it is placed in the world.
@Criminal
Fires when the character becomes a criminal.
@DClick
Fires when the object is double-clicked.
@Destroy
Fires when the object is being deleted.
@Dismount
Fires when the character dismounts their ride.
@EnvironChange
Fires when the environment changes for the character.
@ExpChange
Fires when the character's experience points change.
@ExpLevelChange
Fires when the character's experience level changes.
@FameChange
Fires when the character's fame changes.
@HouseDesignCommit
Fires when the character commits a new house design.
@HouseDesignExit
Fires when the character exits house design mode.
@Hunger
Fires when the character's food level decreases.
@ItemAfterClick
Fires when the character single-clicks an item, just before the overhead name is shown.
@ItemBuy
Fires when the character buys an item from a vendor.
@ItemClick
Fires when the character single-clicks an item.
@ItemClientTooltip
Fires when the tooltips are about to be sent to the client for an item.
@ItemContextMenuRequest
Fires when the character requests the context menu options for an item.
@ItemContextMenuSelect
Fires when the character selects a context menu option for an item.
@ItemCreate
Fires when an item is initially created, before it is placed in the world, and the character is in some way responsible for it.
@ItemDamage
Fires when the character damages an item.
@ItemDClick
Fires when the character double-clicks an item.
@ItemDropOn_Char
Fires when the character drops an item on to a character.
@ItemDropOn_Ground
Fires when the character drops an item on to the ground.
@ItemDropOn_Item
Fires when the character drops an item on to another item.
@ItemDropOn_Self
Fires when the character drops an item inside another item.
@ItemEquip
Fires when the character equips an item.
@ItemEquipTest
Fires when the characer is about to equip an item.
@ItemPickUp_Ground
Fires when the character picks an item up from the ground.
@ItemPickUp_Pack
Fires when the character picks an item up from inside a container.
@ItemPickUp_Self
Fires when the character picks an item up from inside another item.
@ItemPickUp_Stack
Fires when the character picks up an item from a stack.
@ItemSell
Fires when the character sells an item to a vendor.
@ItemSpellEffect
Fires when the character hits an item with a spell.
@ItemStep
Fires when the character steps on an item.
@ItemTargOn_Cancel
Fires when the character cancels an item's target cursor.
@ItemTargOn_Char
Fires when the character targets a character with an item's target cursor.
@ItemTargOn_Ground
Fires when the character targets the ground with an item's target cursor.
@ItemTargOn_Item
Fires when the character targets an item with an item's target cursor.
@ItemToolTip
Fires when the character requests old-style tooltips for an item.
@ItemUnEquip
Fires when the character unequips an item.
@Jailed
Fires when the character is sent to jail.
@KarmaChange
Fires when the character's karma changes.
@Login
Fires when the character logs in.
@Logout
Fires when the character logs out.
@Mount
Fires when the character mounts a ride.
@MurderDecay
Fires when one of the character's kills is about to decay.
@MurderMark
Fires when the character is about to gain a kill.
@PersonalSpace
Fires when the character is stepped on.
@PetDesert
Fires when the character deserts its owner.
@Profile
Fires when a player attempts to read the character's profile from the paperdoll.
@ReceiveItem
Fires when the NPC receives an item from another character, before they decide if they want it or not.
@RegionEnter
Fires when the character enters a region.
@RegionLeave
Fires when the character leaves a region.
@Rename
Fires when the character renames another.
@SeeCrime
Fires when the character sees a crime take place.
@SkillAbort
Fires when the character aborts a skill.
@SkillChange
Fires when the character's skill level changes.
@SkillFail
Fires when the character fails a skill.
@SkillGain
Fires when the character has a chance to gain in a skill.
@SkillMakeItem
Fires when the character crafts an item.
@SkillMenu
Fires when a skill menu is shown to the character.
@SkillPreStart
Fires when the character starts a skill, before any hardcoded action takes place.
@SkillSelect
Fires when the character selects a skill on their skill menu.
@SkillStart
Fires when the character starts a skill.
@SkillSuccess
Fires when the character succeeds at a skill.
@SkillUseQuick
Fires when the character quickly uses a skill.
@SpellBook
Fires when the character opens their spellbook.
@SpellCast
Fires when the character casts a spell.
@SpellEffect
Fires when the character is hit by the effects of a spell.
@SpellFail
Fires when the character fails to cast a spell.
@SpellSelect
Fires when the character selects a spell to cast.
@SpellSuccess
Fires when the character successfully casts a spell.
@StatChange
Fires when the character's STR, DEX or INT is changed through skill gain.
@StepStealth
Fires when the character takes a step whilst hidden.
@ToolTip
Fires when a player requests old-style tooltips for this character.
Subcategories
This category has the following 3 subcategories, out of 3 total.
C
Combat
N
NPCS
P
Players
Pages in category "Characters"
The following 49 pages are in this category, out of 49 total.
@
@Attack
@CallGuards
@CharAttack
@ClientTooltip
@CombatAdd
@CombatDelete
@CombatEnd
@CombatStart
@Death
@DeathCorpse
@GetHit
@Hit
@HitMiss
@HitParry
@Kill
@MurderDecay
@MurderMark
@NPCAcceptItem
@NPCActFight
@NPCActFollow
@NPCAction
@NPCActWander
@NPCHearGreeting
@NPCHearUnknown
@NPCLookAtChar
@NPCLookAtItem
@NPCLostTeleport
@NPCRefuseItem
@NPCRestock
@NPCSeeNewPlayer
@NPCSeeWantItem
@NPCSpecialAction
@RegionResourceFound
@TradeAccepted
@UserBugReport
@UserChatButton
@UserExtCmd
@UserExWalkLimit
@UserGuildButton
@UserKRToolbar
@UserMailBag
@UserQuestArrowClick
@UserQuestButton
@UserSkills
@UserSpecialMove
@UserStats
@UserVirtue
@UserVirtueInvoke
@UserWarmode

--- PAGE BREAK ---

Pages in category "Combat"
The following 16 pages are in this category, out of 16 total.
@
@Attack
@CallGuards
@CharAttack
@CombatAdd
@CombatDelete
@CombatEnd
@CombatStart
@Death
@DeathCorpse
@GetHit
@Hit
@HitMiss
@HitParry
@Kill
@MurderDecay
@MurderMark

--- PAGE BREAK ---

Items
Here is a list of all
item
triggers. Click on the trigger name for more detailed information such as arguments and examples.
Name
Description
@AfterClick
Fires when the object has been single-clicked, just before the overhead name is shown.
@Buy
Fires when the item is being bought from a vendor.
@Click
Fires when the object has been single-clicked.
@ClientTooltip
Fires when tooltips are about to be sent to a client.
@ContextMenuRequest
Fires when a client requests the context menu options for the object.
@ContextMenuSelect
Fires when a client selects a context menu option for the object.
@Create
Fires when the object is initially created, before it is placed in the world.
@Damage
Fires when the item receives damage.
@DClick
Fires when the object is double-clicked.
@Destroy
Fires when the object is being deleted.
@DropOn_Char
Fires when the item has been dropped on to a character.
@DropOn_Ground
Fires when the item has been dropped on to the ground.
@DropOn_Item
Fires when the item is dropped on to another item.
@DropOn_Self
Fires when an item has been dropped on to this item.
@Equip
Fires when the item has been equipped.
@EquipTest
Fires when the item is about to be equipped.
@PickUp_Ground
Fires when the item ihas been picked up from the ground.
@PickUp_Pack
Fires when the item is picked up from inside a container.
@PickUp_Self
Fires when an item has been picked up from inside the item.
@PickUp_Stack
Fires when the item is picked up from a stack.
@Sell
Fires when the item is sold to a vendor.
@SpellEffect
Fires when the object is hit by the effects of a spell.
@Step
Fires when a character steps on the item.
@TargOn_Cancel
Fires when a target is cancelled from the item.
@TargOn_Char
Fires when a character is targeted from the item.
@TargOn_Ground
Fires when the ground is targeted from the item.
@TargOn_Item
Fires when an item is targeted from this item.
@Timer
Fires when the item's timer expires.
@ToolTip
Fires when old-style tooltips are requested for the item.
@UnEquip
Fires when the item is unequipped.
Pages in category "Items"
This category contains only the following page.
@
@ClientTooltip

--- PAGE BREAK ---

Pages in category "NPCS"
The following 15 pages are in this category, out of 15 total.
@
@NPCAcceptItem
@NPCActFight
@NPCActFollow
@NPCAction
@NPCActWander
@NPCHearGreeting
@NPCHearUnknown
@NPCLookAtChar
@NPCLookAtItem
@NPCLostTeleport
@NPCRefuseItem
@NPCRestock
@NPCSeeNewPlayer
@NPCSeeWantItem
@NPCSpecialAction

--- PAGE BREAK ---

Subcategories
This category has only the following subcategory.
P
Players
Pages in category "Players"
The following 20 pages are in this category, out of 20 total.
@
@PartyDisband
@PartyInvite
@PartyLeave
@PartyRemove
@TradeAccepted
@UserBugReport
@UserChatButton
@UserExtCmd
@UserExWalkLimit
@UserGuildButton
@UserKRToolbar
@UserMailBag
@UserQuestArrowClick
@UserQuestButton
@UserSkills
@UserSpecialMove
@UserStats
@UserVirtue
@UserVirtueInvoke
@UserWarmode

--- PAGE BREAK ---

Regions
Here is a list of all
region
triggers. Click on the trigger name for more detailed information such as arguments and examples.
Name
Description
@CliPeriodic
Fires multiple times approximately every 30 seconds, for each client in the region.
@Enter
Fires when a character enters the region.
@Exit
Fires when a character exits the region.
@RegPeriodic
Fires once approximately every 30 seconds, as long as there is at least one client in the region.
@Step
Fires whenever a character takes a step within the region.
@ResourceTest
Fires when the resource is being considered for spawning.
@ResourceFound
Fires when the resource is spawned.
This category currently contains no pages or media.

--- PAGE BREAK ---

Skills
The following table lists all of the triggers that can be placed under a skill definition. All of the triggers here have an equivalent @Skill trigger on the
character
object.
Name
Description
@Abort
Fires when a character aborts an attempt at using the skill.
@Fail
Fires when a character fails an attempt at using the skill.
@Gain
Fires when a character is given the chance to gain in the skill.
@PreStart
Fires when a character starts to use the skill, before any hardcoded behaviour takes place.
@Select
Fires when a character selects the skill from their skill menu.
@Start
Fires when a character starts to use the skill.
@Success
Fires when a character succeeds an attempt at using the skill.
@UseQuick
Fires when a character quickly uses the skill, without changing their
ACTION
.
This category currently contains no pages or media.

--- PAGE BREAK ---

Spells
The following table lists all of the triggers that can be placed under a spell definition. All of the triggers here have an equivalent @Spell trigger on the
character
object.
Name
Description
@Effect
Fires when a character or item is hit by the spell.
@EffectAdd
Fires when a spell memory item is being added.
@EffectRemove
Fires when a spell memory item is removed.
@Fail
Fires when a character fails to cast the spell.
@Select
Fires when a character selects to cast the spell, or when Sphere checks if a character is capable of casting it.
@Start
Fires when a character starts to cast the spell.
@Success
Fires when a character successfully casts the spell.
This category currently contains no pages or media.

--- PAGE BREAK ---

Subcategories
This category has the following 8 subcategories, out of 8 total.
C
Characters
Combat
I
Items
N
NPCS
P
Players
R
Regions
S
Skills
Spells
Pages in category "Triggers"
The following page is in this category, out of 201 total.
(
previous page
) (next page)
T
Tr:@SpellTargetCancel
(
previous page
) (next page)

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character is about to disband a party.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
disbanding the party (master).
SRC
The
character
disbanding the party (master).
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Cancels the action.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character has sent the invitation and before the other player receive it.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
getting the invitation the party.
SRC
The
character
inviting to the party (master).
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Cancels the invite. Player won't receive the invitation.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character is about to leave a party.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
leaving the party.
SRC
The
character
leaving the party.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
No arguments are set for this trigger.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Cancels the action.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character is about to be removed from a party by it's party master.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
I
The
character
being removed from the party.
SRC
The
character
removing another from the party (master).
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
when argn1=1, means informative remove when a @PartyDisband has been fired before and is in proccess now. In this case, no return can stop this action.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
1
Cancels the action.

--- PAGE BREAK ---

Contents
1
Description
2
References
3
Arguments
4
Return Values
Description
This trigger fires when a character sees someone Snooping something.
Fires on:
Characters
References
The following object references are explicitly available for this trigger:
Name
Description
ARGO
The
victim
of the crime.
I
The
character
witnessing the crime.
SRC
The
character
performing the criminal action.
Arguments
The following arguments are set for this trigger. If an argument is marked as "In" then a value will be passed in to the trigger, if an argument is marked as "Out" then it can be set to a value to affect Sphere's behaviour:
Argument
In/Out
Description
ARGN1
I
The skill number that is needed to see the crime. (-1 = seen by all)
ARGN2
I
The
UID
of the object related to the action. (e.g. a corpse, if the action is looting)
ARGS
I
A description of the criminal action.
Return Values
The following return values are explicitly defined for this trigger:
Return Value
Description
0
Allows the character to see the crime, with no skill check taking place.
1
Prevents the character from seeing the crime.

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Açıklama
2
Referanslar
3
Seçenekler
4
Geri Bildirim Verileri
Açıklama
Bu trigger bir eşya donatıldığı zaman devreye girer ve Sphere karakterin eşyayı kullanabilir olup, olmadığına karar verir.
Kullanılabilir:
Items
Referanslar
Aşağıda belirtilen referanslar bu trigger için mümkündür:
İsim
Açıklama
I
Teçhiz edilen
eşya
.
SRC
Eşya ile donatılan
karakter
.
Seçenekler
Aşağıda bu trigger için mümkün olan seçenekler bulunmaktadır. Eğer parametrelerden herhangi biri "Okunabilir" olarak seçilmiş ise, bu parametre <KOMUT> ile okunabileceğini gösterir. Eğer bir parametre "Yazılabilir" görünüyorsa bu parametre değiştirilebilir demektir.
Bu trigger için herhangi bir seçenek yoktur.
Geri Bildirim Verileri
Takip etmekte olan geribildirimler, bu trigger için kullanılabilir:
Return
Açıklama
1
Eşyanın techiz edilmesini engeller.

--- PAGE BREAK ---

Note: This is a test for  a language toolbar. The template is taken from the openstreetmap-wiki.
Do not edit this template too often. This template is linked from many pages, when you renew it, the wiki-server starts to rebuild database of link connections. It takes about 20 seconds for each page.
Instructions were moved to
Wiki Translation
:
Help
Available languages
Missing languages

--- PAGE BREAK ---

This template is called by
Template:Languages
to make the default interface of the language bar.
example
Help
Available languages
English exist
Missing languages
French is missing

--- PAGE BREAK ---

The reference compendium documents everything you may find in a Sphere script, ranging from things such as definitions in scripts to objects and their associated functions, properties, references and triggers.
Subcategories
This category has the following 15 subcategories, out of 15 total.
C
Characters
Combat
D
Definitions
F
Functions
I
Items
N
NPCS
O
Objects
P
Players
R
Regions
S
Scripts
Skills
Spells
Statements
T
Triggers
V
Variables
Pages in category "Reference Compendium"
The following 42 pages are in this category, out of 242 total.
(
previous page
) (next page)
A
AEXECUTE
AQUERY
AREADEF
ATTACKER
C
Characters
CHARDEF
CONNECT
D
Database
De:Database
De:Intrinsic Functions
DIALOG
E
EVENTS
F
Files
G
GM Pages
I
Intrinsic Functions
ITEMDEF
Items
L
LAYER
LIST
M
Map Points
MENU
N
NOTORIETY
P
Parties
Portuguese:Intrinsic Functions
R
REGIONRESOURCE
Regions
REGIONTYPE
ROOMDEF
Rooms
S
Sectors
Server
SKILL
SKILLCLASS
SKILLMENU
SPAWN
Special Items
SPELL
T
TARGETF
Tr:@EquipTest
Tr:@SpellTargetCancel
Tr:ATTACKER
TYPEDEF
(
previous page
) (next page)

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
spheretables.scp
2
Sphere.ini
3
sphere_region.scp
4
sphere_mapX.scp
5
sphere_book.scp
6
sphere_name.scp
7
sphere_newb.scp
8
sphere_skill.scp (SKILLCLASSES)
9
sphere_serv_triggers.scp
spheretables.scp
Spheretables.scp  ist die allererste Datei, die beim Start von Sphere genau nach der Sphere.ini eingelesen wird. Deshalb ist sie äusserst wichtig. Viele weitere Einstellungen werden innerhalb dieser Datei vorgenommen und das macht sie so wichtig. Deshalb wird diese Datei hier nun erklärt und aufgeschlüsselt:
==
[RESOURCES]
==
Öffnet man diese Datei, fällt einem als erstes eine Liste von Dateien ins Auge. Diese Liste ist durch das [RESOURCE]-Tag markiert und sieht so aus:
[RESOURCES]
scripts/sphere_defs.scp
scripts/sphere_book.scp
scripts/sphere_backward_compatibility.scp
scripts/sphere_events_human.scp
scripts/sphere_events_npcs.scp
scripts/npcs/
...
Hier wird eingestellt, welche und in welcher Reihenfolge Skriptdateien von Sphere geladen werden. Manchmal sollten hier Änderungen mit äusserster Vorsicht vorgenommen werden. Dateien mit DEFNAMES, REGIONS und anderen global benutzten Einstellungen sollten als erstes geladen werden, um Fehler beim Start von Sphere zu vermeiden (obgleich diese Fehler oftmals den Server nicht beeinträchtigen). Beispielsweise wurde in
Kapitel 1
das Goldskript behandelt:
TYPE=t_gold
Wurde die sphere_defs.scp nicht vor dem Goldskript geladen, weiss Sphere nicht was t_gold bedeutet, dann wird eine Fehlermeldung ausgegeben. Deshalb sollte vor dem Goldskript auf alle Fälle zuerst die sphere_defs.scp geladen werden, in der t_gold definiert wurde.
Skripte mit Itemdefinitionen sollten vor Skripten mit Templatedefinitionen geladen werden und danach dann die Characterdefinitionen. Andere Dateien folgen danach, aber diese Dateien sollten auf jeden Fall in dieser Reihenfolge sein. Der Loot von Monstern benötigt Templates und die wiederum Items und solange Sphere keine Dateien mit Templates oder Items geladen hat, werden hunderte Fehler ausgegeben, die dann korrigiert werden müssen.
Anmerkung
:
Es können ganze Ordner angegeben werden, es muss nicht jede einzelne Datei in der Liste aufgeführt werden. Deshalb enthält die Liste beispielsweise
scripts/
am ende von [RESOURCE], damit alle Skripte dieses Ordner geladen werden, die noch nicht aufgeführt wurden.
==
[OBSCENE]
==
Die nächste Sektion ist selbsterklärend: [OBSCENE]. Hier werden unerlaubte Namen aufgeführt. Versucht ein Spieler seinem Charakter einen Namen aus der Liste zu geben, dann wird ihm mitgeteilt, dass er einen anderen wählen soll.
==
[NOTOTITLES]
==
Hier werden Titel definiert, die basierend auf dem Karmawert eines Spielers angezeigt werden. Diese Sektion sollte nicht angerührt werden, denn fehlt hier eine Zeile wird Sphere nicht mehr starten - diese Zeilen sollten höchstens geändert werden.
==
[PLEVEL X]
==
Dieser Abschnitt legt fest, welche Befehle mit welchen Accountrechten (PLEVEL) ausgeführt werden können. Jeder nichtgelistete Befehl wird automatisch mit PLEVEL 4 eingeordnet. Das gilt auch für selbstgeschriebene Funktionen (siehe
Kapitel 6
). Wie man sieht, gibt es eine große Liste an Befehlen und Funktionen.
Anmerkung
: Es muss nicht jede selbstgeschriebene Funktion in diese Liste, da jederzeit weitere [PLEVEL]-Sektionen in anderen Skripten angelegt werden können, obgleich es natürlich organisatorisch besser wäre, diese würden zentral gehalten.
==
[RUNES]
==
Das ist die Liste der Worte, die gesagt werden, wenn ein Spruch gezaubert wird (An, Lor, In, usw.). Sie können geändert werden, aber das kann durchaus sehr verwirren. =P
Sphere.ini
Sphere.ini enthält alle internen Einstellungen des Sphere Emulators. Um einen Shard zu konfigurieren sollte hier begonnen werden. Um die Datei besser zu erklären, wurden Kommentare in
fetter Schrift
eingefügt.
//****************************************************************************
// SPHERE by : Menasoft 1997-2003
// www.sphereserver.com
// All SPHERE script files and formats are copyright Menasoft & Partners.
// This file may be freely edited for personal use, but may not be distributed
// in whole or in part, in any format without express written permission from
// Menasoft & Partners. All donations and contributions
// become the property of Menasoft & Partners.
//****************************************************************************
///////////////////////////////////////////////////////////////
//////// General Information
///////////////////////////////////////////////////////////////
[SPHERE]
// Name of your Sphere shard
ServName=
WarAngel's Test Centre
// The IP of your server, this will be 127.0.0.1 almost always
ServIP=127.0.0.1
// The port of your server, this is 2593 by default
ServPort=2593
// Admin's contact email
AdminEmail=
warangel999@msn.com
// Web page for this server
URL=www.myshard.com Replace www.myshard.com with your shard's URL'
// GMT offset, from -12 to +12 [London=0, EST=5, etc]
TimeZone=
-5 Östliche Zeitzone (US & Canada). Sollte passend eingestellt werden.
// Official staff language
Lang=English
// Start this as a system service on Win2000, XP, NT
NTService=0
Wird diese Einstellung aktiviert, ist kein Zugriff auf die Konsole mehr möglich.
// MySql configuration.
//MYSQL=0
Auf =1 wird MySQL aktiviert.
//MySqlHost=
localhost Wird fast immer localhost sein, ausser MySQL läuft auf einen anderen Rechner als der Shard.
//MySqlUser=
//MySqlPassword=
//MySqlDatabase=
///////////////////////////////////////////////////////////////
//////// File Locations
///////////////////////////////////////////////////////////////
// Directory where spheretables.scp is located, from there we will
// load any additional scripts
ScpFiles=scripts/
// Where your sphereworld.scp and spherechars.scp are located
WorldSave=save/
// Where your sphereaccu.scp and sphereacct.scp is located
AcctFiles=accounts/
// Where your UO installation is located. This need: map0.mul, statics0.mul,
// staidx0.mul, multi.mul, multi.idx, hues.mul, tiledata.mul.
// Optional files: verdata.mul, mapX.mul/staticsX.mul/staidxX.mul for higher
// maps support (Malas, etc).
//
// Note that if not set, sphere will scan windows registry to auto-detect it
//MulFiles=mul/
// Where your log files will be saved by sphere
Log=logs/
///////////////////////////////////////////////////////////////
//////// World Save Information
///////////////////////////////////////////////////////////////
// How often for Sphere to save your world (minutes)
SavePeriod=20
// How many backup levels to keep. Each level means 7 backups done for it.
// So, 10*7 = 70 backup saves will be storied.
BackupLevels=10
// On would save in the background quietly over a longer period of time, and not interrupt the game
// Off would notify "World save has been initiated" and save faster, but pause the game momentarily
SaveBackground=0
///////////////////////////////////////////////////////////////
//////// Account Management
///////////////////////////////////////////////////////////////
//Code for servers account application process
// 0=Closed, // Closed. Not accepting more.
// 2=Free, // Anyone can just log in and create a full account.
// 3=GuestAuto, // You get to be a guest and are automatically sent email with u're new password.
// 4=GuestTrial, // You get to be a guest til u're accepted for full by an Admin.
// 6=Unspecified, // Not specified.
// To enable auto account you must set this to 2
AccApp=0
// Store password hashed with MD5
MD5 ist eine Verschlüsselungsmethode zur Speicherung von Passwörtern. Mehr Information:
hier
Md5Passwords=0
// local ip is assumed to be the admin
LocalIPAdmin=1
// Number of chars allowed per account
MaxCharsPerAccount=5
// Min time for a char to exist before delete allowed (in seconds)
MinCharDeleteTime=3*24*60
// Max number of Guest accounts allowed
GuestsMax=0
///////////////////////////////////////////////////////////////
//////// Client Management
///////////////////////////////////////////////////////////////
// What client protocol version used
// Comment out the ClientVersion line to allow any client that is supported.
//ClientVersion=2.0.3
// Set this to 0 to block login to encrypted clients
Normalerweise benutzen Clients Verschlüsselung.
UseCrypt=1
// Set this to 1 to allow login to unencrypted clients
Klappt mit Tools wie bspw.:
UO Rice
und
UOGateway
die Verschlüsselung eines Clients zu entfernen
UseNoCrypt=0
// Maximum total open connections to server
ClientMax=256
// Maximum open connections to server per IP
ClientMaxIP=16
// Maximum total (not-in-game) connections to server
ConnectingMax=32
// Maximum total simultaneous (not-in-game) connections to server per IP
ConnectingMax=8
// How long logged out clients linger in seconds
ClientLinger=15
// Walk limiting code: buffer size (in tenths of second)
WalkBuffer=75
// Walk limiting code: regen speed (%)
WalkRegen=25
// Only commands issued by this plevel and higher will be logged
CommandLog=0
0 bedeutet, dass alle Befehle geloggt werden.
// Prefix for ingame commands
CommandPrefix=.
// Use the built in http server
UseHttp=1
// Use the built in god port
UseGodPort=0
This is for use with the God client
// Default setting for all accounts specifying default resdisp. Recommended
// specifying at least 1 (T2A) here.
//AutoResDisp=0
0=autmatisch herausfinden, 1=T2A, 2=LBR, 3=AoS, 4=SE, 5=ML
// Default setting for new accounts specifying default priv level
//AutoPrivFlags=010
///////////////////////////////////////////////////////////////
//////// Game Mechanics
///////////////////////////////////////////////////////////////
// Do not allow entering under roof being on horse?
MountHeight=0
// Archery does not work if too close (0 = not checked)
ArcheryMinDist=2
// Maximum Distance for Archery
ArcheryMaxDist=15
// Speed scale factor for weapons
Formel ist: VERZÖGERUNG = SPEEDSCALEFACTOR /((DEX + 100) * SPEED)
SpeedScaleFactor=15000
// This is the percent of max weight at which stamina is lost half the time
// (200 = no effect)
StaminaLossAtWeight=150
// Weight penalty for running +N% of max carry weight (0 = no effect)
RunningPenalty=50
// Show people joining/leaving the server
ArriveDepartMsg=1
// Are house and boat keys newbied automatically
AutoNewbieKeys=1
// Maximum number of items allowed in bank
BankMaxItems=1000
// Maximum weight in stones allowed in bank
BankMaxWeight=1000
// If 1 vendors will take gold only from backpack
PayFromPackOnly=0
Wenn 0, dann nehmen Händler auch Geld vom Bankfach.
// Disable weather effects?
NoWeather=1
// Default light level in dungeons
DungeonLight=27
0 ist am helssten, 30 ist am dunkelsten
// Day light level 0-30
0 ist am helssten, 30 ist am dunkelsten
LightDay=0
// Night light level 0-30
LightNight=25
// Wool Regen Time (in minutes)
WoolGrowthTime=30
// Suppress player speech with 75% of capital letters
SuppressCapitals=0
// Extra combat flags to control the fight (default:0, 0.55i compatible)
// COMBAT_NODIRCHANGE 00001 // not rotate player when fighting (like was in 0.51a)
// COMBAT_FACECOMBAT 00002 // allow faced combat only (recommended)
//CombatFlags=0
Sind beide aktiviert, dann bedeutet das, dass der Spieler den Gegner ansehen muss, um ihn zu treffen.
///////////////////////////////////////////////////////////////
//////// NPC/Item/Player Management
///////////////////////////////////////////////////////////////
// Distance in tiles before an NPC that's wandered too far from it's home will teleport back
LostNPCTeleport=50
// Wether PCs get a resurrection robe when they get resurrected.
NoResRobe=0
// Time for a NPC corpse to decay mins
CorpseNPCDecay=10
// Time for a playercorpse to decay mins
CorpsePlayerDecay=15
// Base decay time in minutes for items
DecayTimer=30
// Put [NPC] tags over chars
oder [TAME], wenn der NPC gezähmt wurde
CharTags=0
// Flip dropped items
FlipDroppedItems=0
// Monsters run when scared of death
MonsterFear=0
// Monsters may fight each other
MonsterFight=0
// Percent setting of the all NPC move rate, default 100
MoveRate=100
// Do players receive sounds
GenericSounds=1
// Max number of items to sell to one person at once
VendorMaxSell=255
// Max level npc trainers can go
NPCTrainMax=300
300 ist 30.0 skill
// Percent of own ability npcs can train to
NPCTrainPercent=30
// Max level of skill trainable on dummies, archery butte ect..
SkillPracticeMax=300
300 ist 30.0 skill
// Max skill player's will start with on skills they haven't chosen during char create
MaxBaseSkill=200
Hier eine 0, damit Spieler mit keinen Skills ausser den gewählten beginnen.
// Time in seconds for hitpoint regeneration
Regen0=40
// Time in seconds for mana regeneration
Regen1=20
// Time in seconds for stamina regeneration
Regen2=10
// Time in seconds for food degeneration
// 60*60*24 = 1 day of real life time
Regen3=60*60*24
// Speech block associated to players
SpeechSelf=spk_player
// Speech block associated to pets
SpeechPet=spk_pet
// When player skills/stats goes this times more than skillclass allowed, drop
// them to skillclass level. Setting this to 0 disables the action.
OverSkillMultiply=2
// NPC AI settings
// NPC_AI_PATH 0001 NPC pathfinding
// NPC_AI_FOOD 0002 NPC food search (objects + grass)
Sorgt dafür, dass NPCs nach Essen bzw Gras suchen (siehe FOODTYPE)
// NPC_AI_EXTRA 0004 NPC magics, combat, etc
//NPCAI=0
///////////////////////////////////////////////////////////////
//////// Crime/Murder/Karma/Fame/Guard Settings
///////////////////////////////////////////////////////////////
// Karma when player goes from good to neutral (from -10000 to 10000)
PlayerNeutral=-2000
// How many minutes are criminals flagged for
CriminalTimer=3
// Times a player can snoop before becoming a criminal
SnoopCriminal=20
// Seconds time to decay a murder count (default 8*60*60 is 8 hours)
MurderDecayTime=8*60*60
// Amount of murders before we get title
MurderMinCount=1
// Looting or carving a blue player is a crime
LootingIsaCrime=1
// Flag players criminal for helping criminals?
HelpingCriminalsIsaCrime=1
// How long do guards linger about in minutes
GuardLinger=3
// Will guards kill instantly or follow normal combat rules
GuardsInstantKill=1
// Limits the MAXHITS/MAXMANA/MAXSTAM changes
// STAT_FLAG_NORMAL 0x00 // MAX* status allowed (default)
// STAT_FLAG_DENYMAX 0x01 // MAX* denied
// STAT_FLAG_DENYMAXP 0x02 // .. for players
// STAT_FLAG_DENYMAXN 0x04 // .. for npcs
StatsFlags=0
///////////////////////////////////////////////////////////////
//////// Server Mechanics
///////////////////////////////////////////////////////////////
// Experimental flags
// Flags for options that affect server behaviour and which might affect compatibility
// See the revisions.txt file for more details on this
// EF_DiagonalWalkCheck = 00000001
// EF_UNICODE = 00000002 // No on Linux
Bringt UNICODE Korrekturen
// EF_Scripts_Ret_Strings = 00000004
// EF_New_Triggers = 00000008
// EF_Scripts_Parse_Verbs = 00000010
// EF_Intrinsic_Locals = 00000020 //
Erlaubt locals anders zu nutzen. Beispielsweise kann statt <local.x> auch nur <x> benutzt werden.
// EF_Item_Strict_Comparison = 00000040 //
Sorgt dafür, dass gleiche Items nicht mehr verglichen werden, wie Stoff, Leder, Fell, Holz, Bretter, Pfeile und Bolzen.
// EF_WalkCheck = 00000100
//Behebt viele Hauseinbruchsbugs und ähnliche Probleme.
// EF_Script_Profiler = 00000400
// EF_Size_Optimise = 00000800
// EF_Minimize_Triggers = 00001000 //Minimize trigger calls (use only 0.51 triggers)
Experimental=00000
// Option flags
// Flags for options that affect server behaviour but not compatibility
// See the revisions.txt file for more details on this
// OF_Magic_IgnoreAR = 00000001 //
Magieschaden ignoriert Rüstung (AR)?
// OF_Magic_CanHarmSelf = 00000002 //
Kann sich ein Spieler mit Magie selbst verletzen? (einen Magic Arrow auf sich abfeuern, um Lähmung (Paralyze) zu beenden?)
// OF_Magic_StackStats = 00000004
// OF_Archery_CanMove = 00000010 //
Kann ein Spieler laufen und schiessen gleichzeitig?
// OF_Magic_PreCast = 00000020 //
Funktionieren Zauber mit pre-cast oder ist der Spieler solange er zaubert unfähig herumzulaufen?
// OF_Items_AutoName = 00000040
// OF_FileCommands = 00000080 //
Aktiviert Befehle zur Dateiverarbeitung, wie writefile usw
// OF_NoItemNaming = 00000100 //
Verhindert die Benennung von Gegenständen mit "crafted by"
// OF_NoHouseMuteSpeech = 00000200 //
Können sich spieler in und ausserhalb von Häusern gegenseitig hören?
// OF_Multithreaded = 00000400 //
Nicht setzen, solange der Server läuft!!! (Macht *Nix Server instabil) Lässt die Verarbeitung von Accounts auf einem anderen Thread laufen
// OF_Advanced_LOS = 00000800
// OF_Flood_Protection = 00001000
OptionFlags=0200
// FeatureT2A, used to control T2A expansion features ( default 03 )
// FEATURE_T2A_UPDATE 01 // Monster and Lost lands
// FEATURE_T2A_CHAT 02 // In game chat
FeatureT2A = 03
// FeatureLBR, used to control LBR expansion features ( default 0 )
// FEATURE_LBR_UPDATE 01 // Lbr Monsters
// FEATURE_LBR_SOUND 02 // MP3 instead of MIDI
FeatureLBR = 0
// FeatureAOS, used to control AOS expansion features ( default 0 )
// Enabling one of them automagically enables AoS basic features
// FEATURE_AOS_UPDATE 01 // Basic AoS feature
// FEATURE_AOS_POPUP 02 // Popup infos
// FEATURE_AOS_DAMAGE 04 // Damage shown on hit
// FEATURE_AOS_PALNECRO 08 // Fightbook and Paladin/Necro on char creation
// FEATURE_AOS_TOOLTIP 010 // Tooltips
FeatureAOS = 0
// FeatureSE, used to control SE expansion features ( default 0 )
// FEATURE_SE_UPDATE 01 // Basic SE features
// FEATURE_SE_NINJASAM 02 // Ninja and Samurai
FeatureSE = 0
// FeatureML, used to control ML expansion features ( default 0 )
// FEATURE_ML_UPDATE 01 // Basic ML features
FeatureML = 0
// In game effects to turn on and off
// Messages echoed to the server console while in debug mode
// DEBUGF_NPC_EMOTE = 0x0001
// DEBUGF_ADVANCE_STATS = 0x0002
// DEBUGF_WALKCODES = 0x0080 // try the new walk code checking stuff
// DEBUGF_NPCAI = 0x0100 // some NPC AI debugging
// DEBUGF_EXP = 0x0200 // experience gain/loss
// DEBUGF_LEVEL = 0x0400 // experience level changes
DebugFlags=0
// Console Hears all that is said on the server
HearAll=1
// Secure mode attempts to ignore errors, protect from accidently shutdowns
Secure=1
// Value from 1 to 32, set sectors inactive when unused to conserve resources
SectorSleep=10
// Disconnect inactive socket in x min
DeadSocketTime=5
// Always force a full garbage collection on save
ForceGarbageCollect=1
// Time before restarting when server appears hung (in seconds)
FreezeRestartTime=60
// Length of the game world minute in real world in seconds
GameMinuteLength=60
// Bit Mask of the subjects you want to log when logging is on
// LOGM_ACCOUNTS 0x00080
// LOGM_SAVE 0x00200 // world save status.
// LOGM_CLIENTS_LOG 0x00400 // all clients as they log in and out.
// LOGM_GM_PAGE 0x00800 // player gm pages.
// LOGM_PLAYER_SPEAK 0x01000 // All that the players say.
// LOGM_GM_CMDS 0x02000 // Log all GM commands.
// LOGM_CHEAT 0x04000 // Probably an exploit !
// LOGM_KILLS 0x08000 // Log player combat results.
// LOGM_HTTP 0x10000
// 01ffff log everything
LogMask=01ec80
// Amount of time to keep map data cached in sec
MapCacheTime=120
// Max NPC chars for a sector to prevent lag
MaxComplexity=32
// Amount of items in one tile so start showing "too many items here"
MaxItemComplexity=25
// Amount of items in one sector to start showing "x items too complex"
MaxSectorComplexity=1024
// Limit the number of cycles the while/for loop can proceed. Setting this to
// zero disables the limitation
MaxLoopTimes=0
///////////////////////////////////////////////////////////////
//////// Magic/Effects Settings
///////////////////////////////////////////////////////////////
// Allow casting while equipped
EquippedCast=1
// Words of power for player using magic
WOPPlayer=1
// Words of power for staff using magic
WOPStaff=0
// Reagents lost if magic fails
ReagentLossFail=0
// Magic requires reagents
ReagentsRequired=0
// What % of hitpoints players will resurrect with. Note, that if you set this
// too low, people with little STR will have problems resurrecting.
HitPointPercentOnRez=33
// How many % of hits will the character loose when starving. 0 disables
//HitsHungerLoss=0
// Amount of skill of lock picking needed to unlock a magically locked door
MagicUnlockDoor=900
// Teleport effect for GMs and players. Setting 0 disables the effect
TeleportEffectStaff=03709
TeleportEffectPlayers=0372a
///////////////////////////////////////////////////////////////
//////// Experience and Level system
///////////////////////////////////////////////////////////////
// Enable experience system
//ExperienceSystem=0
// Experience system settings:
// 0001 gain experience in combat
// 0002 gain experience in crafts
// 0004 allow experience to go down
// 0008 limit experience decrease by a range witheen a current level
// 0010 auto-init EXP/LEVEL for NPCs if not set in @Create
// 0020 allow trigger @ExpChange
// 0040 allow trigger @ExpLevelChange
//ExperienceMode=0
// If combat experience gain is allowed, use these percents for gaining exp in
// Player versus Monster and Player versus Player combats. Value 0 disables gain.
//ExperienceKoefPVM=100
//ExperienceKoefPVP=100
// Enable levels system (as a part of experience system)
//LevelSystem=0
// Level system settings:
// linear = 0 (each NextLevelAt exp will give a level up)
// double = 1 (you need (NextLevelAt * (level+1)) to get a level up)
//LevelMode=1
// Amount of experience to raise to the next level
//LevelNextAt=0
///////////////////////////////////////////////////////////////
//////// Webpage Settings
///////////////////////////////////////////////////////////////
// Note, that you can catch error codes by creating sphere404.htm and so on
// for all HTTP error codes sphere support.
[WEBPAGE 1]
// Determines what html file is used as base for the status page
WebPageSrc=scripts\web\spherestatusbase.html
// Determines where the status page is saved
WebPageFile=scripts\web\status.html
// In seconds, how often the status file is updated
WebPageUpdate=60
// Required PLevel to view this page (0 = anyone, 6 = admins only)
PLevel=0
///////////////////////////////////////////////////////////////
//////// Abuse Control
///////////////////////////////////////////////////////////////
// Block these ips from the server
// 255 is a wildcard, so 255.255.255.255 disables anyone connecting.
[BlockIP]
//123.34.45.56
//123.45.56.78
///////////////////////////////////////////////////////////////
//////// Connection Information
///////////////////////////////////////////////////////////////
//First line should be the name of your shard (this is what people see when they connect)
//Second line should be the IP of your shard (this is almost always 127.0.0.1)
//Third line should be the port of your shard (this should be whatever ServPort is set to)
//Uncomment next 3 lines below this if you have a router
//First line should be a name different than your shard name above this
//Second line should be your real/external IP (www.whatismyip.com)
//Third line should be the shard port (this should be whatever ServPort is set to)
[SERVERS]
WarAngel's Test Centre
127.0.0.1
2593
//External
//my.ip.goes.here
//2593
[EOF]
MAPx
Ist zwar nicht in sphere.ini, kann aber genutzt weden (siehe REVISIONS.txt). Und zwar so:
MAPx=max_x,max_y,sector_size,real_map_number.
Beispiel: MAP1=7168,4096,512,-1
setzt die Größe von map1 auf 7168,4096, die Sektorgröße von map1 auf 512 und die -1 bedeutet, dass die Standarddatei für diese map benutzt wird.
Anderes Beispiel:
MAP50=7168,4096,64,3
Aktiviert die Map mit nummer 50, die eine Größe von 7168,4096, eine Sektorgröße von 64 hat und map3.mul, statics3.mul und staidx3.mul als Dateien benutzt.
sphere_region.scp
Dieses Skript stellt Orte auf der Karte ein und defniert, was bspw. dort an Metallen oder Holz abgebaut werden kann, was passiert, wenn diese Orte betreten werden und weiteres. Es enthält zudem Resource-Sektionen, die so aufgebaut sind:
[REGIONRESOURCE x]
Diese Sektion enthält den Skill, der benötigt wird, um diese Resource abzubauen, welche Resource der Spieler erhält und wie lange es dauert, damit sie "nachwächst". Ein Beispiel hierfür (es gibt einen Kommentar mit "//t_tree", der aber klar sein sollte, wenn das vorherige Kapitel über defnames gelesen wurde).
[REGIONRESOURCE mr_tree]
// lumberjacking default
// t_tree
SKILL=1.0,80.0
AMOUNT=9,30
REAP=i_log
REGEN=60*60*10
Diese Sektion definiert eine Resource, etwas das gesammelt werden kann. Es vergleicht Skill und Menge. Das bedeutet, dass mit Skill 1.0 maximal 9 i_log und mit Skill 80.ß maximal 30 i_log gesammelt werden können. Alles danach ist nur eine Erhöhung der Chance auf 30 i_log. In der SKILL-Zeile wird also eine Unter- und eine Obergrenze festgelegt, die AMOUNT-Zeile macht selbiges für die Mengen.
Was bringt uns das? Die Zeile:
REAP=i_log
. Das sagt dem Server, er soll i_log Items erstellen, wenn diese Resource gebraucht wird. Es kann hier alles stehen, was man auf seinem Shard sammelbar machen möchte.
Die nächste Zeile, REGEN, legt in Sekunden fest, wie lange es dauert, damit diese Resource wieder neu abgebaut werden kann. In diesem Beispiel sind das 60*60*10 Sekunden, also 10 Stunden. Als GM können die Punkte wahrgenommen werden, an denen Spieler geschürft oder abgeholz haben, denn dort liegen kleine Kristalle am Boden. Sie sehen wie Spawnpunkte aus, aber sind in Wahrheit Resourcenmarkierungen. Sie markieren, wo eine spezielle Resource geholt werden kann, wie viel geholt werden kann und welchen Typ die Resource hat. Sie haben zudem einen TIMER, der runterzählt (von bspw 36000) und der dann dafür sorgt, dass der Kristall bei 0 gelöscht wird.
[REGIONTYPE r_default_rock t_rock]
//Random rocks
RESOURCES=100.0 mr_nothing
RESOURCES=500.0 mr_iron
//RESOURCES=6.0 mr_rusty
//RESOURCES=6.0 mr_old_copper
//RESOURCES=6.0 mr_dull_copper
//RESOURCES=4.5 mr_bronze
RESOURCES=5.0 mr_copper
RESOURCES=2.0 mr_gold
RESOURCES=1.0 mr_rose
RESOURCES=2.0 mr_agapite
RESOURCES=1.0 mr_bloodrock
RESOURCES=1.0 mr_silver
RESOURCES=0.5 mr_verite
RESOURCES=0.2 mr_Valorite
RESOURCES=0.1 mr_mytheril
RESOURCES=0.1 mr_blackrock
RESOURCES=0.1 mr_diamond
Wow? Was sind das für Dinge? mr_iron, mr_agapite? Das ist nirgendwo in der Datei. Auch in sphere_defs.scp findet man diese Definitionen nicht, man muss in sphereitem_ore.scp nachsehen.
RESOURCES=50.0 mr_iron
Das sieht irgendwie bekannt aus. Würde es noch mehr, wenns so aussehen würde?
RESOURCES={ mr_iron 50 mr_copper 5 mr_gold 2 mr_rose 2 ...etc... }
Möchte wetten, dass es das würde, wenn die vorherigen Lektionen in Kapitel 1 gelesen wurden. Das ist eine gewichtete Liste von Resourcen. In einem etwas anderen Format, als die für Template genutzte Version, aber sie funktioniert genau so. Das ist der einzige Ort in allen Skripten, in denen Kommazahlen genutzt werden können, wie bspw 0.1 und 0.2. Eigentlich stimmt das nur halb, aber Sphere verdeckt erfolgreich, solange in jeder RESOURECE-Zeile eine Kommazahl steht. (Im übrigen sollte nicht ein
RESOURCES
mit einer Zufallsauswahl geskriptet werden. Sphere wird das nicht richtig auswerten, es sollte dieses Format genutzt werden.)
[REGIONTYPE r_default_rock t_rock]
Bedeutet:
r_default t_rock legt einen Defname für einen
REGIONTYPE
fest, der in anderen Skripten benutzt werden kann (im nächsten Abschnitt bspw. =P). t_rock ist ein Defname (siehe
sphere_defs.scp
) für Stein, was für Sphere festlegt wo Spieler welche Resource sammeln können (sollte es auf t_water geändert werden, kann im Wasser Erz geschürft werden, was sicher nicht ganz so beabsichtigt ist.)
Hoffentlich erklärt das sphere-resion.scp für jeden. Im nächsten Abschnitt wird gezeigt, wie REGIONTYPE-Einstellungen benutzt werden, damit die Resourcen auch wirklich im Spiel vorhanden sind.
sphere_mapX.scp
Willkommen zur einfachsten Datei in Sphere: spheremap.scp. Diese Datei ist vollständig fertiggestellt für die Standardmap. Es ist sehr selten, dass diese Datei verändert werden muss.
Eine Anmerkung, die gleich zu Anfang gesagt werden muss: wird diese Datei verändert, muss der Server neu gestartet werden, damit die Änderung auch übernommen wird. Sollte das innerhalb eine Resyncs passieren, wirds viele Fehler geben.
Diese Sektion zeigt, wie neue Regionen erstellt werden können, zu denen man mit dem .go Befehl reisen kann.
Es gibt momentan 5 Dateien in den Standardskripten, eine für jede Map (Felucca, Trammel, Ilshenar, Malas und Tokuno) die von 0 bis 4 durchnummeriert sind (sphere_map0.scp, sphere_map1.scp usw).
Ich benutze die Region Felucca als ein Beispiel für dieses Tutorial und hier das Skript dafür:
[AREADEF a_world]
NAME=Felucca
EVENTS=r_default,r_default_rock,r_default_water,r_default_tree,r_default_grass
GROUP=ALLMAP
P=1323,1624,55,0
RECT=0,0,6144,4096,0
Diese Zeilen bedeuten:
[AREADEF somedef]
: Wie in allen anderen Skripten ist das ein Defname - nur hier für eine Region auf dem Server.
Name
: Diese Zeile enthält einen Namen für die Region, der angezeigt wird, wenn der .where Befehl im Spiel benutzt wird. Zudem kann .go "Region Name" dafür benutzt werden, um dort hin zu reisen (keine zwei Regionen sollten den selben Namen haben, ansonsten wird hier einiges an Fehlern produziert).
Events
: Hier wird festgelegt, was alles in der Regeion passiert und welche Resourcen hier abbaubar sind (siehe den Abschnitt über REGEIONTYPE - diese können hier als EVENT benutzt werden). Neben den Resourcen können hier auch Trigger benutzt werden, die von den EVENTS aufgerufen werden können (wahrscheinlich bemerkt man hier, dass die REGIONTYPE-Sektionen nur Ereignisse für Regionen sind :P), wie beispielsweise @Enter und andere (siehe
Triggers
).
Group
: Das ist eine Axiseinstellung, die im Travelmenü Regionen gruppiert.
P
: Das ist der Ort, an den man mit .go "Region Name" gelangt. Jede Region hat eine solche Angabe und sie liegt normalerweise mitten in der Region oder an einem passenden ort. Wenn eine eigene Region erstellt wird, sollte ein solcher Punkt angegeben werden.
RainChance
: Legt die Chance auf Regeion in der Region fest (Rainchance=50 gibt eine 50% Wahrescheinlichkeit) der Rest bedeutet, dass es zu 50% schneit.
Rect
: Gibt die Grenzen der Region als Koordinaten an. Die ersten zwei Zahlen sind die Koordinaten des oberen linken Punktes und die zweiten der untere linke Punkt eines Rechtecks. Im Fall von Felucca ist das 0,0 bis 6144,4096 (RECT=0,0,6144,4096). Mit 56b kann auch ein fünfter Wert angegeben werden, nämlich die Karte, auf der die Region liegt, also RECT=0,0,6144,4096,0 (kann auch weggelassen werden, dann wird standardmäßig 0 verwendet - soll das nicht Map 0 sein, dann muss ein Wert angegeben werden, sonst gibts Fehler).
Flags
: Regionenflags bestimmen, was in einer Region los ist. Sie beschreiben, ob eine Region bewacht ist, welche Magie genutzt werden kann, wer hier wen verletzen kann und ob es hier regnen kann. Soll das verwendet werden, dann so:
Diese Zeile hinzufügen:
FLAGS=#
Natürlich sollte statt # eine Zahl verwendet werden! Wo diese nummern stehen? Es gibt vordefinierte, aber es gibt eine Liste.
Beispielsweise für eine bewachte und gesicherte Region, sehen sie so aus:
region_flag_safe    (02000)
+
region_flag_guarded (04000)
=
06000
Das wars. Die
FLAGS
werden auf 06000 gesetzt. "Aber, aber ... hiess es nicht, dass
DEFNAMEs
die Eingabe von Zahlen unnötig machen?" (siehe
Kapitel 1
.) Natürlich, deshalb geht das auch ohne Zahlen und zwar so:
FLAGS=region_flag_safe|region_flag_guarded
Das wars. Die Region ist bewacht und sicher.
Aus Sicht eines Admins ist das aber keine gute Idee. Eine derartige Region verhindert, dass Wachen wirklich jemanden töten können, sie rufen sich gegenseitig und werden zu keiner Handlung fähig sein und letztendlich Lag verursachen. Einfach glauben und keine Region mit diesen beiden Flags erstellen.
Hier ist die Liste der möglichen Flags (stehen auch in sphere_defs.scp und können sich von Zeit zu Zeit ändern):
[DEFNAME region_flags]
region_antimagic_all 00001        //
keine Magie möglich hier.
region_antimagic_recall_in 00002  //
kein Teleport,Recall hier her, keine Markierung von Runen.
region_antimagic_recall_out 00004 //
kein Recall nach draussen von hier aus.
region_antimagic_gate 00008       //
keine Gatezauber hier hin oder hier raus.
region_antimagic_teleport 00010   //
kein Teleport hier her.
region_antimagic_damage 00020     //
Keine "böse" Magie hier.
region_flag_ship 00040            //
Das hier ist ein Schiff - Schiffsbefehle klappen hier.
region_flag_nobuilding 00080      //
kein Gebäude in diesem Areal
region_flag_globalname 00100      //
Sicherstellen, dass der Name global gilt.
region_flag_announce 00200        //
Ankündigung an alle, dass diese Region betreten wird.
region_flag_insta_logout 00400    //
Instant Logout erlaubt. (Hotel?)
region_flag_underground 00800     //
Dungeon Areal. (kein Wetter)
region_flag_nodecay 01000         //
Items am Boden werden nie gelöscht.
region_flag_safe 02000            //
Diese Region sichert vor jedem Schaden.
region_flag_guarded 04000         //
siehe tag.guardowner
region_flag_no_pvp 08000          //
Spieler können sich nicht direkt Schaden.
Und das wars mit der
sphere_mapX.scp
Datei.
sphere_book.scp
Spherebook.scp ist eine der sinnlosesten Dateien, die zu finden ist. Wie oft liest man schon die Tips auf einem Shard, wenn man einloggt? Ich weiss, dass die meisten Spieler diese Rollen einfach wegklicken. Aber der Inhalt ist in dieser Datei festgelegt. Und Bücher - hab ich die erwähnt? Diese fast-unmöglich-zu-schreiben, selten benutzten Speicherverschwender?
[SCROLL SCROLL_MOTD]
[SCROLL SCROLL_NEWBIE]
[SCROLL SCROLL_GUEST]
Das sind die Sektionen, die Nachrichten definiert, wenn man einloggt. Alles, das hier nach diesen Tags steht, wird in einer Nachricht auftauchen. Welche Leerzeichen wo gebraucht werden, muss mit vielen Tests herausgefunden werden. Braucht etwas Zeit und es gibt keine echte Möglichkeit das gut zu erklären. Einfach versuchen. Achtung: es gibt hier keine Zeilenumbrüche - oder zumindest gabs in der Vergangenheit keine.
[TIP X]
Richtig. Das sind Tips, die es beim Start gibt. "Krieg ist für Kinder und alles Leben ungesund." ist einer davon. Sehr passend.
[BOOK title]
[BOOK title x]
Erstellt ein Buch mit DEFNAME Titel. Es legt eine Seitenzahl x nach dem DEFNAME fest und fügt Text auf einer bestimmten Seite hinzu. Sieht man die Beispielbücher an, kann man erahnen, wie das klappt. Die größte Schwierigkeit dieser Bücher ist die benutzte Schriftart im Spiel, so dass man nicht wirklich weiss, wieviele Zeichen es für eine Zeile oder Seite braucht. Beispielsweise passen mehr 'i's als 'w's oder 'm's in eine Zeile, weil diese Buchstaben größer sind. Ein Absatz kann mit der TAB Taste eingefügt werden.
sphere_name.scp
Eine einfache Datei. Es enthält eine Liste von Namen unter Sektionen mit verschiedenen
DEFNAMEs
. Die Namen sind wichtig, nicht der Inhalt, da man wahrscheinlich nie eine eigene Liste von Namen anlegen wird. Ich benutze diesen Emulator seit Jahren und habe nie diese Datei verändert.
Um auf die Liste der Namen zugreifen zu können, benutzt man das hier:
NAME=#NAMES_HUMANMALE
Das ersetzt automatisch auf einen Zufallsnamen aus der Liste
NAMES_HUMANMALE
.
Um eine Liste von Namen zu erstellen, sieht das so aus:
[NAMES EIN_DEFNAME]
ANZAHL_DER_NAMEN
NAMEN
Beispielsweise:
[NAMES NAMES_SPECIAL]
2
Hil
Hol
Schwierig, hm? Eigentlich wollte ich dafür keinen Abschnitt schreiben ...
sphere_newb.scp
Ich habs getan - kein eitler Humor unter diesem Titel! :)
Auf jeden Fall ist diese Datei oft Gegenstand vieler Fragen. "Wie sorge ich dafür, dass meine Spieler mit 10000 Gold anfangen?" oder "Wie gebe ich allen Schmieden 800 Barren?" Ich sag nicht, dass das sinnvoll wäre, aber in dieser Datei können solche Dinge geregelt werden.
[NEWBIE MALE_DEFAULT]
// Male Generic Starting Clothes
ITEMNEWBIE=i_shirt_plain
COLOR=colors_all
ITEMNEWBIE=random_pants
COLOR=colors_neutral
ITEMNEWBIE=random_shoes
COLOR=colors_neutral
ITEMNEWBIE=i_dagger
ITEMNEWBIE=i_candle
ITEMNEWBIE=i_book_sm
ITEMNEWBIE=i_gold,100
So sieht ein typisches Skript aus. Wie eine große Template, nicht wahr? Dafür gibts einen Grund. Es ist ein Template, es steht nur
ITEMNEWBIE
statt
ITEM
drin. In Kapitel 1 steht über Templates alles, was man wissen muss und genau so funktioniert das auch hier.
Das einzige wichtige in diesen Sektionen ist: alles MUSS einen eindeutigen Namen haben, den der Server finden kann. Es kann keine weitere Newbie-Sektion hinzugüfgt werden, so sehr das auch gewollt werden würde - sorry.
sphere_skill.scp (SKILLCLASSES)
Skill Klassen legen fest, wie weit Skills/Stats gesteigert werden können und es können zudem Trigger angelegt werden. Ein Skillclass Skript sieht so aus:
[SKILLCLASS 0]
// undeclared class.
// max skills for players of this skill class.
// might want this to be all 50.0 to make people declare a class?
DEFNAME=Class_undeclared
NAME=undeclared
// EVENTS=e_ClassUndeclared
STATSUM=300
SKILLSUM=10000.0
STR=100
INT=100
DEX=100
ALCHEMY=100.0
ANATOMY=100.0
ITEMID=100.0
ARMSLORE=100.0
and so on...
Um es zu verstehen:
EVENTS
: Bedeutet, dass jeder mit dieser Skillclass auch die hier angegebenen Ereignisse auslöst. (mehrere EVENTS werden mit Komma getrennt, bspw: EVENTS=e_1,e_2 usw).
STATSUM
: Gibt eine Obergrenze für die Summe der Stats an. Bspw: ich hab 100 Str, 100 Dex und 100 Int, dann hab ich 300 und damit STATSUM erreicht, ich kann nicht mehr erreichen (außer mit magischen Gegenständen und sowas).
SKILLSUM
: Wie STATSUM, nur für Skills.
STR/DEX/INT
: Obergrenze für einen spezifischen Stat (außer mit magischen Gegenständen und sowas).
ALCHEMY
: Wie STR/DEX/INT, nur für Skills (in diesem Fall Alchemy, aber kann auch jeder andere sein).
sphere_serv_triggers.scp
Diese Datei enthält spezielle Trigger "Functions", die vom Server bei bestimmten Ereignissen aufgerufen werden. Darunter gibt es eine Liste von Funktionen, die in dieser Datei gefunden werden und manche haben auch eine Erklärung dabei:
f_onaccount_login
Wird aufgerufen, wenn ein Client das Passwort eingegeben hat.
ARGS --> Benutzername des Clients, der einloggen möchte
ARGO --> Referenz zum Client selbst
RETURN 0 --> nichts tun (also Login weiterlaufen lassen)
RETURN 1 --> die Verbindung zum Client trennen
f_onaccount_delete
Diese Funktion wird aufgerufen, bevor ein Account gelöscht wird.
ARGS --> Benutername des Accounts
RETURN 0 --> Löschen zulassen
RETURN 1 --> Löschen verhindern
f_onchar_create
f_onchar_delete
f_onserver_start
f_onserver_save
f_onserver_save_ok
f_onserver_save_fail
f_onserver_save_finished
f_onserver_exit
f_onserver_blockip
Kapitel 3

--- PAGE BREAK ---

Subcategories
This category has the following 8 subcategories, out of 8 total.
C
Characters
Combat
I
Items
N
NPCS
P
Players
R
Regions
S
Skills
Spells
Pages in category "Triggers"
The following 200 pages are in this category, out of 201 total.
(previous page) (
next page
)
@
@Abort
@AfterClick
@Attack
@Buy
@CallGuards
@CharAttack
@CharClick
@CharClientTooltip
@CharDClick
@CharTradeAccepted
@Click
@ClientTooltip
@CliPeriodic
@CombatAdd
@CombatDelete
@CombatEnd
@CombatStart
@ContextMenuRequest
@ContextMenuSelect
@Create
@Criminal
@Damage
@DClick
@Death
@DeathCorpse
@Destroy
@Dismount
@DropOn Char
@DropOn Ground
@DropOn Item
@DropOn Self
@DropOn Trade
@Dye
@Eat
@Effect
@EffectAdd
@EffectRemove
@EffectTick
@Enter
@EnvironChange
@Equip
@EquipTest
@Exit
@ExpChange
@ExpLevelChange
@Fail
@Fail (Spell Trigger)
@FameChange
@Gain
@GetHit
@Hit
@HitMiss
@HitParry
@HitTry
@HouseDesignCommit
@HouseDesignExit
@ItemAfterClick
@ItemBuy
@ItemClick
@ItemClientTooltip
@ItemContextMenuRequest
@ItemContextMenuSelect
@ItemCreate
@ItemDamage
@ItemDClick
@ItemDropOn Char
@ItemDropOn Ground
@ItemDropOn Item
@ItemDropOn Self
@ItemEquip
@ItemEquipTest
@ItemPickUp Ground
@ItemPickUp Pack
@ItemPickUp Self
@ItemPickUp Stack
@ItemSell
@ItemSmelt
@ItemSpellEffect
@ItemStep
@ItemTargOn Cancel
@ItemTargOn Char
@ItemTargOn Ground
@ItemTargOn Item
@ItemToolTip
@ItemUnEquip
@Jailed
@KarmaChange
@Kill
@Login
@Logout
@Mount
@MurderDecay
@MurderMark
@NotoSend
@NPCAcceptItem
@NpcActCast
@NPCActFight
@NPCActFollow
@NPCAction
@NPCActWander
@NPCHearGreeting
@NPCHearUnknown
@NPCLookAtChar
@NPCLookAtItem
@NPCLostTeleport
@NPCRefuseItem
@NPCRestock
@NPCSeeNewPlayer
@NPCSeeWantItem
@NPCSpecialAction
@PartyDisband
@PartyInvite
@PartyLeave
@PartyRemove
@PayGold
@PersonalSpace
@PetDesert
@PickUp Ground
@PickUp Pack
@PickUp Self
@PickUp Stack
@PreStart
@Profile
@ReceiveItem
@Redeed
@RegenStat
@RegionEnter
@RegionLeave
@RegionResourceFound
@RegPeriodic
@Rename
@ResourceFound
@ResourceGather
@ResourceTest
@Resurrect
@SeeCrime
@SeeHidden
@SeeSnoop
@Select
@Select (Spell Trigger)
@Sell
@SkillAbort
@SkillChange
@SkillFail
@SkillGain
@SkillMakeItem
@SkillMenu
@SkillPreStart
@SkillSelect
@SkillStart
@SkillSuccess
@SkillUseQuick
@SkillWait
@Smelt
@SpellBook
@SpellCast
@SpellEffect
@SpellEffectAdd
@SpellEffectRemove
@SpellEffectTick
@SpellFail
@SpellSelect
@SpellSuccess
@SpellTargetCancel
@Start
@Start (Spell Trigger)
@StatChange
@Step
@StepStealth
@Success
@Success (Spell Trigger)
@TargOn Cancel
@TargOn Char
@TargOn Ground
@TargOn Item
@Timer
@ToggleFlying
@ToolTip
@TradeAccepted
@TradeClose
@TradeCreate
@UnEquip
@UseQuick
@UserBugReport
@UserChatButton
@UserExtCmd
@UserExWalkLimit
@UserGuildButton
@UserKRToolbar
@UserMailBag
@UserQuestArrowClick
@UserQuestButton
@UserSkills
@UserSpecialMove
@UserStats
@UserVirtue
@UserVirtueInvoke
@UserWarmode
@Wait
T
Tr:@EquipTest
(previous page) (
next page
)

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Description
2
Referanslar
3
Argümanlar
4
Geri Bildirim Verileri
Description
Bu trigger oyuncu büyü targetini iptal ettiğinde devreye girer.
Aktif:
Karakterler
Referanslar
Takip etmekte olan nesneler bu triggerin kullanılabilir referanslarıdır:
İsim
Açıklama
I
Büyü targetini iptal eden
oyuncu
.
SRC
Büyü targetini iptal eden
oyuncu
.
Argümanlar
Takip etmekte olan argümanlar bu trigger için kullanılabilir. Eğer alttaki argümanlar "Giriş" olarak belirlenmiş ise bu argüman sadece okunabilirdir, eğer "Çıkış" olarak seçilmişse bu argümanın değiştirilebildiğini gösterir.
Argüman
Giriş/Çıkış
Açıklama
ARGN1
G
İptal edilen büyü.
Geri Bildirim Verileri
Takip etmekte olan geribildirimler, bu trigger için kullanılabilir:
Bu trigger için herhangi bir geri bildirim verisi tanımlanmamış.

--- PAGE BREAK ---

The reference compendium documents everything you may find in a Sphere script, ranging from things such as definitions in scripts to objects and their associated functions, properties, references and triggers.
Subcategories
This category has the following 15 subcategories, out of 15 total.
C
Characters
Combat
D
Definitions
F
Functions
I
Items
N
NPCS
O
Objects
P
Players
R
Regions
S
Scripts
Skills
Spells
Statements
T
Triggers
V
Variables
Pages in category "Reference Compendium"
The following 200 pages are in this category, out of 242 total.
(previous page) (
next page
)
@
@Abort
@AfterClick
@Attack
@Buy
@CallGuards
@CharAttack
@CharClick
@CharClientTooltip
@CharDClick
@CharTradeAccepted
@Click
@ClientTooltip
@CliPeriodic
@CombatAdd
@CombatDelete
@CombatEnd
@CombatStart
@ContextMenuRequest
@ContextMenuSelect
@Create
@Criminal
@Damage
@DClick
@Death
@DeathCorpse
@Destroy
@Dismount
@DropOn Char
@DropOn Ground
@DropOn Item
@DropOn Self
@DropOn Trade
@Dye
@Eat
@Effect
@EffectAdd
@EffectRemove
@EffectTick
@Enter
@EnvironChange
@Equip
@EquipTest
@Exit
@ExpChange
@ExpLevelChange
@Fail
@Fail (Spell Trigger)
@FameChange
@Gain
@GetHit
@Hit
@HitMiss
@HitParry
@HitTry
@HouseDesignCommit
@HouseDesignExit
@ItemAfterClick
@ItemBuy
@ItemClick
@ItemClientTooltip
@ItemContextMenuRequest
@ItemContextMenuSelect
@ItemCreate
@ItemDamage
@ItemDClick
@ItemDropOn Char
@ItemDropOn Ground
@ItemDropOn Item
@ItemDropOn Self
@ItemEquip
@ItemEquipTest
@ItemPickUp Ground
@ItemPickUp Pack
@ItemPickUp Self
@ItemPickUp Stack
@ItemSell
@ItemSmelt
@ItemSpellEffect
@ItemStep
@ItemTargOn Cancel
@ItemTargOn Char
@ItemTargOn Ground
@ItemTargOn Item
@ItemToolTip
@ItemUnEquip
@Jailed
@KarmaChange
@Kill
@Login
@Logout
@Mount
@MurderDecay
@MurderMark
@NotoSend
@NPCAcceptItem
@NpcActCast
@NPCActFight
@NPCActFollow
@NPCAction
@NPCActWander
@NPCHearGreeting
@NPCHearUnknown
@NPCLookAtChar
@NPCLookAtItem
@NPCLostTeleport
@NPCRefuseItem
@NPCRestock
@NPCSeeNewPlayer
@NPCSeeWantItem
@NPCSpecialAction
@PartyDisband
@PartyInvite
@PartyLeave
@PartyRemove
@PayGold
@PersonalSpace
@PetDesert
@PickUp Ground
@PickUp Pack
@PickUp Self
@PickUp Stack
@PreStart
@Profile
@ReceiveItem
@Redeed
@RegenStat
@RegionEnter
@RegionLeave
@RegionResourceFound
@RegPeriodic
@Rename
@ResourceFound
@ResourceGather
@ResourceTest
@Resurrect
@SeeCrime
@SeeHidden
@SeeSnoop
@Select
@Select (Spell Trigger)
@Sell
@SkillAbort
@SkillChange
@SkillFail
@SkillGain
@SkillMakeItem
@SkillMenu
@SkillPreStart
@SkillSelect
@SkillStart
@SkillSuccess
@SkillUseQuick
@SkillWait
@Smelt
@SpellBook
@SpellCast
@SpellEffect
@SpellEffectAdd
@SpellEffectRemove
@SpellEffectTick
@SpellFail
@SpellSelect
@SpellSuccess
@SpellTargetCancel
@Start
@Start (Spell Trigger)
@StatChange
@Step
@StepStealth
@Success
@Success (Spell Trigger)
@TargOn Cancel
@TargOn Char
@TargOn Ground
@TargOn Item
@Timer
@ToggleFlying
@ToolTip
@TradeAccepted
@TradeClose
@TradeCreate
@UnEquip
@UseQuick
@UserBugReport
@UserChatButton
@UserExtCmd
@UserExWalkLimit
@UserGuildButton
@UserKRToolbar
@UserMailBag
@UserQuestArrowClick
@UserQuestButton
@UserSkills
@UserSpecialMove
@UserStats
@UserVirtue
@UserVirtueInvoke
@UserWarmode
@Wait
A
Accounts
(previous page) (
next page
)

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
Zahlen
2
Defnames
3
ITEMDEF
4
CHARDEF
5
TEMPLATE
6
Beispiele
Zahlen
Als erstes wird die verschiedenartige Art und Weise zur Verwendung von Zahlen innerhalb der Sphere Skripte behandelt. Da Zahlen naturgemäß sehr wichtig für einen Sphereskripter sind, ist dies der erste Abschnitt überhaupt. Am Ende dieser Einheit wird hoffentlich jeder über ein allgemeines Verständnis über hexadezimale, dezimale und binäre Zahlensysteme und die Verwendung in Sphere Skripten besitzen. Zudem wird noch vermittelt, wie einerseits Zufallszahlen innerhalb eines Zahlenbereichs oder aus einer Liste von Zahlen generiert werden können.
Es muss zunächst verstanden werden: wie wir zählen ist nicht die einzige Art zu zählen. Unser Zahlensystem enthält zehn Ziffern (0, 1, 2, 3, 4, 5, 6, 7, 8, und 9). Ab der zehnten Zahl wird eine weitere Ziffer angehängt und die letzte Stelle auf 0 gesetzt (1, 2, 3, 4, 5, 6, 7, 8, 9, 10). Deshalb funktioniert unser Zahlensystem wie es funktioniert.
Im Dezimalsystem, ohne dass wir davon Notiz nehmen, schreiben wir diese Zahlen immer als Zehnerpotenzen. Beispielsweise die beliebige Zahl 17282 aufgeteilt in Zehnerpotenzen:
Zehnerpotenz
4
3
2
1
0
10 hoch Zehnerpotenz
10000
1000
100
10
1
Ziffer
1
7
2
8
2
Um zur Zahl 17282 zu gelangen, wird immer 10 hoch Zehnerpotenz mal der Ziffer in der untersten Zeile berechnet und am Ende alle Ergebnisse addiert. Das Ergebnis: 10000 + 7000 + 200 + 80 + 2. Offensichtlich ist das sehr einfach und jeder tut das ständig ohne davon Notiz zu nehmen. Du fragst dich sicherlich jetzt "Richtig, warum schrieb Taran das alles?" Die Sache ist die, dass unser Zahlensystem nicht das einzige ist.
Computer zählen beispielsweise komplett anders. Sie kennen nur zwei Ziffern (1 und 0) und das wird dann Binärsystem genannt. Binäre Zahlen sehen beispielsweise so aus: 101011101101. Oftmals tauchen sie in der Werbung für Computer auf. Ziffern im Binärsystem werden Bit genannt (kurz für BInary digiT). Binärzahlen im Kopf zu Dezimalzahlen zu berechnen ist meist nicht ohne weiteres möglich, hierfür braucht es ein wenig Mathematik.
Binärsysteme funktionieren wie Dezimalsysteme, es wird eine Potenz einer Zahl addiert. Da Binarzählen nur aus zwei Ziffern bestehen, handelt es sich hierbei um Zweierpotenzen. Manchen wird die folgende Tabelle sicher bekannt vorkommen:
Zweierpotenz
Binärzahl
Dezimalzahl
0
1
1
1
10
2
2
100
4
3
1000
8
4
10000
16
5
100000
32
6
1000000
64
7
10000000
128
8
100000000
256
9
1000000000
512
10
10000000000
1024
Spannend oder?  :)
Wir brauchen ein besseres System! Der Grund, dass seltsame Ergebnisse auftreten, liegt daran, dasss 10 keine Potenz von 2 ist. Wir brauchen deshalb ein System, das eine Zweierpotenz als Basis hat. Das am meisten genutzte System ist ein 16er System, auch hexadezimal genannt. Im Sphere-Forum sieht man das Wort hex sicherlich an der ein oder andren Stelle, das ist kein Fluch und auch kein böser Zauber. Es ist eine Kurzform für "hexadecimal".
Binär
Dezimal
Hexadezimal
1
1
1
10
2
2
11
3
3
100
4
4
101
5
5
110
6
6
111
7
7
1000
8
8
1001
9
9
1010
10
A
1011
11
B
1100
12
C
1101
13
D
1110
14
E
1111
15
F
10000
16
10
Ersichtlich, wie das funktioniert? Es gibt sechs Ziffern, die zusätzlich am Ende des Systems herangezogen werden müssen, es werden üblicherweise hierfür die ersten 6 Buchstaben des Alphabets verwendet.
Innerhalb von Sphere Skripten wird beinahe NIE mit Binärzahlen gearbeitet, die KEINE Potenz von zwei sind und wenn, dann kann jeder herkömmliche Taschenrechner benutzt werden, um sie umzurechnen. Mit Hexadezimalzahlen ist das um einiges einfacher.
(This is the last table, I promise!!)
Binär
Hexadezimal
000000001 (1)
01
000000010 (2)
02
000000100 (3)
04
000001000 (4)
08
000010000 (5)
010
000100000 (6)
020
001000000 (7)
040
010000000 (8)
080
100000000 (9)
0100
Wie in der Tabelle ersichtlich gibt es ein Muster in der Hexadezimalspalte. Man könnte meinen, dass da ein Muster in den Zahlen 1, 2, 4 und 8 auftritt. Das stimmt auch. Ein weiteres Detail sind die führenden 0en für Hexadezimalzahlen (0100 statt nur 100). In Sphere bedeutet eine solche führende 0: "Diese Zahl ist eine Hexadezimalzahl!" und dementsprechend sind 100 und 0100 völlig verschiedene Zahlen.
Angenommen in einem Sphere Skript wird das 13. bit in einer Zahl benötigt (FLAGS beispielsweise), dann würde so etwas verwendet werden:
SRC.FLAGS |= 8192
Allerdings: merkt man sich wirklich, dass 8192 das Ergebnis von 2 hoch 13 ist? Das tut man nicht, es ist viel einfacher diese Liste durch zu gehen, bis man zur 13. Zahl kommt (wichtig: Zählen beginnt immer bei 0!).
01
02
04
08
010
020
040
080
0100
0200
0400
0800
01000
02000
2^0
2^1
2^2
2^3
2^4
2^5
2^6
2^7
2^8
2^9
2^10
2^11
2^12
2^13
Und hier sind sie: die ersten 14 Zweierpotenzen in Hexadezimal.
SRC.FLAGS |= 02000
Diese Zeile ist identisch zur obigen, nur dass 8192 (dezimal) GLEICH 02000 (hexadezimal) ist.
8192 = 02000
Nun könnte man sagen "Wie weiß ich, dass das nicht frei erfunden ist?". Nunja, schon der windowseigene Microsofttaschenrechner beherrscht die Umrechnung zwischen Binär-, Hexadezimal-, Dezimal und Oktalzahlen (ein weiteres, aber in Sphere nutzloses Zahlensystem). Der Taschenrechner von Windows befindet sich im Startmenü unter Programme im Zubehör. Im Taschenrechner wird im Menü Ansicht auf Wissenschaftlich umgestellt. Die Oberfläche des Taschenrechners verändert sich dann ziemlich. Um damit eine Zahl zwischen den Systemen umzurechnen, muss nur die originale Zahl eingegeben werden und dann kann zwischen den verschiedenen Zahlensystemen (Hex, Dez, Okt, Bin) umgeschaltet werden. Eine 0 vorne an eine Hexadezimalzahl gehängt und Sphere interpretiert sie als auch als eine hexadezimale Zahl.
Das war vermutlich das schwierigste in allen Sphere Skripten. Glücklicherweise, wegen des nächsten Abschnitts, muss sich ab jetzt niemand mehr mit angsteinflössenden Zahlen beschäftigen. Wenn du nach dieser Einheit noch dabei bist, wird sicher alles gut!
Weiter gehts mit: Skripten für Sphere!
Defnames
Hier eine Liste angsteinflössender Zahlen, die man innerhalb von Sphere Skripten antrifft:
angsteinflössende Zahl
Was sie bedeutet
0eed
ID einer Goldmünze
0dda
ID eines roten Moongates
1650,1440
Koordinaten von Britain
021
Farbcode für die Farbe "rot"
04000
Farbcode für unsichtbar
04000efad
Eindeutige serielle Nummer eines Gegestands
4
Das PLEVEL eines GMs
2048 (oder 0800)
Flag für den Unsichtbarkeitszauber
010 (oder 16)
Memory type für Aggressoren
Offensichtlich will solche Zahlen niemand auswendig kennen. Aber in frühesten Versionen, weit vor Sphere und TUS (vor .50 Sphere) und tief im Nebel von Grayworld (vor .41 TUS), musste jeder Skripter diese Zahlen kennen. Ich kenne diese Zahlen (ausser die serielle Nummer, die frei erfunden ist) und noch ein paar weitere, allesamt in- und auswändig. Glücklicherweise hat sich für jeden, der nicht gern Zahlen auswendig lernen will, Sphere dazu entwickelt, dass Namen statt Zahlen verwendet werden können.
Zwar wird alles mögliche immer noch mit Zahlen verknüpft, aber diese Zahlen sind mittlerweile mit Namen verknpft worden.
Gib im Spiel .add 0eed ein und drücke die Returntaste. Ein Zielcursor taucht auf und es kann eine Goldmünze erschaffen werden.
Nun gib .add i_gold ein und drücke Return. Es passiert genau das selbe.
Natürlich kann man sich i_gold leichter als 0eed merken. Aber wie funktioniert das? Dazu muss die Skriptdefinition von einer Goldmünze angesehen werden. Dieses Skript muss an dieser Stelle noch nicht verstanden werden, Itemskripte werden später genauer behandelt. Dieser Skriptausschnitt findet sich in der Datei sphere_item_resources.scp.
[ITEMDEF 0eed]
//gold coin
DEFNAME=i_gold
TYPE=T_GOLD
VALUE=1
CATEGORY=Provisions - Miscellaneous
SUBSECTION=Coins
DESCRIPTION=Gold Coin
DUPELIST=0eee,0eef
Die rot markierte Zeile ist für diese Lektion von Belang. Ansonsten ist noch die erste Zeile, die 0eed enthält, interessant, aber der Rest kann getrost ignoriert werden vorerst. Die 0eed ist die Nummer des Items, diese Nummern werden im nächsten Abschnitt behandelt.
Wirklich interessant ist allerdings
DEFNAME=i_gold
. Diese Zeile legt im Server fest: "Ab jetzt wird 0eed mit i_gold identifiziert". Wird vor dieser Zeile irgendwo innerhalb eines Skripts i_gold verwendet, wird der Server einen Fehler melden (siehe
Kapitel 2
über die Reihenfolge von Skripten), aber jetzt ist ihm bekannt, worauf i_gold verweist und es kann in Skripten oder im Spiel frei verwendet werden.
Es sollte IMMER ein solcher Name mit DEFNAME erstellt werden, wenn ein Item geskriptet wird. Normalerweise wird dieser defname in [ITEMDEF] selbst festgelegt (mehr darüber später), aber wenn unbedingt Zahlen verwendet werden sollen, sollte zudem noch ein einfach zu zu merkender Name verwendet werden (bspw nicht goldenes_gulasch für ein Schwert). Es macht das Leben einfacher, als Zahlen zu benutzen.
Eine zweite Möglichkeit, DEFNAME zu nutzen, ist die Nutzung eines [DEFNAME]-Abschnitts. Hier ein Beispiel dafür:
[DEFNAME colors]
color_blue 02
color_red 021
color_green 041
Ein ähnliches Skript steht in spheredefs.scp, eine weitere Datei, die ganz am Anfang geladen werden sollte.
Hier eine Aufschlüsselung dieses Skripts, Zeile für Zeile:
Zeile 1
: Hier wird der Typ des Skripts festgelegt und der Name dafür (Colors in diesem Fall). Hier wird dem Server vermittelt, dass von dieser Zeile bis zum nächsten Identifier (das sind die Zeilen die von eckigen Klammern eingerahmt sind) eine bestimmte Art von Skript enthalten ist. Alle Identifier haben dieses Format. Der erste Parameter legt dabei den Skripttyp fest und davon gibt es mehrere, die in den weiteren Kapiteln abgehandelt werden. Der zweite Parameter ist entweder eine Zahl als ID oder ein Defname. In den meisten Fällen wird in selbst geschriebenen Skripten wird hier ein Defname stehen. Die einzige Ausnahme besteht dann, wenn neue Items in die Clientdateien eingefügt werden.
Zeilen 2-4
: Diese Zeilen enthalten individuelle Teile. Es wird festgelegt, dass color_blue gleich 02, color_red gleich 021 und color_green gleich 041 ist. Zwischen dem Namen und dem Wert können beliebig viele Leerzeichen enthalten sein. Die Definitionen in spheredefs.scp sind so ziemlich die nützlichsten auf die man treffen kann, da sie es unnötig machen, viele angsteinflössende Zahlen zu verwenden. In spheredefs.scp werden deshalb Namen für Flags, für Attribute von Items, für verschiedene Töne und Klänge, für Memory Types und viele andere Dinge festgelegt. Einen Blick in diese Datei zu werfen ist sicherlich zuweilen ganz ratsam.
Das wars mit DEFNAMES. Weiteres taucht später in allen möglichen Skripten auf.
Jetzt werden Items abgehandelt.
ITEMDEF
Oder: wie macht man aus einem Maulwurfshügel einen Berg auf Sphere-Art.
Die meisten machen sich Itemskripte schwieriger, als es nötig ist. Für die Zwecke dieses Tutorials, da es noch ein weit fortgeschritteneres später gibt, werden hier nur einfach die Grundlagen eines ITEM Skripts behandelt, Zeile für Zeile. Wir werden das Goldskript vom vorherigen Absatz verwenden, vorausgesetzt ich finde es ...
Ok, hier ist es, mit Farbe unterlegt, damit es schöner anzusehen ist!
[ITEMDEF 0eed]
//gold coin
DEFNAME=i_gold
TYPE=T_GOLD
VALUE=1
CATEGORY=Provisions - Miscellaneous
SUBSECTION=Coins
DESCRIPTION=Gold Coin
DUPELIST=0eee,0eef
Das ist das einfachste aller Itemskripts, da es kein weiteres Verhalten hat und nichts anderes macht ausser einfach nur zu existieren. Es wird nun jede Zeile erklärt und was es damit auf sich hat:
Zeile 1
: [ITEMDEF 0eed]
Die erste Zeile eines Itemskripts ist die wichtigste. Grundsätzlich bedeutet diese Zeile für den Server "Hey, das ist ein Item und es soll 0eed heißen!". Der Server sieht sich dann die Clientdateien an (vor allem art.idx), und gleicht ab, ob das Item eins der eingebauten ist. Ich glaube, alle Items mit Nummern unter 04500 gelten als eingebaut, deshalb sollte nie ein neues Item mit einer Zahl definiert werden, die darunter liegt. Bei Eingabe dieser Zeile, wird der Server wissen, dass ein Itemskript folgt. Außerdem wird 0eed als gültiges Item festgelegt, was später nützlich ist, wenn die Spieler Gold brauchen!
Zeile 2
: // gold coin
Das ist die Sphereversion eines Kommentars. C-Programmierer kennen das Format (Anmerkung des Übersetzers: eigentlich kennt man das erst ab C++). Jede Zeile, die mit // beginnt ist eine Kommentarzeile und alles, was in einer Kommentarzeile enthalten ist, wird nicht vom Server interpretiert oder gelesen. Diese Kommentare können aber auch an beliebiger Stelle innerhalb einer Zeile beginnen um am Ende einer Zeile eine Erklärung einzufügen. Auf jeden Fall sind Kommentare nicht für die Funktion des Skriptes relevant, sondern können sie unter Umständen verständlicher machen.
Zeile 3
: DEFNAME=i_gold
Du solltest jetzt wissen, was diese Zeile bedeutet. Wenn nicht, dann sollte die vorherige Einheit nochmal wiederholt werden. Es legt im Server fest, dass i_gold und 0eed das selbe sind. In Itemskripten sind alle alle Parameter nach diesem Format spezifiziert:
variable=wert
Später, wenn es um Skripte geht, wird ersichtlicher, dass dieses Format sehr hilfreich ist. Items haben einige Variablen, die belegt werden können, unter anderem:
DEFNAME
ID
TYPE
VALUE
RESOURCES
Andere Variablen sind wiederum vom Wert von TYPE abhängig.
Zeile 4
: TYPE=t_gold
"Was ist t_gold?" Auch das ist nur ein DEFNAME. Also eine Zahl, in diesem Fall 72. In spheredefs.scp steht diese Zahl, also hätte TYPE=72 den selben Effekt.
Momentan gibt es 183 eingebaute Itemtypen. Sie sind hardcoded (=fest in Sphere implementiert) und enthalten vordefinierte Verwendungszwecke für einen Gegenstand. Hat ein Gegenstand keinen Typ, dann erhält man eine "You cannot think of a way to use that item"-Nachricht, wenn man im Spiel das Item anklickt. Es gibt eine vollständige Liste von Itemtypen und wie sie genutzt werden. Der Typ t_gold hat nur einen Effekt: der Gegenstand wird behandelt wie eine Goldmünze (d.h: es können damit Dinge gekauft werden!). Andere Gegenstände den Typ t_gold zu geben würde den Server dazu veranlassen auch diese Dinge als Währung heran zu ziehen. Ich habe das nie versucht, aber es könnte eine interessanter Weg sein einzigartige Währungen zu haben ...
Zeile 5
: VALUE=1
Diese Zeile legt fest, wie viel ein Item wert ist, wenn es gekauft wird - in Gold. Natürlich ist eine Goldmünze eine Goldmünze wert, deshalb wird der Wert hier auf 1 gesetzt.
Zeilen 6-8
: CATEGORY, SUBSECTION, DESCRIPTION
Diese Zeilen werden nur von Spheres GM-Tool, Axis, benutzt, das es unnötig macht, im Spiel ".add i_gold" einzugeben. Wichtiger noch, es übernimmt solche Aufgaben auch für Items, die keinen DEFNAME haben, sondern nur eine Nummer.
Zeile 9
: DUPEITEM
Es wäre viel Arbeit für das Sphereteam alle 8000 Items im Spiel zu definieren, vor allem, wenn viele eigentlich ein und das selbe sind. (Beispielsweise kann eine Tür mit dem Befehl .xflip gedreht werden. Dieser Befehl läuft durch alle DUPEITEMS, die für ein Item angegeben sind.) Die Liste von Nummern sind Itemnummern, die vielleicht noch nicht definiert wurden. Hier wäre das Skript für 0eee:
[ITEMDEF 0eee]
//gold coins
DUPEITEM=0eed
CATEGORY=Provisions - Miscellaneous
SUBSECTION=Coins
DESCRIPTION=Gold Coins
In diesem Skript gibt es nur einen Parameter für das Item. Es verweist den Server auf das DUPEITEM, das unter 0eed (oder i_gold) angelegt wurde, um die Informationen von dort, wie TYPE und VALUE zu verwenden. DUPEITEM spart Tipparbeit, wahrscheinlich wird es selten benutzt.
CHARDEF
Oder was es braucht, einen nackten Mann zu machen, der rumstehen und "Huh?" sagen kann.
NPCs machen die Welt lebendig. Sie sind das, was UO zu einem einzigartigen Multiplayer Spiel macht. Die Monster und NPCs die du skriptest machen den Server einzigartig im Vergleich zu jedem anderen. Dieser Abschnitt des ersten Kapitels wird beinhalten, wie ein einfacher nackter Mann geskriptet wird, der herumwandern und ein wenig mehr als "Huh?" (oder "Halt Dieb!", wenn man so will) sagen kann.
Als erstens sehen wir uns das SKript eines einfachen nackten Mannes an. Es befindet sich in spherechar_human.scp.
[CHARDEF 0190]
DEFNAME=c_man
Name=Man
ICON=i_pet_MAN
CAN=MT_EQUIP|MT_WALK|MT_RUN|MT_USEHANDS
RESOURCES=i_flesh_head, i_flesh_torso, i_flesh_right_arm, i_flesh_left_arm
FOODTYPE=15 t_food, t_fruit
DESIRES=i_gold,e_notoriety
AVERSIONS=t_TRAP,t_eerie_stuff
SHELTER=r_house
BLOODCOLOR=0

TSPEECH=spk_human_prime
TSPEECH=spk_human_default
TEVENTS=e_Human_HearUnk
DESCRIPTION=Man
SUBSECTION=Miscellaneous
CATEGORY=Civilized
Wie ersichtlich sieht es sehr viel anders aus als die Skripte der vorherigen Abschnitte. Es werden eine ganze Menge an Variablen gesetzt, die gleich sind wie der DEFNAME, DESCRIPTION und die anderen Axis Variablen.
Aber es gibt auch eine Menge neuer Dinge hier, die der Reihe nach und Zeile für Zeile betrachtet werden! Und es ist länger diesmal! Let the good times roll! (Entschuldigung an alle Nichtamerikaner, alle amerikanischen Cliches sind vermutlich irritierend!)
Zeile 1
: [CHARDEF 0190]
Überraschung! Ein Identifier, der dem Server mitteilt, dass hier ein Charakter bis zum zum nächsten Identifier definiert wird. Und zudem wird für diesen Charakter bzw. NPC die ID 0190 gesetzt. Der Server kennt diese ID, da es eine eingebaute ist. In der Tat gehört diese ID zum nackten Mann. Des weiteren steht 0190 als hexadezimale Zahl natürlich für 400, nicht wahr? :) Warum weißt du das nicht? OK, nur ein Witz, das muss man natürlich nicht wissen.
Zeile 2
: DEFNAME=c_man
Nichts neues. c_man entspricht hiermit 0190. Die meisten DEFNAMES für Charaktere beginnen mit c und dann folgt ein _ wie oben.
Zeile 3
: Name=Man
Hier ist etwas neues. Items haben einen vorgegebenen Namen, der im Server bekannt ist. Charaktere nicht. Deshalb muss ein Name zugewiesen werden. Es kann im Grunde jeder Name zugewiesen werden, den man hier haben möchte, aber da das kein spezifischer Mann ist, heißt er einfach nur Man.
Zeile 4
: ICON=i_pet_man
Ich brauchte eine Weile, um das herauszufinden. ICON legt ein kleines Bildchen fest, das man bei benutzung des Tracking Skills sieht und diese kleinen ICONs tauchen im Menü dort auf. Eigentlich sind diese Bildchen Items. Um herauszufinden, wie dieses Bildchen aussieht, kann der Mann einfach im Spiel mit .addnpc c_man erstellt werden und dann der .shrink Befehl auf ihn angewendet werden. Die ID dieses Items wird dann zum i_pet Item.
Zeile 5
: CAN=mt_*
(Falls * nicht bekannt ist: * heisst "alles mögliche" für diejenigen, die Linux nutzen.)
Das ist eine der wichtigsten Zeilen im Character Skript, neben der ID die in der ersten Zeile vergeben wird. Sie lässt uns festlegen, was ein NPC tun kann und was nicht. Es gibt nur ein paar wenige Möglichkeiten für mt_*, die alle in der spheredefs.scp definiert sind. Für unsere Zwecke sind sie hier hin kopiert worden.
MT_NONMOVER        0 // Kann ueberhaupt nicht laufen
MT_GHOST          01 // Kann wie ein Geist durch Tueren und aehnliches laufen
MT_SWIM           02 // Ich kann schwimmen! (Wasser Elementare, Delphine, etc)
MT_WALK           04 // Ich kann laufen! Setze dies wenn deine Kreatur laufen koennen soll.
MT_FLY           010 // Laeuft durch Baeume (soll das darueber Fliegen darstellen)
MT_FIRE_IMMUNE   020 // Ist gegen Feuer Immun. Das sollte man nicht auf einen Spieler setzen. :)
MT_EQUIP       00100 // Kann Sachen anlegen (equip).
MT_USEHANDS    00200 // Kann seine Haende benutzen um Sachen zu tragen (oder Tueren zu oeffnen)
MT_MALE            0 // Ist maennlich
MT_FEMALE      00800 // Ist weiblich
MT_NONHUM      01000 // Kein Mensch. Ich bin mir nicht sicher was es genau bewirkt.
MT_RUN         02000 // Kann wirklich schnell laufen!
Nach dieser Tabelle wird klar, dass ein NPC ohne CAN Flags ein MT_Male und MT_NONMOVER (zweimal 0) ist. Die Flags können durch ein | (Alt Gr + <) getrennt in einer Liste angegeben werden, so dass ein NPC mehrere solcher Flags erhalten kann. In diesem Fall erlauben wir unserem Mann, dass er etwas ausrüsten (oder anziehen), gehen, rennen und seine Hände benutzen kann. (Interessant ist, dass sogar Kreaturen ohne Hände ihre Hände nutzen können und damit bspw. Lichtquellen tragen können. Feuerelementare tun das beispielsweise, deshalb leuchten sie.)
Zeile 6
: RESOURCES
Die Resources sind etwas morbide als Bezeichnung. Vor allem für Personen, denn sie enthalten die Items, die herauskommen, wenn man im Spiel eine Leiche aufschneidet. Gruslig, hm?
Zeile 7-10
: FOODTYPE, DESIRES, AVERSIONS
FOODTYPE
: Legt fest, welche Art von Essen der NPC essen würde und wenn NPC_AI_FOOD aktiviert ist, sucht der NPC nach so einem Essen wenn er hungrig wird.
DESIRES
: Legt fest, welche Art von Items ihn interessieren und wenn NPC_AI_EXTRA aktiviert ist, dann wird ein NPC aus Spielerleichen diese Gegenstände holen oder, falls diese Gegenstände am Boden liegen, zu ihnen hingehen.
AVERSIONS
: Das ist nicht ganz klar. Ich nehme an, dass diese Option angibt, was der NPC am liebsten angreift. Beispielsweise: Ich habe ein Pferd mit dem Event e_horse und einen Imp mit AVERSIONS=e_horse, dann würde im Falle eines Kampfs der IMP wohl vorziehen gegen das Pferd zu kämpfen.
Zeile 11
: BLOODCOLOR
Jemals vorgehabt den Spielern grünes Blut zu verpassen? Das geht hiermit. Eine Nummer für eine Farbe oder ein DEFNAME funktioniert hier. (Für Farben sollte man versuchen die Zahlen zu lernen, das macht es einfacher.)
Der Rest: TSPEECH and TEVENTS
Diese beiden Zeilen erhalten eigene Kapitel. Sie sind sehr komplex und mitunter die komplexesten Dinge beim Skripten! (Wie oft ich das wohl sagen werde, bis das wirklich wahr ist?)
Einige andere Dinge:
Auf 56B gibt es weitere Variablen wie MOVERATE, RESLEVEL, RESDISPDNID and RESDISPDNHUE. Sie klingen schwierig und seltsam, aber das sind sie nicht. Hier ist eine Erklärung:
MOVERATE
: Diese Einstellung (die nur innerhalb eines CHARDEF Blocks sein kann) legt fest, wie schnell sich ein NPC bewegt. Je kleiner der Wert, desto schneller ist ein NPC. Beispielsweise für ein Pferd mit vorgegebener MOVERATE von 100, wäre ein anderer NPC mit MOVERATE von 60 schneller als das Pferd. Das ist ganz gut, um schwierige Monster zu skripten, die nur schwer zu erlegen sind.
RESLEVEL
: Das sagt Sphere aus welcher Version von UO das Monster abstammt, Beispielsweise hat ein "Wanderer of the Void" RESLEVEL=3 (3 ist AOS) (siehe spheredefs.scp für eine Liste), so dass nur Accounts mit RESDISP 3 oder größer das Monster so sehen, wie es wirklich aussieht.
NOTE
: Setzt man einen zu niedrigen Wert für RESLEVEL und der Spieler hat die passende Animation nicht, führt das zum Absturz seines Clients.
RESDISPDNID
: Wie wahrscheinlich bemerkt, sagte ich oft nun "wie er wirklich" ist, genau wegen dieser Einstellung. Das legt fest, wie ein Monster für einen Spieler aussieht, hat er die Animation nicht. Beispielsweise wird der Wanderer of the Void für jeden mit ACCOUNT.RESDISP=3 oder großer auch wie ein Wanderer of the Void aussehen, aber für alle anderen sieht er wie ein c_spectre aus (wenn es so eingestellt wurde).
RESDISPDNHUE
: Das legt fest, welche Farbe für den Spieler das Monster hat, wenn die RESDISPDNID angezeigt wird (und sein account.resdisp kleiner als reslevel dieses Charakters ist).
Hier ist ein Beispiel für diese neuen Einstellungen:
[CHARDEF 310]
DEFNAME=c_Wailing_Banshee
NAME=Wailing Banshee
SOUND=snd_monster_zombie1
ICON=i_pet_wailingbanshee
DAM=11,16
RESDISPDNID=c_spectre
RESLEVEL=3
RESDISPDNHUE=01
ARMOR=20
CAN=MT_WALK|MT_FLY
DESIRES=i_gold,e_notoriety,e_horses,c_man,c_woman,t_corpse
CATEGORY=New Monsters
SUBSECTION=AOS
DESCRIPTION=Wailing Banshee

ON=@Create
    NPC = brain_monster
    FAME = {100 3000}
    KARMA = {-5000 -6999}
    STR = {126 166}
    INT = {86 115}
    DEX = {41 75}
    MAGICRESISTANCE = {75.0 95.0}
    TACTICS = {45.0 75.0}
    WRESTLING = {50.0 70.0}
    
ON=@NpcRestock
    ITEM = i_gold, {50 100}
    ITEM = i_reag_daemon_bone, {2 6}
Und das wars. Einfache Charakterskripte und ein paar neue Dinge. Es gibt dazu noch ein spezielles Kapitel nur über das Skripten von NPCs später.
TEMPLATE
Oder wie man eine große Menge serverbelastender Items in einen nichtserverbelastenden Container packt.
Jeder hat sie schon gesehen. Die Shards, die keine TEMPLATEs benutzen. Wird beispielsweise ein Drache auf diesen Shards erlegt und lootet man ihn dann, dann findet man statt schön abgepackte Behälter ein paar 100 Tränke im Lootfenster verteilt. Nicht nur das, alle magischen Gegenstände sind auch noch darunter vergraben!
Wie wird das Problem gelöst? Sphere hat ein sehr handhabbares Werkzeug: die TEMPLATES. Sie erlauben, dass Container Items definiert werden und die Items in diesen Containern ebenfalls und zwar gleichzeitig. Das ist doch toll? I dachte es mir, als ich heraus fand, was sie sind. Deshalb wieder eine Zeile für Zeile Aufschlüsselung, diesmal mit einem TEMPLATE aus spheretemp_loot.scp.
[TEMPLATE 101505]
DEFNAME=backpack_poor
CATEGORY=Item Templates
SUBSECTION=Loot Templates
DESCRIPTION=Poor Backpack
CONTAINER=i_backpack
ITEM={ random_food 1 0 3 },{ 1 3 }
ITEM={ random_bottle 1 0 8 }
ITEM={ random_light 1 0 8 }
ITEM={ random_male_tops 1 0 4 }
COLOR=colors_all
ITEM={ random_male_pants 1 0 4 }
COLOR=colors_all
ITEM=POOR_GOLD_PILE
Sieht verwirrend aus. Aber kein Problem, das wird schon alles klar werden, was das bedeutet!
[TEMPLATE 101505]
: Als erstes wird die Kopfzeile des templates betrachtet. Interessant an Templates ist, dass der Itemname kein DEFNAME sein kann, sondern eine sehr hohe Zahl sein muss.
DEFNAME=backpack_poor
: Natürlich sind die Sphere Entwickler nicht bösartig und haben deshalb hier noch die Möglichkeit eines DEFNAMEs eingeführt.
CATEGORY, SUBSECTION, DESCRIPTION
: Der übliche Axiskram. Optional natürlich. In den vorherigen Abschnitten wird das genauer erklärt.
CONTAINER=i_backpack
: Ok, nun gehts runter bis aufs Eingemachte. Das ist der Container, der benutzt wird und alle anderen Items landen in diesem. Wenn der Container im Spiel erstellt wird, dann sieht man ihn. In diesem Fall ist das ein Rucksack. Ganz einfach. Hier kann nur ein gültiger Container vom Typ t_container oder t_container_locked angegeben werden.
ITEM={ random_food 1 0 3},{1 3}
Das sieht ziemlich kryptisch aus. Deshalb wird diese Zeile ein wenig eingehender beleuchtet.
Als erstes muss ZUFALLSAUSWAHL behandelt werden! Klingt nach Spaß, nicht? Nun ja, klingt auch für mich nicht danach, aber es ist unbedingt notwendig, um einen guten Shard zu bauen.
Sie sind einfache grundlegende Mechanismen, um mit einem Befehl eine zufällige Zahl zu erhalten. Was wäre das schon für ein Shard, auf dem jeder getötete Drache auch eine Platemail of Magic Stuff und ein Super Duper Sword of Power liefern würde? Jeder würde damit herumlaufen, deshalb braucht es etwas Variabilität.
Es gibt zwei Arten von Zufallsauswahlen: gewichtete und bereichsweise Auswahl. Gewichtete Auswahlen funktionieren so: "OK, 1 mal von 10 nimm Nummer A, 3 mal von 10 nimm Nummer B und 6 mal von 10 nimm Nummer C". Bereichsweise Auswahlen funktionieren so: "Wähle eine zufällige Zahl zwischen zwei Zahlen, die ich festlege".
Unser Beispiel nutzt beides - sowohl bereichsweisen als auch gewichteten Zufall. Der Reihe nach:
{ random_food 1 0 3}
Das ist eine gewichtete Auswahl. Um das richtig zu verstehen, wird der Ausdruck zwischen den Klammern in zwei Teile zerlegt:
random_food 1
0 3
Addiert man die zweite Zahl in den beiden Zeilen, erhält man 4. Das sagt Sphere "OK, 1 von 4 Mal, will ich random_food und 3 von 4 Mal wähle ich 0." Man kann auch Zufallsauswahlen verschachteln, aber das wird dann verwirrend.
{ { random_food 1 0 3} 1 random_clothing 1}
Klar, was das heisst?
random_clothing 1
{ random_food 1 0 3} 1
2 ist hier die magische Zahl. Einmal von 2 nimmt Sphere random_clothing und einmal von 2 nimmt Sphere den vorherigen Auswähler, der dann aus seinen eigenen Optionen eins auswählt. Wenn du jetzt schon verwirrt bist, keine Sorge. Das ist sehr selten, aber es wird sich zeigen, wie TEMPLATES diese Probleme lösen können.
Ich habe erwähnt, dass es noch einen weiteren Zufallswähler gibt. Und dieser ist hier:
{1 3}
Anmerkung: Leerzeichen sind hier wichtig. Hier dürfen keine Leerzeichen zwischen { und der ersten Zahl oder } und der letzten Zahl sein. Ansonsten kommt seltsames Verhalten dabei heraus.
Das weist Sphere an "Nimm eine beliebige Zahl zwischen 1 und 3, inklusive". Inklusive heißt, dass Sphere auch 1 und 3 wählen kann oder eben jede Zahl dazwischen. In diesem Fall ist der Bereich sehr beschränkt. Sphere wird eine 1, 2 oder eine 3 liefern. Bereichsweise Auswähler werden oftmals in gewichteten Auswählern benutzt.
{ {1 3} 3 {4 9} 1}
"Einmal aus 4, nimm eine Zahl zwischen 4 und 9. Dreimal von 4, nimm eine Zahl zwischen 1 und 3."
Nachdem wir das nun hinter uns haben, sehen wir uns die Zeile des Skripts von oben an. Der Teil mit ITEM=
Das legt im Skript fest "Ok, wir werden jetzt ein Item zum Container hinzufügen". Alles nach dem = legt fest, was genau das ist und in welcher Menge. Es kann natürlich geskriptete werden ITEM=i_platemail_chest oder sonst was ohne die mysteriösen { } Auswähler, aber der Grund, warum TEMPLATES so interessant sind, ist die große Variabilität, die sie bringen.
{ random_food 1 0 3}
Das ist das Item, das erstellt wird. Aus der Einheit über gewichtete Zufallsauswahlen, 1 von 4 Mal, wird das random_food sein und 3 von 4 Mal, wird das 0 sein. Wenn ein Item 0 ist, dann wird nichts erstellt. Das bedeutet: "Hier gibt es eine 1 zu 4 Chance, dass random_food im Container auftaucht." Was random_food ist? Das ist ein weiteres TEMPLATE, das in spheretemplate.scp definiert wurde ... glaube ich.
{1 3} Ist die Menge des Items, die erstellt wird. Das ist eine zufällige Bereichsauswhl. Sphere nimmt eine Zahl zwischen 1 und 3 und setzt dann die Menge im Container. Natürlich: ist das Item zuvor 0 geworden, dann wird auch die Menge daran nichts ändern, denn 3 mal 0 ist weiterhin 0.
Das war grundlegend das Template Skript. Hier können noch so viele Items eingefügt werden, wie man Lust hat. Ausserdem ist noch folgendes Konstrukt dann interessant:
ITEM=i_sword_long,R11
Das ist eine Kurzform von:
ITEM={ i_sword_long 1 0 10 }
R11 bedeutet: "1 zu 11 Chance, dass das Item gefunden wird". Und zusätzlich kann noch eine Mengenauswahl hinten angehängt werden, was es ziemlich seltsam aussehen lässt:
ITEM=i_sword_long,R11,{4 5}
Aber warum würde man 4 oder 5 Langschwerter haben wollen? Das wäre noch seltsamer. :)
Das wars von Templates. Gratulation, das erste Kapitel ist hiermit durch. Jetzt sollten die Beispiele im nächsten Abschnitt nicht schwierig zu verstehen sein. Du könntest auch einige fragen haben, die hier allerdings ohnehin nicht beantwortet werden. Einfach weiterlesen, es wird noch vieles in den folgenden Kapiteln abgehandelt.
(Ein Template Beispiel von Belgar)
[TEMPLATE tm_necromancer]
CONTAINER=i_bag
ITEM=random_necro_scroll
ITEM=random_necro_scroll
ITEM=random_necro_reagent, {5 12}
ITEM=random_reagent, {5 12}
ITEM=random_necro_reagent, {5 12}
Beispiele
Oder ... naja, glaub es gibt kein anderes Wort für "Beispiele".
Das soll mein Versuch sein, einfachste simpelste Items zu erstellen. Du wirst hier einige DInge in diesen Beispielen sehen, die in den Tutorials nicht behandelt wurden. Hauptsächlich gibts hier ein ON=@create das im 2. Kapitel abgehandelt wird. Für die Beispiele ist nur wichtig, dass die Farbe der Dinge im Spiel geändert werden kann und dass das unter on=@create passieren muss.
Beispiel 1
: Ein rotes Schwert
[ITEMDEF i_sword_red]
ID=i_sword_viking
TYPE=t_weapon_sword
NAME=Das rote Schwert
CATEGORY=Weapons
SUBSECTION=New Swords
DESCRIPTION=Red Sword
ON=@Create
COLOR=colors_red // Das ist ein Kommentar. Kommentare werden von Sphere ignoriert.
Moment ... was heisst das // an dieser Stelle? Das ist ein Kommentar, er wird gänzlich von Sphere ignoriert, deshalb kann hier alles stehen, solange es hinter den // steht. Es gibt in Sphere keine mehrzeiligen Kommentare, solange man nicht jede Zeile mit // beginnen lässt. Deshalb sollte man das gar nicht versuchen, sonst wird Sphere viele Fehler ausgeben und man darf sie suchen.
Beispiel 2
: Ein blauer Ettin
[CHARDEF c_ettin_blue]
ID=02 // Hier kann auch c_ettin benutzt werden natürlich.
NAME=Mein blauer Ettin
ON=@Create
COLOR=02 // Das ist dunkelblau. Wird oft für Counselorroben benutzt. Merken.
Beispiel 3
: Ein Template aus einer der Dateien, weil ich zu faul bin eins selbst zu schreiben
[TEMPLATE 101521]
DEFNAME=goodie_meager_1
CATEGORY=Item Templates
SUBSECTION=Loot Templates
DESCRIPTION=Meager Goodie 1
ITEM={ meager_gold_pile 1 backpack_meager 1 pouch_meager 1 }
ITEM={ random_boots 1 0 4 }
ITEM={ random_gorget 1 0 4 }
ITEM={ random_staff 1 0 4 }
ITEM={ random_necklace 1 0 4 }
ITEM={ i_cape 1 0 9 }
COLOR=colors_all
Bemerkenswert ist hier etwas neues (das speziell in rot hervorgehoben ist) und ja, das kann man so schreiben. Alle Zeilen zwischen ITEM= Zeilen betreffen das zuvor erstelle Item. COLOR= bezieht sich also auf die Zeile
ITEM={ i_cape 1 0 9 }
Der beste Weg diese Art von Skripten zu lernen, liegt darin, dass man die Skripte in den Dateien wie beispielsweise sphereitem_colorarm.scp und sphereitem_beers.scp liest.
Kapitel 2

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
NPC Evolution
2
Advanced Item Scripting
3
TYPEs
4
ATTRs
5
Cool Commands
NPC Evolution
Erinnerst du dich an das grundlegende NPC Script aus Kapitel 1? Es war ein sehr allgemeines Script um einen nackten Mann (oder Spieler) zu erstellen. Es sah in etwa so aus:
[CHARDEF 0190]
DEFNAME=c_man
Name=Man
ICON=i_pet_MAN
CAN=MT_EQUIP|MT_WALK|MT_RUN|MT_USEHANDS
RESOURCES=i_flesh_head, i_flesh_torso, i_flesh_right_arm, i_flesh_left_arm
FOODTYPE=15 t_food, t_fruit
DESIRES=i_gold,e_notoriety
AVERSIONS=t_TRAP,t_eerie_stuff
SHELTER=r_house
BLOODCOLOR=0
TSPEECH=spk_human_prime
TSPEECH=spk_human_default
TEVENTS=e_Human_HearUnk
DESCRIPTION=Man
SUBSECTION=Miscellaneous
CATEGORY=Civilized
Wie du sehen kannst ist es ein eher unfertiges Script. Von allen Scripts in den spherechar_*.scp Dateien ist dies eines der Unvollständigsten. Hier ein etwas vollständigeres Beispiel eines NPC Scripts:
[CHARDEF 0490]
DEFNAME=C_H_ALCHEMIST
NAME=#NAMES_HUMANMALE the Alchemist
ID=C_MAN
DESIRES=i_gold,e_notoriety,t_magic
AVERSIONS=t_TRAP,t_eerie_stuff
TSPEECH=spk_human_prime
TSPEECH=jobalchemist
TSPEECH=spk_shopkeep
TSPEECH=spk_needs
TSPEECH=spk_rehello
TSPEECH=spk_human_default
TEVENTS=e_Human_HearUnk
TEVENTS=e_Human_ConvInit
TEVENTS=e_Human_Greet
TEVENTS=e_Human_Space
TEVENTS=e_Human_Needs
TEVENTS=e_Human_Refuse
TEVENTS=e_Human_Environ
CATEGORY=Civilized
SUBSECTION=Tradesmen
DESCRIPTION=Alchemist (male)
ON=@Create
NPC=brain_vendor
COLOR=colors_skin
STR={36 50}
DEX={36 50}
INT={51 65}
ALCHEMY={55.0 78.0}
TASTEID={55.0 78.0}
WRESTLING={15.0 38.0}
MAGICRESISTANCE={25.0 48.0}
TACTICS={15.0 38.0}
POISONING={35.0 55.0}
ITEMNEWBIE=random_male_hair
COLOR=colors_hair
ITEMNEWBIE=random_facial_hair
COLOR=match_hair
ON=@NPCRestock
ITEM=i_expcoin,3
ITEM=i_shirt_plain
COLOR=colors_all
ITEM=random_pants
COLOR=colors_all
ITEM=i_robe
COLOR=colors_red
ITEM=random_shoes
COLOR=colors_neutral
ITEM=random_coin_purse
SELL=VENDOR_S_ALCHEMIST
BUY=VENDOR_B_ALCHEMIST
[CHARDEF 0490]
Wir haben das schon einmal gesehen. Es sagt quasi "Hey SPHERE! Alles nach dieser Zeile bis zum nächsten Header definiert einen Charakter!" Was wird dieser Charakter sein? Nun, im Moment wissen wir das noch nicht, für SPHERE ist das einfach nur ein Char mit der Nummer 0490. Diese 0490 sagt dem Client auch welche Animation er zeigen soll (das gilt nicht für Monster mit einem ID Feld, bei diesen wird die Animation aus dem ID Feld angezeigt). Statt einer Nummer kannst du auch den Char Defname im [CHARDEF x] Feld verwenden (was für neue NPCs besser ist). Zum Beispiel: [CHARDEF c_new_monster]
DEFNAME=C_H_ALCHEMIST
Wer hätte es geglaubt: Das ist der
Defname
für dieses Script. Wir haben so etwas schon so oft gesehen, dass ich nicht glaube, dass ich es nochmal erklären muss. Letztendlich haben wir jetzt einen leichter zu merkenden Namen für dieses Script. Es ist offensichtlich ein Charakter (C), ein Mensch (H) (Englisch: human), und ein Alchemist (
C_H_ALCHEMIST
). Versuche deine
DEFNAMEs
sinnvoll nach dem zu benennen was der Charakter ist. Dieses Script z.B. "c_robed_man" zu nennen hätte keinen Sinn, da man es kaum zuordnen und sich auch schlecht merken könnte. :)
NAME=#NAMES_HUMANMALE the Alchemist
Hier macht SPHERE ein paar irre Sachen. Als erstes, wie du vielleicht noch aus der Lektion
SPHERE_NAME.SCP
in
Kapitel 2
weisst, ersetzt es #NAMES_HUMANMALE durch einen richtigen Namen für diesen NPC, wie z.B. "Fritz", "Bob" oder den immer wieder beliebten "Roderick". Als Zweites teilt es den Namen in ein
NAME
und ein
TITLE
. Aber wo wird der Name geteilt? Ganz einfach: Bei dem Wort "the". Das Schreiben dieser Zeile ist also gleichbedeutend mit der folgenden Schreibweise:
NAME=#NAMES_HUMANMALE
TITLE=the Alchemist
ID=C_MAN
Hier sagen wir SPHERE was dieses Ding ist. Was ist C_MAN? Es ist natürlich ein
DEFNAME
, aber für was steht er? Schau einfach an den Anfang dieser Seite, dort wirst du die Definition eines
C_MAN
-Charakters finden.
Und so weiter. Wie du siehst haben wir einfach all das nochmal geschrieben was wir in dem vorherigen Abschnitt bereits hatten. Aber mit den neueren Versionen von SPHERE müssen wir das gar nicht mehr. Sofern wir nichts anderes sagen bekommt unser Charakter 0490 automatisch alles was auch standardmäßig bei einem C_MAN vorhanden ist, auch Fähigkeiten, Icons und Sounds. Beim Programmieren wird das Vererbung genannt. Der neue, spezifischere Charakter erbt die Eigenschaften des weniger Spezifischen.
Du hast sicher bemerkt, dass wir
DESIRES
(Wünsche, etw. begehren) und
AVERSIONS
(Abneigungen) noch einmal angegeben haben. Warum haben wir das wenn
C_MAN
uns durch die Vererbung doch bereits sagt was diese Art von Charakter will und nicht will? Nun, ich bin mir im Fall von AVERSIONS nicht sicher, denn beide sind gleich. Aber die Wünsche und Begehren (DESIRES) eines Alchemisten sind natürlich andere als die eines "gewöhnlichen" Mannes, deshalb sagen wir SPHERE: "Hey, ersetze die Wünsche des
C_MAN
mit unseren Neuen!"
TSPEECH=
Was meinst du sind die kryptischen Namen die dieser Anweisung folgen? Natürlich, es sind DEFNAMES, aber was machen sie? Beim Durchsuchen deiner Dateien, wirst du die Definitionen dieser Namen wahrscheinlich nirgendwo finden.. Aber was ist das? Da ist ein Ordner "Speech" der bereits in der ZIP-Datei mit dabei ist (Anm. d. Ü.: Bei neuen Sphere Versionen im Community Script Pack). Wenn du dir diese Dateien anschaust, wirst du eine Menge
[SPEECH]
Block Definitionen sehen. Die Standarddefinitionen liegen im SPEECH Ordner unterhalb deines Script-Ordners.
Hier haben wir ein sehr einfaches Speech-Script. Das habe ich diesmal nicht aus den Scriptdateien.
[SPEECH spk_human_test]
ON=*hallo*
SAY Cheese!
Würden wir nun in unser obiges NPC-Script
TSPEECH=spk_human_test
einfügen, würde unser NPC mit "Cheese!" antworten, wenn wir ihn mit "hallo" ansprechen. Du wunderst dich vielleicht wieso ich im Script vor und hinter das "hallo" ein Sternchen
(*)
gesetzt habe. Im Programmierfachjargon bedeutet ein Sternchen
"IRGENDETWAS"
. Du könntest also sagen "Ich möchte dich fressen hallo und auf Wiedersehen" und der NPC würde dir immernoch antworten: "Cheese!", weil das Wort "hallo" im Satz vorhanden ist.
SPEECH ist natürlich noch um einiges komplexer als das hier gezeigte, deshalb werden wir es uns noch einmal anschauen wenn wir das Kapitel des Basic Event Scriptings (Grundlagen des ereignisgesteuerten Scripings) erreichen. Für jetzt reicht es erst einmal noch zu wissen, dass du innerhalb des CHARDEF Bereichs so viele TSPEECH-Zeilen einfügen kannst wie du willst.
TEVENTS=
Das haben wir bereits in Kapitel 1 behandelt, sind dabei aber nur sehr sehr wenig ins Detail gegangen. Hier werden die Events für die NPCs definiert. Wie du sehen kannst besitzt dieser NPC eine ganze Menge Events. Diese definieren alle seine Reaktionen, angefangen bei dem was er sagt wenn er ein unbekanntes Wort hört ("Huh?") bis hin zu dem was er macht wenn er einen neuen Spieler sieht. In Kapitel 8 werden wir uns solch ein Event Script einmal ansehen. Bevor du das Event Scripting versuchst solltest du aber erst die Grundlagen des Item Scriptings lernen. Für jetzt musst du erst einmal nur noch wissen, dass du alle TEVENTS eines NPCs mit Hilfe von <[REF].TEVENTS> abfragen kannst.
ON=@Create
Genau genommen habe ich gelogen. @Create ist ein Event, und über das werden wir nun reden. Es ist es ein sehr spezielles Event, was daran so speziell ist werden wir auch gleich erörtern. Grundsätzlich bewirkt @Create, dass jede danach folgende Zeile verarbeitet wird (der gesamte rot markierte Bereich) sobald ein Objekt erstellt wird. Kreativ, was? (Ha, ha.) Auf die meisten der danach folgenden Zeilen werde ich dieses mal nicht eingehen, da sie für dich inzwischen alle einen Sinn ergeben sollten. Alles was du zu diesem Zeitpunkt wissen musst ist, dass die Sachen die du IN GAME ändern kannst, auf das Konto von @Create gehen. Das beinhaltet Stats, Skills, Nicht lootbare Items, Farben, Brain Types und TAGs (Obwohl Tags auch im CHARDEF definiert werden können. Das ist ein guter Weg um ein Tag auf alle NPCs mit diesem Chardef zu setzen ohne einen Restock anstoßen oder jeden einzelnen NPC ändern zu müssen) (Du weißt nicht was ein TAG ist? Gut so, das habe ich dir auch noch nicht erklärt.).
ALCHEMY={55.0 77.0}
Diese Zeile kann sehr täuschen. Der Grund für die Täuschung ist die Art und Weise wie SPHERE Zahlen verarbeitet. SPHERE kann keine Dezimalzahlen lesen. 55.0 bedeutet nichts für SPHERE, es entfernt einfach das Dezimalzeichen. Ist es nicht praktisch, dass Skills intern als große Zahlen gespeichert werden?  Sieh dir jetzt mal deine Skills im Ingame Menü an und suche einen Skill aus der nicht Null ist.
Er wird in etwa so aussehen: 42.0
Fuehre Ingame dieses Kommando aus: .set [Skillname] 42 (Natürlich musst du [Skillname] mit dem Skill deiner Wahl ersetzen. Schau in der spheretables.scp nach wenn der von dir verwendete Skillname nicht funktioniert) (Anm. d. Ueb.: Die Skillnamen sind Standardmäßig in Englisch, auch wenn eure Skillnamen im Skillmenü Deutsch aind). Was passiert nun? Dein Skill ist plötzlich auf 4.2 gesunken!! Ist das ein Fehler im Spiel? Nein, eigentlich passiert das weil beim Speichern der Skills der Dezimalpunkt entfernt wird. Wenn du 100.0 in Blacksmithing hast ist dein Skill in Wirklichkeit 1000. Wenn du 75.2 in einem Skill hast, ist er in Wirklichkeit 752.
Das scheint ein einfaches Konzept zu sein, deshalb gilt es auch fuer alle anderen Bereiche beim Scripten. Jedes mal wenn du eine Zahl wie 55.0 eingibst, entfernt SPHERE das Dezimalzeichen. D.h. unser obiges Beispiel ist eigentlich das selbe wie:
ALCHEMY={550 770}
Ist das nicht fies?
Spätestens wenn es um die Multiplikation von Zahlen geht, wirst du dir dieses Thema wieder in Erinnerung rufen müssen:
4 * 0.5
Sphere übersetzt das mit "4 mal 5" und anders als erwartet wird dein Ergebnis 20 statt 2 sein. Wie du dir sicher denken kannst, kann das massive Probleme verursachen. An dieser Stelle möchte ich erstmal nur auf dieses Problem hinweisen. In späteren Kapiteln werden ich dann zeigen wie man dieses Problem umgehen kann. (Schau dir für weitere Beispiele in denen diese fiesen Dezimalpunkte verwendet werden mal die Resource Table in der sphereregion.scp an.)
NPC=brain_vendor
Ok, so I'm out of order. Deal with it. (Anm. v. Übersetzer: Hat jemand eine Idee wie man das ins deutsche übersetzen soll?) brain=Gehirn, vendor=Verkäufer
Alle NPCs im Spiel werden durch spezielle Intelligenzen kontrolliert welche bestimmen wie sie sich in bestimmten Situationen verhalten. Zum Beispiel ist dieser Alchemist ein "brain_vendor", das heisst er reagiert auf Kommandos wie "buy" oder "sell" indem er ein Verkaufsmenü öffnet. Es bedeutet auch dass er mehr Speicherplatz erhält um zusätzliche Informationen zu den Items die er an- und verkauft zu speichern. (Eigentlich sind es nur zusätzliche Container die zu diesem NPC gespeichert werden, aber mehr dazu später) Hier eine Liste aller verfügbaren Intelligenzen (Ich wette du errätst nie aus welcher Datei ich die habe):
[DEFNAME brains]
BRAIN_NONE 0               // Spieler: Kein Hirn. Passend, was? :)
BRAIN_ANIMAL 1             // Tiere: wander (herumlaufend), attack (attackierend) nur wenn es angegriffen wurde
BRAIN_HUMAN 2              // Mensch: wander (herumlaufend) und speak (sprechend)
BRAIN_HEALER 3             // Heiler: Heilt Geister in seiner Nähe
BRAIN_GUARD 4              // Wache: Attackiert böse Jungs (Spieler/NPCs mit negativem Karma) die du siehst
BRAIN_BANKER 5             // Bänker: Öffnet dir auf Wunsch dein Bankfach
BRAIN_VENDOR 6             // Verkäufer: Kauft und verkauft Sachen
BRAIN_BEGGAR 7             // Bettler: Folgt Spielern und stellt irritierende Fragen.
BRAIN_ANIMAL_TRAINER 8     // Trainer: Kann Tiere verwahren
BRAIN_THIEF 9              // Dieb: Kein Effekt bisher
BRAIN_MONSTER 10           // Böse: Attackiere jeden Spieler den du siehst
BRAIN_BERSERK 11            // Rasend: Attackiere alles was du siehst
BRAIN_UNDEAD 12            // Untot: Das gleiche wie bei Böse. Wird nur zur Unterscheidung verwendet.
BRAIN_DRAGON 13            // Drache: Speiht Feuer(setz das mal auf ein Kaninchen)
BRAIN_VENDOR_OFFDUTY 14    // Keine Ahnung was hier der Unterschied zu BRAIN_VENDOR ist
BRAIN_TOWNCRIER 2          // Gleiche Nummer wie brain_human, gleicher Effekt
brain_beserk brain_berserk // Das gleiche wie brain_berserk, nur um einige Fehler durch Tippfehler zu vermeiden
ITEMNEWBIE=
Erstellt auf dem Char das entsprechende Item mit gesetztem attr_newbie.
ON=@NPCRestock
Ich hab ein zweites mal gelogen! Das ist das zweite Event das du in diesem Script kennen lernst. Dieses Event wird angestoßen wenn Ingame ein "restock" ausgeführt wird. Das passiert alle paar Realtimestunden einmal oder wenn ein Staffler "
.sector.restock
" eingibt. Eingetragen wird hier alles Lootbare und was der NPC kaufen bzw. verkaufen können soll. In den meisten Fällen wird hier wieder einmal nur eine Vorlage (ein Template) eingetragen, du müsstest inzwischen also wissen was du machen musst. Aber ich erkläre es trotzdem nochmal anhand von zwei Zeilen:
SELL=VENDOR_S_ALCHEMIST
BUY=VENDOR_B_ALCHEMIST
Das definiert was ein Vendor kauft und verkauft? Aber woher kommen diese mysteriösen Listen mit den ganzen Items? Das sind natürlich Templates (Vorlagen) aus der Datei
spheretemp_vend.scp
. (Templates für Vendoren. Entwickler sind so kreativ.) Es ist natürlich immer eine gute Idee Dateien nach ihrem Inhalt zu benennen!  :)
--
Die Übersetzung endet hier. Wir wären für weitere Hilfe bei der Übersetzung sehr Dankbar. Hilf mit und Übersetze den nächsten Absatz :)
Mehr Infos wie man Übersetzt findest du auf dieser Seite:
Wiki Übersetzung
--
Price is not defined anywhere on these BUY and SELL lines. Price is defined in a VALUE= line in an individual item script. If an item script does not have a VALUE= line, price is determined by multiplying the value of the resources in that item by the number of resources required. For example, if an item takes 8 iron ingots to make, and each ingot has a VALUE of 8 gold pieces, the entire item is going to be worth 64 gold. By default, things sell for half of the price you can buy them for.
I think that's all you need to know for now about scripting a new NPC. Right now, with your abilities, you can create new vendors, new monsters, and new animals that wander your world. But they don't do anything unique yet. They just behave like stronger or weaker versions of the same monsters. And they're probably pretty colors, too, judging from the recent use of my hues.mul file for colors 077a and 07a1. (I really should release a DEFNAME script for those.)
Now that you know how to make a decent NPC, let's explore ways to make unique items to put on him as loot. In the next section, we're going to make a SUPER DUPER BOW OF FIRE AND BRIMSTONE! *trumpet fanfare*
Advanced Item Scripting
The Super Duper Wand of Fire and Brimstone!
[ITEMDEF i_wand_sdwfb]
NAME=Super Duper Wand of Fire and Brimstone
ID=i_wand_1
TYPE=t_wand
RESOURCES=i_wand,10 i_scroll_flamestrike
ON=@Create
ATTR=attr_magic
MOREX=s_flamestrike
MOREY=50.0
MORE2=10
I tricked you that time! We STARTED with the script. No funny introductions. No livening up the article. Just a script. And a very interesting script it is too. You won't find it in any of your files. (In case you're wondering, SDBFB stands for "Super Duper Wand of Fire and Brimstone").
Now, what does this thing do? Well it's one of those handy predefined types that makes it do what it's supposed to do. Actually, it's not the only thing here that makes it do what it's supposed to do, but we'll see that in a moment!
[ITEMDEF i_wand_sdwfb]
You should be able to tell me what this does by now. We're making a new item with DEFNAME i_wand_sdwfb.
Notice that we don't explicitly declare the DEFNAME, but put it in the ITEMDEF. It's the same thing.
NAME=
Duh.  :)
ID=i_wand_1
Once again, we're inheriting some properties here, including animation, skill type (macefighting oddly enough), etc from the definition of i_wand_1.
TYPE=t_wand
Remember in our NPC script, I said that the different brain types caused the NPCs to act different ways in certain situations. Well, in items, TYPE does the same thing. Only there are more of them. A lot more. Here are the specifications of the "t_wand" type. As you can see, we use all of them in the @Create section. Note: this line wouldn't be necessary since we're getting type=t_wand from the itemdef i_wand_1 too.
MOREX
= the spell this wand will cast
MOREY
= the skill with which the spell will be cast
MORE2
= the number of charges this wand has left
Every item does something different with the MOREs. Actually this is a good time to go through the variables available to you on an item. In a simple list:
MORE1 (or MORE)
MORE2
MOREP
COLOR
TYPE
CREATE
LAYER
ATTR
LINK
CONT
TOPOBJ
LINK
As we'll see, a few of these have special functions that will allow us to do a lot more. But that doesn't come until advanced scripting. And there are also a lot more things which you'll know in future chapters.
One of these properties (MOREP) has the weirdness that it can hold a coordinate of the form (x, y, z, m). Which means that it can be broken down into MOREX, MOREY, MOREZ, and MOREM. For example, if you write this line:
MOREP=1,2,3,4
It is exactly the same as writing:
MOREX=1
MOREY=2
MOREZ=3
MOREM=4
This is what you call in C++ programming a "union", basically meaning there are going to be restrictions on the amount of data you can store in each of these variables. MOREX and MOREY can both hold numbers up to 0FFFF. MOREZ can hold numbers from -128 to 127, and is always displayed in decimal. MOREM can hold numbers from 0 to 255, and is also always displayed in decimal.
Be sure that when you're writing a script, or an item, you don't use both MOREP and one of the other MOREP pieces (MOREX, etc). It won't work together, since one will overwrite the other.
MOREP=10,42,51,53
MOREX=78
MOREY=89
MOREM=56
MOREP now is equal to 78,89,51,56.
So you see, it doesn't work to use these together.
Another strangeness of SPHERE is that they have given us the properties MORE1L, MORE1H, MORE2L, and MORE2H. These are not entirely visible to you, but just know that they are pieces of the MORE1 and MORE2 properties. As such, you should not be using both MORE1 and either of the MORE1 properties, or the same for the MORE2 properties, on a single item.
MORE1=0FFFFFFFF
MORE1L=01234
MORE1H=0F0
Now MORE1 is 000F01234. Which would totally screw up any script you were writing involving the MORE1 property. So don't use both in the same script. (If you don't understand where that number came from, don't worry about it. I've never used MORE1L and MORE1H in a script, and chances are neither will you.)
We'll also see later how to use the ATTR property to give your item special properties (like being unmovable, or magical, or blessed). I'll put that in my massive chart that's going in the next section, which lists all the TYPEs and all of the ATTR values.
From what I've just explained to you, the rest of the item script, after the @Create event, should be obvious. We're setting the pieces of MOREP to be what we need them to be so our wand functions properly. And if you create this item in the game, and double-click it, you'll get a target to cast Flamestrike. That's all you need to do.
By the way, you could just as easily have written:
MOREP=s_flamestrike,50.0
MORE2L=10
Think about it.  :)
(Anyone know why the developers decided to have 10 variables named MORE? Standing for "MORE information about an item" perhaps?)
Understanding the @Create trigger
You're probably wandering why I didn't set the item properties (such as the mores) directly on the itemdef, that's because not everything can be set there, only general properties for the items with that id.
"But hey, I can set different names for an item with the same id"
Yes you can, but mostly you won't, another thing that can be set there but you can also change are TAGs (you'll see more on other chapters).
Things that you can't change for example are WEIGHT, VALUE, RESOURCES and of course the DEFNAME. There are more, but just to make you get the idea.
TYPEs
This section explains how you can use
built-in item types
, how to override the built-in types, and how you can make your own.
If you want to override a built-in typedef, that is indeed possible, just define its new behavior it in a script and since the scripts are loaded after the server starts, your new definition will take precedence.
A TYPEDEF is essentially a collection of triggers, and can be written to reference other aspects of the ITEMDEF, CHARDEF, or REGION that it is assigned to.  To assign a TYPEDEF to an item, you can simply set TYPE=t_mytype in the ITEMDEF (Note: An item can only have one TYPE.)
Here is an example TYPEDEF:
[TYPEDEF t_horseshoes]
ON=@DClick
   TARGET What animal needs this item?
   RETURN 1
ON=@Targon_Char
   IF (<SRC.TARG.DEX> > 100)
      SRC.SYSMESSAGE @032 That animal does not need this item.
      RETURN 1
   ENDIF
   IF (<SRC.TARG.OBODY>==(c_horse_pack|c_llama_pack|c_horse_gray|c_horse_brown_dk|c_horse_brown_lt|c_llama))
      SRC.SYSMESSAGE @032 Now the animal is faster.
      SRC.TARG.MODDEX += <MORE1>
      SRC.EFFECT=3,0374a,6,15,1
      REMOVE
   ELSE
      SRC.SYSMESSAGE @032 That animal can not wear this item.
   ENDIF
   RETURN 1
Here is an example item that uses the t_horseshoes TYPEDEF shown above:
[ITEMDEF i_horse_shoes_magic]
ID=0fb6
NAME=magic horseshoes
TYPE=t_horseshoes
VALUE=35
WEIGHT=8.0
RESOURCES=8 i_ingot_iron
SKILLMAKE=Blacksmithing 30.0
CATEGORY=Items by Professions
SUBSECTION=Blacksmiths
DESCRIPTION=Magic Horse Shoes
ON=@Create
   MORE1={10 15}
   ATTR=attr_magic
ATTRs
This is a list of the ATTR flags available and what they do. I pulled it right out of
spheredefs.scp
Value
DEFNAME
Description
01
attr_identified
Someone has used the Item ID skill on this item so it will display the full magic name "+7 Sword of Ruin of Flamestrike".
02
attr_decay
The item will decay when the internal decay timer, or the item's TIMER reaches zero.
04
attr_newbie
The item will not be placed in a corpse upon death.
08
attr_move_always
Anyone can pick this up, even if they shouldn't be able to normally. The item will not decay unless the decay flag is also set.
010
attr_move_never
Locked down. Probably the one you'll use most often. It will never decay, even if the decay flag is set.
020
attr_magic
This item has been enchanted
040
attr_owned
This is owned by the town, and trying to pick it up will count as stealing. You will be flagged criminal if you try to use the Stealing skill on this item. It will never decay.
080
attr_invis
Invisible to non-GM clients
0100
attr_cursed
Cursed item, casts curse on the wearer while it's equipped
0200
attr_cursed2
I have no idea what the difference is.. strength maybe?
0400
attr_blessed
Casts bless on the person who is equipping it (stat gain)
0800
attr_blessed2
?
01000
attr_forsale
In a vendor's sell-box or buy-box.
02000
attr_stolen
This item has been stolen (from the town probably)
04000
attr_can_decay
I think this is used to get rid of those irritating errors "TIMER has expired without decay flag".
08000
attr_static
Makes it so an item doesn't highlight when a player passes the mouse over it. (Items will still highlight for GMs no matter what.)
You can, of course, have multiple ATTRs on a single item like this:
ATTR=attr_magic|attr_decay|attr_move_never
If you have a @Timer script on an item, you must have an attr_decay on that item.  Otherwise you will get scary errors.  You can always RETURN 1 from the @Timer script to prevent decay, but the flag must still be there.
Cool Commands
Or, how to make a huge number of NPCs die at once
There are a few often overlooked commands in the SPHERE scripting language, and the in-game command set. These are:
.nuke
.nukechar
.region.sectors restock
You may not understand the format of the last command yet, but I will tell you how to use it anyway.
One thing that make SPHERE scripters do not realize is that the
.nuke
and
.nukechar
commands can take parameters, and that those parameters will be applied to any items within the targetted area.
Type
.nuke
and target a box. All the items disappear.
Now type
.nuke color 02
and target a box. All the items in the box turn blue.
.nuke dupe
is an interesting command that creates a duplicate of any item in the box.
.nukechar
works the same way:
.nukechar kill
will kill any NPC you target inside of the box.
Note:
BOX can mean the world too, but if you target the ground it'll ask for a second targetting and will peform the actions in all chars/items in the area you selected)
Now, after you have spawned your world, if you make massive changes to your Vendor files, the changes WILL NOT take effect on already-spawned NPCs. And I'm sure you don't want to go around the world resetting every single vendor. But there's an easier way. Do these two commands in order:
.go 11 11 .region.sectors restock
or just
.region.restock
(since from 56b region.X will automatically access all the sectors of this region too)
Magically, all your Vendors will be restocked!
NOTE TO VETERANS:
NEVER, EVER TYPE
.region.restock all
!!! It will freeze the server!
Extra:
If you want to respawn all of your npcs across all maps you need to create a function to do that, here's an example:
[FUNCTION redospawns]
GO 1,1
FOR 0 4 //make loop through all 5 maps
MAP = <LOCAL._FOR> //set the map
FORCHARS 8000 //loop through all chars in the world (unless EA makes a map bigger than 8000x8000 squares)
REF1 = <MEMORYFINDTYPE.memory_ispawned.LINK> //set REF1 to the spawngem of that npc
IF (<REF1>) //checks if the npc has the spawn memory
REF1.TIMER = <EVAL {<REF1.MOREX> <REF1.MOREY>} * 60> //set the spawn memory timer to the values specified when creating it
ENDIF
ENDFOR
ENDFOR

--- PAGE BREAK ---

Help
Available languages
Missing languages
Contents
1
HowTo für Wiki-Übersetzung
2
Link übersetzen
2.1
Link im Fließtext
2.2
Link in Liste/Tabelle
3
Sprach-Menü "Languages-Template"
3.1
Kurzanleitung
3.2
Seiten mit Titeln in Landessprache
3.3
Interface-Wahl
HowTo für Wiki-Übersetzung
Übersetze alle Seiten, die von neuen Sphere Usern gebraucht werden: Einführung, Übersicht, HowTo, etc., und
alle Seiten die häufig gelesen werden
:
Wenn im Artikel das Sprachmenü nicht angezeigt wird
Öffne den Artikel zum
Bearbeiten
und füge ganz oben folgende Zeile ein:
{{Languages|Page_name}}
Speichere den Artikel
wenn im Artikel das Sprachmenü angezeigt wird
Öffne den zu übersetzenden Artikel zum
Bearbeiten
,
kopiere den gesamten Inhalt mit <Strg-A> und <Strg-C>
und schließe den Modus
Bearbeiten
mit "Abbrechen".
Klicke im Sprachmenü auf den entsprechenden roten Link ("Deutsch" oder "English").
Dadurch öffnet sich der anzulegende Artikel im Modus
Bearbeiten
.
Füge den kopierten zu übersetzenden Inhalt mit <Strg-V> in das Bearbeitungsfenster ein.
Übersetze nun Satz für Satz. Übersetze den Inhalt sinngemäß (nicht wörtlich). Nutze gleich die Gelegenheit, den Text zu verbessern, zu erweitern, zu vertiefen.
Siehe auch:
Sprach-Menü "Languages-Template"
Hinweis: Vor dem ersten Speichern der neuen Seite wird in der Vorschau der Sprach-Link im Sprach-Menü noch als fehlende Sprache rot dargestellt. Auch nach dem Speichern wird die Sprache immer noch im Bereich 'missing language' aufgeführt - jetzt aber mit blauer Farbe. Dieses seltsame Verhalten wird durch einen Template-Cache verursacht. Loesche den Cache (
Purge cache
), um die verfügbaren Sprachen neu zu laden. Die neue Sprache ist dann unter "available languages"  verfügbar (und steht nicht mehr unter "missing languages").
Link übersetzen
Verlinke, wenn irgend möglich, ausschließlich deutschsprachige Seiten. Es ist für den Benutzer ärgerlich, wenn er über einen Link auf einer Seite landet, die in einer Sprache geschrieben ist, die er nicht versteht.
Link im Fließtext
Setze die Links im Text immer nach dem Muster:
[[de:Seitentitel|passender Text in deutscher Sprache]]
Link in Liste/Tabelle
In Listen und Tabellen verweisen Links meist zu unter- oder übergeordneten Seiten zu denen es jeweils einen eigenen Artikel gibt.
Setze die Links nach dem Muster:
[[de:Seitentitel|Seitentitel]]
Wenn die Seite noch nicht in deutscher Sprache existiert, aber in einer anderen Sprache schon ein informativer Artikel vorliegt, dann schreibe den Link nach folgendem Muster:
[[de:Seitentitel|Seitentitel]] ([[Seitentitel|Fremdsprache]])
Beispiel:
Translation
(
englisch
)
Dadurch wird der Link der noch nicht übersetzten Seite rot, und der Leser sieht sofort, dass da noch Übersetzung gebraucht wird. Mit Klick auf den roten Link landet er sofort auf der anzulegenden Seite direkt im Editor-Fenster, und kann gleich mit Übersetzen beginnen.
Und der englischsprechende Leser findet den fremdsprachigen Text eindeutig gekennzeichnet.
Sprach-Menü "Languages-Template"
Diese
Vorlage erzeugt ein Menü aller verfügbaren Übersetzungen einer Wiki-Seite. Sie basiert auf einer
Parser Funktion
von Mediawiki und dem
Sprachcode ISO 639-1
.
Kurzanleitung
Alle Seiten haben einen englischen Dateinamen.
Jede übersetzte Seite beginnt mit einem Sprachkürzel als Suffix, gefolgt von einem Doppelpunkt und dem englischen Dateinamen.
Die englische Seite hat kein Präfix im Dateinamen.
Beispiel:
Page_name - fr:Page_name - de:Page_name
Schreibe in jeder Seite in die erste Zeile:
{{Languages|Page_name}}
Klicke auf 'Missing Languages' und dort auf einen roten Link. Dadurch öffnet sich automatisch eine neue Seite mit dem richtigen Suffix und Seitennamen. Kopiere die Originalseite hierher und übersetze den Text. Schreibe in die erste Zeile {{Languages|Page_name}}.
Beispiel für aktuell eingerichtete Namensräume und Sprachen (2009-6):
Page_name
de:Page_name
fr:Page_name 
es:Page_name
it:Page_name 
nl:Page_name
Hierdurch wird automatisch ein Sprachmenü erzeugt. Darin sind automatisch die Original-Seite und alle übersetzten Seiten als Link aufgeführt. Die Links sind in Landessprache und heißen Deutsch, English, Français, etc.
Seiten mit Titeln in Landessprache
Landessprachliche oder sonstwie anderslautende Dateinamen können das automatische Menü mit einem Redirect erzeugen:
in
XX:Page_name
steht:
#REDIRECT [[Page_name]]
in
de:übersetzter Titel von "Page_name"
muss im Template der englischsprachige Titel als Parameter hinzugefügt werden. Dort steht dann:
{{Languages|Page_name}}
... und natürlich der Artikeltext.
Interface-Wahl
Wenn du die Darstellung des Menüs ändern möchtest, übersetze Texte oder verändere das Link-Ziel des
help
-Knopfs. Dies kannst du durch Hinzufügen des zweiten Parameters deines Design-Templates erreichen.
{{Languages|Chapter_1|Fi:Languages/Interface}}
Kopiere
Template:Languages/Interface
als deine erste Version des Templates.
Bemerkung
: Technisch gesehen kannst Du ein übersetztes Interface wie oben erstellen, aber dies wird nicht empfohlen. Siehe auch
diese Diskussionsseite
.